

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyk.kast.outer &mdash; pyk 7.1.313 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=9c1be6d9"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pyk
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">pyk</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyk.kast.outer</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyk.kast.outer</h1><div class="highlight"><pre>
<span></span><span class="linenos">   1</span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">   2</span>
<span class="linenos">   3</span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="linenos">   4</span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="linenos">   5</span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="linenos">   6</span><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="linenos">   7</span><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="linenos">   8</span><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>
<span class="linenos">   9</span><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">InitVar</span>  <span class="c1"># noqa: TC003</span>
<span class="linenos">  10</span><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="linenos">  11</span><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="linenos">  12</span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cached_property</span><span class="p">,</span> <span class="n">reduce</span>
<span class="linenos">  13</span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise</span><span class="p">,</span> <span class="n">product</span>
<span class="linenos">  14</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">overload</span>
<span class="linenos">  15</span>
<span class="linenos">  16</span><span class="kn">from</span><span class="w"> </span><span class="nn">..utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">FrozenDict</span><span class="p">,</span> <span class="n">POSet</span><span class="p">,</span> <span class="n">filter_none</span><span class="p">,</span> <span class="n">not_none</span><span class="p">,</span> <span class="n">single</span><span class="p">,</span> <span class="n">unique</span>
<span class="linenos">  17</span><span class="kn">from</span><span class="w"> </span><span class="nn">.att</span><span class="w"> </span><span class="kn">import</span> <span class="n">EMPTY_ATT</span><span class="p">,</span> <span class="n">Atts</span><span class="p">,</span> <span class="n">Format</span><span class="p">,</span> <span class="n">KAst</span><span class="p">,</span> <span class="n">KAtt</span><span class="p">,</span> <span class="n">WithKAtt</span>
<span class="linenos">  18</span><span class="kn">from</span><span class="w"> </span><span class="nn">.inner</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="linenos">  19</span>    <span class="n">KApply</span><span class="p">,</span>
<span class="linenos">  20</span>    <span class="n">KInner</span><span class="p">,</span>
<span class="linenos">  21</span>    <span class="n">KLabel</span><span class="p">,</span>
<span class="linenos">  22</span>    <span class="n">KRewrite</span><span class="p">,</span>
<span class="linenos">  23</span>    <span class="n">KSequence</span><span class="p">,</span>
<span class="linenos">  24</span>    <span class="n">KSort</span><span class="p">,</span>
<span class="linenos">  25</span>    <span class="n">KToken</span><span class="p">,</span>
<span class="linenos">  26</span>    <span class="n">KVariable</span><span class="p">,</span>
<span class="linenos">  27</span>    <span class="n">Subst</span><span class="p">,</span>
<span class="linenos">  28</span>    <span class="n">bottom_up</span><span class="p">,</span>
<span class="linenos">  29</span>    <span class="n">bottom_up_with_summary</span><span class="p">,</span>
<span class="linenos">  30</span>    <span class="n">top_down</span><span class="p">,</span>
<span class="linenos">  31</span><span class="p">)</span>
<span class="linenos">  32</span><span class="kn">from</span><span class="w"> </span><span class="nn">.kast</span><span class="w"> </span><span class="kn">import</span> <span class="n">kast_term</span>
<span class="linenos">  33</span><span class="kn">from</span><span class="w"> </span><span class="nn">.prelude.k</span><span class="w"> </span><span class="kn">import</span> <span class="n">K_ITEM</span><span class="p">,</span> <span class="n">K</span>
<span class="linenos">  34</span><span class="kn">from</span><span class="w"> </span><span class="nn">.rewrite</span><span class="w"> </span><span class="kn">import</span> <span class="n">indexed_rewrite</span>
<span class="linenos">  35</span>
<span class="linenos">  36</span><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
<span class="linenos">  37</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Mapping</span>
<span class="linenos">  38</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">os</span><span class="w"> </span><span class="kn">import</span> <span class="n">PathLike</span>
<span class="linenos">  39</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Final</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="linenos">  40</span>
<span class="linenos">  41</span>    <span class="n">S</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;KSentence&#39;</span><span class="p">)</span>
<span class="linenos">  42</span>    <span class="n">RL</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;RL&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;KRuleLike&#39;</span><span class="p">)</span>
<span class="linenos">  43</span>
<span class="linenos">  44</span><span class="n">_LOGGER</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="linenos">  45</span>
<span class="linenos">  46</span>
<span class="linenos">  47</span><span class="n">_BOOL</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="n">KSort</span><span class="p">(</span><span class="s1">&#39;Bool&#39;</span><span class="p">)</span>
<span class="linenos">  48</span><span class="n">_TRUE</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="n">KToken</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">_BOOL</span><span class="p">)</span>
<span class="linenos">  49</span>
<span class="linenos">  50</span>
<div class="viewcode-block" id="KOuter">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KOuter">[docs]</a>
<span class="linenos">  51</span><span class="k">class</span><span class="w"> </span><span class="nc">KOuter</span><span class="p">(</span><span class="n">KAst</span><span class="p">):</span>
<span class="linenos">  52</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents K definitions in KAST format.</span>
<span class="linenos">  53</span>
<span class="linenos">  54</span><span class="sd">    Outer syntax is K specific datastructures, including modules, definitions, imports, user-syntax declarations, rules, contexts, and claims.</span>
<span class="linenos">  55</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">  56</span>
<span class="linenos">  57</span>    <span class="o">...</span></div>

<span class="linenos">  58</span>
<span class="linenos">  59</span>
<div class="viewcode-block" id="KProductionItem">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KProductionItem">[docs]</a>
<span class="linenos">  60</span><span class="k">class</span><span class="w"> </span><span class="nc">KProductionItem</span><span class="p">(</span><span class="n">KOuter</span><span class="p">):</span>
<span class="linenos">  61</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents the elements used to declare components of productions in EBNF style.&quot;&quot;&quot;</span>
<span class="linenos">  62</span>
<span class="linenos">  63</span>    <span class="n">_NODES</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;KTerminal&#39;</span><span class="p">,</span> <span class="s1">&#39;KRegexTerminal&#39;</span><span class="p">,</span> <span class="s1">&#39;KNonTerminal&#39;</span><span class="p">}</span>
<span class="linenos">  64</span>
<div class="viewcode-block" id="KProductionItem.from_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KProductionItem.from_dict">[docs]</a>
<span class="linenos">  65</span>    <span class="nd">@staticmethod</span>
<span class="linenos">  66</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KProductionItem</span><span class="p">:</span>
<span class="linenos">  67</span>        <span class="n">node</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>
<span class="linenos">  68</span>        <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">KProductionItem</span><span class="o">.</span><span class="n">_NODES</span><span class="p">:</span>
<span class="linenos">  69</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid KProductionItem node: </span><span class="si">{</span><span class="n">node</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">  70</span>        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos">  71</span>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>
</div>

<span class="linenos">  72</span>
<span class="linenos">  73</span>
<div class="viewcode-block" id="KRegexTerminal">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRegexTerminal">[docs]</a>
<span class="linenos">  74</span><span class="nd">@final</span>
<span class="linenos">  75</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">  76</span><span class="k">class</span><span class="w"> </span><span class="nc">KRegexTerminal</span><span class="p">(</span><span class="n">KProductionItem</span><span class="p">):</span>
<span class="linenos">  77</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a regular-expression terminal in EBNF production, to be matched against input text.&quot;&quot;&quot;</span>
<span class="linenos">  78</span>
<span class="linenos">  79</span>    <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos">  80</span>
<span class="linenos">  81</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="linenos">  82</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;regex&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>
<span class="linenos">  83</span>
<span class="linenos">  84</span>    <span class="nd">@classmethod</span>
<span class="linenos">  85</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KRegexTerminal</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KRegexTerminal</span><span class="p">:</span>
<span class="linenos">  86</span>        <span class="k">return</span> <span class="n">KRegexTerminal</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;regex&#39;</span><span class="p">])</span>
<span class="linenos">  87</span>
<div class="viewcode-block" id="KRegexTerminal.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRegexTerminal.to_dict">[docs]</a>
<span class="linenos">  88</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos">  89</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos">  90</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KRegexTerminal&#39;</span><span class="p">,</span>
<span class="linenos">  91</span>            <span class="s1">&#39;regex&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="p">,</span>
<span class="linenos">  92</span>        <span class="p">}</span></div>

<span class="linenos">  93</span>
<div class="viewcode-block" id="KRegexTerminal.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRegexTerminal.let">[docs]</a>
<span class="linenos">  94</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KRegexTerminal</span><span class="p">:</span>
<span class="linenos">  95</span>        <span class="n">regex</span> <span class="o">=</span> <span class="n">regex</span> <span class="k">if</span> <span class="n">regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span>
<span class="linenos">  96</span>        <span class="k">return</span> <span class="n">KRegexTerminal</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">)</span></div>
</div>

<span class="linenos">  97</span>
<span class="linenos">  98</span>
<div class="viewcode-block" id="KNonTerminal">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KNonTerminal">[docs]</a>
<span class="linenos">  99</span><span class="nd">@final</span>
<span class="linenos"> 100</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 101</span><span class="k">class</span><span class="w"> </span><span class="nc">KNonTerminal</span><span class="p">(</span><span class="n">KProductionItem</span><span class="p">):</span>
<span class="linenos"> 102</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a non-terminal of a given sort in EBNF productions, for defining arguments to to production.&quot;&quot;&quot;</span>
<span class="linenos"> 103</span>
<span class="linenos"> 104</span>    <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span>
<span class="linenos"> 105</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
<span class="linenos"> 106</span>
<span class="linenos"> 107</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="linenos"> 108</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span>
<span class="linenos"> 109</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="linenos"> 110</span>
<span class="linenos"> 111</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 112</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KNonTerminal</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KNonTerminal</span><span class="p">:</span>
<span class="linenos"> 113</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos"> 114</span>        <span class="k">return</span> <span class="n">KNonTerminal</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">KSort</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<span class="linenos"> 115</span>
<div class="viewcode-block" id="KNonTerminal.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KNonTerminal.to_dict">[docs]</a>
<span class="linenos"> 116</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 117</span>        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KNonTerminal&#39;</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()}</span>
<span class="linenos"> 118</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 119</span>            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
<span class="linenos"> 120</span>        <span class="k">return</span> <span class="n">d</span></div>

<span class="linenos"> 121</span>
<div class="viewcode-block" id="KNonTerminal.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KNonTerminal.let">[docs]</a>
<span class="linenos"> 122</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KNonTerminal</span><span class="p">:</span>
<span class="linenos"> 123</span>        <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span>
<span class="linenos"> 124</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
<span class="linenos"> 125</span>        <span class="k">return</span> <span class="n">KNonTerminal</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>
</div>

<span class="linenos"> 126</span>
<span class="linenos"> 127</span>
<div class="viewcode-block" id="KTerminal">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KTerminal">[docs]</a>
<span class="linenos"> 128</span><span class="nd">@final</span>
<span class="linenos"> 129</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 130</span><span class="k">class</span><span class="w"> </span><span class="nc">KTerminal</span><span class="p">(</span><span class="n">KProductionItem</span><span class="p">):</span>
<span class="linenos"> 131</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a string literal component of a production in EBNF grammar.&quot;&quot;&quot;</span>
<span class="linenos"> 132</span>
<span class="linenos"> 133</span>    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 134</span>
<span class="linenos"> 135</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="linenos"> 136</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="linenos"> 137</span>
<span class="linenos"> 138</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 139</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KTerminal</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KTerminal</span><span class="p">:</span>
<span class="linenos"> 140</span>        <span class="k">return</span> <span class="n">KTerminal</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
<span class="linenos"> 141</span>
<div class="viewcode-block" id="KTerminal.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KTerminal.to_dict">[docs]</a>
<span class="linenos"> 142</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 143</span>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KTerminal&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">}</span></div>

<span class="linenos"> 144</span>
<div class="viewcode-block" id="KTerminal.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KTerminal.let">[docs]</a>
<span class="linenos"> 145</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KTerminal</span><span class="p">:</span>
<span class="linenos"> 146</span>        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 147</span>        <span class="k">return</span> <span class="n">KTerminal</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>
</div>

<span class="linenos"> 148</span>
<span class="linenos"> 149</span>
<div class="viewcode-block" id="KSentence">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSentence">[docs]</a>
<span class="linenos"> 150</span><span class="k">class</span><span class="w"> </span><span class="nc">KSentence</span><span class="p">(</span><span class="n">KOuter</span><span class="p">,</span> <span class="n">WithKAtt</span><span class="p">):</span>
<span class="linenos"> 151</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an individual declaration in a K module.&quot;&quot;&quot;</span>
<span class="linenos"> 152</span>
<span class="linenos"> 153</span>    <span class="n">_NODES</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 154</span>        <span class="s1">&#39;KProduction&#39;</span><span class="p">,</span>
<span class="linenos"> 155</span>        <span class="s1">&#39;KSyntaxSort&#39;</span><span class="p">,</span>
<span class="linenos"> 156</span>        <span class="s1">&#39;KSortSynonym&#39;</span><span class="p">,</span>
<span class="linenos"> 157</span>        <span class="s1">&#39;KSyntaxLexical&#39;</span><span class="p">,</span>
<span class="linenos"> 158</span>        <span class="s1">&#39;KSyntaxAssociativity&#39;</span><span class="p">,</span>
<span class="linenos"> 159</span>        <span class="s1">&#39;KSyntaxPriority&#39;</span><span class="p">,</span>
<span class="linenos"> 160</span>        <span class="s1">&#39;KBubble&#39;</span><span class="p">,</span>
<span class="linenos"> 161</span>        <span class="s1">&#39;KRule&#39;</span><span class="p">,</span>
<span class="linenos"> 162</span>        <span class="s1">&#39;KClaim&#39;</span><span class="p">,</span>
<span class="linenos"> 163</span>        <span class="s1">&#39;KContext&#39;</span><span class="p">,</span>
<span class="linenos"> 164</span>    <span class="p">}</span>
<span class="linenos"> 165</span>
<div class="viewcode-block" id="KSentence.from_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSentence.from_dict">[docs]</a>
<span class="linenos"> 166</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 167</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KSentence</span><span class="p">:</span>
<span class="linenos"> 168</span>        <span class="n">node</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>
<span class="linenos"> 169</span>        <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">KSentence</span><span class="o">.</span><span class="n">_NODES</span><span class="p">:</span>
<span class="linenos"> 170</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid KSentence node: </span><span class="si">{</span><span class="n">node</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 171</span>        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 172</span>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>

<span class="linenos"> 173</span>
<span class="linenos"> 174</span>    <span class="nd">@property</span>
<span class="linenos"> 175</span>    <span class="k">def</span><span class="w"> </span><span class="nf">unique_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 176</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the unique ID assigned to this sentence, or None.&quot;&quot;&quot;</span>
<span class="linenos"> 177</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Atts</span><span class="o">.</span><span class="n">UNIQUE_ID</span><span class="p">)</span>
<span class="linenos"> 178</span>
<span class="linenos"> 179</span>    <span class="nd">@property</span>
<span class="linenos"> 180</span>    <span class="k">def</span><span class="w"> </span><span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 181</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the source assigned to this sentence, or None.&quot;&quot;&quot;</span>
<span class="linenos"> 182</span>        <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">SOURCE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="ow">and</span> <span class="n">Atts</span><span class="o">.</span><span class="n">LOCATION</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="p">:</span>
<span class="linenos"> 183</span>            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">SOURCE</span><span class="p">]</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">LOCATION</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos"> 184</span>        <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 185</span>
<span class="linenos"> 186</span>    <span class="nd">@property</span>
<span class="linenos"> 187</span>    <span class="k">def</span><span class="w"> </span><span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 188</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a (hopefully) unique label associated with the given `KSentence`.</span>
<span class="linenos"> 189</span>
<span class="linenos"> 190</span><span class="sd">        :return: Unique label for the given sentence, either (in order):</span>
<span class="linenos"> 191</span><span class="sd">          - User supplied `label` attribute (or supplied in rule label),or</span>
<span class="linenos"> 192</span><span class="sd">          - Unique identifier computed and inserted by the frontend.</span>
<span class="linenos"> 193</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 194</span>        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Atts</span><span class="o">.</span><span class="n">LABEL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_id</span><span class="p">)</span>
<span class="linenos"> 195</span>        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 196</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found sentence without label or UNIQUE_ID: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 197</span>        <span class="k">return</span> <span class="n">label</span></div>

<span class="linenos"> 198</span>
<span class="linenos"> 199</span>
<div class="viewcode-block" id="KProduction">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KProduction">[docs]</a>
<span class="linenos"> 200</span><span class="nd">@final</span>
<span class="linenos"> 201</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 202</span><span class="k">class</span><span class="w"> </span><span class="nc">KProduction</span><span class="p">(</span><span class="n">KSentence</span><span class="p">):</span>
<span class="linenos"> 203</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a production in K&#39;s EBNF grammar definitions, as a sequence of ProductionItem.&quot;&quot;&quot;</span>
<span class="linenos"> 204</span>
<span class="linenos"> 205</span>    <span class="c1"># TODO Order in Java implementation: klabel, params, sort, items, att</span>
<span class="linenos"> 206</span>    <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span>
<span class="linenos"> 207</span>    <span class="n">items</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProductionItem</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos"> 208</span>    <span class="n">params</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos"> 209</span>    <span class="n">klabel</span><span class="p">:</span> <span class="n">KLabel</span> <span class="o">|</span> <span class="kc">None</span>
<span class="linenos"> 210</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 211</span>
<span class="linenos"> 212</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span class="linenos"> 213</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 214</span>        <span class="n">sort</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">KSort</span><span class="p">,</span>
<span class="linenos"> 215</span>        <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KProductionItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
<span class="linenos"> 216</span>        <span class="n">params</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">KSort</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
<span class="linenos"> 217</span>        <span class="n">klabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">KLabel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 218</span>        <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 219</span>    <span class="p">):</span>
<span class="linenos"> 220</span>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 221</span>            <span class="n">sort</span> <span class="o">=</span> <span class="n">KSort</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
<span class="linenos"> 222</span>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">klabel</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 223</span>            <span class="n">klabel</span> <span class="o">=</span> <span class="n">KLabel</span><span class="p">(</span><span class="n">klabel</span><span class="p">)</span>
<span class="linenos"> 224</span>
<span class="linenos"> 225</span>        <span class="n">params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">KSort</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">)</span>
<span class="linenos"> 226</span>
<span class="linenos"> 227</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span>
<span class="linenos"> 228</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
<span class="linenos"> 229</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="linenos"> 230</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;klabel&#39;</span><span class="p">,</span> <span class="n">klabel</span><span class="p">)</span>
<span class="linenos"> 231</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 232</span>
<span class="linenos"> 233</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 234</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KProduction</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KProduction</span><span class="p">:</span>
<span class="linenos"> 235</span>        <span class="k">return</span> <span class="n">KProduction</span><span class="p">(</span>
<span class="linenos"> 236</span>            <span class="n">sort</span><span class="o">=</span><span class="n">KSort</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]),</span>
<span class="linenos"> 237</span>            <span class="n">items</span><span class="o">=</span><span class="p">(</span><span class="n">KProductionItem</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;productionItems&#39;</span><span class="p">]),</span>
<span class="linenos"> 238</span>            <span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">KSort</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]),</span>
<span class="linenos"> 239</span>            <span class="n">klabel</span><span class="o">=</span><span class="n">KLabel</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;klabel&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;klabel&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 240</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 241</span>        <span class="p">)</span>
<span class="linenos"> 242</span>
<div class="viewcode-block" id="KProduction.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KProduction.to_dict">[docs]</a>
<span class="linenos"> 243</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 244</span>        <span class="k">return</span> <span class="n">filter_none</span><span class="p">(</span>
<span class="linenos"> 245</span>            <span class="p">{</span>
<span class="linenos"> 246</span>                <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KProduction&#39;</span><span class="p">,</span>
<span class="linenos"> 247</span>                <span class="s1">&#39;sort&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 248</span>                <span class="s1">&#39;productionItems&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">],</span>
<span class="linenos"> 249</span>                <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">],</span>
<span class="linenos"> 250</span>                <span class="s1">&#39;klabel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">klabel</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">klabel</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 251</span>                <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 252</span>            <span class="p">}</span>
<span class="linenos"> 253</span>        <span class="p">)</span></div>

<span class="linenos"> 254</span>
<div class="viewcode-block" id="KProduction.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KProduction.let">[docs]</a>
<span class="linenos"> 255</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span>
<span class="linenos"> 256</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 257</span>        <span class="o">*</span><span class="p">,</span>
<span class="linenos"> 258</span>        <span class="n">sort</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">KSort</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 259</span>        <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KProductionItem</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 260</span>        <span class="n">params</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">KSort</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 261</span>        <span class="n">klabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">KLabel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 262</span>        <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 263</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KProduction</span><span class="p">:</span>
<span class="linenos"> 264</span>        <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span> <span class="k">if</span> <span class="n">sort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span>
<span class="linenos"> 265</span>        <span class="n">items</span> <span class="o">=</span> <span class="n">items</span> <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
<span class="linenos"> 266</span>        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
<span class="linenos"> 267</span>        <span class="n">klabel</span> <span class="o">=</span> <span class="n">klabel</span> <span class="k">if</span> <span class="n">klabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">klabel</span>  <span class="c1"># TODO figure out a way to set klabel to None</span>
<span class="linenos"> 268</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 269</span>        <span class="k">return</span> <span class="n">KProduction</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">klabel</span><span class="o">=</span><span class="n">klabel</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 270</span>
<div class="viewcode-block" id="KProduction.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KProduction.let_att">[docs]</a>
<span class="linenos"> 271</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KProduction</span><span class="p">:</span>
<span class="linenos"> 272</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 273</span>
<span class="linenos"> 274</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 275</span>    <span class="k">def</span><span class="w"> </span><span class="nf">as_subsort</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="n">KSort</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 276</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a pair `(supersort, subsort)` if `self` is a subsort production, and `None` otherwise.&quot;&quot;&quot;</span>
<span class="linenos"> 277</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">klabel</span><span class="p">:</span>
<span class="linenos"> 278</span>            <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 279</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 280</span>            <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 281</span>        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 282</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">KNonTerminal</span><span class="p">):</span>
<span class="linenos"> 283</span>            <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 284</span>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">klabel</span>
<span class="linenos"> 285</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">sort</span>
<span class="linenos"> 286</span>
<span class="linenos"> 287</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 288</span>    <span class="k">def</span><span class="w"> </span><span class="nf">non_terminals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KNonTerminal</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 289</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the non-terminals of the production.&quot;&quot;&quot;</span>
<span class="linenos"> 290</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">KNonTerminal</span><span class="p">))</span>
<span class="linenos"> 291</span>
<span class="linenos"> 292</span>    <span class="nd">@property</span>
<span class="linenos"> 293</span>    <span class="k">def</span><span class="w"> </span><span class="nf">argument_sorts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">KSort</span><span class="p">]:</span>
<span class="linenos"> 294</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the sorts of the non-terminal positions of the productions.&quot;&quot;&quot;</span>
<span class="linenos"> 295</span>        <span class="k">return</span> <span class="p">[</span><span class="n">knt</span><span class="o">.</span><span class="n">sort</span> <span class="k">for</span> <span class="n">knt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_terminals</span><span class="p">]</span>
<span class="linenos"> 296</span>
<span class="linenos"> 297</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 298</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 299</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;The production is of the form ``t* &quot;(&quot; (n (&quot;,&quot; n)*)? &quot;)&quot;``.</span>
<span class="linenos"> 300</span>
<span class="linenos"> 301</span><span class="sd">        Here, ``t`` is a terminal other than ``&quot;(&quot;``, ``&quot;,&quot;`` or ``&quot;)&quot;``, and ``n`` a non-terminal.</span>
<span class="linenos"> 302</span>
<span class="linenos"> 303</span><span class="sd">        Example: ``syntax Int ::= &quot;mul&quot; &quot;(&quot; Int &quot;,&quot; Int &quot;)&quot;``</span>
<span class="linenos"> 304</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 305</span>
<span class="linenos"> 306</span>        <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">KProductionItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 307</span>            <span class="k">match</span> <span class="n">item</span><span class="p">:</span>
<span class="linenos"> 308</span>                <span class="k">case</span> <span class="n">KTerminal</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="linenos"> 309</span>                    <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">]:</span>
<span class="linenos"> 310</span>                        <span class="k">return</span> <span class="n">value</span>
<span class="linenos"> 311</span>                    <span class="k">return</span> <span class="s1">&#39;t&#39;</span>
<span class="linenos"> 312</span>                <span class="k">case</span> <span class="n">KNonTerminal</span><span class="p">():</span>
<span class="linenos"> 313</span>                    <span class="k">return</span> <span class="s1">&#39;n&#39;</span>
<span class="linenos"> 314</span>                <span class="k">case</span> <span class="n">KRegexTerminal</span><span class="p">():</span>
<span class="linenos"> 315</span>                    <span class="k">return</span> <span class="s1">&#39;r&#39;</span>
<span class="linenos"> 316</span>                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
<span class="linenos"> 317</span>                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">()</span>
<span class="linenos"> 318</span>
<span class="linenos"> 319</span>        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
<span class="linenos"> 320</span>        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;t*\((n(,n)*)?\)&#39;</span>
<span class="linenos"> 321</span>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">))</span>
<span class="linenos"> 322</span>
<span class="linenos"> 323</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 324</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_record</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 325</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;The production is prefix with labelled nonterminals.&quot;&quot;&quot;</span>
<span class="linenos"> 326</span>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_prefix</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_terminals</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_terminals</span><span class="p">))</span>
<span class="linenos"> 327</span>
<span class="linenos"> 328</span>    <span class="nd">@property</span>
<span class="linenos"> 329</span>    <span class="k">def</span><span class="w"> </span><span class="nf">default_format</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Format</span><span class="p">:</span>
<span class="linenos"> 330</span>        <span class="n">format_str</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 331</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_record</span><span class="p">:</span>
<span class="linenos"> 332</span>            <span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 333</span>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
<span class="linenos"> 334</span>                <span class="k">match</span> <span class="n">item</span><span class="p">:</span>
<span class="linenos"> 335</span>                    <span class="k">case</span> <span class="n">KTerminal</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">):</span>
<span class="linenos"> 336</span>                        <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
<span class="linenos"> 337</span>                    <span class="k">case</span><span class="w"> </span><span class="n">KTerminal</span><span class="p">(</span><span class="k">_</span><span class="p">):</span>
<span class="linenos"> 338</span>                        <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 339</span>                    <span class="k">case</span><span class="w"> </span><span class="n">KNonTerminal</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="linenos"> 340</span>                        <span class="k">assert</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="linenos"> 341</span>                        <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
<span class="linenos"> 342</span>                        <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 343</span>                    <span class="k">case</span> <span class="n">KRegexTerminal</span><span class="p">():</span>
<span class="linenos"> 344</span>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Default format is not supported for productions with regex terminals&#39;</span><span class="p">)</span>
<span class="linenos"> 345</span>                    <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
<span class="linenos"> 346</span>                        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">()</span>
<span class="linenos"> 347</span>            <span class="n">format_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
<span class="linenos"> 348</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 349</span>            <span class="n">format_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 350</span>
<span class="linenos"> 351</span>        <span class="k">return</span> <span class="n">Format</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">format_str</span><span class="p">)</span></div>

<span class="linenos"> 352</span>
<span class="linenos"> 353</span>
<div class="viewcode-block" id="KSyntaxSort">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxSort">[docs]</a>
<span class="linenos"> 354</span><span class="nd">@final</span>
<span class="linenos"> 355</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 356</span><span class="k">class</span><span class="w"> </span><span class="nc">KSyntaxSort</span><span class="p">(</span><span class="n">KSentence</span><span class="p">):</span>
<span class="linenos"> 357</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a sort declaration, potentially parametric.&quot;&quot;&quot;</span>
<span class="linenos"> 358</span>
<span class="linenos"> 359</span>    <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span>
<span class="linenos"> 360</span>    <span class="n">params</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos"> 361</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 362</span>
<span class="linenos"> 363</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">KSort</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">):</span>
<span class="linenos"> 364</span>        <span class="n">params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">KSort</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">)</span>
<span class="linenos"> 365</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span>
<span class="linenos"> 366</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="linenos"> 367</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 368</span>
<span class="linenos"> 369</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 370</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KSyntaxSort</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KSyntaxSort</span><span class="p">:</span>
<span class="linenos"> 371</span>        <span class="k">return</span> <span class="n">KSyntaxSort</span><span class="p">(</span>
<span class="linenos"> 372</span>            <span class="n">sort</span><span class="o">=</span><span class="n">KSort</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]),</span>
<span class="linenos"> 373</span>            <span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">KSort</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]),</span>
<span class="linenos"> 374</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 375</span>        <span class="p">)</span>
<span class="linenos"> 376</span>
<div class="viewcode-block" id="KSyntaxSort.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxSort.to_dict">[docs]</a>
<span class="linenos"> 377</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 378</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 379</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KSyntaxSort&#39;</span><span class="p">,</span>
<span class="linenos"> 380</span>            <span class="s1">&#39;sort&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 381</span>            <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">],</span>
<span class="linenos"> 382</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 383</span>        <span class="p">}</span></div>

<span class="linenos"> 384</span>
<div class="viewcode-block" id="KSyntaxSort.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxSort.let">[docs]</a>
<span class="linenos"> 385</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span>
<span class="linenos"> 386</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 387</span>        <span class="o">*</span><span class="p">,</span>
<span class="linenos"> 388</span>        <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 389</span>        <span class="n">params</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">KSort</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 390</span>        <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 391</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSyntaxSort</span><span class="p">:</span>
<span class="linenos"> 392</span>        <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span>
<span class="linenos"> 393</span>        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
<span class="linenos"> 394</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 395</span>        <span class="k">return</span> <span class="n">KSyntaxSort</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 396</span>
<div class="viewcode-block" id="KSyntaxSort.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxSort.let_att">[docs]</a>
<span class="linenos"> 397</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSyntaxSort</span><span class="p">:</span>
<span class="linenos"> 398</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>
</div>

<span class="linenos"> 399</span>
<span class="linenos"> 400</span>
<div class="viewcode-block" id="KSortSynonym">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSortSynonym">[docs]</a>
<span class="linenos"> 401</span><span class="nd">@final</span>
<span class="linenos"> 402</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 403</span><span class="k">class</span><span class="w"> </span><span class="nc">KSortSynonym</span><span class="p">(</span><span class="n">KSentence</span><span class="p">):</span>
<span class="linenos"> 404</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a sort synonym, allowing declaring a new name for a given sort.&quot;&quot;&quot;</span>
<span class="linenos"> 405</span>
<span class="linenos"> 406</span>    <span class="n">new_sort</span><span class="p">:</span> <span class="n">KSort</span>
<span class="linenos"> 407</span>    <span class="n">old_sort</span><span class="p">:</span> <span class="n">KSort</span>
<span class="linenos"> 408</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 409</span>
<span class="linenos"> 410</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">,</span> <span class="n">old_sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">):</span>
<span class="linenos"> 411</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;new_sort&#39;</span><span class="p">,</span> <span class="n">new_sort</span><span class="p">)</span>
<span class="linenos"> 412</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;old_sort&#39;</span><span class="p">,</span> <span class="n">old_sort</span><span class="p">)</span>
<span class="linenos"> 413</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 414</span>
<span class="linenos"> 415</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 416</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KSortSynonym</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KSortSynonym</span><span class="p">:</span>
<span class="linenos"> 417</span>        <span class="k">return</span> <span class="n">KSortSynonym</span><span class="p">(</span>
<span class="linenos"> 418</span>            <span class="n">new_sort</span><span class="o">=</span><span class="n">KSort</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;newSort&#39;</span><span class="p">]),</span>
<span class="linenos"> 419</span>            <span class="n">old_sort</span><span class="o">=</span><span class="n">KSort</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;oldSort&#39;</span><span class="p">]),</span>
<span class="linenos"> 420</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 421</span>        <span class="p">)</span>
<span class="linenos"> 422</span>
<div class="viewcode-block" id="KSortSynonym.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSortSynonym.to_dict">[docs]</a>
<span class="linenos"> 423</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 424</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 425</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KSortSynonym&#39;</span><span class="p">,</span>
<span class="linenos"> 426</span>            <span class="s1">&#39;newSort&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_sort</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 427</span>            <span class="s1">&#39;oldSort&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_sort</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 428</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 429</span>        <span class="p">}</span></div>

<span class="linenos"> 430</span>
<div class="viewcode-block" id="KSortSynonym.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSortSynonym.let">[docs]</a>
<span class="linenos"> 431</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span>
<span class="linenos"> 432</span>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">old_sort</span><span class="p">:</span> <span class="n">KSort</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">new_sort</span><span class="p">:</span> <span class="n">KSort</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 433</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSortSynonym</span><span class="p">:</span>
<span class="linenos"> 434</span>        <span class="n">new_sort</span> <span class="o">=</span> <span class="n">new_sort</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_sort</span>
<span class="linenos"> 435</span>        <span class="n">old_sort</span> <span class="o">=</span> <span class="n">old_sort</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_sort</span>
<span class="linenos"> 436</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 437</span>        <span class="k">return</span> <span class="n">KSortSynonym</span><span class="p">(</span><span class="n">new_sort</span><span class="o">=</span><span class="n">new_sort</span><span class="p">,</span> <span class="n">old_sort</span><span class="o">=</span><span class="n">old_sort</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 438</span>
<div class="viewcode-block" id="KSortSynonym.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSortSynonym.let_att">[docs]</a>
<span class="linenos"> 439</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSortSynonym</span><span class="p">:</span>
<span class="linenos"> 440</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>
</div>

<span class="linenos"> 441</span>
<span class="linenos"> 442</span>
<div class="viewcode-block" id="KSyntaxLexical">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxLexical">[docs]</a>
<span class="linenos"> 443</span><span class="nd">@final</span>
<span class="linenos"> 444</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 445</span><span class="k">class</span><span class="w"> </span><span class="nc">KSyntaxLexical</span><span class="p">(</span><span class="n">KSentence</span><span class="p">):</span>
<span class="linenos"> 446</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a named piece of lexical syntax, definable as a regular expression.&quot;&quot;&quot;</span>
<span class="linenos"> 447</span>
<span class="linenos"> 448</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 449</span>    <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 450</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 451</span>
<span class="linenos"> 452</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">):</span>
<span class="linenos"> 453</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="linenos"> 454</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;regex&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>
<span class="linenos"> 455</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 456</span>
<span class="linenos"> 457</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 458</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KSyntaxLexical</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KSyntaxLexical</span><span class="p">:</span>
<span class="linenos"> 459</span>        <span class="k">return</span> <span class="n">KSyntaxLexical</span><span class="p">(</span>
<span class="linenos"> 460</span>            <span class="n">name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
<span class="linenos"> 461</span>            <span class="n">regex</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;regex&#39;</span><span class="p">],</span>
<span class="linenos"> 462</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 463</span>        <span class="p">)</span>
<span class="linenos"> 464</span>
<div class="viewcode-block" id="KSyntaxLexical.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxLexical.to_dict">[docs]</a>
<span class="linenos"> 465</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 466</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 467</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KSyntaxLexcial&#39;</span><span class="p">,</span>
<span class="linenos"> 468</span>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<span class="linenos"> 469</span>            <span class="s1">&#39;regex&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="p">,</span>
<span class="linenos"> 470</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 471</span>        <span class="p">}</span></div>

<span class="linenos"> 472</span>
<div class="viewcode-block" id="KSyntaxLexical.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxLexical.let">[docs]</a>
<span class="linenos"> 473</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSyntaxLexical</span><span class="p">:</span>
<span class="linenos"> 474</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
<span class="linenos"> 475</span>        <span class="n">regex</span> <span class="o">=</span> <span class="n">regex</span> <span class="k">if</span> <span class="n">regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span>
<span class="linenos"> 476</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 477</span>        <span class="k">return</span> <span class="n">KSyntaxLexical</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 478</span>
<div class="viewcode-block" id="KSyntaxLexical.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxLexical.let_att">[docs]</a>
<span class="linenos"> 479</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSyntaxLexical</span><span class="p">:</span>
<span class="linenos"> 480</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>
</div>

<span class="linenos"> 481</span>
<span class="linenos"> 482</span>
<div class="viewcode-block" id="KAssoc">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KAssoc">[docs]</a>
<span class="linenos"> 483</span><span class="k">class</span><span class="w"> </span><span class="nc">KAssoc</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="linenos"> 484</span>    <span class="n">LEFT</span> <span class="o">=</span> <span class="s1">&#39;Left&#39;</span>
<span class="linenos"> 485</span>    <span class="n">RIGHT</span> <span class="o">=</span> <span class="s1">&#39;Right&#39;</span>
<span class="linenos"> 486</span>    <span class="n">NON_ASSOC</span> <span class="o">=</span> <span class="s1">&#39;NonAssoc&#39;</span></div>

<span class="linenos"> 487</span>
<span class="linenos"> 488</span>
<div class="viewcode-block" id="KSyntaxAssociativity">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxAssociativity">[docs]</a>
<span class="linenos"> 489</span><span class="nd">@final</span>
<span class="linenos"> 490</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 491</span><span class="k">class</span><span class="w"> </span><span class="nc">KSyntaxAssociativity</span><span class="p">(</span><span class="n">KSentence</span><span class="p">):</span>
<span class="linenos"> 492</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a standalone declaration of operator associativity for tagged productions.&quot;&quot;&quot;</span>
<span class="linenos"> 493</span>
<span class="linenos"> 494</span>    <span class="n">assoc</span><span class="p">:</span> <span class="n">KAssoc</span>
<span class="linenos"> 495</span>    <span class="n">tags</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 496</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 497</span>
<span class="linenos"> 498</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assoc</span><span class="p">:</span> <span class="n">KAssoc</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(),</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">):</span>
<span class="linenos"> 499</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;assoc&#39;</span><span class="p">,</span> <span class="n">assoc</span><span class="p">)</span>
<span class="linenos"> 500</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">tags</span><span class="p">))</span>
<span class="linenos"> 501</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 502</span>
<span class="linenos"> 503</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 504</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KSyntaxAssociativity</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KSyntaxAssociativity</span><span class="p">:</span>
<span class="linenos"> 505</span>        <span class="k">return</span> <span class="n">KSyntaxAssociativity</span><span class="p">(</span>
<span class="linenos"> 506</span>            <span class="n">assoc</span><span class="o">=</span><span class="n">KAssoc</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;assoc&#39;</span><span class="p">]),</span>
<span class="linenos"> 507</span>            <span class="n">tags</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">],</span>
<span class="linenos"> 508</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 509</span>        <span class="p">)</span>
<span class="linenos"> 510</span>
<div class="viewcode-block" id="KSyntaxAssociativity.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxAssociativity.to_dict">[docs]</a>
<span class="linenos"> 511</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 512</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 513</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KSyntaxAssociativity&#39;</span><span class="p">,</span>
<span class="linenos"> 514</span>            <span class="s1">&#39;assoc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assoc</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="linenos"> 515</span>            <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">),</span>
<span class="linenos"> 516</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 517</span>        <span class="p">}</span></div>

<span class="linenos"> 518</span>
<div class="viewcode-block" id="KSyntaxAssociativity.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxAssociativity.let">[docs]</a>
<span class="linenos"> 519</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span>
<span class="linenos"> 520</span>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">assoc</span><span class="p">:</span> <span class="n">KAssoc</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 521</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSyntaxAssociativity</span><span class="p">:</span>
<span class="linenos"> 522</span>        <span class="n">assoc</span> <span class="o">=</span> <span class="n">assoc</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">assoc</span>
<span class="linenos"> 523</span>        <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span> <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span>
<span class="linenos"> 524</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 525</span>        <span class="k">return</span> <span class="n">KSyntaxAssociativity</span><span class="p">(</span><span class="n">assoc</span><span class="o">=</span><span class="n">assoc</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 526</span>
<div class="viewcode-block" id="KSyntaxAssociativity.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxAssociativity.let_att">[docs]</a>
<span class="linenos"> 527</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSyntaxAssociativity</span><span class="p">:</span>
<span class="linenos"> 528</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>
</div>

<span class="linenos"> 529</span>
<span class="linenos"> 530</span>
<div class="viewcode-block" id="KSyntaxPriority">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxPriority">[docs]</a>
<span class="linenos"> 531</span><span class="nd">@final</span>
<span class="linenos"> 532</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 533</span><span class="k">class</span><span class="w"> </span><span class="nc">KSyntaxPriority</span><span class="p">(</span><span class="n">KSentence</span><span class="p">):</span>
<span class="linenos"> 534</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a standalone declaration of syntax priorities, using productions tags.&quot;&quot;&quot;</span>
<span class="linenos"> 535</span>
<span class="linenos"> 536</span>    <span class="n">priorities</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos"> 537</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 538</span>
<span class="linenos"> 539</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">priorities</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">):</span>
<span class="linenos"> 540</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;priorities&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">priorities</span><span class="p">))</span>
<span class="linenos"> 541</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 542</span>
<span class="linenos"> 543</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 544</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KSyntaxPriority</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KSyntaxPriority</span><span class="p">:</span>
<span class="linenos"> 545</span>        <span class="k">return</span> <span class="n">KSyntaxPriority</span><span class="p">(</span>
<span class="linenos"> 546</span>            <span class="n">priorities</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;priorities&#39;</span><span class="p">],</span>
<span class="linenos"> 547</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 548</span>        <span class="p">)</span>
<span class="linenos"> 549</span>
<div class="viewcode-block" id="KSyntaxPriority.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxPriority.to_dict">[docs]</a>
<span class="linenos"> 550</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 551</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 552</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KSyntaxPriority&#39;</span><span class="p">,</span>
<span class="linenos"> 553</span>            <span class="s1">&#39;priorities&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">priorities</span><span class="p">],</span>
<span class="linenos"> 554</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 555</span>        <span class="p">}</span></div>

<span class="linenos"> 556</span>
<div class="viewcode-block" id="KSyntaxPriority.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxPriority.let">[docs]</a>
<span class="linenos"> 557</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">priorities</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSyntaxPriority</span><span class="p">:</span>
<span class="linenos"> 558</span>        <span class="n">priorities</span> <span class="o">=</span> <span class="n">priorities</span> <span class="k">if</span> <span class="n">priorities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">priorities</span>
<span class="linenos"> 559</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 560</span>        <span class="k">return</span> <span class="n">KSyntaxPriority</span><span class="p">(</span><span class="n">priorities</span><span class="o">=</span><span class="n">priorities</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 561</span>
<div class="viewcode-block" id="KSyntaxPriority.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KSyntaxPriority.let_att">[docs]</a>
<span class="linenos"> 562</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSyntaxPriority</span><span class="p">:</span>
<span class="linenos"> 563</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>
</div>

<span class="linenos"> 564</span>
<span class="linenos"> 565</span>
<div class="viewcode-block" id="KBubble">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KBubble">[docs]</a>
<span class="linenos"> 566</span><span class="nd">@final</span>
<span class="linenos"> 567</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 568</span><span class="k">class</span><span class="w"> </span><span class="nc">KBubble</span><span class="p">(</span><span class="n">KSentence</span><span class="p">):</span>
<span class="linenos"> 569</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an unparsed chunk of AST in user-defined syntax.&quot;&quot;&quot;</span>
<span class="linenos"> 570</span>
<span class="linenos"> 571</span>    <span class="n">sentence_type</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 572</span>    <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 573</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 574</span>
<span class="linenos"> 575</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">):</span>
<span class="linenos"> 576</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sentence_type&#39;</span><span class="p">,</span> <span class="n">sentence_type</span><span class="p">)</span>
<span class="linenos"> 577</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>
<span class="linenos"> 578</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 579</span>
<span class="linenos"> 580</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 581</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KBubble</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KBubble</span><span class="p">:</span>
<span class="linenos"> 582</span>        <span class="k">return</span> <span class="n">KBubble</span><span class="p">(</span>
<span class="linenos"> 583</span>            <span class="n">sentence_type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;sentenceType&#39;</span><span class="p">],</span>
<span class="linenos"> 584</span>            <span class="n">contents</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;contents&#39;</span><span class="p">],</span>
<span class="linenos"> 585</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 586</span>        <span class="p">)</span>
<span class="linenos"> 587</span>
<div class="viewcode-block" id="KBubble.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KBubble.to_dict">[docs]</a>
<span class="linenos"> 588</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 589</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 590</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KBubble&#39;</span><span class="p">,</span>
<span class="linenos"> 591</span>            <span class="s1">&#39;sentenceType&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentence_type</span><span class="p">,</span>
<span class="linenos"> 592</span>            <span class="s1">&#39;contents&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
<span class="linenos"> 593</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 594</span>        <span class="p">}</span></div>

<span class="linenos"> 595</span>
<div class="viewcode-block" id="KBubble.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KBubble.let">[docs]</a>
<span class="linenos"> 596</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sentence_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KBubble</span><span class="p">:</span>
<span class="linenos"> 597</span>        <span class="n">sentence_type</span> <span class="o">=</span> <span class="n">sentence_type</span> <span class="k">if</span> <span class="n">sentence_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentence_type</span>
<span class="linenos"> 598</span>        <span class="n">contents</span> <span class="o">=</span> <span class="n">contents</span> <span class="k">if</span> <span class="n">contents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span>
<span class="linenos"> 599</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 600</span>        <span class="k">return</span> <span class="n">KBubble</span><span class="p">(</span><span class="n">sentence_type</span><span class="o">=</span><span class="n">sentence_type</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 601</span>
<div class="viewcode-block" id="KBubble.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KBubble.let_att">[docs]</a>
<span class="linenos"> 602</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KBubble</span><span class="p">:</span>
<span class="linenos"> 603</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>
</div>

<span class="linenos"> 604</span>
<span class="linenos"> 605</span>
<div class="viewcode-block" id="KRuleLike">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRuleLike">[docs]</a>
<span class="linenos"> 606</span><span class="k">class</span><span class="w"> </span><span class="nc">KRuleLike</span><span class="p">(</span><span class="n">KSentence</span><span class="p">):</span>
<span class="linenos"> 607</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents something with rule-like structure (with body, requires, and ensures clauses).&quot;&quot;&quot;</span>
<span class="linenos"> 608</span>
<span class="linenos"> 609</span>    <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 610</span>    <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 611</span>    <span class="n">ensures</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 612</span>
<div class="viewcode-block" id="KRuleLike.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRuleLike.let">[docs]</a>
<span class="linenos"> 613</span>    <span class="nd">@abstractmethod</span>
<span class="linenos"> 614</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span></div>

<span class="linenos"> 615</span>        <span class="bp">self</span><span class="p">:</span> <span class="n">RL</span><span class="p">,</span>
<span class="linenos"> 616</span>        <span class="o">*</span><span class="p">,</span>
<span class="linenos"> 617</span>        <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 618</span>        <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 619</span>        <span class="n">ensures</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 620</span>        <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 621</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RL</span><span class="p">:</span> <span class="o">...</span></div>

<span class="linenos"> 622</span>
<span class="linenos"> 623</span>
<div class="viewcode-block" id="KRule">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRule">[docs]</a>
<span class="linenos"> 624</span><span class="nd">@final</span>
<span class="linenos"> 625</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 626</span><span class="k">class</span><span class="w"> </span><span class="nc">KRule</span><span class="p">(</span><span class="n">KRuleLike</span><span class="p">):</span>
<span class="linenos"> 627</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a K rule definition, typically a conditional rewrite/transition.&quot;&quot;&quot;</span>
<span class="linenos"> 628</span>
<span class="linenos"> 629</span>    <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 630</span>    <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 631</span>    <span class="n">ensures</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 632</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 633</span>
<span class="linenos"> 634</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span><span class="p">,</span> <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">=</span> <span class="n">_TRUE</span><span class="p">,</span> <span class="n">ensures</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">=</span> <span class="n">_TRUE</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">):</span>
<span class="linenos"> 635</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
<span class="linenos"> 636</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;requires&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="p">)</span>
<span class="linenos"> 637</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ensures&#39;</span><span class="p">,</span> <span class="n">ensures</span><span class="p">)</span>
<span class="linenos"> 638</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 639</span>
<span class="linenos"> 640</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 641</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KRule</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KRule</span><span class="p">:</span>
<span class="linenos"> 642</span>        <span class="k">return</span> <span class="n">KRule</span><span class="p">(</span>
<span class="linenos"> 643</span>            <span class="n">body</span><span class="o">=</span><span class="n">KInner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]),</span>
<span class="linenos"> 644</span>            <span class="n">requires</span><span class="o">=</span><span class="n">KInner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;requires&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;requires&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">_TRUE</span><span class="p">,</span>
<span class="linenos"> 645</span>            <span class="n">ensures</span><span class="o">=</span><span class="n">KInner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ensures&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ensures&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">_TRUE</span><span class="p">,</span>
<span class="linenos"> 646</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 647</span>        <span class="p">)</span>
<span class="linenos"> 648</span>
<div class="viewcode-block" id="KRule.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRule.to_dict">[docs]</a>
<span class="linenos"> 649</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 650</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 651</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KRule&#39;</span><span class="p">,</span>
<span class="linenos"> 652</span>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 653</span>            <span class="s1">&#39;requires&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 654</span>            <span class="s1">&#39;ensures&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensures</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 655</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 656</span>        <span class="p">}</span></div>

<span class="linenos"> 657</span>
<div class="viewcode-block" id="KRule.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRule.let">[docs]</a>
<span class="linenos"> 658</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span>
<span class="linenos"> 659</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 660</span>        <span class="o">*</span><span class="p">,</span>
<span class="linenos"> 661</span>        <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 662</span>        <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 663</span>        <span class="n">ensures</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 664</span>        <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 665</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KRule</span><span class="p">:</span>
<span class="linenos"> 666</span>        <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span>
<span class="linenos"> 667</span>        <span class="n">requires</span> <span class="o">=</span> <span class="n">requires</span> <span class="k">if</span> <span class="n">requires</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span>
<span class="linenos"> 668</span>        <span class="n">ensures</span> <span class="o">=</span> <span class="n">ensures</span> <span class="k">if</span> <span class="n">ensures</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensures</span>
<span class="linenos"> 669</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 670</span>        <span class="k">return</span> <span class="n">KRule</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span> <span class="n">ensures</span><span class="o">=</span><span class="n">ensures</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 671</span>
<div class="viewcode-block" id="KRule.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRule.let_att">[docs]</a>
<span class="linenos"> 672</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KRule</span><span class="p">:</span>
<span class="linenos"> 673</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 674</span>
<span class="linenos"> 675</span>    <span class="nd">@property</span>
<span class="linenos"> 676</span>    <span class="k">def</span><span class="w"> </span><span class="nf">priority</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 677</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Atts</span><span class="o">.</span><span class="n">PRIORITY</span><span class="p">,</span> <span class="mi">200</span> <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">OWISE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="k">else</span> <span class="mi">50</span><span class="p">)</span></div>

<span class="linenos"> 678</span>
<span class="linenos"> 679</span>
<div class="viewcode-block" id="KClaim">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KClaim">[docs]</a>
<span class="linenos"> 680</span><span class="nd">@final</span>
<span class="linenos"> 681</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 682</span><span class="k">class</span><span class="w"> </span><span class="nc">KClaim</span><span class="p">(</span><span class="n">KRuleLike</span><span class="p">):</span>
<span class="linenos"> 683</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a K claim, typically a transition with pre/post-conditions.&quot;&quot;&quot;</span>
<span class="linenos"> 684</span>
<span class="linenos"> 685</span>    <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 686</span>    <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 687</span>    <span class="n">ensures</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 688</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 689</span>
<span class="linenos"> 690</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span><span class="p">,</span> <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">=</span> <span class="n">_TRUE</span><span class="p">,</span> <span class="n">ensures</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">=</span> <span class="n">_TRUE</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">):</span>
<span class="linenos"> 691</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
<span class="linenos"> 692</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;requires&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="p">)</span>
<span class="linenos"> 693</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ensures&#39;</span><span class="p">,</span> <span class="n">ensures</span><span class="p">)</span>
<span class="linenos"> 694</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 695</span>
<span class="linenos"> 696</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 697</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KClaim</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KClaim</span><span class="p">:</span>
<span class="linenos"> 698</span>        <span class="k">return</span> <span class="n">KClaim</span><span class="p">(</span>
<span class="linenos"> 699</span>            <span class="n">body</span><span class="o">=</span><span class="n">KInner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]),</span>
<span class="linenos"> 700</span>            <span class="n">requires</span><span class="o">=</span><span class="n">KInner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;requires&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;requires&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">_TRUE</span><span class="p">,</span>
<span class="linenos"> 701</span>            <span class="n">ensures</span><span class="o">=</span><span class="n">KInner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ensures&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ensures&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">_TRUE</span><span class="p">,</span>
<span class="linenos"> 702</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 703</span>        <span class="p">)</span>
<span class="linenos"> 704</span>
<div class="viewcode-block" id="KClaim.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KClaim.to_dict">[docs]</a>
<span class="linenos"> 705</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 706</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 707</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KClaim&#39;</span><span class="p">,</span>
<span class="linenos"> 708</span>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 709</span>            <span class="s1">&#39;requires&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 710</span>            <span class="s1">&#39;ensures&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensures</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 711</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 712</span>        <span class="p">}</span></div>

<span class="linenos"> 713</span>
<div class="viewcode-block" id="KClaim.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KClaim.let">[docs]</a>
<span class="linenos"> 714</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span>
<span class="linenos"> 715</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 716</span>        <span class="o">*</span><span class="p">,</span>
<span class="linenos"> 717</span>        <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 718</span>        <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 719</span>        <span class="n">ensures</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 720</span>        <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 721</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KClaim</span><span class="p">:</span>
<span class="linenos"> 722</span>        <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span>
<span class="linenos"> 723</span>        <span class="n">requires</span> <span class="o">=</span> <span class="n">requires</span> <span class="k">if</span> <span class="n">requires</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span>
<span class="linenos"> 724</span>        <span class="n">ensures</span> <span class="o">=</span> <span class="n">ensures</span> <span class="k">if</span> <span class="n">ensures</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensures</span>
<span class="linenos"> 725</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 726</span>        <span class="k">return</span> <span class="n">KClaim</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span> <span class="n">ensures</span><span class="o">=</span><span class="n">ensures</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 727</span>
<div class="viewcode-block" id="KClaim.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KClaim.let_att">[docs]</a>
<span class="linenos"> 728</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KClaim</span><span class="p">:</span>
<span class="linenos"> 729</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 730</span>
<span class="linenos"> 731</span>    <span class="nd">@property</span>
<span class="linenos"> 732</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_circularity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 733</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this claim is a circularity (must be used coinductively to prove itself).&quot;&quot;&quot;</span>
<span class="linenos"> 734</span>        <span class="k">return</span> <span class="n">Atts</span><span class="o">.</span><span class="n">CIRCULARITY</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 735</span>
<span class="linenos"> 736</span>    <span class="nd">@property</span>
<span class="linenos"> 737</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_trusted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 738</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this claim is trusted (does not need to be proven to be considered true).&quot;&quot;&quot;</span>
<span class="linenos"> 739</span>        <span class="k">return</span> <span class="n">Atts</span><span class="o">.</span><span class="n">TRUSTED</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 740</span>
<span class="linenos"> 741</span>    <span class="nd">@property</span>
<span class="linenos"> 742</span>    <span class="k">def</span><span class="w"> </span><span class="nf">dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="linenos"> 743</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dependencies of this claim (list of other claims needed to help prove this one or speed up this ones proof).&quot;&quot;&quot;</span>
<span class="linenos"> 744</span>        <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Atts</span><span class="o">.</span><span class="n">DEPENDS</span><span class="p">)</span>
<span class="linenos"> 745</span>        <span class="k">if</span> <span class="n">deps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 746</span>            <span class="k">return</span> <span class="p">[]</span>
<span class="linenos"> 747</span>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">deps</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span></div>

<span class="linenos"> 748</span>
<span class="linenos"> 749</span>
<div class="viewcode-block" id="KContext">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KContext">[docs]</a>
<span class="linenos"> 750</span><span class="nd">@final</span>
<span class="linenos"> 751</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 752</span><span class="k">class</span><span class="w"> </span><span class="nc">KContext</span><span class="p">(</span><span class="n">KSentence</span><span class="p">):</span>
<span class="linenos"> 753</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a K evaluation context, used for isolating chunks of computation and focusing on them.&quot;&quot;&quot;</span>
<span class="linenos"> 754</span>
<span class="linenos"> 755</span>    <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 756</span>    <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos"> 757</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 758</span>
<span class="linenos"> 759</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span><span class="p">,</span> <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">=</span> <span class="n">_TRUE</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">):</span>
<span class="linenos"> 760</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
<span class="linenos"> 761</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;requires&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="p">)</span>
<span class="linenos"> 762</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 763</span>
<span class="linenos"> 764</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 765</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">KContext</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KContext</span><span class="p">:</span>
<span class="linenos"> 766</span>        <span class="k">return</span> <span class="n">KContext</span><span class="p">(</span>
<span class="linenos"> 767</span>            <span class="n">body</span><span class="o">=</span><span class="n">KInner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]),</span>
<span class="linenos"> 768</span>            <span class="n">requires</span><span class="o">=</span><span class="n">KInner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;requires&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;requires&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">_TRUE</span><span class="p">,</span>
<span class="linenos"> 769</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 770</span>        <span class="p">)</span>
<span class="linenos"> 771</span>
<div class="viewcode-block" id="KContext.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KContext.to_dict">[docs]</a>
<span class="linenos"> 772</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 773</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 774</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KContext&#39;</span><span class="p">,</span>
<span class="linenos"> 775</span>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 776</span>            <span class="s1">&#39;requires&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 777</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 778</span>        <span class="p">}</span></div>

<span class="linenos"> 779</span>
<div class="viewcode-block" id="KContext.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KContext.let">[docs]</a>
<span class="linenos"> 780</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">requires</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KContext</span><span class="p">:</span>
<span class="linenos"> 781</span>        <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span>
<span class="linenos"> 782</span>        <span class="n">requires</span> <span class="o">=</span> <span class="n">requires</span> <span class="k">if</span> <span class="n">requires</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span>
<span class="linenos"> 783</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 784</span>        <span class="k">return</span> <span class="n">KContext</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 785</span>
<div class="viewcode-block" id="KContext.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KContext.let_att">[docs]</a>
<span class="linenos"> 786</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KContext</span><span class="p">:</span>
<span class="linenos"> 787</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>
</div>

<span class="linenos"> 788</span>
<span class="linenos"> 789</span>
<div class="viewcode-block" id="KImport">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KImport">[docs]</a>
<span class="linenos"> 790</span><span class="nd">@final</span>
<span class="linenos"> 791</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 792</span><span class="k">class</span><span class="w"> </span><span class="nc">KImport</span><span class="p">(</span><span class="n">KOuter</span><span class="p">):</span>
<span class="linenos"> 793</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a K module import, used for inheriting all the sentences of the imported module into this one.&quot;&quot;&quot;</span>
<span class="linenos"> 794</span>
<span class="linenos"> 795</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 796</span>    <span class="n">public</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos"> 797</span>
<span class="linenos"> 798</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">public</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="linenos"> 799</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="linenos"> 800</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="n">public</span><span class="p">)</span>
<span class="linenos"> 801</span>
<div class="viewcode-block" id="KImport.from_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KImport.from_dict">[docs]</a>
<span class="linenos"> 802</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 803</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KImport</span><span class="p">:</span>
<span class="linenos"> 804</span>        <span class="k">return</span> <span class="n">KImport</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">public</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;isPublic&#39;</span><span class="p">])</span></div>

<span class="linenos"> 805</span>
<div class="viewcode-block" id="KImport.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KImport.to_dict">[docs]</a>
<span class="linenos"> 806</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 807</span>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KImport&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;isPublic&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">public</span><span class="p">}</span></div>

<span class="linenos"> 808</span>
<div class="viewcode-block" id="KImport.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KImport.let">[docs]</a>
<span class="linenos"> 809</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">public</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KImport</span><span class="p">:</span>
<span class="linenos"> 810</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
<span class="linenos"> 811</span>        <span class="n">public</span> <span class="o">=</span> <span class="n">public</span> <span class="k">if</span> <span class="n">public</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">public</span>
<span class="linenos"> 812</span>        <span class="k">return</span> <span class="n">KImport</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">public</span><span class="o">=</span><span class="n">public</span><span class="p">)</span></div>
</div>

<span class="linenos"> 813</span>
<span class="linenos"> 814</span>
<div class="viewcode-block" id="KFlatModule">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModule">[docs]</a>
<span class="linenos"> 815</span><span class="nd">@final</span>
<span class="linenos"> 816</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 817</span><span class="k">class</span><span class="w"> </span><span class="nc">KFlatModule</span><span class="p">(</span><span class="n">KOuter</span><span class="p">,</span> <span class="n">WithKAtt</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KSentence</span><span class="p">]):</span>
<span class="linenos"> 818</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a K module, with a name, list of imports, and list of sentences.&quot;&quot;&quot;</span>
<span class="linenos"> 819</span>
<span class="linenos"> 820</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 821</span>    <span class="n">sentences</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KSentence</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos"> 822</span>    <span class="n">imports</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KImport</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos"> 823</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos"> 824</span>
<span class="linenos"> 825</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span class="linenos"> 826</span>        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sentences</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KSentence</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">imports</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KImport</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span>
<span class="linenos"> 827</span>    <span class="p">):</span>
<span class="linenos"> 828</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="linenos"> 829</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sentences&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sentences</span><span class="p">))</span>
<span class="linenos"> 830</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;imports&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">imports</span><span class="p">))</span>
<span class="linenos"> 831</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos"> 832</span>
<span class="linenos"> 833</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">KSentence</span><span class="p">]:</span>
<span class="linenos"> 834</span>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sentences</span><span class="p">)</span>
<span class="linenos"> 835</span>
<span class="linenos"> 836</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 837</span>    <span class="k">def</span><span class="w"> </span><span class="nf">productions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 838</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all the `KProduction` sentences from this module.&quot;&quot;&quot;</span>
<span class="linenos"> 839</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sentence</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KProduction</span><span class="p">)</span>
<span class="linenos"> 840</span>
<span class="linenos"> 841</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 842</span>    <span class="k">def</span><span class="w"> </span><span class="nf">syntax_productions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 843</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all the `KProduction` sentences from this module that contain `KLabel` (are EBNF syntax declarations).&quot;&quot;&quot;</span>
<span class="linenos"> 844</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="k">if</span> <span class="n">prod</span><span class="o">.</span><span class="n">klabel</span><span class="p">)</span>
<span class="linenos"> 845</span>
<span class="linenos"> 846</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 847</span>    <span class="k">def</span><span class="w"> </span><span class="nf">functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 848</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all the `KProduction` sentences from this module that are function declarations.&quot;&quot;&quot;</span>
<span class="linenos"> 849</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">syntax_productions</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_function</span><span class="p">(</span><span class="n">prod</span><span class="p">))</span>
<span class="linenos"> 850</span>
<span class="linenos"> 851</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 852</span>    <span class="k">def</span><span class="w"> </span><span class="nf">constructors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 853</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all the `KProduction` sentences from this module that are constructor declarations.&quot;&quot;&quot;</span>
<span class="linenos"> 854</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">syntax_productions</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_function</span><span class="p">(</span><span class="n">prod</span><span class="p">))</span>
<span class="linenos"> 855</span>
<span class="linenos"> 856</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 857</span>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_collection_productions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 858</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all the `KProduction` sentences from this module that are cell collection declarations.&quot;&quot;&quot;</span>
<span class="linenos"> 859</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">syntax_productions</span> <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">CELL_COLLECTION</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="p">)</span>
<span class="linenos"> 860</span>
<span class="linenos"> 861</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 862</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_is_function</span><span class="p">(</span><span class="n">prod</span><span class="p">:</span> <span class="n">KProduction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 863</span>        <span class="k">def</span><span class="w"> </span><span class="nf">is_not_actually_function</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 864</span>            <span class="n">is_cell_map_constructor</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;CellMapItem&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;CellMap_&#39;</span><span class="p">)</span>
<span class="linenos"> 865</span>            <span class="n">is_builtin_data_constructor</span> <span class="o">=</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">{</span>
<span class="linenos"> 866</span>                <span class="s1">&#39;_Set_&#39;</span><span class="p">,</span>
<span class="linenos"> 867</span>                <span class="s1">&#39;_List_&#39;</span><span class="p">,</span>
<span class="linenos"> 868</span>                <span class="s1">&#39;_Map_&#39;</span><span class="p">,</span>
<span class="linenos"> 869</span>                <span class="s1">&#39;_RangeMap_&#39;</span><span class="p">,</span>
<span class="linenos"> 870</span>                <span class="s1">&#39;.Set&#39;</span><span class="p">,</span>
<span class="linenos"> 871</span>                <span class="s1">&#39;.List&#39;</span><span class="p">,</span>
<span class="linenos"> 872</span>                <span class="s1">&#39;.Map&#39;</span><span class="p">,</span>
<span class="linenos"> 873</span>                <span class="s1">&#39;.RangeMap&#39;</span><span class="p">,</span>
<span class="linenos"> 874</span>                <span class="s1">&#39;SetItem&#39;</span><span class="p">,</span>
<span class="linenos"> 875</span>                <span class="s1">&#39;ListItem&#39;</span><span class="p">,</span>
<span class="linenos"> 876</span>                <span class="s1">&#39;_|-&gt;_&#39;</span><span class="p">,</span>
<span class="linenos"> 877</span>                <span class="s1">&#39;_r|-&gt;_&#39;</span><span class="p">,</span>
<span class="linenos"> 878</span>            <span class="p">}</span>
<span class="linenos"> 879</span>            <span class="k">return</span> <span class="n">is_cell_map_constructor</span> <span class="ow">or</span> <span class="n">is_builtin_data_constructor</span>
<span class="linenos"> 880</span>
<span class="linenos"> 881</span>        <span class="k">return</span> <span class="p">(</span><span class="n">Atts</span><span class="o">.</span><span class="n">FUNCTION</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">att</span> <span class="ow">or</span> <span class="n">Atts</span><span class="o">.</span><span class="n">FUNCTIONAL</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
<span class="linenos"> 882</span>            <span class="n">prod</span><span class="o">.</span><span class="n">klabel</span> <span class="ow">and</span> <span class="n">is_not_actually_function</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">klabel</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="linenos"> 883</span>        <span class="p">)</span>
<span class="linenos"> 884</span>
<span class="linenos"> 885</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 886</span>    <span class="k">def</span><span class="w"> </span><span class="nf">syntax_sorts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KSyntaxSort</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 887</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all the `KSyntaxSort` sentences from this module.&quot;&quot;&quot;</span>
<span class="linenos"> 888</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sentence</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">KSyntaxSort</span><span class="p">))</span>
<span class="linenos"> 889</span>
<span class="linenos"> 890</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 891</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KRule</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 892</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all the `KRule` declared in this module.&quot;&quot;&quot;</span>
<span class="linenos"> 893</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sentence</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KRule</span><span class="p">)</span>
<span class="linenos"> 894</span>
<span class="linenos"> 895</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 896</span>    <span class="k">def</span><span class="w"> </span><span class="nf">claims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KClaim</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 897</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all the `KClaim` declared in this module.&quot;&quot;&quot;</span>
<span class="linenos"> 898</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sentence</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KClaim</span><span class="p">)</span>
<span class="linenos"> 899</span>
<span class="linenos"> 900</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 901</span>    <span class="k">def</span><span class="w"> </span><span class="nf">sentence_by_unique_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KSentence</span><span class="p">]:</span>
<span class="linenos"> 902</span>        <span class="k">return</span> <span class="p">{</span><span class="n">sent</span><span class="o">.</span><span class="n">unique_id</span><span class="p">:</span> <span class="n">sent</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentences</span> <span class="k">if</span> <span class="n">sent</span><span class="o">.</span><span class="n">unique_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
<span class="linenos"> 903</span>
<span class="linenos"> 904</span>    <span class="nd">@overload</span>
<span class="linenos"> 905</span>    <span class="k">def</span><span class="w"> </span><span class="nf">map_sentences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">S</span><span class="p">],</span> <span class="n">S</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">of_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KFlatModule</span><span class="p">:</span> <span class="o">...</span>
<span class="linenos"> 906</span>
<span class="linenos"> 907</span>    <span class="nd">@overload</span>
<span class="linenos"> 908</span>    <span class="k">def</span><span class="w"> </span><span class="nf">map_sentences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">KSentence</span><span class="p">],</span> <span class="n">KSentence</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">of_type</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KFlatModule</span><span class="p">:</span> <span class="o">...</span>
<span class="linenos"> 909</span>
<span class="linenos"> 910</span>    <span class="c1"># Uses overload instead of default argument as a workaround: https://github.com/python/mypy/issues/3737</span>
<div class="viewcode-block" id="KFlatModule.map_sentences">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModule.map_sentences">[docs]</a>
<span class="linenos"> 911</span>    <span class="k">def</span><span class="w"> </span><span class="nf">map_sentences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">of_type</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KFlatModule</span><span class="p">:</span>
<span class="linenos"> 912</span>        <span class="k">if</span> <span class="n">of_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 913</span>            <span class="n">of_type</span> <span class="o">=</span> <span class="n">KSentence</span>
<span class="linenos"> 914</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">sentences</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sent</span><span class="p">,</span> <span class="n">of_type</span><span class="p">)</span> <span class="k">else</span> <span class="n">sent</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentences</span><span class="p">))</span></div>

<span class="linenos"> 915</span>
<div class="viewcode-block" id="KFlatModule.from_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModule.from_dict">[docs]</a>
<span class="linenos"> 916</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 917</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KFlatModule</span><span class="p">:</span>
<span class="linenos"> 918</span>        <span class="k">return</span> <span class="n">KFlatModule</span><span class="p">(</span>
<span class="linenos"> 919</span>            <span class="n">name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
<span class="linenos"> 920</span>            <span class="n">sentences</span><span class="o">=</span><span class="p">(</span><span class="n">KSentence</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;localSentences&#39;</span><span class="p">]),</span>
<span class="linenos"> 921</span>            <span class="n">imports</span><span class="o">=</span><span class="p">(</span><span class="n">KImport</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">imp</span><span class="p">)</span> <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;imports&#39;</span><span class="p">]),</span>
<span class="linenos"> 922</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos"> 923</span>        <span class="p">)</span></div>

<span class="linenos"> 924</span>
<div class="viewcode-block" id="KFlatModule.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModule.to_dict">[docs]</a>
<span class="linenos"> 925</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 926</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 927</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KFlatModule&#39;</span><span class="p">,</span>
<span class="linenos"> 928</span>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<span class="linenos"> 929</span>            <span class="s1">&#39;localSentences&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">sentence</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentences</span><span class="p">],</span>
<span class="linenos"> 930</span>            <span class="s1">&#39;imports&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">imp</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">imports</span><span class="p">],</span>
<span class="linenos"> 931</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos"> 932</span>        <span class="p">}</span></div>

<span class="linenos"> 933</span>
<div class="viewcode-block" id="KFlatModule.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModule.let">[docs]</a>
<span class="linenos"> 934</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span>
<span class="linenos"> 935</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 936</span>        <span class="o">*</span><span class="p">,</span>
<span class="linenos"> 937</span>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 938</span>        <span class="n">sentences</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KSentence</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 939</span>        <span class="n">imports</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KImport</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 940</span>        <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 941</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KFlatModule</span><span class="p">:</span>
<span class="linenos"> 942</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
<span class="linenos"> 943</span>        <span class="n">sentences</span> <span class="o">=</span> <span class="n">sentences</span> <span class="k">if</span> <span class="n">sentences</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentences</span>
<span class="linenos"> 944</span>        <span class="n">imports</span> <span class="o">=</span> <span class="n">imports</span> <span class="k">if</span> <span class="n">imports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">imports</span>
<span class="linenos"> 945</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos"> 946</span>        <span class="k">return</span> <span class="n">KFlatModule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">imports</span><span class="o">=</span><span class="n">imports</span><span class="p">,</span> <span class="n">sentences</span><span class="o">=</span><span class="n">sentences</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos"> 947</span>
<div class="viewcode-block" id="KFlatModule.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModule.let_att">[docs]</a>
<span class="linenos"> 948</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KFlatModule</span><span class="p">:</span>
<span class="linenos"> 949</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>
</div>

<span class="linenos"> 950</span>
<span class="linenos"> 951</span>
<div class="viewcode-block" id="KFlatModuleList">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModuleList">[docs]</a>
<span class="linenos"> 952</span><span class="nd">@final</span>
<span class="linenos"> 953</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 954</span><span class="k">class</span><span class="w"> </span><span class="nc">KFlatModuleList</span><span class="p">(</span><span class="n">KOuter</span><span class="p">):</span>
<span class="linenos"> 955</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a list of K modules, as returned by the prover parser for example, with a given module called out as the main module.&quot;&quot;&quot;</span>
<span class="linenos"> 956</span>
<span class="linenos"> 957</span>    <span class="n">main_module</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 958</span>    <span class="n">modules</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos"> 959</span>
<span class="linenos"> 960</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">modules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">]):</span>
<span class="linenos"> 961</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;main_module&#39;</span><span class="p">,</span> <span class="n">main_module</span><span class="p">)</span>
<span class="linenos"> 962</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;modules&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">modules</span><span class="p">))</span>
<span class="linenos"> 963</span>
<div class="viewcode-block" id="KFlatModuleList.from_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModuleList.from_dict">[docs]</a>
<span class="linenos"> 964</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 965</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KFlatModuleList</span><span class="p">:</span>
<span class="linenos"> 966</span>        <span class="k">return</span> <span class="n">KFlatModuleList</span><span class="p">(</span><span class="n">main_module</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;mainModule&#39;</span><span class="p">],</span> <span class="n">modules</span><span class="o">=</span><span class="p">(</span><span class="n">KFlatModule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">kfm</span><span class="p">)</span> <span class="k">for</span> <span class="n">kfm</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]))</span></div>

<span class="linenos"> 967</span>
<div class="viewcode-block" id="KFlatModuleList.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModuleList.to_dict">[docs]</a>
<span class="linenos"> 968</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 969</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 970</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KFlatModuleList&#39;</span><span class="p">,</span>
<span class="linenos"> 971</span>            <span class="s1">&#39;mainModule&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_module</span><span class="p">,</span>
<span class="linenos"> 972</span>            <span class="s1">&#39;term&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mod</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">],</span>
<span class="linenos"> 973</span>        <span class="p">}</span></div>

<span class="linenos"> 974</span>
<div class="viewcode-block" id="KFlatModuleList.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KFlatModuleList.let">[docs]</a>
<span class="linenos"> 975</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">main_module</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">modules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KFlatModuleList</span><span class="p">:</span>
<span class="linenos"> 976</span>        <span class="n">main_module</span> <span class="o">=</span> <span class="n">main_module</span> <span class="k">if</span> <span class="n">main_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_module</span>
<span class="linenos"> 977</span>        <span class="n">modules</span> <span class="o">=</span> <span class="n">modules</span> <span class="k">if</span> <span class="n">modules</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span>
<span class="linenos"> 978</span>        <span class="k">return</span> <span class="n">KFlatModuleList</span><span class="p">(</span><span class="n">main_module</span><span class="o">=</span><span class="n">main_module</span><span class="p">,</span> <span class="n">modules</span><span class="o">=</span><span class="n">modules</span><span class="p">)</span></div>
</div>

<span class="linenos"> 979</span>
<span class="linenos"> 980</span>
<div class="viewcode-block" id="KRequire">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRequire">[docs]</a>
<span class="linenos"> 981</span><span class="nd">@final</span>
<span class="linenos"> 982</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 983</span><span class="k">class</span><span class="w"> </span><span class="nc">KRequire</span><span class="p">(</span><span class="n">KOuter</span><span class="p">):</span>
<span class="linenos"> 984</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a K file import of another file.&quot;&quot;&quot;</span>
<span class="linenos"> 985</span>
<span class="linenos"> 986</span>    <span class="n">require</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 987</span>
<span class="linenos"> 988</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">require</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="linenos"> 989</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;require&#39;</span><span class="p">,</span> <span class="n">require</span><span class="p">)</span>
<span class="linenos"> 990</span>
<div class="viewcode-block" id="KRequire.from_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRequire.from_dict">[docs]</a>
<span class="linenos"> 991</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 992</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KRequire</span><span class="p">:</span>
<span class="linenos"> 993</span>        <span class="k">return</span> <span class="n">KRequire</span><span class="p">(</span><span class="n">require</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;require&#39;</span><span class="p">])</span></div>

<span class="linenos"> 994</span>
<div class="viewcode-block" id="KRequire.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRequire.to_dict">[docs]</a>
<span class="linenos"> 995</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 996</span>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KRequire&#39;</span><span class="p">,</span> <span class="s1">&#39;require&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">require</span><span class="p">}</span></div>

<span class="linenos"> 997</span>
<div class="viewcode-block" id="KRequire.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KRequire.let">[docs]</a>
<span class="linenos"> 998</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">require</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KRequire</span><span class="p">:</span>
<span class="linenos"> 999</span>        <span class="n">require</span> <span class="o">=</span> <span class="n">require</span> <span class="k">if</span> <span class="n">require</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">require</span>
<span class="linenos">1000</span>        <span class="k">return</span> <span class="n">KRequire</span><span class="p">(</span><span class="n">require</span><span class="o">=</span><span class="n">require</span><span class="p">)</span></div>
</div>

<span class="linenos">1001</span>
<span class="linenos">1002</span>
<div class="viewcode-block" id="KDefinition">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition">[docs]</a>
<span class="linenos">1003</span><span class="nd">@final</span>
<span class="linenos">1004</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">1005</span><span class="k">class</span><span class="w"> </span><span class="nc">KDefinition</span><span class="p">(</span><span class="n">KOuter</span><span class="p">,</span> <span class="n">WithKAtt</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">]):</span>
<span class="linenos">1006</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an entire K definition, with file imports and modules in place, and a given module called out as main module.&quot;&quot;&quot;</span>
<span class="linenos">1007</span>
<span class="linenos">1008</span>    <span class="n">main_module_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos">1009</span>    <span class="n">all_modules</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos">1010</span>    <span class="n">requires</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KRequire</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos">1011</span>    <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span>
<span class="linenos">1012</span>
<span class="linenos">1013</span>    <span class="n">main_module</span><span class="p">:</span> <span class="n">InitVar</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">]</span>
<span class="linenos">1014</span>
<span class="linenos">1015</span>    <span class="n">_init_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="n">KInner</span><span class="p">]</span>
<span class="linenos">1016</span>    <span class="n">_empty_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="n">KInner</span><span class="p">]</span>
<span class="linenos">1017</span>
<span class="linenos">1018</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span class="linenos">1019</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos">1020</span>        <span class="n">main_module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="linenos">1021</span>        <span class="n">all_modules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">],</span>
<span class="linenos">1022</span>        <span class="n">requires</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KRequire</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
<span class="linenos">1023</span>        <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">=</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos">1024</span>    <span class="p">):</span>
<span class="linenos">1025</span>        <span class="n">all_modules</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">all_modules</span><span class="p">)</span>
<span class="linenos">1026</span>        <span class="n">main_modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">module</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">all_modules</span> <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">main_module_name</span><span class="p">]</span>
<span class="linenos">1027</span>
<span class="linenos">1028</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">main_modules</span><span class="p">:</span>
<span class="linenos">1029</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Module not found: </span><span class="si">{</span><span class="n">main_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1030</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">main_modules</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1031</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Module is not unique: </span><span class="si">{</span><span class="n">main_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1032</span>
<span class="linenos">1033</span>        <span class="n">main_module</span> <span class="o">=</span> <span class="n">main_modules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">1034</span>
<span class="linenos">1035</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;main_module_name&#39;</span><span class="p">,</span> <span class="n">main_module_name</span><span class="p">)</span>
<span class="linenos">1036</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;all_modules&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">all_modules</span><span class="p">))</span>
<span class="linenos">1037</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;requires&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">requires</span><span class="p">))</span>
<span class="linenos">1038</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
<span class="linenos">1039</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;main_module&#39;</span><span class="p">,</span> <span class="n">main_module</span><span class="p">)</span>
<span class="linenos">1040</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_init_config&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos">1041</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_empty_config&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos">1042</span>
<span class="linenos">1043</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">]:</span>
<span class="linenos">1044</span>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_modules</span><span class="p">)</span>
<span class="linenos">1045</span>
<div class="viewcode-block" id="KDefinition.from_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.from_dict">[docs]</a>
<span class="linenos">1046</span>    <span class="nd">@staticmethod</span>
<span class="linenos">1047</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">KDefinition</span><span class="p">:</span>
<span class="linenos">1048</span>        <span class="k">return</span> <span class="n">KDefinition</span><span class="p">(</span>
<span class="linenos">1049</span>            <span class="n">main_module_name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;mainModule&#39;</span><span class="p">],</span>
<span class="linenos">1050</span>            <span class="n">all_modules</span><span class="o">=</span><span class="p">(</span><span class="n">KFlatModule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">module</span><span class="p">)</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;modules&#39;</span><span class="p">]),</span>
<span class="linenos">1051</span>            <span class="n">requires</span><span class="o">=</span><span class="p">(</span><span class="n">KRequire</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">require</span><span class="p">)</span> <span class="k">for</span> <span class="n">require</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;requires&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;requires&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">(),</span>
<span class="linenos">1052</span>            <span class="n">att</span><span class="o">=</span><span class="n">KAtt</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;att&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">EMPTY_ATT</span><span class="p">,</span>
<span class="linenos">1053</span>        <span class="p">)</span></div>

<span class="linenos">1054</span>
<div class="viewcode-block" id="KDefinition.to_dict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.to_dict">[docs]</a>
<span class="linenos">1055</span>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos">1056</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos">1057</span>            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="s1">&#39;KDefinition&#39;</span><span class="p">,</span>
<span class="linenos">1058</span>            <span class="s1">&#39;mainModule&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_module_name</span><span class="p">,</span>
<span class="linenos">1059</span>            <span class="s1">&#39;modules&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">module</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_modules</span><span class="p">],</span>
<span class="linenos">1060</span>            <span class="s1">&#39;requires&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">require</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">require</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">],</span>
<span class="linenos">1061</span>            <span class="s1">&#39;att&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos">1062</span>        <span class="p">}</span></div>

<span class="linenos">1063</span>
<div class="viewcode-block" id="KDefinition.let">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.let">[docs]</a>
<span class="linenos">1064</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span>
<span class="linenos">1065</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos">1066</span>        <span class="o">*</span><span class="p">,</span>
<span class="linenos">1067</span>        <span class="n">main_module_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos">1068</span>        <span class="n">all_modules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos">1069</span>        <span class="n">requires</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KRequire</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos">1070</span>        <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos">1071</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KDefinition</span><span class="p">:</span>
<span class="linenos">1072</span>        <span class="n">main_module_name</span> <span class="o">=</span> <span class="n">main_module_name</span> <span class="k">if</span> <span class="n">main_module_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_module_name</span>
<span class="linenos">1073</span>        <span class="n">all_modules</span> <span class="o">=</span> <span class="n">all_modules</span> <span class="k">if</span> <span class="n">all_modules</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_modules</span>
<span class="linenos">1074</span>        <span class="n">requires</span> <span class="o">=</span> <span class="n">requires</span> <span class="k">if</span> <span class="n">requires</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span>
<span class="linenos">1075</span>        <span class="n">att</span> <span class="o">=</span> <span class="n">att</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span>
<span class="linenos">1076</span>        <span class="k">return</span> <span class="n">KDefinition</span><span class="p">(</span><span class="n">main_module_name</span><span class="o">=</span><span class="n">main_module_name</span><span class="p">,</span> <span class="n">all_modules</span><span class="o">=</span><span class="n">all_modules</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos">1077</span>
<div class="viewcode-block" id="KDefinition.let_att">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.let_att">[docs]</a>
<span class="linenos">1078</span>    <span class="k">def</span><span class="w"> </span><span class="nf">let_att</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="n">KAtt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KDefinition</span><span class="p">:</span>
<span class="linenos">1079</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span></div>

<span class="linenos">1080</span>
<span class="linenos">1081</span>    <span class="nd">@cached_property</span>
<span class="linenos">1082</span>    <span class="k">def</span><span class="w"> </span><span class="nf">all_module_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1083</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the name of all modules in this `KDefinition`.&quot;&quot;&quot;</span>
<span class="linenos">1084</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_modules</span><span class="p">)</span>
<span class="linenos">1085</span>
<span class="linenos">1086</span>    <span class="nd">@cached_property</span>
<span class="linenos">1087</span>    <span class="k">def</span><span class="w"> </span><span class="nf">module_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1088</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the list of module names transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1089</span>        <span class="n">module_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">main_module_name</span><span class="p">]</span>
<span class="linenos">1090</span>        <span class="n">seen_modules</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1091</span>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">module_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1092</span>            <span class="n">mname</span> <span class="o">=</span> <span class="n">module_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">1093</span>            <span class="k">if</span> <span class="n">mname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_modules</span><span class="p">:</span>
<span class="linenos">1094</span>                <span class="n">seen_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mname</span><span class="p">)</span>
<span class="linenos">1095</span>                <span class="n">module_names</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_modules_dict</span><span class="p">[</span><span class="n">mname</span><span class="p">]</span><span class="o">.</span><span class="n">imports</span><span class="p">])</span>
<span class="linenos">1096</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">seen_modules</span><span class="p">)</span>
<span class="linenos">1097</span>
<span class="linenos">1098</span>    <span class="nd">@cached_property</span>
<span class="linenos">1099</span>    <span class="k">def</span><span class="w"> </span><span class="nf">all_modules_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KFlatModule</span><span class="p">]:</span>
<span class="linenos">1100</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dictionary of all the modules (with names as keys) defined in this definition.&quot;&quot;&quot;</span>
<span class="linenos">1101</span>        <span class="k">return</span> <span class="p">{</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_modules</span><span class="p">}</span>
<span class="linenos">1102</span>
<span class="linenos">1103</span>    <span class="nd">@cached_property</span>
<span class="linenos">1104</span>    <span class="k">def</span><span class="w"> </span><span class="nf">modules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KFlatModule</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1105</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the list of modules transitively imported by th emain module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1106</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_modules_dict</span><span class="p">[</span><span class="n">mname</span><span class="p">]</span> <span class="k">for</span> <span class="n">mname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_names</span><span class="p">)</span>
<span class="linenos">1107</span>
<span class="linenos">1108</span>    <span class="nd">@cached_property</span>
<span class="linenos">1109</span>    <span class="k">def</span><span class="w"> </span><span class="nf">productions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1110</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `KProduction` transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1111</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">productions</span><span class="p">)</span>
<span class="linenos">1112</span>
<span class="linenos">1113</span>    <span class="nd">@cached_property</span>
<span class="linenos">1114</span>    <span class="k">def</span><span class="w"> </span><span class="nf">syntax_productions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1115</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `KProduction` which are syntax declarations transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1116</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">syntax_productions</span><span class="p">)</span>
<span class="linenos">1117</span>
<span class="linenos">1118</span>    <span class="nd">@cached_property</span>
<span class="linenos">1119</span>    <span class="k">def</span><span class="w"> </span><span class="nf">functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1120</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `KProduction` which are function declarations transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1121</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">func</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span>
<span class="linenos">1122</span>
<span class="linenos">1123</span>    <span class="nd">@cached_property</span>
<span class="linenos">1124</span>    <span class="k">def</span><span class="w"> </span><span class="nf">function_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1125</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the label names of all the `KProduction` which are function symbols for all modules in this definition.&quot;&quot;&quot;</span>
<span class="linenos">1126</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">not_none</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">klabel</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span>
<span class="linenos">1127</span>
<span class="linenos">1128</span>    <span class="nd">@cached_property</span>
<span class="linenos">1129</span>    <span class="k">def</span><span class="w"> </span><span class="nf">constructors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1130</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `KProduction` which are constructor declarations transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1131</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ctor</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="k">for</span> <span class="n">ctor</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">constructors</span><span class="p">)</span>
<span class="linenos">1132</span>
<span class="linenos">1133</span>    <span class="nd">@cached_property</span>
<span class="linenos">1134</span>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_collection_productions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KProduction</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1135</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `KProduction` which are cell collection declarations transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1136</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">cell_collection_productions</span><span class="p">)</span>
<span class="linenos">1137</span>
<span class="linenos">1138</span>    <span class="nd">@cached_property</span>
<span class="linenos">1139</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KRule</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1140</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `KRule` sentences transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1141</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rule</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span>
<span class="linenos">1142</span>
<span class="linenos">1143</span>    <span class="nd">@cached_property</span>
<span class="linenos">1144</span>    <span class="k">def</span><span class="w"> </span><span class="nf">alias_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KRule</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1145</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `KRule` sentences which are `alias` transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1146</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rule</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">ALIAS</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">att</span><span class="p">)</span>
<span class="linenos">1147</span>
<span class="linenos">1148</span>    <span class="nd">@cached_property</span>
<span class="linenos">1149</span>    <span class="k">def</span><span class="w"> </span><span class="nf">macro_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KRule</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1150</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `KRule` sentences which are `alias` or `macro` transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1151</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rule</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">MACRO</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">att</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias_rules</span>
<span class="linenos">1152</span>
<span class="linenos">1153</span>    <span class="nd">@cached_property</span>
<span class="linenos">1154</span>    <span class="k">def</span><span class="w"> </span><span class="nf">semantic_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KRule</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos">1155</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `KRule` sentences which are topmost transitively imported by the main module of this definition.&quot;&quot;&quot;</span>
<span class="linenos">1156</span>
<span class="linenos">1157</span>        <span class="k">def</span><span class="w"> </span><span class="nf">is_semantic</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="n">KRule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">1158</span>            <span class="k">return</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KApply</span> <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&lt;generatedTop&gt;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
<span class="linenos">1159</span>                <span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KRewrite</span>
<span class="linenos">1160</span>                <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KApply</span>
<span class="linenos">1161</span>                <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&lt;generatedTop&gt;&#39;</span>
<span class="linenos">1162</span>            <span class="p">)</span>
<span class="linenos">1163</span>
<span class="linenos">1164</span>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rule</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="k">if</span> <span class="n">is_semantic</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span>
<span class="linenos">1165</span>
<span class="linenos">1166</span>    <span class="nd">@cached_property</span>
<span class="linenos">1167</span>    <span class="k">def</span><span class="w"> </span><span class="nf">sentence_by_unique_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KSentence</span><span class="p">]:</span>
<span class="linenos">1168</span>        <span class="n">unique_id_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KSentence</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1169</span>        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_modules</span><span class="p">:</span>
<span class="linenos">1170</span>            <span class="k">for</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">sentence_by_unique_id</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">1171</span>                <span class="k">if</span> <span class="n">unique_id</span> <span class="ow">in</span> <span class="n">unique_id_map</span> <span class="ow">and</span> <span class="n">sent</span> <span class="o">!=</span> <span class="n">unique_id_map</span><span class="p">[</span><span class="n">unique_id</span><span class="p">]:</span>
<span class="linenos">1172</span>                    <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<span class="linenos">1173</span>                        <span class="sa">f</span><span class="s1">&#39;Same UNIQUE_ID found for two different sentences: </span><span class="si">{</span><span class="p">(</span><span class="n">sent</span><span class="p">,</span><span class="w"> </span><span class="n">unique_id_map</span><span class="p">[</span><span class="n">unique_id</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos">1174</span>                    <span class="p">)</span>
<span class="linenos">1175</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">1176</span>                    <span class="n">unique_id_map</span><span class="p">[</span><span class="n">unique_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">sent</span>
<span class="linenos">1177</span>        <span class="k">return</span> <span class="n">unique_id_map</span>
<span class="linenos">1178</span>
<div class="viewcode-block" id="KDefinition.production_for_cell_sort">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.production_for_cell_sort">[docs]</a>
<span class="linenos">1179</span>    <span class="k">def</span><span class="w"> </span><span class="nf">production_for_cell_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KProduction</span><span class="p">:</span>
<span class="linenos">1180</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the production for a given cell-declaration syntax from the cell&#39;s declared sort.&quot;&quot;&quot;</span>
<span class="linenos">1181</span>        <span class="c1"># Typical cell production has 3 productions:</span>
<span class="linenos">1182</span>        <span class="c1">#     syntax KCell ::= &quot;project:KCell&quot; &quot;(&quot; K &quot;)&quot; [function, projection]</span>
<span class="linenos">1183</span>        <span class="c1">#     syntax KCell ::= &quot;initKCell&quot; &quot;(&quot; Map &quot;)&quot; [function, initializer, noThread]</span>
<span class="linenos">1184</span>        <span class="c1">#     syntax KCell ::= &quot;&lt;k&gt;&quot; K &quot;&lt;/k&gt;&quot; [cell, cellName(k), format(%1%i%n%2%d%n%3), maincell, org.kframework.definition.Production(syntax #RuleContent ::= #RuleBody [klabel(#ruleNoConditions), symbol])]</span>
<span class="linenos">1185</span>        <span class="c1"># And it may have a 4th:</span>
<span class="linenos">1186</span>        <span class="c1">#     syntax GeneratedCounterCell ::= &quot;getGeneratedCounterCell&quot; &quot;(&quot; GeneratedTopCell &quot;)&quot; [function]</span>
<span class="linenos">1187</span>        <span class="c1"># We want the actual label one (3rd one in the list).</span>
<span class="linenos">1188</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">sort</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Cell&#39;</span><span class="p">):</span>
<span class="linenos">1189</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="linenos">1190</span>                <span class="sa">f</span><span class="s1">&#39;Method production_for_cell_sort only intended to be called on sorts ending in &quot;Cell&quot;, not: </span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos">1191</span>            <span class="p">)</span>
<span class="linenos">1192</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">1193</span>            <span class="k">return</span> <span class="n">single</span><span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="k">if</span> <span class="n">prod</span><span class="o">.</span><span class="n">sort</span> <span class="o">==</span> <span class="n">sort</span> <span class="ow">and</span> <span class="n">Atts</span><span class="o">.</span><span class="n">CELL</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="p">)</span>
<span class="linenos">1194</span>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="linenos">1195</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expected a single cell production for sort </span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span></div>

<span class="linenos">1196</span>
<div class="viewcode-block" id="KDefinition.module">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.module">[docs]</a>
<span class="linenos">1197</span>    <span class="k">def</span><span class="w"> </span><span class="nf">module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KFlatModule</span><span class="p">:</span>
<span class="linenos">1198</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the module associated with a given name.&quot;&quot;&quot;</span>
<span class="linenos">1199</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_modules_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<span class="linenos">1200</span>
<span class="linenos">1201</span>    <span class="nd">@cached_property</span>
<span class="linenos">1202</span>    <span class="k">def</span><span class="w"> </span><span class="nf">subsort_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="n">KSort</span><span class="p">]]:</span>
<span class="linenos">1203</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a mapping from sorts to all their proper subsorts.&quot;&quot;&quot;</span>
<span class="linenos">1204</span>        <span class="n">poset</span> <span class="o">=</span> <span class="n">POSet</span><span class="p">(</span><span class="n">subsort</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="k">if</span> <span class="p">(</span><span class="n">subsort</span> <span class="o">:=</span> <span class="n">prod</span><span class="o">.</span><span class="n">as_subsort</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
<span class="linenos">1205</span>        <span class="k">return</span> <span class="n">poset</span><span class="o">.</span><span class="n">image</span>
<span class="linenos">1206</span>
<div class="viewcode-block" id="KDefinition.subsorts">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.subsorts">[docs]</a>
<span class="linenos">1207</span>    <span class="k">def</span><span class="w"> </span><span class="nf">subsorts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">frozenset</span><span class="p">[</span><span class="n">KSort</span><span class="p">]:</span>
<span class="linenos">1208</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all subsorts of a given `KSort` by inspecting the definition.&quot;&quot;&quot;</span>
<span class="linenos">1209</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsort_table</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">())</span></div>

<span class="linenos">1210</span>
<span class="linenos">1211</span>    <span class="nd">@cached_property</span>
<span class="linenos">1212</span>    <span class="k">def</span><span class="w"> </span><span class="nf">brackets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="n">KProduction</span><span class="p">]:</span>
<span class="linenos">1213</span>        <span class="n">brackets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="n">KProduction</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1214</span>        <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="p">:</span>
<span class="linenos">1215</span>            <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">BRACKET</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="p">:</span>
<span class="linenos">1216</span>                <span class="k">assert</span> <span class="ow">not</span> <span class="n">prod</span><span class="o">.</span><span class="n">klabel</span>
<span class="linenos">1217</span>                <span class="n">sort</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">sort</span>
<span class="linenos">1218</span>                <span class="k">if</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">brackets</span><span class="p">:</span>
<span class="linenos">1219</span>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Multiple bracket productions for sort: </span><span class="si">{</span><span class="n">sort</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1220</span>                <span class="n">brackets</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>
<span class="linenos">1221</span>        <span class="k">return</span> <span class="n">FrozenDict</span><span class="p">(</span><span class="n">brackets</span><span class="p">)</span>
<span class="linenos">1222</span>
<span class="linenos">1223</span>    <span class="nd">@cached_property</span>
<span class="linenos">1224</span>    <span class="k">def</span><span class="w"> </span><span class="nf">symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KProduction</span><span class="p">]:</span>
<span class="linenos">1225</span>        <span class="n">symbols</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KProduction</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1226</span>        <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="p">:</span>
<span class="linenos">1227</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">prod</span><span class="o">.</span><span class="n">klabel</span><span class="p">:</span>
<span class="linenos">1228</span>                <span class="k">continue</span>
<span class="linenos">1229</span>            <span class="n">symbol</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">klabel</span><span class="o">.</span><span class="n">name</span>
<span class="linenos">1230</span>            <span class="k">if</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>  <span class="c1"># Check if duplicate</span>
<span class="linenos">1231</span>                <span class="n">other</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<span class="linenos">1232</span>                <span class="k">if</span> <span class="n">prod</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">drop_source</span><span class="p">())</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">drop_source</span><span class="p">()):</span>
<span class="linenos">1233</span>                    <span class="n">prods</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="p">,</span> <span class="n">prod</span><span class="p">]</span>
<span class="linenos">1234</span>                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found multiple productions for </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">prods</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1235</span>                <span class="k">continue</span>
<span class="linenos">1236</span>            <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>
<span class="linenos">1237</span>        <span class="k">return</span> <span class="n">FrozenDict</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
<span class="linenos">1238</span>
<span class="linenos">1239</span>    <span class="nd">@cached_property</span>
<span class="linenos">1240</span>    <span class="k">def</span><span class="w"> </span><span class="nf">syntax_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KProduction</span><span class="p">]:</span>
<span class="linenos">1241</span>        <span class="n">brackets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KProduction</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">1242</span>            <span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">BRACKET_LABEL</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">prod</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">brackets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="linenos">1243</span>        <span class="p">}</span>
<span class="linenos">1244</span>        <span class="k">return</span> <span class="n">FrozenDict</span><span class="p">({</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="o">**</span><span class="n">brackets</span><span class="p">})</span>
<span class="linenos">1245</span>
<span class="linenos">1246</span>    <span class="nd">@cached_property</span>
<span class="linenos">1247</span>    <span class="k">def</span><span class="w"> </span><span class="nf">overloads</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="linenos">1248</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a mapping from symbols to the sets of symbols that overload them.&quot;&quot;&quot;</span>
<span class="linenos">1249</span>
<span class="linenos">1250</span>        <span class="k">def</span><span class="w"> </span><span class="nf">lt</span><span class="p">(</span><span class="n">overloader</span><span class="p">:</span> <span class="n">KProduction</span><span class="p">,</span> <span class="n">overloaded</span><span class="p">:</span> <span class="n">KProduction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">1251</span>            <span class="k">assert</span> <span class="n">overloader</span><span class="o">.</span><span class="n">klabel</span>
<span class="linenos">1252</span>            <span class="k">assert</span> <span class="n">overloaded</span><span class="o">.</span><span class="n">klabel</span>
<span class="linenos">1253</span>            <span class="k">assert</span> <span class="n">overloader</span><span class="o">.</span><span class="n">klabel</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">overloaded</span><span class="o">.</span><span class="n">klabel</span><span class="o">.</span><span class="n">name</span>
<span class="linenos">1254</span>            <span class="k">assert</span> <span class="n">Atts</span><span class="o">.</span><span class="n">OVERLOAD</span> <span class="ow">in</span> <span class="n">overloader</span><span class="o">.</span><span class="n">att</span>
<span class="linenos">1255</span>            <span class="k">assert</span> <span class="n">Atts</span><span class="o">.</span><span class="n">OVERLOAD</span> <span class="ow">in</span> <span class="n">overloaded</span><span class="o">.</span><span class="n">att</span>
<span class="linenos">1256</span>            <span class="k">assert</span> <span class="n">overloader</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">OVERLOAD</span><span class="p">]</span> <span class="o">==</span> <span class="n">overloaded</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">OVERLOAD</span><span class="p">]</span>
<span class="linenos">1257</span>            <span class="n">overloader_sorts</span> <span class="o">=</span> <span class="p">[</span><span class="n">overloader</span><span class="o">.</span><span class="n">sort</span><span class="p">]</span> <span class="o">+</span> <span class="n">overloader</span><span class="o">.</span><span class="n">argument_sorts</span>
<span class="linenos">1258</span>            <span class="n">overloaded_sorts</span> <span class="o">=</span> <span class="p">[</span><span class="n">overloaded</span><span class="o">.</span><span class="n">sort</span><span class="p">]</span> <span class="o">+</span> <span class="n">overloaded</span><span class="o">.</span><span class="n">argument_sorts</span>
<span class="linenos">1259</span>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">overloader_sorts</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">overloaded_sorts</span><span class="p">):</span>
<span class="linenos">1260</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">1261</span>            <span class="n">less</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">1262</span>            <span class="k">for</span> <span class="n">overloader_sort</span><span class="p">,</span> <span class="n">overloaded_sort</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">overloader_sorts</span><span class="p">,</span> <span class="n">overloaded_sorts</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="linenos">1263</span>                <span class="k">if</span> <span class="n">overloader_sort</span> <span class="o">==</span> <span class="n">overloaded_sort</span><span class="p">:</span>
<span class="linenos">1264</span>                    <span class="k">continue</span>
<span class="linenos">1265</span>                <span class="k">if</span> <span class="n">overloader_sort</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsorts</span><span class="p">(</span><span class="n">overloaded_sort</span><span class="p">):</span>
<span class="linenos">1266</span>                    <span class="n">less</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">1267</span>                    <span class="k">continue</span>
<span class="linenos">1268</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">1269</span>            <span class="k">return</span> <span class="n">less</span>
<span class="linenos">1270</span>
<span class="linenos">1271</span>        <span class="n">symbols_by_overload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1272</span>        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
<span class="linenos">1273</span>            <span class="n">prod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<span class="linenos">1274</span>            <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">OVERLOAD</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="p">:</span>
<span class="linenos">1275</span>                <span class="n">symbols_by_overload</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">OVERLOAD</span><span class="p">],</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<span class="linenos">1276</span>
<span class="linenos">1277</span>        <span class="n">overloads</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1278</span>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">symbols</span> <span class="ow">in</span> <span class="n">symbols_by_overload</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">1279</span>            <span class="k">for</span> <span class="n">overloader</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
<span class="linenos">1280</span>                <span class="k">for</span> <span class="n">overloaded</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
<span class="linenos">1281</span>                    <span class="k">if</span> <span class="n">overloader</span> <span class="o">==</span> <span class="n">overloaded</span><span class="p">:</span>
<span class="linenos">1282</span>                        <span class="k">continue</span>
<span class="linenos">1283</span>                    <span class="k">if</span> <span class="n">lt</span><span class="p">(</span><span class="n">overloader</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">overloader</span><span class="p">],</span> <span class="n">overloaded</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">overloaded</span><span class="p">]):</span>
<span class="linenos">1284</span>                        <span class="c1"># Index by overloaded symbol, this way it is easy to look them up</span>
<span class="linenos">1285</span>                        <span class="n">overloads</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">overloaded</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overloader</span><span class="p">)</span>
<span class="linenos">1286</span>        <span class="k">return</span> <span class="n">FrozenDict</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">overloads</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
<span class="linenos">1287</span>
<span class="linenos">1288</span>    <span class="nd">@cached_property</span>
<span class="linenos">1289</span>    <span class="k">def</span><span class="w"> </span><span class="nf">priorities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="linenos">1290</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a mapping from symbols to the sets of symbols with lower priority.&quot;&quot;&quot;</span>
<span class="linenos">1291</span>        <span class="n">syntax_priorities</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos">1292</span>            <span class="n">sent</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">sentences</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sent</span><span class="p">,</span> <span class="n">KSyntaxPriority</span><span class="p">)</span>
<span class="linenos">1293</span>        <span class="p">)</span>
<span class="linenos">1294</span>        <span class="n">relation</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
<span class="linenos">1295</span>            <span class="n">pair</span>
<span class="linenos">1296</span>            <span class="k">for</span> <span class="n">syntax_priority</span> <span class="ow">in</span> <span class="n">syntax_priorities</span>
<span class="linenos">1297</span>            <span class="k">for</span> <span class="n">highers</span><span class="p">,</span> <span class="n">lowers</span> <span class="ow">in</span> <span class="n">pairwise</span><span class="p">(</span><span class="n">syntax_priority</span><span class="o">.</span><span class="n">priorities</span><span class="p">)</span>
<span class="linenos">1298</span>            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">highers</span><span class="p">,</span> <span class="n">lowers</span><span class="p">)</span>
<span class="linenos">1299</span>        <span class="p">)</span>
<span class="linenos">1300</span>        <span class="k">return</span> <span class="n">POSet</span><span class="p">(</span><span class="n">relation</span><span class="p">)</span><span class="o">.</span><span class="n">image</span>
<span class="linenos">1301</span>
<span class="linenos">1302</span>    <span class="nd">@cached_property</span>
<span class="linenos">1303</span>    <span class="k">def</span><span class="w"> </span><span class="nf">left_assocs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="linenos">1304</span>        <span class="k">return</span> <span class="n">FrozenDict</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assocs</span><span class="p">(</span><span class="n">KAssoc</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
<span class="linenos">1305</span>
<span class="linenos">1306</span>    <span class="nd">@cached_property</span>
<span class="linenos">1307</span>    <span class="k">def</span><span class="w"> </span><span class="nf">right_assocs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="linenos">1308</span>        <span class="k">return</span> <span class="n">FrozenDict</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assocs</span><span class="p">(</span><span class="n">KAssoc</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
<span class="linenos">1309</span>
<span class="linenos">1310</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_assocs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assoc</span><span class="p">:</span> <span class="n">KAssoc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="linenos">1311</span>        <span class="n">sents</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos">1312</span>            <span class="n">sent</span>
<span class="linenos">1313</span>            <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span>
<span class="linenos">1314</span>            <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">sentences</span>
<span class="linenos">1315</span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sent</span><span class="p">,</span> <span class="n">KSyntaxAssociativity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sent</span><span class="o">.</span><span class="n">assoc</span> <span class="ow">in</span> <span class="p">(</span><span class="n">assoc</span><span class="p">,</span> <span class="n">KAssoc</span><span class="o">.</span><span class="n">NON_ASSOC</span><span class="p">)</span>
<span class="linenos">1316</span>        <span class="p">)</span>
<span class="linenos">1317</span>        <span class="n">pairs</span> <span class="o">=</span> <span class="p">(</span><span class="n">pair</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">sents</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">sent</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">sent</span><span class="o">.</span><span class="n">tags</span><span class="p">))</span>
<span class="linenos">1318</span>
<span class="linenos">1319</span>        <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="o">*</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="linenos">1320</span>            <span class="n">dct</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="linenos">1321</span>            <span class="k">return</span> <span class="n">dct</span>
<span class="linenos">1322</span>
<span class="linenos">1323</span>        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">res</span><span class="p">,</span> <span class="n">pair</span><span class="p">:</span> <span class="n">insert</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">pairs</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos">1324</span>
<div class="viewcode-block" id="KDefinition.sort">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.sort">[docs]</a>
<span class="linenos">1325</span>    <span class="k">def</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSort</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1326</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the sort of a given term using best-effort simple sorting algorithm, returns `None` on algorithm failure.&quot;&quot;&quot;</span>
<span class="linenos">1327</span>        <span class="k">match</span> <span class="n">kast</span><span class="p">:</span>
<span class="linenos">1328</span>            <span class="k">case</span><span class="w"> </span><span class="n">KToken</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span> <span class="o">|</span> <span class="n">KVariable</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">sort</span><span class="p">):</span>
<span class="linenos">1329</span>                <span class="k">return</span> <span class="n">sort</span>
<span class="linenos">1330</span>            <span class="k">case</span> <span class="n">KRewrite</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
<span class="linenos">1331</span>                <span class="n">lhs_sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span>
<span class="linenos">1332</span>                <span class="n">rhs_sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
<span class="linenos">1333</span>                <span class="k">if</span> <span class="n">lhs_sort</span> <span class="ow">and</span> <span class="n">rhs_sort</span><span class="p">:</span>
<span class="linenos">1334</span>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">least_common_supersort</span><span class="p">(</span><span class="n">lhs_sort</span><span class="p">,</span> <span class="n">rhs_sort</span><span class="p">)</span>
<span class="linenos">1335</span>                <span class="k">return</span> <span class="kc">None</span>
<span class="linenos">1336</span>            <span class="k">case</span><span class="w"> </span><span class="n">KSequence</span><span class="p">(</span><span class="k">_</span><span class="p">):</span>
<span class="linenos">1337</span>                <span class="k">return</span> <span class="n">KSort</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">)</span>
<span class="linenos">1338</span>            <span class="k">case</span><span class="w"> </span><span class="n">KApply</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="k">_</span><span class="p">):</span>
<span class="linenos">1339</span>                <span class="n">sort</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_sorts</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="linenos">1340</span>                <span class="k">return</span> <span class="n">sort</span>
<span class="linenos">1341</span>            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
<span class="linenos">1342</span>                <span class="k">return</span> <span class="kc">None</span></div>

<span class="linenos">1343</span>
<div class="viewcode-block" id="KDefinition.sort_strict">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.sort_strict">[docs]</a>
<span class="linenos">1344</span>    <span class="k">def</span><span class="w"> </span><span class="nf">sort_strict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSort</span><span class="p">:</span>
<span class="linenos">1345</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the sort of a given term using best-effort simple sorting algorithm, dies on algorithm failure.&quot;&quot;&quot;</span>
<span class="linenos">1346</span>        <span class="n">sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">kast</span><span class="p">)</span>
<span class="linenos">1347</span>        <span class="k">if</span> <span class="n">sort</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1348</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not determine sort of term: </span><span class="si">{</span><span class="n">kast</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1349</span>        <span class="k">return</span> <span class="n">sort</span></div>

<span class="linenos">1350</span>
<div class="viewcode-block" id="KDefinition.resolve_sorts">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.resolve_sorts">[docs]</a>
<span class="linenos">1351</span>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_sorts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="n">KLabel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
<span class="linenos">1352</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the result and argument sorts for a given production based on a `KLabel`.&quot;&quot;&quot;</span>
<span class="linenos">1353</span>        <span class="n">prod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="linenos">1354</span>        <span class="n">sorts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="linenos">1355</span>
<span class="linenos">1356</span>        <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span><span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSort</span><span class="p">:</span>
<span class="linenos">1357</span>            <span class="k">return</span> <span class="n">sorts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span>
<span class="linenos">1358</span>
<span class="linenos">1359</span>        <span class="k">return</span> <span class="n">resolve</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">sort</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">resolve</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span> <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">argument_sorts</span><span class="p">)</span></div>

<span class="linenos">1360</span>
<div class="viewcode-block" id="KDefinition.least_common_supersort">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.least_common_supersort">[docs]</a>
<span class="linenos">1361</span>    <span class="k">def</span><span class="w"> </span><span class="nf">least_common_supersort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort1</span><span class="p">:</span> <span class="n">KSort</span><span class="p">,</span> <span class="n">sort2</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSort</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1362</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the lowest-upper-bound of two sorts in the sort lattice using very simple approach, returning `None` on failure (not necessarily meaning there isn&#39;t a lub).&quot;&quot;&quot;</span>
<span class="linenos">1363</span>        <span class="k">if</span> <span class="n">sort1</span> <span class="o">==</span> <span class="n">sort2</span><span class="p">:</span>
<span class="linenos">1364</span>            <span class="k">return</span> <span class="n">sort1</span>
<span class="linenos">1365</span>        <span class="k">if</span> <span class="n">sort1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsorts</span><span class="p">(</span><span class="n">sort2</span><span class="p">):</span>
<span class="linenos">1366</span>            <span class="k">return</span> <span class="n">sort2</span>
<span class="linenos">1367</span>        <span class="k">if</span> <span class="n">sort2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsorts</span><span class="p">(</span><span class="n">sort1</span><span class="p">):</span>
<span class="linenos">1368</span>            <span class="k">return</span> <span class="n">sort1</span>
<span class="linenos">1369</span>        <span class="c1"># Computing least common supersort is not currently supported if sort1 is not a subsort of sort2 or</span>
<span class="linenos">1370</span>        <span class="c1"># vice versa. In that case there may be more than one LCS.</span>
<span class="linenos">1371</span>        <span class="k">return</span> <span class="kc">None</span></div>

<span class="linenos">1372</span>
<div class="viewcode-block" id="KDefinition.greatest_common_subsort">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.greatest_common_subsort">[docs]</a>
<span class="linenos">1373</span>    <span class="k">def</span><span class="w"> </span><span class="nf">greatest_common_subsort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort1</span><span class="p">:</span> <span class="n">KSort</span><span class="p">,</span> <span class="n">sort2</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KSort</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1374</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the greatest-lower-bound of two sorts in the sort lattice using very simple approach, returning `None` on failure (not necessarily meaning there isn&#39;t a glb).&quot;&quot;&quot;</span>
<span class="linenos">1375</span>        <span class="k">if</span> <span class="n">sort1</span> <span class="o">==</span> <span class="n">sort2</span><span class="p">:</span>
<span class="linenos">1376</span>            <span class="k">return</span> <span class="n">sort1</span>
<span class="linenos">1377</span>        <span class="k">if</span> <span class="n">sort1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsorts</span><span class="p">(</span><span class="n">sort2</span><span class="p">):</span>
<span class="linenos">1378</span>            <span class="k">return</span> <span class="n">sort1</span>
<span class="linenos">1379</span>        <span class="k">if</span> <span class="n">sort2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsorts</span><span class="p">(</span><span class="n">sort1</span><span class="p">):</span>
<span class="linenos">1380</span>            <span class="k">return</span> <span class="n">sort2</span>
<span class="linenos">1381</span>        <span class="c1"># Computing greatest common subsort is not currently supported if sort1 is not a subsort of sort2 or</span>
<span class="linenos">1382</span>        <span class="c1"># vice versa. In that case there may be more than one GCS.</span>
<span class="linenos">1383</span>        <span class="k">return</span> <span class="kc">None</span></div>

<span class="linenos">1384</span>
<span class="linenos">1385</span>    <span class="c1"># Sorts like Int cannot be injected directly into sort K so they are embedded in a KSequence.</span>
<div class="viewcode-block" id="KDefinition.add_ksequence_under_k_productions">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.add_ksequence_under_k_productions">[docs]</a>
<span class="linenos">1386</span>    <span class="k">def</span><span class="w"> </span><span class="nf">add_ksequence_under_k_productions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1387</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inject a `KSequence` under the given term if it&#39;s a subsort of `K` and is being used somewhere that sort `K` is expected (determined by inspecting the definition).&quot;&quot;&quot;</span>
<span class="linenos">1388</span>
<span class="linenos">1389</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_add_ksequence_under_k_productions</span><span class="p">(</span><span class="n">_kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1390</span>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_kast</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">KApply</span><span class="p">:</span>
<span class="linenos">1391</span>                <span class="k">return</span> <span class="n">_kast</span>
<span class="linenos">1392</span>
<span class="linenos">1393</span>            <span class="n">prod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">_kast</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="linenos">1394</span>            <span class="k">return</span> <span class="n">KApply</span><span class="p">(</span>
<span class="linenos">1395</span>                <span class="n">_kast</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
<span class="linenos">1396</span>                <span class="p">[</span>
<span class="linenos">1397</span>                    <span class="n">KSequence</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">if</span> <span class="n">sort</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="n">KSort</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">arg</span>
<span class="linenos">1398</span>                    <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">sort</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_kast</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">prod</span><span class="o">.</span><span class="n">argument_sorts</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">1399</span>                <span class="p">],</span>
<span class="linenos">1400</span>            <span class="p">)</span>
<span class="linenos">1401</span>
<span class="linenos">1402</span>        <span class="k">return</span> <span class="n">top_down</span><span class="p">(</span><span class="n">_add_ksequence_under_k_productions</span><span class="p">,</span> <span class="n">kast</span><span class="p">)</span></div>

<span class="linenos">1403</span>
<div class="viewcode-block" id="KDefinition.sort_vars">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.sort_vars">[docs]</a>
<span class="linenos">1404</span>    <span class="k">def</span><span class="w"> </span><span class="nf">sort_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1405</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the original term with all the variables having the sorts added or specialized, failing if recieving conflicting sorts for a given variable.&quot;&quot;&quot;</span>
<span class="linenos">1406</span>        <span class="n">ml_quantifiers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;#Exists&#39;</span><span class="p">,</span> <span class="s1">&#39;#Forall&#39;</span><span class="p">}</span>
<span class="linenos">1407</span>
<span class="linenos">1408</span>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kast</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KVariable</span> <span class="ow">and</span> <span class="n">kast</span><span class="o">.</span><span class="n">sort</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1409</span>            <span class="k">return</span> <span class="n">kast</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">)</span>
<span class="linenos">1410</span>
<span class="linenos">1411</span>        <span class="k">def</span><span class="w"> </span><span class="nf">get_quantifier_variable</span><span class="p">(</span><span class="n">q</span><span class="p">:</span> <span class="n">KApply</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KVariable</span><span class="p">:</span>
<span class="linenos">1412</span>            <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">arity</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos">1413</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expected a quantifier to have 2 children, got </span><span class="si">{</span><span class="n">q</span><span class="o">.</span><span class="n">arity</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<span class="linenos">1414</span>            <span class="n">var</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">1415</span>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">KVariable</span><span class="p">):</span>
<span class="linenos">1416</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected a quantifier&#39;s first child to be a variable, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">1417</span>            <span class="k">return</span> <span class="n">var</span>
<span class="linenos">1418</span>
<span class="linenos">1419</span>        <span class="k">def</span><span class="w"> </span><span class="nf">merge_variables</span><span class="p">(</span>
<span class="linenos">1420</span>            <span class="n">term</span><span class="p">:</span> <span class="n">KInner</span><span class="p">,</span> <span class="n">occurrences_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">KVariable</span><span class="p">]]]</span>
<span class="linenos">1421</span>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">KVariable</span><span class="p">]]:</span>
<span class="linenos">1422</span>            <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">KVariable</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="linenos">1423</span>            <span class="k">for</span> <span class="n">occurrences</span> <span class="ow">in</span> <span class="n">occurrences_list</span><span class="p">:</span>
<span class="linenos">1424</span>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">occurrences</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">occurrences</span><span class="p">)</span>
<span class="linenos">1425</span>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">occurrences</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">1426</span>                    <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
<span class="linenos">1427</span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">KVariable</span><span class="p">):</span>
<span class="linenos">1428</span>                <span class="n">result</span><span class="p">[</span><span class="n">term</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
<span class="linenos">1429</span>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">KApply</span><span class="p">):</span>
<span class="linenos">1430</span>                <span class="k">if</span> <span class="n">term</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">ml_quantifiers</span><span class="p">:</span>
<span class="linenos">1431</span>                    <span class="n">var</span> <span class="o">=</span> <span class="n">get_quantifier_variable</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
<span class="linenos">1432</span>                    <span class="n">result</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
<span class="linenos">1433</span>            <span class="k">return</span> <span class="n">result</span>
<span class="linenos">1434</span>
<span class="linenos">1435</span>        <span class="k">def</span><span class="w"> </span><span class="nf">add_var_to_subst</span><span class="p">(</span><span class="n">vname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">vars</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KVariable</span><span class="p">],</span> <span class="n">subst</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KVariable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1436</span>            <span class="n">vsorts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">sort</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">sort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span>
<span class="linenos">1437</span>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vsorts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1438</span>                <span class="n">vsort</span> <span class="o">=</span> <span class="n">vsorts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">1439</span>                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">vsorts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
<span class="linenos">1440</span>                    <span class="n">_vsort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">greatest_common_subsort</span><span class="p">(</span><span class="n">vsort</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="linenos">1441</span>                    <span class="k">if</span> <span class="n">_vsort</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1442</span>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot compute greatest common subsort of </span><span class="si">{</span><span class="n">vname</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="p">(</span><span class="n">vsort</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1443</span>                    <span class="n">vsort</span> <span class="o">=</span> <span class="n">_vsort</span>
<span class="linenos">1444</span>                <span class="n">subst</span><span class="p">[</span><span class="n">vname</span><span class="p">]</span> <span class="o">=</span> <span class="n">KVariable</span><span class="p">(</span><span class="n">vname</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">vsort</span><span class="p">)</span>
<span class="linenos">1445</span>
<span class="linenos">1446</span>        <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span>
<span class="linenos">1447</span>            <span class="n">term</span><span class="p">:</span> <span class="n">KInner</span><span class="p">,</span> <span class="n">child_variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">KVariable</span><span class="p">]]]</span>
<span class="linenos">1448</span>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KInner</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">KVariable</span><span class="p">]]]:</span>
<span class="linenos">1449</span>            <span class="n">occurrences</span> <span class="o">=</span> <span class="n">merge_variables</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">child_variables</span><span class="p">)</span>
<span class="linenos">1450</span>
<span class="linenos">1451</span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">KApply</span><span class="p">):</span>
<span class="linenos">1452</span>                <span class="k">if</span> <span class="n">term</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">ml_quantifiers</span><span class="p">:</span>
<span class="linenos">1453</span>                    <span class="n">var</span> <span class="o">=</span> <span class="n">get_quantifier_variable</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
<span class="linenos">1454</span>                    <span class="n">subst</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KVariable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1455</span>                    <span class="n">add_var_to_subst</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">subst</span><span class="p">)</span>
<span class="linenos">1456</span>                    <span class="k">del</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="linenos">1457</span>                    <span class="k">return</span> <span class="p">(</span><span class="n">Subst</span><span class="p">(</span><span class="n">subst</span><span class="p">)(</span><span class="n">term</span><span class="p">),</span> <span class="n">occurrences</span><span class="p">)</span>
<span class="linenos">1458</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">1459</span>                    <span class="n">prod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">term</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="linenos">1460</span>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1461</span>                        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">argument_sorts</span><span class="p">,</span> <span class="n">term</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="linenos">1462</span>                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KVariable</span><span class="p">:</span>
<span class="linenos">1463</span>                                <span class="n">occurrences</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">let_sort</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="linenos">1464</span>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">KSequence</span><span class="p">):</span>
<span class="linenos">1465</span>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
<span class="linenos">1466</span>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">KVariable</span><span class="p">):</span>
<span class="linenos">1467</span>                        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">sort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1468</span>                            <span class="n">occurrences</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="linenos">1469</span>                        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">term</span><span class="o">.</span><span class="n">arity</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1470</span>                            <span class="n">occurrences</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">let_sort</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
<span class="linenos">1471</span>                        <span class="k">else</span><span class="p">:</span>
<span class="linenos">1472</span>                            <span class="n">occurrences</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">let_sort</span><span class="p">(</span><span class="n">K_ITEM</span><span class="p">))</span>
<span class="linenos">1473</span>            <span class="k">return</span> <span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">occurrences</span><span class="p">)</span>
<span class="linenos">1474</span>
<span class="linenos">1475</span>        <span class="p">(</span><span class="n">new_term</span><span class="p">,</span> <span class="n">var_occurrences</span><span class="p">)</span> <span class="o">=</span> <span class="n">bottom_up_with_summary</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">kast</span><span class="p">)</span>
<span class="linenos">1476</span>
<span class="linenos">1477</span>        <span class="n">subst</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KVariable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1478</span>        <span class="k">for</span> <span class="n">vname</span><span class="p">,</span> <span class="n">occurrences</span> <span class="ow">in</span> <span class="n">var_occurrences</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">1479</span>            <span class="n">add_var_to_subst</span><span class="p">(</span><span class="n">vname</span><span class="p">,</span> <span class="n">occurrences</span><span class="p">,</span> <span class="n">subst</span><span class="p">)</span>
<span class="linenos">1480</span>
<span class="linenos">1481</span>        <span class="k">return</span> <span class="n">Subst</span><span class="p">(</span><span class="n">subst</span><span class="p">)(</span><span class="n">new_term</span><span class="p">)</span></div>

<span class="linenos">1482</span>
<span class="linenos">1483</span>    <span class="c1"># Best-effort addition of sort parameters to klabels, context insensitive</span>
<div class="viewcode-block" id="KDefinition.add_sort_params">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.add_sort_params">[docs]</a>
<span class="linenos">1484</span>    <span class="k">def</span><span class="w"> </span><span class="nf">add_sort_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1485</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a given term with the sort parameters on the `KLabel` filled in (which may be missing because of how the frontend works), best effort.&quot;&quot;&quot;</span>
<span class="linenos">1486</span>
<span class="linenos">1487</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_add_sort_params</span><span class="p">(</span><span class="n">_k</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1488</span>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_k</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KApply</span><span class="p">:</span>
<span class="linenos">1489</span>                <span class="n">prod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">_k</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="linenos">1490</span>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_k</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1491</span>                    <span class="n">sort_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">KSort</span><span class="p">,</span> <span class="n">KSort</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1492</span>                    <span class="k">for</span> <span class="n">psort</span><span class="p">,</span> <span class="n">asort</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">argument_sorts</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">,</span> <span class="n">_k</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="linenos">1493</span>                        <span class="k">if</span> <span class="n">asort</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1494</span>                            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="linenos">1495</span>                                <span class="sa">f</span><span class="s1">&#39;Failed to add sort parameter, unable to determine sort for argument in production: </span><span class="si">{</span><span class="p">(</span><span class="n">prod</span><span class="p">,</span><span class="w"> </span><span class="n">psort</span><span class="p">,</span><span class="w"> </span><span class="n">asort</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos">1496</span>                            <span class="p">)</span>
<span class="linenos">1497</span>                            <span class="k">return</span> <span class="n">_k</span>
<span class="linenos">1498</span>                        <span class="k">if</span> <span class="n">psort</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
<span class="linenos">1499</span>                            <span class="k">if</span> <span class="n">psort</span> <span class="ow">in</span> <span class="n">sort_dict</span> <span class="ow">and</span> <span class="n">sort_dict</span><span class="p">[</span><span class="n">psort</span><span class="p">]</span> <span class="o">!=</span> <span class="n">asort</span><span class="p">:</span>
<span class="linenos">1500</span>                                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="linenos">1501</span>                                    <span class="sa">f</span><span class="s1">&#39;Failed to add sort parameter, sort mismatch between different occurances of sort parameter: </span><span class="si">{</span><span class="p">(</span><span class="n">prod</span><span class="p">,</span><span class="w"> </span><span class="n">psort</span><span class="p">,</span><span class="w"> </span><span class="n">sort_dict</span><span class="p">[</span><span class="n">psort</span><span class="p">],</span><span class="w"> </span><span class="n">asort</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos">1502</span>                                <span class="p">)</span>
<span class="linenos">1503</span>                                <span class="k">return</span> <span class="n">_k</span>
<span class="linenos">1504</span>                            <span class="k">elif</span> <span class="n">psort</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sort_dict</span><span class="p">:</span>
<span class="linenos">1505</span>                                <span class="n">sort_dict</span><span class="p">[</span><span class="n">psort</span><span class="p">]</span> <span class="o">=</span> <span class="n">asort</span>
<span class="linenos">1506</span>                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="ow">in</span> <span class="n">sort_dict</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">params</span><span class="p">):</span>
<span class="linenos">1507</span>                        <span class="k">return</span> <span class="n">_k</span><span class="o">.</span><span class="n">let</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">KLabel</span><span class="p">(</span><span class="n">_k</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="n">sort_dict</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">params</span><span class="p">]))</span>
<span class="linenos">1508</span>            <span class="k">return</span> <span class="n">_k</span>
<span class="linenos">1509</span>
<span class="linenos">1510</span>        <span class="k">return</span> <span class="n">bottom_up</span><span class="p">(</span><span class="n">_add_sort_params</span><span class="p">,</span> <span class="n">kast</span><span class="p">)</span></div>

<span class="linenos">1511</span>
<div class="viewcode-block" id="KDefinition.add_cell_map_items">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.add_cell_map_items">[docs]</a>
<span class="linenos">1512</span>    <span class="k">def</span><span class="w"> </span><span class="nf">add_cell_map_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1513</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrap cell-map items in the syntactical wrapper that the frontend generates for them (see `KDefinition.remove_cell_map_items`).&quot;&quot;&quot;</span>
<span class="linenos">1514</span>        <span class="c1"># example:</span>
<span class="linenos">1515</span>        <span class="c1"># syntax AccountCellMap [cellCollection, hook(MAP.Map)]</span>
<span class="linenos">1516</span>        <span class="c1"># syntax AccountCellMap ::= AccountCellMap AccountCellMap [assoc, avoid, cellCollection, comm, element(AccountCellMapItem), function, hook(MAP.concat), unit(.AccountCellMap), wrapElement(&lt;account&gt;)]</span>
<span class="linenos">1517</span>
<span class="linenos">1518</span>        <span class="n">cell_wrappers</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1519</span>        <span class="k">for</span> <span class="n">ccp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_collection_productions</span><span class="p">:</span>
<span class="linenos">1520</span>            <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">ELEMENT</span> <span class="ow">in</span> <span class="n">ccp</span><span class="o">.</span><span class="n">att</span> <span class="ow">and</span> <span class="n">Atts</span><span class="o">.</span><span class="n">WRAP_ELEMENT</span> <span class="ow">in</span> <span class="n">ccp</span><span class="o">.</span><span class="n">att</span><span class="p">:</span>
<span class="linenos">1521</span>                <span class="n">cell_wrappers</span><span class="p">[</span><span class="n">ccp</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">WRAP_ELEMENT</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ccp</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">ELEMENT</span><span class="p">]</span>
<span class="linenos">1522</span>
<span class="linenos">1523</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_wrap_elements</span><span class="p">(</span><span class="n">_k</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1524</span>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_k</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KApply</span> <span class="ow">and</span> <span class="n">_k</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">cell_wrappers</span><span class="p">:</span>
<span class="linenos">1525</span>                <span class="k">return</span> <span class="n">KApply</span><span class="p">(</span><span class="n">cell_wrappers</span><span class="p">[</span><span class="n">_k</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="p">[</span><span class="n">_k</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_k</span><span class="p">])</span>
<span class="linenos">1526</span>            <span class="k">return</span> <span class="n">_k</span>
<span class="linenos">1527</span>
<span class="linenos">1528</span>        <span class="c1"># To ensure we don&#39;t get duplicate wrappers.</span>
<span class="linenos">1529</span>        <span class="n">_kast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_cell_map_items</span><span class="p">(</span><span class="n">kast</span><span class="p">)</span>
<span class="linenos">1530</span>        <span class="k">return</span> <span class="n">bottom_up</span><span class="p">(</span><span class="n">_wrap_elements</span><span class="p">,</span> <span class="n">_kast</span><span class="p">)</span></div>

<span class="linenos">1531</span>
<div class="viewcode-block" id="KDefinition.remove_cell_map_items">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.remove_cell_map_items">[docs]</a>
<span class="linenos">1532</span>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_cell_map_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1533</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove cell-map syntactical wrapper items that the frontend generates (see `KDefinition.add_cell_map_items`).&quot;&quot;&quot;</span>
<span class="linenos">1534</span>        <span class="c1"># example:</span>
<span class="linenos">1535</span>        <span class="c1"># syntax AccountCellMap [cellCollection, hook(MAP.Map)]</span>
<span class="linenos">1536</span>        <span class="c1"># syntax AccountCellMap ::= AccountCellMap AccountCellMap [assoc, avoid, cellCollection, comm, element(AccountCellMapItem), function, hook(MAP.concat), unit(.AccountCellMap), wrapElement(&lt;account&gt;)]</span>
<span class="linenos">1537</span>
<span class="linenos">1538</span>        <span class="n">cell_wrappers</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">1539</span>        <span class="k">for</span> <span class="n">ccp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_collection_productions</span><span class="p">:</span>
<span class="linenos">1540</span>            <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">ELEMENT</span> <span class="ow">in</span> <span class="n">ccp</span><span class="o">.</span><span class="n">att</span> <span class="ow">and</span> <span class="n">Atts</span><span class="o">.</span><span class="n">WRAP_ELEMENT</span> <span class="ow">in</span> <span class="n">ccp</span><span class="o">.</span><span class="n">att</span><span class="p">:</span>
<span class="linenos">1541</span>                <span class="n">cell_wrappers</span><span class="p">[</span><span class="n">ccp</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">ELEMENT</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ccp</span><span class="o">.</span><span class="n">att</span><span class="p">[</span><span class="n">Atts</span><span class="o">.</span><span class="n">WRAP_ELEMENT</span><span class="p">]</span>
<span class="linenos">1542</span>
<span class="linenos">1543</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_wrap_elements</span><span class="p">(</span><span class="n">_k</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1544</span>            <span class="k">if</span> <span class="p">(</span>
<span class="linenos">1545</span>                <span class="nb">type</span><span class="p">(</span><span class="n">_k</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KApply</span>
<span class="linenos">1546</span>                <span class="ow">and</span> <span class="n">_k</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">cell_wrappers</span>
<span class="linenos">1547</span>                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">_k</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<span class="linenos">1548</span>                <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">_k</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="n">KApply</span>
<span class="linenos">1549</span>                <span class="ow">and</span> <span class="n">_k</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">cell_wrappers</span><span class="p">[</span><span class="n">_k</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="linenos">1550</span>            <span class="p">):</span>
<span class="linenos">1551</span>                <span class="k">return</span> <span class="n">_k</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">1552</span>            <span class="k">return</span> <span class="n">_k</span>
<span class="linenos">1553</span>
<span class="linenos">1554</span>        <span class="k">return</span> <span class="n">bottom_up</span><span class="p">(</span><span class="n">_wrap_elements</span><span class="p">,</span> <span class="n">kast</span><span class="p">)</span></div>

<span class="linenos">1555</span>
<div class="viewcode-block" id="KDefinition.empty_config">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.empty_config">[docs]</a>
<span class="linenos">1556</span>    <span class="k">def</span><span class="w"> </span><span class="nf">empty_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1557</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a cell-sort, compute an &quot;empty&quot; configuration for it (all the constructor structure of the configuration in place, but variables in cell positions).&quot;&quot;&quot;</span>
<span class="linenos">1558</span>        <span class="k">if</span> <span class="n">sort</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_empty_config</span><span class="p">:</span>
<span class="linenos">1559</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_empty_config</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_empty_config</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
<span class="linenos">1560</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_empty_config</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span></div>

<span class="linenos">1561</span>
<span class="linenos">1562</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_empty_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1563</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_kdefinition_empty_config</span><span class="p">(</span><span class="n">_sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KApply</span><span class="p">:</span>
<span class="linenos">1564</span>            <span class="n">cell_prod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_for_cell_sort</span><span class="p">(</span><span class="n">_sort</span><span class="p">)</span>
<span class="linenos">1565</span>            <span class="n">cell_klabel</span> <span class="o">=</span> <span class="n">cell_prod</span><span class="o">.</span><span class="n">klabel</span>
<span class="linenos">1566</span>            <span class="k">assert</span> <span class="n">cell_klabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="linenos">1567</span>            <span class="n">production</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">cell_klabel</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="linenos">1568</span>            <span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KInner</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1569</span>            <span class="n">num_nonterminals</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1570</span>            <span class="n">num_freshvars</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1571</span>            <span class="k">for</span> <span class="n">p_item</span> <span class="ow">in</span> <span class="n">production</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
<span class="linenos">1572</span>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p_item</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KNonTerminal</span><span class="p">:</span>
<span class="linenos">1573</span>                    <span class="n">num_nonterminals</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">1574</span>                    <span class="k">if</span> <span class="n">p_item</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Cell&#39;</span><span class="p">):</span>
<span class="linenos">1575</span>                        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_kdefinition_empty_config</span><span class="p">(</span><span class="n">p_item</span><span class="o">.</span><span class="n">sort</span><span class="p">))</span>
<span class="linenos">1576</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">1577</span>                        <span class="n">num_freshvars</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">1578</span>                        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">KVariable</span><span class="p">(</span><span class="n">_sort</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_CELL&#39;</span><span class="p">))</span>
<span class="linenos">1579</span>            <span class="k">if</span> <span class="n">num_nonterminals</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">num_freshvars</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1580</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found mixed cell and non-cell arguments to cell constructor for: </span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1581</span>            <span class="k">return</span> <span class="n">KApply</span><span class="p">(</span><span class="n">cell_klabel</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
<span class="linenos">1582</span>
<span class="linenos">1583</span>        <span class="k">return</span> <span class="n">_kdefinition_empty_config</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
<span class="linenos">1584</span>
<div class="viewcode-block" id="KDefinition.instantiate_cell_vars">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.instantiate_cell_vars">[docs]</a>
<span class="linenos">1585</span>    <span class="k">def</span><span class="w"> </span><span class="nf">instantiate_cell_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">term</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1586</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a partially-complete configuration, find positions where there could be more cell structure but instead there are variables and instantiate more cell structure.&quot;&quot;&quot;</span>
<span class="linenos">1587</span>
<span class="linenos">1588</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_cell_vars_to_labels</span><span class="p">(</span><span class="n">_kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1589</span>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_kast</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KApply</span> <span class="ow">and</span> <span class="n">_kast</span><span class="o">.</span><span class="n">is_cell</span><span class="p">:</span>
<span class="linenos">1590</span>                <span class="n">production</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">_kast</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="linenos">1591</span>                <span class="n">production_arity</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">sort</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">production</span><span class="o">.</span><span class="n">non_terminals</span><span class="p">]</span>
<span class="linenos">1592</span>                <span class="n">new_args</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1593</span>                <span class="k">for</span> <span class="n">sort</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">production_arity</span><span class="p">,</span> <span class="n">_kast</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="linenos">1594</span>                    <span class="k">if</span> <span class="n">sort</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Cell&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KVariable</span><span class="p">:</span>
<span class="linenos">1595</span>                        <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_config</span><span class="p">(</span><span class="n">sort</span><span class="p">))</span>
<span class="linenos">1596</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">1597</span>                        <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<span class="linenos">1598</span>                <span class="k">return</span> <span class="n">KApply</span><span class="p">(</span><span class="n">_kast</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">new_args</span><span class="p">)</span>
<span class="linenos">1599</span>            <span class="k">return</span> <span class="n">_kast</span>
<span class="linenos">1600</span>
<span class="linenos">1601</span>        <span class="k">return</span> <span class="n">bottom_up</span><span class="p">(</span><span class="n">_cell_vars_to_labels</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span></div>

<span class="linenos">1602</span>
<div class="viewcode-block" id="KDefinition.init_config">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.KDefinition.init_config">[docs]</a>
<span class="linenos">1603</span>    <span class="k">def</span><span class="w"> </span><span class="nf">init_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1604</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an initialized configuration as the user declares it in the semantics, complete with configuration variables in place.&quot;&quot;&quot;</span>
<span class="linenos">1605</span>        <span class="k">if</span> <span class="n">sort</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_config</span><span class="p">:</span>
<span class="linenos">1606</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_init_config</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_init_config</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
<span class="linenos">1607</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_config</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span></div>

<span class="linenos">1608</span>
<span class="linenos">1609</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_init_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="p">:</span> <span class="n">KSort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1610</span>        <span class="n">config_var_map</span> <span class="o">=</span> <span class="n">KVariable</span><span class="p">(</span><span class="s1">&#39;__###CONFIG_VAR_MAP###__&#39;</span><span class="p">)</span>
<span class="linenos">1611</span>
<span class="linenos">1612</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_remove_config_var_lookups</span><span class="p">(</span><span class="n">_kast</span><span class="p">:</span> <span class="n">KInner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos">1613</span>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_kast</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KApply</span> <span class="ow">and</span> <span class="n">_kast</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;project:&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">_kast</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1614</span>                <span class="n">_term</span> <span class="o">=</span> <span class="n">_kast</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">1615</span>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_term</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KApply</span> <span class="ow">and</span> <span class="n">_term</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">KLabel</span><span class="p">(</span><span class="s1">&#39;Map:lookup&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_term</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">config_var_map</span><span class="p">:</span>
<span class="linenos">1616</span>                    <span class="n">_token_var</span> <span class="o">=</span> <span class="n">_term</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">1617</span>                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_token_var</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KToken</span> <span class="ow">and</span> <span class="n">_token_var</span><span class="o">.</span><span class="n">sort</span> <span class="o">==</span> <span class="n">KSort</span><span class="p">(</span><span class="s1">&#39;KConfigVar&#39;</span><span class="p">):</span>
<span class="linenos">1618</span>                        <span class="k">return</span> <span class="n">KVariable</span><span class="p">(</span><span class="n">_token_var</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
<span class="linenos">1619</span>            <span class="k">return</span> <span class="n">_kast</span>
<span class="linenos">1620</span>
<span class="linenos">1621</span>        <span class="n">init_prods</span> <span class="o">=</span> <span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">syntax_productions</span> <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">INITIALIZER</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">att</span><span class="p">)</span>
<span class="linenos">1622</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">1623</span>            <span class="n">init_prod</span> <span class="o">=</span> <span class="n">single</span><span class="p">(</span><span class="n">prod</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">init_prods</span> <span class="k">if</span> <span class="n">prod</span><span class="o">.</span><span class="n">sort</span> <span class="o">==</span> <span class="n">sort</span><span class="p">)</span>
<span class="linenos">1624</span>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="linenos">1625</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Did not find unique initializer for sort: </span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
<span class="linenos">1626</span>
<span class="linenos">1627</span>        <span class="n">prod_klabel</span> <span class="o">=</span> <span class="n">init_prod</span><span class="o">.</span><span class="n">klabel</span>
<span class="linenos">1628</span>        <span class="k">assert</span> <span class="n">prod_klabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="linenos">1629</span>        <span class="n">arg_sorts</span> <span class="o">=</span> <span class="p">[</span><span class="n">nt</span><span class="o">.</span><span class="n">sort</span> <span class="k">for</span> <span class="n">nt</span> <span class="ow">in</span> <span class="n">init_prod</span><span class="o">.</span><span class="n">items</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KNonTerminal</span><span class="p">]</span>
<span class="linenos">1630</span>        <span class="n">init_config</span><span class="p">:</span> <span class="n">KInner</span>
<span class="linenos">1631</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_sorts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1632</span>            <span class="n">init_config</span> <span class="o">=</span> <span class="n">KApply</span><span class="p">(</span><span class="n">prod_klabel</span><span class="p">)</span>
<span class="linenos">1633</span>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_sorts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">arg_sorts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">KSort</span><span class="p">(</span><span class="s1">&#39;Map&#39;</span><span class="p">):</span>
<span class="linenos">1634</span>            <span class="n">init_config</span> <span class="o">=</span> <span class="n">KApply</span><span class="p">(</span><span class="n">prod_klabel</span><span class="p">,</span> <span class="p">[</span><span class="n">config_var_map</span><span class="p">])</span>
<span class="linenos">1635</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">1636</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot handle initializer for label: </span><span class="si">{</span><span class="n">prod_klabel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1637</span>
<span class="linenos">1638</span>        <span class="n">init_rewrites</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">1639</span>            <span class="n">rule</span><span class="o">.</span><span class="n">body</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="k">if</span> <span class="n">Atts</span><span class="o">.</span><span class="n">INITIALIZER</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">att</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KRewrite</span>
<span class="linenos">1640</span>        <span class="p">]</span>
<span class="linenos">1641</span>        <span class="n">init_config</span> <span class="o">=</span> <span class="n">indexed_rewrite</span><span class="p">(</span><span class="n">init_config</span><span class="p">,</span> <span class="n">init_rewrites</span><span class="p">)</span>
<span class="linenos">1642</span>        <span class="n">init_config</span> <span class="o">=</span> <span class="n">top_down</span><span class="p">(</span><span class="n">_remove_config_var_lookups</span><span class="p">,</span> <span class="n">init_config</span><span class="p">)</span>
<span class="linenos">1643</span>
<span class="linenos">1644</span>        <span class="k">return</span> <span class="n">init_config</span></div>

<span class="linenos">1645</span>
<span class="linenos">1646</span>
<div class="viewcode-block" id="read_kast_definition">
<a class="viewcode-back" href="../../../api/pyk.kast.outer.html#pyk.kast.outer.read_kast_definition">[docs]</a>
<span class="linenos">1647</span><span class="k">def</span><span class="w"> </span><span class="nf">read_kast_definition</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KDefinition</span><span class="p">:</span>
<span class="linenos">1648</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a `KDefinition` from disk, failing if it&#39;s not actually a `KDefinition`.&quot;&quot;&quot;</span>
<span class="linenos">1649</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">1650</span>        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loading JSON definition: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1651</span>        <span class="n">json_defn</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="linenos">1652</span>        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Converting JSON definition to Kast: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1653</span>        <span class="k">return</span> <span class="n">KDefinition</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">kast_term</span><span class="p">(</span><span class="n">json_defn</span><span class="p">))</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Runtime Verification, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>