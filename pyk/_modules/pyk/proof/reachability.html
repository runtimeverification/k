

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyk.proof.reachability &mdash; pyk 7.1.313 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=9c1be6d9"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pyk
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">pyk</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyk.proof.reachability</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyk.proof.reachability</h1><div class="highlight"><pre>
<span></span><span class="linenos">   1</span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">   2</span>
<span class="linenos">   3</span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="linenos">   4</span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="linenos">   5</span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="linenos">   6</span><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="linenos">   7</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
<span class="linenos">   8</span>
<span class="linenos">   9</span><span class="kn">from</span><span class="w"> </span><span class="nn">..cterm.cterm</span><span class="w"> </span><span class="kn">import</span> <span class="n">remove_useless_constraints</span>
<span class="linenos">  10</span><span class="kn">from</span><span class="w"> </span><span class="nn">..kast.inner</span><span class="w"> </span><span class="kn">import</span> <span class="n">KInner</span><span class="p">,</span> <span class="n">Subst</span>
<span class="linenos">  11</span><span class="kn">from</span><span class="w"> </span><span class="nn">..kast.manip</span><span class="w"> </span><span class="kn">import</span> <span class="n">flatten_label</span><span class="p">,</span> <span class="n">free_vars</span><span class="p">,</span> <span class="n">ml_pred_to_bool</span>
<span class="linenos">  12</span><span class="kn">from</span><span class="w"> </span><span class="nn">..kast.outer</span><span class="w"> </span><span class="kn">import</span> <span class="n">KClaim</span><span class="p">,</span> <span class="n">KFlatModule</span><span class="p">,</span> <span class="n">KImport</span><span class="p">,</span> <span class="n">KRule</span>
<span class="linenos">  13</span><span class="kn">from</span><span class="w"> </span><span class="nn">..kast.prelude.ml</span><span class="w"> </span><span class="kn">import</span> <span class="n">mlAnd</span><span class="p">,</span> <span class="n">mlTop</span>
<span class="linenos">  14</span><span class="kn">from</span><span class="w"> </span><span class="nn">..kcfg</span><span class="w"> </span><span class="kn">import</span> <span class="n">KCFG</span><span class="p">,</span> <span class="n">KCFGStore</span>
<span class="linenos">  15</span><span class="kn">from</span><span class="w"> </span><span class="nn">..kcfg.exploration</span><span class="w"> </span><span class="kn">import</span> <span class="n">KCFGExploration</span>
<span class="linenos">  16</span><span class="kn">from</span><span class="w"> </span><span class="nn">..kore.rpc</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogEntry</span>
<span class="linenos">  17</span><span class="kn">from</span><span class="w"> </span><span class="nn">..ktool.claim_index</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClaimIndex</span>
<span class="linenos">  18</span><span class="kn">from</span><span class="w"> </span><span class="nn">..utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">FrozenDict</span><span class="p">,</span> <span class="n">ensure_dir_path</span><span class="p">,</span> <span class="n">hash_str</span><span class="p">,</span> <span class="n">shorten_hashes</span><span class="p">,</span> <span class="n">single</span>
<span class="linenos">  19</span><span class="kn">from</span><span class="w"> </span><span class="nn">.implies</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProofSummary</span><span class="p">,</span> <span class="n">Prover</span><span class="p">,</span> <span class="n">RefutationProof</span>
<span class="linenos">  20</span><span class="kn">from</span><span class="w"> </span><span class="nn">.proof</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompositeSummary</span><span class="p">,</span> <span class="n">FailureInfo</span><span class="p">,</span> <span class="n">Proof</span><span class="p">,</span> <span class="n">ProofStatus</span>
<span class="linenos">  21</span>
<span class="linenos">  22</span><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
<span class="linenos">  23</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Mapping</span>
<span class="linenos">  24</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="linenos">  25</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Final</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="linenos">  26</span>
<span class="linenos">  27</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">..kast.outer</span><span class="w"> </span><span class="kn">import</span> <span class="n">KDefinition</span><span class="p">,</span> <span class="n">KFlatModuleList</span><span class="p">,</span> <span class="n">KRuleLike</span>
<span class="linenos">  28</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">..kcfg</span><span class="w"> </span><span class="kn">import</span> <span class="n">KCFGExplore</span>
<span class="linenos">  29</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">..kcfg.explore</span><span class="w"> </span><span class="kn">import</span> <span class="n">KCFGExtendResult</span>
<span class="linenos">  30</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">..kcfg.kcfg</span><span class="w"> </span><span class="kn">import</span> <span class="n">CSubst</span><span class="p">,</span> <span class="n">NodeIdLike</span>
<span class="linenos">  31</span>
<span class="linenos">  32</span>    <span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;Proof&#39;</span><span class="p">)</span>
<span class="linenos">  33</span>
<span class="linenos">  34</span><span class="n">_LOGGER</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="linenos">  35</span>
<span class="linenos">  36</span>
<div class="viewcode-block" id="APRProofResult">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProofResult">[docs]</a>
<span class="linenos">  37</span><span class="nd">@dataclass</span>
<span class="linenos">  38</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProofResult</span><span class="p">:</span>
<span class="linenos">  39</span>    <span class="n">node_id</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos">  40</span>    <span class="n">prior_loops_cache_update</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos">  41</span>    <span class="n">optimize_kcfg</span><span class="p">:</span> <span class="nb">bool</span></div>

<span class="linenos">  42</span>
<span class="linenos">  43</span>
<div class="viewcode-block" id="APRProofExtendResult">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProofExtendResult">[docs]</a>
<span class="linenos">  44</span><span class="nd">@dataclass</span>
<span class="linenos">  45</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProofExtendResult</span><span class="p">(</span><span class="n">APRProofResult</span><span class="p">):</span>
<span class="linenos">  46</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Proof extension to be applied.&quot;&quot;&quot;</span>
<span class="linenos">  47</span>
<span class="linenos">  48</span>    <span class="n">extension_to_apply</span><span class="p">:</span> <span class="n">KCFGExtendResult</span></div>

<span class="linenos">  49</span>
<span class="linenos">  50</span>
<div class="viewcode-block" id="APRProofExtendAndCacheResult">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProofExtendAndCacheResult">[docs]</a>
<span class="linenos">  51</span><span class="nd">@dataclass</span>
<span class="linenos">  52</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProofExtendAndCacheResult</span><span class="p">(</span><span class="n">APRProofExtendResult</span><span class="p">):</span>
<span class="linenos">  53</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Proof extension to be cached.&quot;&quot;&quot;</span>
<span class="linenos">  54</span>
<span class="linenos">  55</span>    <span class="n">extension_to_cache</span><span class="p">:</span> <span class="n">KCFGExtendResult</span></div>

<span class="linenos">  56</span>
<span class="linenos">  57</span>
<div class="viewcode-block" id="APRProofUseCacheResult">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProofUseCacheResult">[docs]</a>
<span class="linenos">  58</span><span class="nd">@dataclass</span>
<span class="linenos">  59</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProofUseCacheResult</span><span class="p">(</span><span class="n">APRProofResult</span><span class="p">):</span>
<span class="linenos">  60</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Proof extension to be applied using the extension cache.&quot;&quot;&quot;</span>
<span class="linenos">  61</span>
<span class="linenos">  62</span>    <span class="n">cached_node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span></div>

<span class="linenos">  63</span>
<span class="linenos">  64</span>
<div class="viewcode-block" id="APRProofSubsumeResult">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProofSubsumeResult">[docs]</a>
<span class="linenos">  65</span><span class="nd">@dataclass</span>
<span class="linenos">  66</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProofSubsumeResult</span><span class="p">(</span><span class="n">APRProofResult</span><span class="p">):</span>
<span class="linenos">  67</span>    <span class="n">csubst</span><span class="p">:</span> <span class="n">CSubst</span></div>

<span class="linenos">  68</span>
<span class="linenos">  69</span>
<div class="viewcode-block" id="APRProofTerminalResult">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProofTerminalResult">[docs]</a>
<span class="linenos">  70</span><span class="nd">@dataclass</span>
<span class="linenos">  71</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProofTerminalResult</span><span class="p">(</span><span class="n">APRProofResult</span><span class="p">):</span> <span class="o">...</span></div>

<span class="linenos">  72</span>
<span class="linenos">  73</span>
<div class="viewcode-block" id="APRProofBoundedResult">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProofBoundedResult">[docs]</a>
<span class="linenos">  74</span><span class="nd">@dataclass</span>
<span class="linenos">  75</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProofBoundedResult</span><span class="p">(</span><span class="n">APRProofResult</span><span class="p">):</span> <span class="o">...</span></div>

<span class="linenos">  76</span>
<span class="linenos">  77</span>
<div class="viewcode-block" id="APRProofStep">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProofStep">[docs]</a>
<span class="linenos">  78</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">  79</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProofStep</span><span class="p">:</span>
<span class="linenos">  80</span>    <span class="n">node</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span>
<span class="linenos">  81</span>    <span class="n">target</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span>
<span class="linenos">  82</span>    <span class="n">proof_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos">  83</span>    <span class="n">bmc_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
<span class="linenos">  84</span>    <span class="n">use_cache</span><span class="p">:</span> <span class="n">NodeIdLike</span> <span class="o">|</span> <span class="kc">None</span>
<span class="linenos">  85</span>    <span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos">  86</span>    <span class="n">shortest_path_to_node</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="linenos">  87</span>    <span class="n">prior_loops_cache</span><span class="p">:</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">  88</span>    <span class="n">circularity</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos">  89</span>    <span class="n">nonzero_depth</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos">  90</span>    <span class="n">circularity_rule_id</span><span class="p">:</span> <span class="nb">str</span></div>

<span class="linenos">  91</span>
<span class="linenos">  92</span>
<div class="viewcode-block" id="APRProof">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof">[docs]</a>
<span class="linenos">  93</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProof</span><span class="p">(</span><span class="n">Proof</span><span class="p">[</span><span class="n">APRProofStep</span><span class="p">,</span> <span class="n">APRProofResult</span><span class="p">],</span> <span class="n">KCFGExploration</span><span class="p">):</span>
<span class="linenos">  94</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent an all-path reachability proof.</span>
<span class="linenos">  95</span>
<span class="linenos">  96</span><span class="sd">    APRProof and APRProver implement all-path reachability logic,</span>
<span class="linenos">  97</span><span class="sd">    as introduced by A. Stefanescu and others in their paper &#39;All-Path Reachability Logic&#39;:</span>
<span class="linenos">  98</span><span class="sd">    https://doi.org/10.23638/LMCS-15(2:5)2019</span>
<span class="linenos">  99</span>
<span class="linenos"> 100</span><span class="sd">    Note that reachability logic formula `phi =&gt;A psi` has *not* the same meaning</span>
<span class="linenos"> 101</span><span class="sd">    as CTL/CTL*&#39;s `phi -&gt; AF psi`, since reachability logic ignores infinite traces.</span>
<span class="linenos"> 102</span><span class="sd">    This implementation extends the above with bounded model checking, allowing the user</span>
<span class="linenos"> 103</span><span class="sd">    to specify an optional loop iteration bound for each loop in execution.</span>
<span class="linenos"> 104</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 105</span>
<span class="linenos"> 106</span>    <span class="n">node_refutations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">RefutationProof</span><span class="p">]</span>  <span class="c1"># TODO _node_refutatations</span>
<span class="linenos"> 107</span>    <span class="n">init</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 108</span>    <span class="n">target</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 109</span>    <span class="n">bmc_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
<span class="linenos"> 110</span>    <span class="n">_bounded</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="linenos"> 111</span>    <span class="n">logs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>
<span class="linenos"> 112</span>    <span class="n">circularity</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos"> 113</span>    <span class="n">_exec_time</span><span class="p">:</span> <span class="nb">float</span>
<span class="linenos"> 114</span>    <span class="n">error_info</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span>
<span class="linenos"> 115</span>    <span class="n">prior_loops_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>
<span class="linenos"> 116</span>
<span class="linenos"> 117</span>    <span class="n">_checked_for_bounded</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="linenos"> 118</span>    <span class="n">_next_steps</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">NodeIdLike</span><span class="p">,</span> <span class="n">KCFGExtendResult</span><span class="p">]</span>
<span class="linenos"> 119</span>
<span class="linenos"> 120</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span class="linenos"> 121</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 122</span>        <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="linenos"> 123</span>        <span class="n">kcfg</span><span class="p">:</span> <span class="n">KCFG</span><span class="p">,</span>
<span class="linenos"> 124</span>        <span class="n">terminal</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<span class="linenos"> 125</span>        <span class="n">init</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">,</span>
<span class="linenos"> 126</span>        <span class="n">target</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">,</span>
<span class="linenos"> 127</span>        <span class="n">logs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
<span class="linenos"> 128</span>        <span class="n">bmc_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 129</span>        <span class="n">bounded</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 130</span>        <span class="n">proof_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 131</span>        <span class="n">node_refutations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 132</span>        <span class="n">subproof_ids</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
<span class="linenos"> 133</span>        <span class="n">circularity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 134</span>        <span class="n">admitted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 135</span>        <span class="n">_exec_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="linenos"> 136</span>        <span class="n">error_info</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 137</span>        <span class="n">prior_loops_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 138</span>    <span class="p">):</span>
<span class="linenos"> 139</span>        <span class="n">Proof</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">proof_dir</span><span class="o">=</span><span class="n">proof_dir</span><span class="p">,</span> <span class="n">subproof_ids</span><span class="o">=</span><span class="n">subproof_ids</span><span class="p">,</span> <span class="n">admitted</span><span class="o">=</span><span class="n">admitted</span><span class="p">)</span>
<span class="linenos"> 140</span>        <span class="n">KCFGExploration</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kcfg</span><span class="p">,</span> <span class="n">terminal</span><span class="p">)</span>
<span class="linenos"> 141</span>
<span class="linenos"> 142</span>        <span class="bp">self</span><span class="o">.</span><span class="n">failure_info</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 143</span>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
<span class="linenos"> 144</span>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="linenos"> 145</span>        <span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span> <span class="o">=</span> <span class="n">bmc_depth</span>
<span class="linenos"> 146</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_bounded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">bounded</span><span class="p">)</span> <span class="k">if</span> <span class="n">bounded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>
<span class="linenos"> 147</span>        <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="n">logs</span>
<span class="linenos"> 148</span>        <span class="bp">self</span><span class="o">.</span><span class="n">circularity</span> <span class="o">=</span> <span class="n">circularity</span>
<span class="linenos"> 149</span>        <span class="bp">self</span><span class="o">.</span><span class="n">node_refutations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 150</span>        <span class="bp">self</span><span class="o">.</span><span class="n">prior_loops_cache</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 151</span>            <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">prior_loops_cache</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="k">if</span> <span class="n">prior_loops_cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
<span class="linenos"> 152</span>        <span class="p">)</span>
<span class="linenos"> 153</span>        <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_kcfg_store</span> <span class="o">=</span> <span class="n">KCFGStore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proof_subdir</span> <span class="o">/</span> <span class="s1">&#39;kcfg&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proof_subdir</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos"> 154</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_exec_time</span> <span class="o">=</span> <span class="n">_exec_time</span>
<span class="linenos"> 155</span>        <span class="bp">self</span><span class="o">.</span><span class="n">error_info</span> <span class="o">=</span> <span class="n">error_info</span>
<span class="linenos"> 156</span>
<span class="linenos"> 157</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_checked_for_bounded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="linenos"> 158</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_next_steps</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 159</span>
<span class="linenos"> 160</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proof_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">proof_subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 161</span>            <span class="n">ensure_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proof_dir</span><span class="p">)</span>
<span class="linenos"> 162</span>            <span class="n">ensure_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proof_subdir</span><span class="p">)</span>
<span class="linenos"> 163</span>
<span class="linenos"> 164</span>        <span class="k">if</span> <span class="n">node_refutations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 165</span>            <span class="n">refutations_not_in_subprroofs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">node_refutations</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
<span class="linenos"> 166</span>                <span class="nb">set</span><span class="p">(</span><span class="n">subproof_ids</span> <span class="k">if</span> <span class="n">subproof_ids</span> <span class="k">else</span> <span class="p">[])</span>
<span class="linenos"> 167</span>            <span class="p">)</span>
<span class="linenos"> 168</span>            <span class="k">if</span> <span class="n">refutations_not_in_subprroofs</span><span class="p">:</span>
<span class="linenos"> 169</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="linenos"> 170</span>                    <span class="sa">f</span><span class="s1">&#39;All node refutations must be included in subproofs, violators are </span><span class="si">{</span><span class="n">refutations_not_in_subprroofs</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos"> 171</span>                <span class="p">)</span>
<span class="linenos"> 172</span>            <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">proof_id</span> <span class="ow">in</span> <span class="n">node_refutations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos"> 173</span>                <span class="n">subproof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subproofs</span><span class="p">[</span><span class="n">proof_id</span><span class="p">]</span>
<span class="linenos"> 174</span>                <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">subproof</span><span class="p">)</span> <span class="ow">is</span> <span class="n">RefutationProof</span>
<span class="linenos"> 175</span>                <span class="bp">self</span><span class="o">.</span><span class="n">node_refutations</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">subproof</span>
<span class="linenos"> 176</span>
<div class="viewcode-block" id="APRProof.get_steps">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.get_steps">[docs]</a>
<span class="linenos"> 177</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">APRProofStep</span><span class="p">]:</span>
<span class="linenos"> 178</span>        <span class="n">steps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">APRProofStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 179</span>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending</span><span class="p">:</span>
<span class="linenos"> 180</span>
<span class="linenos"> 181</span>            <span class="n">shortest_path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 182</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 183</span>                <span class="n">shortest_path</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 184</span>                <span class="k">for</span> <span class="n">succ</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortest_path_to</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)):</span>
<span class="linenos"> 185</span>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">zero_depth_between</span><span class="p">(</span><span class="n">succ</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
<span class="linenos"> 186</span>                        <span class="o">...</span>
<span class="linenos"> 187</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 188</span>                        <span class="n">shortest_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">succ</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
<span class="linenos"> 189</span>
<span class="linenos"> 190</span>            <span class="n">nonzero_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonzero_depth</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 191</span>            <span class="n">module_name</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 192</span>                <span class="bp">self</span><span class="o">.</span><span class="n">circularities_module_name</span> <span class="k">if</span> <span class="n">nonzero_depth</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">circularity</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies_module_name</span>
<span class="linenos"> 193</span>            <span class="p">)</span>
<span class="linenos"> 194</span>
<span class="linenos"> 195</span>            <span class="n">predecessor_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">target_id</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="linenos"> 196</span>            <span class="n">predecessor_node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 197</span>                <span class="n">single</span><span class="p">(</span><span class="n">predecessor_edges</span><span class="p">)</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">predecessor_edges</span> <span class="o">!=</span> <span class="p">[]</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos"> 198</span>            <span class="p">)</span>
<span class="linenos"> 199</span>
<span class="linenos"> 200</span>            <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="linenos"> 201</span>                <span class="n">APRProofStep</span><span class="p">(</span>
<span class="linenos"> 202</span>                    <span class="n">bmc_depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span><span class="p">,</span>
<span class="linenos"> 203</span>                    <span class="n">module_name</span><span class="o">=</span><span class="n">module_name</span><span class="p">,</span>
<span class="linenos"> 204</span>                    <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
<span class="linenos"> 205</span>                    <span class="n">use_cache</span><span class="o">=</span><span class="n">predecessor_node_id</span> <span class="k">if</span> <span class="n">predecessor_node_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_steps</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 206</span>                    <span class="n">proof_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="linenos"> 207</span>                    <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span>
<span class="linenos"> 208</span>                    <span class="n">shortest_path_to_node</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">shortest_path</span><span class="p">),</span>
<span class="linenos"> 209</span>                    <span class="n">prior_loops_cache</span><span class="o">=</span><span class="n">FrozenDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_loops_cache</span><span class="p">),</span>
<span class="linenos"> 210</span>                    <span class="n">circularity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">circularity</span><span class="p">,</span>
<span class="linenos"> 211</span>                    <span class="n">nonzero_depth</span><span class="o">=</span><span class="n">nonzero_depth</span><span class="p">,</span>
<span class="linenos"> 212</span>                    <span class="n">circularity_rule_id</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rule_id</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s1">-TO-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 213</span>                <span class="p">)</span>
<span class="linenos"> 214</span>            <span class="p">)</span>
<span class="linenos"> 215</span>        <span class="k">return</span> <span class="n">steps</span></div>

<span class="linenos"> 216</span>
<div class="viewcode-block" id="APRProof.commit">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.commit">[docs]</a>
<span class="linenos"> 217</span>    <span class="k">def</span><span class="w"> </span><span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">APRProofResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 218</span>        <span class="bp">self</span><span class="o">.</span><span class="n">prior_loops_cache</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">prior_loops_cache_update</span>
<span class="linenos"> 219</span>        <span class="c1"># Result has been cached, use the cache</span>
<span class="linenos"> 220</span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">APRProofUseCacheResult</span><span class="p">):</span>
<span class="linenos"> 221</span>            <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">cached_node_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_steps</span>
<span class="linenos"> 222</span>            <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<span class="linenos"> 223</span>                <span class="n">extend_result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_next_steps</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cached_node_id</span><span class="p">),</span>
<span class="linenos"> 224</span>                <span class="n">optimize_kcfg</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">optimize_kcfg</span><span class="p">,</span>
<span class="linenos"> 225</span>                <span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">node_id</span><span class="p">),</span>
<span class="linenos"> 226</span>                <span class="n">logs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">,</span>
<span class="linenos"> 227</span>            <span class="p">)</span>
<span class="linenos"> 228</span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">APRProofExtendResult</span><span class="p">):</span>
<span class="linenos"> 229</span>            <span class="c1"># Result contains two steps, one to be applied, one to be cached</span>
<span class="linenos"> 230</span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">APRProofExtendAndCacheResult</span><span class="p">):</span>
<span class="linenos"> 231</span>                <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_steps</span>
<span class="linenos"> 232</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_next_steps</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">extension_to_cache</span>
<span class="linenos"> 233</span>            <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<span class="linenos"> 234</span>                <span class="n">extend_result</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">extension_to_apply</span><span class="p">,</span>
<span class="linenos"> 235</span>                <span class="n">optimize_kcfg</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">optimize_kcfg</span><span class="p">,</span>
<span class="linenos"> 236</span>                <span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">node_id</span><span class="p">),</span>
<span class="linenos"> 237</span>                <span class="n">logs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">,</span>
<span class="linenos"> 238</span>            <span class="p">)</span>
<span class="linenos"> 239</span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">APRProofSubsumeResult</span><span class="p">):</span>
<span class="linenos"> 240</span>            <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">create_cover</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">csubst</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">csubst</span><span class="p">)</span>
<span class="linenos"> 241</span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">APRProofTerminalResult</span><span class="p">):</span>
<span class="linenos"> 242</span>            <span class="bp">self</span><span class="o">.</span><span class="n">add_terminal</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 243</span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">APRProofBoundedResult</span><span class="p">):</span>
<span class="linenos"> 244</span>            <span class="bp">self</span><span class="o">.</span><span class="n">add_bounded</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 245</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 246</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Incorrect result type, expected APRProofResult: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<span class="linenos"> 247</span>
<div class="viewcode-block" id="APRProof.nonzero_depth">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.nonzero_depth">[docs]</a>
<span class="linenos"> 248</span>    <span class="k">def</span><span class="w"> </span><span class="nf">nonzero_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 249</span>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">zero_depth_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

<span class="linenos"> 250</span>
<span class="linenos"> 251</span>    <span class="nd">@property</span>
<span class="linenos"> 252</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rule_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 253</span>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;APRPROOF-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos"> 254</span>
<span class="linenos"> 255</span>    <span class="nd">@property</span>
<span class="linenos"> 256</span>    <span class="k">def</span><span class="w"> </span><span class="nf">module_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 257</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_module_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="linenos"> 258</span>
<span class="linenos"> 259</span>    <span class="nd">@property</span>
<span class="linenos"> 260</span>    <span class="k">def</span><span class="w"> </span><span class="nf">pending</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="linenos"> 261</span>        <span class="k">return</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">explorable</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pending</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
<span class="linenos"> 262</span>
<span class="linenos"> 263</span>    <span class="nd">@property</span>
<span class="linenos"> 264</span>    <span class="k">def</span><span class="w"> </span><span class="nf">failing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="linenos"> 265</span>        <span class="k">return</span> <span class="p">[</span><span class="n">nd</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">leaves</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_failing</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
<span class="linenos"> 266</span>
<span class="linenos"> 267</span>    <span class="nd">@property</span>
<span class="linenos"> 268</span>    <span class="k">def</span><span class="w"> </span><span class="nf">bounded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="linenos"> 269</span>        <span class="k">return</span> <span class="p">[</span><span class="n">nd</span> <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">leaves</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bounded</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
<span class="linenos"> 270</span>
<div class="viewcode-block" id="APRProof.is_refuted">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.is_refuted">[docs]</a>
<span class="linenos"> 271</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_refuted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 272</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_refutations</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<span class="linenos"> 273</span>
<div class="viewcode-block" id="APRProof.is_pending">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.is_pending">[docs]</a>
<span class="linenos"> 274</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_pending</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 275</span>        <span class="k">return</span> <span class="p">(</span>
<span class="linenos"> 276</span>            <span class="bp">self</span><span class="o">.</span><span class="n">is_explorable</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 277</span>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_target</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 278</span>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_refuted</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 279</span>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bounded</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 280</span>        <span class="p">)</span></div>

<span class="linenos"> 281</span>
<span class="linenos"> 282</span>    <span class="nd">@property</span>
<span class="linenos"> 283</span>    <span class="k">def</span><span class="w"> </span><span class="nf">circularities_module_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 284</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s1">&#39;-CIRCULARITIES-MODULE&#39;</span>
<span class="linenos"> 285</span>
<span class="linenos"> 286</span>    <span class="nd">@property</span>
<span class="linenos"> 287</span>    <span class="k">def</span><span class="w"> </span><span class="nf">dependencies_module_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 288</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s1">&#39;-DEPENDS-MODULE&#39;</span>
<span class="linenos"> 289</span>
<div class="viewcode-block" id="APRProof.is_init">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.is_init">[docs]</a>
<span class="linenos"> 290</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 291</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span></div>

<span class="linenos"> 292</span>
<div class="viewcode-block" id="APRProof.is_target">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.is_target">[docs]</a>
<span class="linenos"> 293</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 294</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span></div>

<span class="linenos"> 295</span>
<div class="viewcode-block" id="APRProof.is_failing">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.is_failing">[docs]</a>
<span class="linenos"> 296</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_failing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 297</span>        <span class="k">return</span> <span class="p">(</span>
<span class="linenos"> 298</span>            <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 299</span>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_explorable</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 300</span>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_target</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 301</span>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_refuted</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 302</span>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">is_vacuous</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 303</span>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bounded</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 304</span>        <span class="p">)</span></div>

<span class="linenos"> 305</span>
<div class="viewcode-block" id="APRProof.is_bounded">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.is_bounded">[docs]</a>
<span class="linenos"> 306</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_bounded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 307</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounded</span></div>

<span class="linenos"> 308</span>
<div class="viewcode-block" id="APRProof.add_bounded">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.add_bounded">[docs]</a>
<span class="linenos"> 309</span>    <span class="k">def</span><span class="w"> </span><span class="nf">add_bounded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nid</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 310</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_bounded</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">nid</span><span class="p">))</span></div>

<span class="linenos"> 311</span>
<div class="viewcode-block" id="APRProof.shortest_path_to">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.shortest_path_to">[docs]</a>
<span class="linenos"> 312</span>    <span class="k">def</span><span class="w"> </span><span class="nf">shortest_path_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">KCFG</span><span class="o">.</span><span class="n">Successor</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="linenos"> 313</span>        <span class="n">spb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">shortest_path_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="n">node_id</span><span class="p">)</span>
<span class="linenos"> 314</span>        <span class="k">assert</span> <span class="n">spb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="linenos"> 315</span>        <span class="k">return</span> <span class="n">spb</span></div>

<span class="linenos"> 316</span>
<div class="viewcode-block" id="APRProof.prune">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.prune">[docs]</a>
<span class="linenos"> 317</span>    <span class="k">def</span><span class="w"> </span><span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">,</span> <span class="n">keep_nodes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">NodeIdLike</span><span class="p">]</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="linenos"> 318</span>        <span class="n">pruned_nodes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">keep_nodes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">keep_nodes</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">])</span>
<span class="linenos"> 319</span>        <span class="k">for</span> <span class="n">nid</span> <span class="ow">in</span> <span class="n">pruned_nodes</span><span class="p">:</span>
<span class="linenos"> 320</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_bounded</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">nid</span><span class="p">)</span>
<span class="linenos"> 321</span>            <span class="bp">self</span><span class="o">.</span><span class="n">prior_loops_cache</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_loops_cache</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="n">nid</span><span class="p">}</span>
<span class="linenos"> 322</span>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_loops_cache</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos"> 323</span>                <span class="k">if</span> <span class="n">nid</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
<span class="linenos"> 324</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">prior_loops_cache</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_nid</span> <span class="k">for</span> <span class="n">_nid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_loops_cache</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">_nid</span> <span class="o">!=</span> <span class="n">nid</span><span class="p">)</span>
<span class="linenos"> 325</span>
<span class="linenos"> 326</span>        <span class="k">return</span> <span class="n">pruned_nodes</span></div>

<span class="linenos"> 327</span>
<span class="linenos"> 328</span>    <span class="nd">@property</span>
<span class="linenos"> 329</span>    <span class="k">def</span><span class="w"> </span><span class="nf">exec_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos"> 330</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exec_time</span>
<span class="linenos"> 331</span>
<div class="viewcode-block" id="APRProof.add_exec_time">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.add_exec_time">[docs]</a>
<span class="linenos"> 332</span>    <span class="k">def</span><span class="w"> </span><span class="nf">add_exec_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exec_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 333</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_exec_time</span> <span class="o">+=</span> <span class="n">exec_time</span></div>

<span class="linenos"> 334</span>
<div class="viewcode-block" id="APRProof.set_exec_time">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.set_exec_time">[docs]</a>
<span class="linenos"> 335</span>    <span class="k">def</span><span class="w"> </span><span class="nf">set_exec_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exec_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 336</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_exec_time</span> <span class="o">=</span> <span class="n">exec_time</span></div>

<span class="linenos"> 337</span>
<div class="viewcode-block" id="APRProof.formatted_exec_time">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.formatted_exec_time">[docs]</a>
<span class="linenos"> 338</span>    <span class="k">def</span><span class="w"> </span><span class="nf">formatted_exec_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 339</span>        <span class="n">exec_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exec_time</span><span class="p">)</span>
<span class="linenos"> 340</span>        <span class="n">h</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">exec_time</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
<span class="linenos"> 341</span>        <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="linenos"> 342</span>        <span class="n">formatted</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 343</span>        <span class="k">if</span> <span class="n">h</span><span class="p">:</span>
<span class="linenos"> 344</span>            <span class="n">formatted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1">h&#39;</span><span class="p">)</span>
<span class="linenos"> 345</span>        <span class="k">if</span> <span class="n">m</span> <span class="ow">or</span> <span class="n">h</span><span class="p">:</span>
<span class="linenos"> 346</span>            <span class="n">formatted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">)</span>
<span class="linenos"> 347</span>        <span class="n">formatted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
<span class="linenos"> 348</span>        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span></div>

<span class="linenos"> 349</span>
<span class="linenos"> 350</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 351</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_module_name</span><span class="p">(</span><span class="n">proof_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 352</span>        <span class="k">return</span> <span class="s1">&#39;M-&#39;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
<span class="linenos"> 353</span>            <span class="sa">r</span><span class="s1">&#39;[\[\]]|[_%().:,@]+&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s1">&#39;bkt&#39;</span> <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">proof_id</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="linenos"> 354</span>        <span class="p">)</span>
<span class="linenos"> 355</span>
<div class="viewcode-block" id="APRProof.read_proof">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.read_proof">[docs]</a>
<span class="linenos"> 356</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 357</span>    <span class="k">def</span><span class="w"> </span><span class="nf">read_proof</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">proof_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">APRProof</span><span class="p">:</span>
<span class="linenos"> 358</span>        <span class="n">proof_path</span> <span class="o">=</span> <span class="n">proof_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">hash_str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="si">}</span><span class="s1">.json&#39;</span>
<span class="linenos"> 359</span>        <span class="k">if</span> <span class="n">APRProof</span><span class="o">.</span><span class="n">proof_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">proof_dir</span><span class="p">):</span>
<span class="linenos"> 360</span>            <span class="n">proof_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">proof_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
<span class="linenos"> 361</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading APRProof from file </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">proof_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 362</span>            <span class="k">return</span> <span class="n">APRProof</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">proof_dict</span><span class="p">,</span> <span class="n">proof_dir</span><span class="o">=</span><span class="n">proof_dir</span><span class="p">)</span>
<span class="linenos"> 363</span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not load APRProof from file </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">proof_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<span class="linenos"> 364</span>
<span class="linenos"> 365</span>    <span class="nd">@property</span>
<span class="linenos"> 366</span>    <span class="k">def</span><span class="w"> </span><span class="nf">own_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProofStatus</span><span class="p">:</span>
<span class="linenos"> 367</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">admitted</span><span class="p">:</span>
<span class="linenos"> 368</span>            <span class="k">return</span> <span class="n">ProofStatus</span><span class="o">.</span><span class="n">PASSED</span>
<span class="linenos"> 369</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failing</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 370</span>            <span class="k">return</span> <span class="n">ProofStatus</span><span class="o">.</span><span class="n">FAILED</span>
<span class="linenos"> 371</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 372</span>            <span class="k">return</span> <span class="n">ProofStatus</span><span class="o">.</span><span class="n">PENDING</span>
<span class="linenos"> 373</span>        <span class="k">return</span> <span class="n">ProofStatus</span><span class="o">.</span><span class="n">PASSED</span>
<span class="linenos"> 374</span>
<span class="linenos"> 375</span>    <span class="nd">@property</span>
<span class="linenos"> 376</span>    <span class="k">def</span><span class="w"> </span><span class="nf">can_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 377</span>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="linenos"> 378</span>
<div class="viewcode-block" id="APRProof.from_dict">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.from_dict">[docs]</a>
<span class="linenos"> 379</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 380</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">APRProof</span><span class="p">],</span> <span class="n">dct</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">proof_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">APRProof</span><span class="p">:</span>
<span class="linenos"> 381</span>        <span class="n">kcfg</span> <span class="o">=</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;kcfg&#39;</span><span class="p">])</span>
<span class="linenos"> 382</span>        <span class="n">terminal</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;terminal&#39;</span><span class="p">]</span>
<span class="linenos"> 383</span>        <span class="n">init_node</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span>
<span class="linenos"> 384</span>        <span class="n">target_node</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>
<span class="linenos"> 385</span>        <span class="nb">id</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="linenos"> 386</span>        <span class="n">circularity</span> <span class="o">=</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;circularity&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 387</span>        <span class="n">admitted</span> <span class="o">=</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;admitted&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 388</span>        <span class="n">subproof_ids</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;subproof_ids&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;subproof_ids&#39;</span> <span class="ow">in</span> <span class="n">dct</span> <span class="k">else</span> <span class="p">[]</span>
<span class="linenos"> 389</span>        <span class="n">node_refutations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 390</span>        <span class="k">if</span> <span class="s1">&#39;node_refutation&#39;</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
<span class="linenos"> 391</span>            <span class="n">node_refutations</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 392</span>                <span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">node_id</span><span class="p">)):</span> <span class="n">proof_id</span> <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">proof_id</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;node_refutations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="linenos"> 393</span>            <span class="p">}</span>
<span class="linenos"> 394</span>        <span class="k">if</span> <span class="s1">&#39;logs&#39;</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
<span class="linenos"> 395</span>            <span class="n">logs</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LogEntry</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">ls</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;logs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="linenos"> 396</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 397</span>            <span class="n">logs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 398</span>
<span class="linenos"> 399</span>        <span class="n">bounded</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;bounded&#39;</span><span class="p">]</span>
<span class="linenos"> 400</span>        <span class="n">bmc_depth</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;bmc_depth&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;bmc_depth&#39;</span> <span class="ow">in</span> <span class="n">dct</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos"> 401</span>
<span class="linenos"> 402</span>        <span class="k">return</span> <span class="n">APRProof</span><span class="p">(</span>
<span class="linenos"> 403</span>            <span class="nb">id</span><span class="p">,</span>
<span class="linenos"> 404</span>            <span class="n">kcfg</span><span class="p">,</span>
<span class="linenos"> 405</span>            <span class="n">terminal</span><span class="p">,</span>
<span class="linenos"> 406</span>            <span class="n">init_node</span><span class="p">,</span>
<span class="linenos"> 407</span>            <span class="n">target_node</span><span class="p">,</span>
<span class="linenos"> 408</span>            <span class="n">logs</span><span class="o">=</span><span class="n">logs</span><span class="p">,</span>
<span class="linenos"> 409</span>            <span class="n">bmc_depth</span><span class="o">=</span><span class="n">bmc_depth</span><span class="p">,</span>
<span class="linenos"> 410</span>            <span class="n">bounded</span><span class="o">=</span><span class="n">bounded</span><span class="p">,</span>
<span class="linenos"> 411</span>            <span class="n">circularity</span><span class="o">=</span><span class="n">circularity</span><span class="p">,</span>
<span class="linenos"> 412</span>            <span class="n">admitted</span><span class="o">=</span><span class="n">admitted</span><span class="p">,</span>
<span class="linenos"> 413</span>            <span class="n">proof_dir</span><span class="o">=</span><span class="n">proof_dir</span><span class="p">,</span>
<span class="linenos"> 414</span>            <span class="n">subproof_ids</span><span class="o">=</span><span class="n">subproof_ids</span><span class="p">,</span>
<span class="linenos"> 415</span>            <span class="n">node_refutations</span><span class="o">=</span><span class="n">node_refutations</span><span class="p">,</span>
<span class="linenos"> 416</span>        <span class="p">)</span></div>

<span class="linenos"> 417</span>
<div class="viewcode-block" id="APRProof.from_claim">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.from_claim">[docs]</a>
<span class="linenos"> 418</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 419</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_claim</span><span class="p">(</span>
<span class="linenos"> 420</span>        <span class="n">defn</span><span class="p">:</span> <span class="n">KDefinition</span><span class="p">,</span>
<span class="linenos"> 421</span>        <span class="n">claim</span><span class="p">:</span> <span class="n">KClaim</span><span class="p">,</span>
<span class="linenos"> 422</span>        <span class="n">logs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
<span class="linenos"> 423</span>        <span class="n">proof_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 424</span>        <span class="n">bmc_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 425</span>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="linenos"> 426</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">APRProof</span><span class="p">:</span>
<span class="linenos"> 427</span>        <span class="n">kcfg_dir</span> <span class="o">=</span> <span class="n">proof_dir</span> <span class="o">/</span> <span class="n">claim</span><span class="o">.</span><span class="n">label</span> <span class="o">/</span> <span class="s1">&#39;kcfg&#39;</span> <span class="k">if</span> <span class="n">proof_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos"> 428</span>
<span class="linenos"> 429</span>        <span class="n">kcfg</span><span class="p">,</span> <span class="n">init_node</span><span class="p">,</span> <span class="n">target_node</span> <span class="o">=</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">from_claim</span><span class="p">(</span><span class="n">defn</span><span class="p">,</span> <span class="n">claim</span><span class="p">,</span> <span class="n">cfg_dir</span><span class="o">=</span><span class="n">kcfg_dir</span><span class="p">)</span>
<span class="linenos"> 430</span>        <span class="k">return</span> <span class="n">APRProof</span><span class="p">(</span>
<span class="linenos"> 431</span>            <span class="n">claim</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
<span class="linenos"> 432</span>            <span class="n">kcfg</span><span class="p">,</span>
<span class="linenos"> 433</span>            <span class="p">[],</span>
<span class="linenos"> 434</span>            <span class="n">init</span><span class="o">=</span><span class="n">init_node</span><span class="p">,</span>
<span class="linenos"> 435</span>            <span class="n">target</span><span class="o">=</span><span class="n">target_node</span><span class="p">,</span>
<span class="linenos"> 436</span>            <span class="n">logs</span><span class="o">=</span><span class="n">logs</span><span class="p">,</span>
<span class="linenos"> 437</span>            <span class="n">bmc_depth</span><span class="o">=</span><span class="n">bmc_depth</span><span class="p">,</span>
<span class="linenos"> 438</span>            <span class="n">proof_dir</span><span class="o">=</span><span class="n">proof_dir</span><span class="p">,</span>
<span class="linenos"> 439</span>            <span class="n">circularity</span><span class="o">=</span><span class="n">claim</span><span class="o">.</span><span class="n">is_circularity</span><span class="p">,</span>
<span class="linenos"> 440</span>            <span class="n">admitted</span><span class="o">=</span><span class="n">claim</span><span class="o">.</span><span class="n">is_trusted</span><span class="p">,</span>
<span class="linenos"> 441</span>            <span class="n">subproof_ids</span><span class="o">=</span><span class="n">claim</span><span class="o">.</span><span class="n">dependencies</span><span class="p">,</span>
<span class="linenos"> 442</span>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="linenos"> 443</span>        <span class="p">)</span></div>

<span class="linenos"> 444</span>
<div class="viewcode-block" id="APRProof.as_rules">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.as_rules">[docs]</a>
<span class="linenos"> 445</span>    <span class="k">def</span><span class="w"> </span><span class="nf">as_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">direct_rule</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">KRule</span><span class="p">]:</span>
<span class="linenos"> 446</span>        <span class="k">if</span> <span class="p">(</span>
<span class="linenos"> 447</span>            <span class="bp">self</span><span class="o">.</span><span class="n">circularity</span>
<span class="linenos"> 448</span>            <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">passed</span> <span class="ow">and</span> <span class="n">direct_rule</span><span class="p">)</span>
<span class="linenos"> 449</span>            <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">admitted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">))</span>
<span class="linenos"> 450</span>        <span class="p">):</span>
<span class="linenos"> 451</span>            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">as_rule</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">)]</span>
<span class="linenos"> 452</span>
<span class="linenos"> 453</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_return_rule</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">KRuleLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KRule</span><span class="p">:</span>
<span class="linenos"> 454</span>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">KRule</span><span class="p">)</span>
<span class="linenos"> 455</span>            <span class="k">return</span> <span class="n">r</span>
<span class="linenos"> 456</span>
<span class="linenos"> 457</span>        <span class="k">return</span> <span class="p">[</span><span class="n">_return_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">to_rules</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">)]</span></div>

<span class="linenos"> 458</span>
<div class="viewcode-block" id="APRProof.as_rule">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.as_rule">[docs]</a>
<span class="linenos"> 459</span>    <span class="k">def</span><span class="w"> </span><span class="nf">as_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KRule</span><span class="p">:</span>
<span class="linenos"> 460</span>        <span class="n">_edge</span> <span class="o">=</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">())</span>
<span class="linenos"> 461</span>        <span class="n">_rule</span> <span class="o">=</span> <span class="n">_edge</span><span class="o">.</span><span class="n">to_rule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">)</span>
<span class="linenos"> 462</span>        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">_rule</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KRule</span>
<span class="linenos"> 463</span>        <span class="k">return</span> <span class="n">_rule</span></div>

<span class="linenos"> 464</span>
<div class="viewcode-block" id="APRProof.as_claim">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.as_claim">[docs]</a>
<span class="linenos"> 465</span>    <span class="k">def</span><span class="w"> </span><span class="nf">as_claim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KClaim</span><span class="p">:</span>
<span class="linenos"> 466</span>        <span class="n">_edge</span> <span class="o">=</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">())</span>
<span class="linenos"> 467</span>        <span class="n">_claim</span> <span class="o">=</span> <span class="n">_edge</span><span class="o">.</span><span class="n">to_rule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">claim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 468</span>        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">_claim</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KClaim</span>
<span class="linenos"> 469</span>        <span class="k">return</span> <span class="n">_claim</span></div>

<span class="linenos"> 470</span>
<div class="viewcode-block" id="APRProof.from_spec_modules">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.from_spec_modules">[docs]</a>
<span class="linenos"> 471</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 472</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_spec_modules</span><span class="p">(</span>
<span class="linenos"> 473</span>        <span class="n">defn</span><span class="p">:</span> <span class="n">KDefinition</span><span class="p">,</span>
<span class="linenos"> 474</span>        <span class="n">spec_modules</span><span class="p">:</span> <span class="n">KFlatModuleList</span><span class="p">,</span>
<span class="linenos"> 475</span>        <span class="n">logs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
<span class="linenos"> 476</span>        <span class="n">proof_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 477</span>        <span class="n">spec_labels</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 478</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">APRProof</span><span class="p">]:</span>
<span class="linenos"> 479</span>        <span class="n">claim_index</span> <span class="o">=</span> <span class="n">ClaimIndex</span><span class="o">.</span><span class="n">from_module_list</span><span class="p">(</span><span class="n">spec_modules</span><span class="p">)</span>
<span class="linenos"> 480</span>        <span class="n">spec_labels</span> <span class="o">=</span> <span class="n">claim_index</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">spec_labels</span><span class="p">,</span> <span class="n">with_depends</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 481</span>
<span class="linenos"> 482</span>        <span class="n">res</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">APRProof</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 483</span>
<span class="linenos"> 484</span>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">spec_labels</span><span class="p">:</span>
<span class="linenos"> 485</span>            <span class="k">if</span> <span class="n">proof_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Proof</span><span class="o">.</span><span class="n">proof_data_exists</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">proof_dir</span><span class="p">):</span>
<span class="linenos"> 486</span>                <span class="n">apr_proof</span> <span class="o">=</span> <span class="n">APRProof</span><span class="o">.</span><span class="n">read_proof_data</span><span class="p">(</span><span class="n">proof_dir</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
<span class="linenos"> 487</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 488</span>                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Building APRProof for claim: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 489</span>                <span class="n">claim</span> <span class="o">=</span> <span class="n">claim_index</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
<span class="linenos"> 490</span>                <span class="n">apr_proof</span> <span class="o">=</span> <span class="n">APRProof</span><span class="o">.</span><span class="n">from_claim</span><span class="p">(</span>
<span class="linenos"> 491</span>                    <span class="n">defn</span><span class="p">,</span>
<span class="linenos"> 492</span>                    <span class="n">claim</span><span class="p">,</span>
<span class="linenos"> 493</span>                    <span class="n">logs</span><span class="o">=</span><span class="n">logs</span><span class="p">,</span>
<span class="linenos"> 494</span>                    <span class="n">proof_dir</span><span class="o">=</span><span class="n">proof_dir</span><span class="p">,</span>
<span class="linenos"> 495</span>                <span class="p">)</span>
<span class="linenos"> 496</span>                <span class="n">apr_proof</span><span class="o">.</span><span class="n">write_proof_data</span><span class="p">()</span>
<span class="linenos"> 497</span>            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">apr_proof</span><span class="p">)</span>
<span class="linenos"> 498</span>
<span class="linenos"> 499</span>        <span class="k">return</span> <span class="n">res</span></div>

<span class="linenos"> 500</span>
<div class="viewcode-block" id="APRProof.path_constraints">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.path_constraints">[docs]</a>
<span class="linenos"> 501</span>    <span class="k">def</span><span class="w"> </span><span class="nf">path_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_node_id</span><span class="p">:</span> <span class="n">NodeIdLike</span><span class="p">,</span> <span class="n">sort_with</span><span class="p">:</span> <span class="n">KDefinition</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KInner</span><span class="p">:</span>
<span class="linenos"> 502</span>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortest_path_to</span><span class="p">(</span><span class="n">final_node_id</span><span class="p">)</span>
<span class="linenos"> 503</span>        <span class="n">curr_constraint</span><span class="p">:</span> <span class="n">KInner</span> <span class="o">=</span> <span class="n">mlTop</span><span class="p">()</span>
<span class="linenos"> 504</span>        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="linenos"> 505</span>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Split</span><span class="p">:</span>
<span class="linenos"> 506</span>                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="linenos"> 507</span>                <span class="n">csubst</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">splits</span><span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
<span class="linenos"> 508</span>                <span class="n">curr_constraint</span> <span class="o">=</span> <span class="n">mlAnd</span><span class="p">(</span>
<span class="linenos"> 509</span>                    <span class="p">[</span><span class="n">csubst</span><span class="o">.</span><span class="n">pred</span><span class="p">(</span><span class="n">sort_with</span><span class="o">=</span><span class="n">sort_with</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">csubst</span><span class="o">.</span><span class="n">constraint</span><span class="p">,</span> <span class="n">curr_constraint</span><span class="p">]</span>
<span class="linenos"> 510</span>                <span class="p">)</span>
<span class="linenos"> 511</span>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Cover</span><span class="p">:</span>
<span class="linenos"> 512</span>                <span class="n">curr_constraint</span> <span class="o">=</span> <span class="n">mlAnd</span><span class="p">([</span><span class="n">edge</span><span class="o">.</span><span class="n">csubst</span><span class="o">.</span><span class="n">constraint</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">csubst</span><span class="o">.</span><span class="n">subst</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">curr_constraint</span><span class="p">)])</span>
<span class="linenos"> 513</span>        <span class="k">return</span> <span class="n">mlAnd</span><span class="p">(</span><span class="n">flatten_label</span><span class="p">(</span><span class="s1">&#39;#And&#39;</span><span class="p">,</span> <span class="n">curr_constraint</span><span class="p">))</span></div>

<span class="linenos"> 514</span>
<span class="linenos"> 515</span>    <span class="nd">@property</span>
<span class="linenos"> 516</span>    <span class="k">def</span><span class="w"> </span><span class="nf">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 517</span>        <span class="c1"># Note: We are relying on the order of inheritance to</span>
<span class="linenos"> 518</span>        <span class="c1"># access `dict` of `Proof`, since mypy is having issues</span>
<span class="linenos"> 519</span>        <span class="c1"># with the two correct solutions.</span>
<span class="linenos"> 520</span>        <span class="n">dct</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dict</span>
<span class="linenos"> 521</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;APRProof&#39;</span>
<span class="linenos"> 522</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;kcfg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="linenos"> 523</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;terminal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
<span class="linenos"> 524</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span>
<span class="linenos"> 525</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
<span class="linenos"> 526</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;bounded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounded</span><span class="p">)</span>
<span class="linenos"> 527</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 528</span>            <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;bmc_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span>
<span class="linenos"> 529</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;node_refutations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">node_id</span><span class="p">:</span> <span class="n">proof</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">proof</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_refutations</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="linenos"> 530</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;circularity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">circularity</span>
<span class="linenos"> 531</span>        <span class="n">logs</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">ls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="linenos"> 532</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;logs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logs</span>
<span class="linenos"> 533</span>        <span class="k">return</span> <span class="n">dct</span>
<span class="linenos"> 534</span>
<span class="linenos"> 535</span>    <span class="nd">@property</span>
<span class="linenos"> 536</span>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CompositeSummary</span><span class="p">:</span>
<span class="linenos"> 537</span>        <span class="n">subproofs_summaries</span> <span class="o">=</span> <span class="p">[</span><span class="n">subproof</span><span class="o">.</span><span class="n">summary</span> <span class="k">for</span> <span class="n">subproof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subproofs</span><span class="p">]</span>
<span class="linenos"> 538</span>        <span class="k">return</span> <span class="n">CompositeSummary</span><span class="p">(</span>
<span class="linenos"> 539</span>            <span class="p">[</span>
<span class="linenos"> 540</span>                <span class="n">APRSummary</span><span class="p">(</span>
<span class="linenos"> 541</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="linenos"> 542</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
<span class="linenos"> 543</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">admitted</span><span class="p">,</span>
<span class="linenos"> 544</span>                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
<span class="linenos"> 545</span>                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending</span><span class="p">),</span>
<span class="linenos"> 546</span>                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failing</span><span class="p">),</span>
<span class="linenos"> 547</span>                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">vacuous</span><span class="p">),</span>
<span class="linenos"> 548</span>                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">stuck</span><span class="p">),</span>
<span class="linenos"> 549</span>                    <span class="nb">len</span><span class="p">([</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)]),</span>
<span class="linenos"> 550</span>                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_refutations</span><span class="p">),</span>
<span class="linenos"> 551</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span><span class="p">,</span>
<span class="linenos"> 552</span>                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounded</span><span class="p">),</span>
<span class="linenos"> 553</span>                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subproof_ids</span><span class="p">),</span>
<span class="linenos"> 554</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">formatted_exec_time</span><span class="p">(),</span>
<span class="linenos"> 555</span>                <span class="p">),</span>
<span class="linenos"> 556</span>                <span class="o">*</span><span class="n">subproofs_summaries</span><span class="p">,</span>
<span class="linenos"> 557</span>            <span class="p">]</span>
<span class="linenos"> 558</span>        <span class="p">)</span>
<span class="linenos"> 559</span>
<span class="linenos"> 560</span>    <span class="nd">@property</span>
<span class="linenos"> 561</span>    <span class="k">def</span><span class="w"> </span><span class="nf">one_line_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 562</span>        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
<span class="linenos"> 563</span>        <span class="n">pending</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending</span><span class="p">)</span>
<span class="linenos"> 564</span>        <span class="n">failing</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failing</span><span class="p">)</span>
<span class="linenos"> 565</span>        <span class="n">vacuous</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">vacuous</span><span class="p">)</span>
<span class="linenos"> 566</span>        <span class="n">stuck</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">stuck</span><span class="p">)</span>
<span class="linenos"> 567</span>        <span class="n">passed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">cover</span> <span class="k">for</span> <span class="n">cover</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">covers</span><span class="p">()</span> <span class="k">if</span> <span class="n">cover</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">])</span>
<span class="linenos"> 568</span>        <span class="n">refuted</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_refutations</span><span class="p">)</span>
<span class="linenos"> 569</span>        <span class="k">return</span> <span class="p">(</span>
<span class="linenos"> 570</span>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">one_line_summary</span>
<span class="linenos"> 571</span>            <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;: </span><span class="si">{</span><span class="n">nodes</span><span class="si">}</span><span class="s1"> nodes: </span><span class="si">{</span><span class="n">pending</span><span class="si">}</span><span class="s1"> pending|</span><span class="si">{</span><span class="n">passed</span><span class="si">}</span><span class="s1"> passed|</span><span class="si">{</span><span class="n">failing</span><span class="si">}</span><span class="s1"> failing|</span><span class="si">{</span><span class="n">vacuous</span><span class="si">}</span><span class="s1"> vacuous|</span><span class="si">{</span><span class="n">refuted</span><span class="si">}</span><span class="s1"> refuted|</span><span class="si">{</span><span class="n">stuck</span><span class="si">}</span><span class="s1"> stuck&#39;</span>
<span class="linenos"> 572</span>        <span class="p">)</span>
<span class="linenos"> 573</span>
<div class="viewcode-block" id="APRProof.get_refutation_id">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.get_refutation_id">[docs]</a>
<span class="linenos"> 574</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_refutation_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 575</span>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">.node-infeasible-</span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s1">&#39;</span></div>

<span class="linenos"> 576</span>
<div class="viewcode-block" id="APRProof.read_proof_data">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.read_proof_data">[docs]</a>
<span class="linenos"> 577</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 578</span>    <span class="k">def</span><span class="w"> </span><span class="nf">read_proof_data</span><span class="p">(</span><span class="n">proof_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">APRProof</span><span class="p">:</span>
<span class="linenos"> 579</span>        <span class="n">proof_subdir</span> <span class="o">=</span> <span class="n">proof_dir</span> <span class="o">/</span> <span class="nb">id</span>
<span class="linenos"> 580</span>        <span class="n">proof_json</span> <span class="o">=</span> <span class="n">proof_subdir</span> <span class="o">/</span> <span class="s1">&#39;proof.json&#39;</span>
<span class="linenos"> 581</span>        <span class="n">proof_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">proof_json</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
<span class="linenos"> 582</span>        <span class="n">cfg_dir</span> <span class="o">=</span> <span class="n">proof_subdir</span> <span class="o">/</span> <span class="s1">&#39;kcfg&#39;</span>
<span class="linenos"> 583</span>        <span class="n">kcfg</span> <span class="o">=</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">read_cfg_data</span><span class="p">(</span><span class="n">cfg_dir</span><span class="p">)</span>
<span class="linenos"> 584</span>        <span class="n">init</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">])</span>
<span class="linenos"> 585</span>        <span class="n">target</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
<span class="linenos"> 586</span>        <span class="n">bounded</span> <span class="o">=</span> <span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;bounded&#39;</span><span class="p">]</span>
<span class="linenos"> 587</span>        <span class="n">bmc_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;bmc_depth&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;bmc_depth&#39;</span> <span class="ow">in</span> <span class="n">proof_dict</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos"> 588</span>        <span class="n">circularity</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;circularity&#39;</span><span class="p">])</span>
<span class="linenos"> 589</span>        <span class="n">admitted</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;admitted&#39;</span><span class="p">])</span>
<span class="linenos"> 590</span>        <span class="n">exec_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;execution_time&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;execution_time&#39;</span> <span class="ow">in</span> <span class="n">proof_dict</span> <span class="k">else</span> <span class="mf">0.0</span>
<span class="linenos"> 591</span>        <span class="n">terminal</span> <span class="o">=</span> <span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;terminal&#39;</span><span class="p">]</span>
<span class="linenos"> 592</span>        <span class="n">logs</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LogEntry</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">ls</span> <span class="ow">in</span> <span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;logs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="linenos"> 593</span>        <span class="n">subproof_ids</span> <span class="o">=</span> <span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;subproof_ids&#39;</span><span class="p">]</span>
<span class="linenos"> 594</span>        <span class="n">node_refutations</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 595</span>            <span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">node_id</span><span class="p">)):</span> <span class="n">proof_id</span> <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">proof_id</span> <span class="ow">in</span> <span class="n">proof_dict</span><span class="p">[</span><span class="s1">&#39;node_refutations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="linenos"> 596</span>        <span class="p">}</span>
<span class="linenos"> 597</span>
<span class="linenos"> 598</span>        <span class="n">prior_loops_cache</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">proof_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;loops_cache&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="linenos"> 599</span>
<span class="linenos"> 600</span>        <span class="k">return</span> <span class="n">APRProof</span><span class="p">(</span>
<span class="linenos"> 601</span>            <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
<span class="linenos"> 602</span>            <span class="n">kcfg</span><span class="o">=</span><span class="n">kcfg</span><span class="p">,</span>
<span class="linenos"> 603</span>            <span class="n">terminal</span><span class="o">=</span><span class="n">terminal</span><span class="p">,</span>
<span class="linenos"> 604</span>            <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
<span class="linenos"> 605</span>            <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
<span class="linenos"> 606</span>            <span class="n">bounded</span><span class="o">=</span><span class="n">bounded</span><span class="p">,</span>
<span class="linenos"> 607</span>            <span class="n">bmc_depth</span><span class="o">=</span><span class="n">bmc_depth</span><span class="p">,</span>
<span class="linenos"> 608</span>            <span class="n">logs</span><span class="o">=</span><span class="n">logs</span><span class="p">,</span>
<span class="linenos"> 609</span>            <span class="n">circularity</span><span class="o">=</span><span class="n">circularity</span><span class="p">,</span>
<span class="linenos"> 610</span>            <span class="n">admitted</span><span class="o">=</span><span class="n">admitted</span><span class="p">,</span>
<span class="linenos"> 611</span>            <span class="n">proof_dir</span><span class="o">=</span><span class="n">proof_dir</span><span class="p">,</span>
<span class="linenos"> 612</span>            <span class="n">subproof_ids</span><span class="o">=</span><span class="n">subproof_ids</span><span class="p">,</span>
<span class="linenos"> 613</span>            <span class="n">node_refutations</span><span class="o">=</span><span class="n">node_refutations</span><span class="p">,</span>
<span class="linenos"> 614</span>            <span class="n">prior_loops_cache</span><span class="o">=</span><span class="n">prior_loops_cache</span><span class="p">,</span>
<span class="linenos"> 615</span>            <span class="n">_exec_time</span><span class="o">=</span><span class="n">exec_time</span><span class="p">,</span>
<span class="linenos"> 616</span>        <span class="p">)</span></div>

<span class="linenos"> 617</span>
<div class="viewcode-block" id="APRProof.write_proof_data">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.write_proof_data">[docs]</a>
<span class="linenos"> 618</span>    <span class="k">def</span><span class="w"> </span><span class="nf">write_proof_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 619</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proof_dir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">proof_subdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 620</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skipped saving proof </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> since no save dir was specified.&#39;</span><span class="p">)</span>
<span class="linenos"> 621</span>            <span class="k">return</span>
<span class="linenos"> 622</span>        <span class="n">ensure_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proof_dir</span><span class="p">)</span>
<span class="linenos"> 623</span>        <span class="n">ensure_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proof_subdir</span><span class="p">)</span>
<span class="linenos"> 624</span>        <span class="n">proof_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proof_subdir</span> <span class="o">/</span> <span class="s1">&#39;proof.json&#39;</span>
<span class="linenos"> 625</span>        <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 626</span>
<span class="linenos"> 627</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 628</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;subproof_ids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subproof_ids</span>
<span class="linenos"> 629</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">admitted</span>
<span class="linenos"> 630</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;execution_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exec_time</span>
<span class="linenos"> 631</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;APRProof&#39;</span>
<span class="linenos"> 632</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
<span class="linenos"> 633</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="linenos"> 634</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;terminal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
<span class="linenos"> 635</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;node_refutations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 636</span>            <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span> <span class="n">proof</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">proof</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_refutations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="linenos"> 637</span>        <span class="p">}</span>
<span class="linenos"> 638</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;circularity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">circularity</span>
<span class="linenos"> 639</span>        <span class="n">logs</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">ls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="linenos"> 640</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;logs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logs</span>
<span class="linenos"> 641</span>
<span class="linenos"> 642</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;bounded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bounded</span><span class="p">)</span>
<span class="linenos"> 643</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 644</span>            <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;bmc_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span>
<span class="linenos"> 645</span>
<span class="linenos"> 646</span>        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;loops_cache&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_loops_cache</span>
<span class="linenos"> 647</span>
<span class="linenos"> 648</span>        <span class="n">proof_json</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dct</span><span class="p">))</span>
<span class="linenos"> 649</span>        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrote proof data for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">proof_json</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 650</span>        <span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">write_cfg_data</span><span class="p">()</span></div>

<span class="linenos"> 651</span>
<div class="viewcode-block" id="APRProof.refute_node">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.refute_node">[docs]</a>
<span class="linenos"> 652</span>    <span class="k">def</span><span class="w"> </span><span class="nf">refute_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefutationProof</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 653</span>        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to refute node </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 654</span>        <span class="n">refutation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_node_refutation</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 655</span>        <span class="k">if</span> <span class="n">refutation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 656</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to refute node </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 657</span>            <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 658</span>        <span class="n">refutation</span><span class="o">.</span><span class="n">write_proof_data</span><span class="p">()</span>
<span class="linenos"> 659</span>
<span class="linenos"> 660</span>        <span class="bp">self</span><span class="o">.</span><span class="n">node_refutations</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">refutation</span>
<span class="linenos"> 661</span>
<span class="linenos"> 662</span>        <span class="bp">self</span><span class="o">.</span><span class="n">write_proof_data</span><span class="p">()</span>
<span class="linenos"> 663</span>
<span class="linenos"> 664</span>        <span class="k">return</span> <span class="n">refutation</span></div>

<span class="linenos"> 665</span>
<div class="viewcode-block" id="APRProof.unrefute_node">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.unrefute_node">[docs]</a>
<span class="linenos"> 666</span>    <span class="k">def</span><span class="w"> </span><span class="nf">unrefute_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 667</span>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_subproof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_refutation_id</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
<span class="linenos"> 668</span>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_refutations</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
<span class="linenos"> 669</span>        <span class="bp">self</span><span class="o">.</span><span class="n">write_proof_data</span><span class="p">()</span>
<span class="linenos"> 670</span>        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Disabled refutation of node </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span></div>

<span class="linenos"> 671</span>
<div class="viewcode-block" id="APRProof.construct_node_refutation">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProof.construct_node_refutation">[docs]</a>
<span class="linenos"> 672</span>    <span class="k">def</span><span class="w"> </span><span class="nf">construct_node_refutation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefutationProof</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># TODO put into prover class</span>
<span class="linenos"> 673</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 674</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot refute node </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> that already has successors&#39;</span><span class="p">)</span>
<span class="linenos"> 675</span>            <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 676</span>
<span class="linenos"> 677</span>        <span class="n">path</span> <span class="o">=</span> <span class="n">single</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">paths_between</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="n">target_id</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
<span class="linenos"> 678</span>        <span class="n">branches_on_path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Split</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">NDBranch</span><span class="p">,</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
<span class="linenos"> 679</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">branches_on_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 680</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot refute node </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> in linear KCFG&#39;</span><span class="p">)</span>
<span class="linenos"> 681</span>            <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 682</span>        <span class="n">closest_branch</span> <span class="o">=</span> <span class="n">branches_on_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 683</span>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">closest_branch</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">NDBranch</span><span class="p">:</span>
<span class="linenos"> 684</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot refute node </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> following a non-deterministic branch: not yet implemented&#39;</span><span class="p">)</span>
<span class="linenos"> 685</span>            <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 686</span>
<span class="linenos"> 687</span>        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">closest_branch</span><span class="p">)</span> <span class="ow">is</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Split</span>
<span class="linenos"> 688</span>        <span class="n">refuted_branch_root</span> <span class="o">=</span> <span class="n">closest_branch</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 689</span>        <span class="n">csubst</span> <span class="o">=</span> <span class="n">closest_branch</span><span class="o">.</span><span class="n">splits</span><span class="p">[</span><span class="n">refuted_branch_root</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
<span class="linenos"> 690</span>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">csubst</span><span class="o">.</span><span class="n">subst</span><span class="o">.</span><span class="n">is_identity</span><span class="p">):</span>
<span class="linenos"> 691</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<span class="linenos"> 692</span>                <span class="sa">f</span><span class="s1">&#39;Cannot refute node </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">: unexpected non-identity substitution </span><span class="si">{</span><span class="n">csubst</span><span class="o">.</span><span class="n">subst</span><span class="si">}</span><span class="s1"> in Split from </span><span class="si">{</span><span class="n">closest_branch</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos"> 693</span>            <span class="p">)</span>
<span class="linenos"> 694</span>            <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 695</span>
<span class="linenos"> 696</span>        <span class="n">last_constraint</span> <span class="o">=</span> <span class="n">ml_pred_to_bool</span><span class="p">(</span><span class="n">csubst</span><span class="o">.</span><span class="n">constraint</span><span class="p">)</span>
<span class="linenos"> 697</span>        <span class="n">relevant_vars</span> <span class="o">=</span> <span class="n">free_vars</span><span class="p">(</span><span class="n">last_constraint</span><span class="p">)</span>
<span class="linenos"> 698</span>        <span class="n">pre_split_constraints</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 699</span>            <span class="n">ml_pred_to_bool</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="linenos"> 700</span>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">remove_useless_constraints</span><span class="p">(</span><span class="n">closest_branch</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">cterm</span><span class="o">.</span><span class="n">constraints</span><span class="p">,</span> <span class="n">relevant_vars</span><span class="p">)</span>
<span class="linenos"> 701</span>        <span class="p">]</span>
<span class="linenos"> 702</span>
<span class="linenos"> 703</span>        <span class="n">refutation_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_refutation_id</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="linenos"> 704</span>        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Adding refutation proof </span><span class="si">{</span><span class="n">refutation_id</span><span class="si">}</span><span class="s1"> as subproof of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 705</span>        <span class="n">refutation</span> <span class="o">=</span> <span class="n">RefutationProof</span><span class="p">(</span>
<span class="linenos"> 706</span>            <span class="nb">id</span><span class="o">=</span><span class="n">refutation_id</span><span class="p">,</span>
<span class="linenos"> 707</span>            <span class="n">pre_constraints</span><span class="o">=</span><span class="n">pre_split_constraints</span><span class="p">,</span>
<span class="linenos"> 708</span>            <span class="n">last_constraint</span><span class="o">=</span><span class="n">last_constraint</span><span class="p">,</span>
<span class="linenos"> 709</span>            <span class="n">proof_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proof_dir</span><span class="p">,</span>
<span class="linenos"> 710</span>        <span class="p">)</span>
<span class="linenos"> 711</span>
<span class="linenos"> 712</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_subproof</span><span class="p">(</span><span class="n">refutation</span><span class="p">)</span>
<span class="linenos"> 713</span>        <span class="k">return</span> <span class="n">refutation</span></div>
</div>

<span class="linenos"> 714</span>
<span class="linenos"> 715</span>
<div class="viewcode-block" id="APRProver">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProver">[docs]</a>
<span class="linenos"> 716</span><span class="k">class</span><span class="w"> </span><span class="nc">APRProver</span><span class="p">(</span><span class="n">Prover</span><span class="p">[</span><span class="n">APRProof</span><span class="p">,</span> <span class="n">APRProofStep</span><span class="p">,</span> <span class="n">APRProofResult</span><span class="p">]):</span>
<span class="linenos"> 717</span>    <span class="n">main_module_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 718</span>    <span class="n">execute_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
<span class="linenos"> 719</span>    <span class="n">cut_point_rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 720</span>    <span class="n">terminal_rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 721</span>    <span class="n">counterexample_info</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos"> 722</span>    <span class="n">fast_check_subsumption</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos"> 723</span>    <span class="n">direct_subproof_rules</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos"> 724</span>    <span class="n">assume_defined</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos"> 725</span>    <span class="n">kcfg_explore</span><span class="p">:</span> <span class="n">KCFGExplore</span>
<span class="linenos"> 726</span>    <span class="n">extra_module</span><span class="p">:</span> <span class="n">KFlatModule</span> <span class="o">|</span> <span class="kc">None</span>
<span class="linenos"> 727</span>    <span class="n">optimize_kcfg</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos"> 728</span>
<span class="linenos"> 729</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span class="linenos"> 730</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 731</span>        <span class="n">kcfg_explore</span><span class="p">:</span> <span class="n">KCFGExplore</span><span class="p">,</span>
<span class="linenos"> 732</span>        <span class="n">execute_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 733</span>        <span class="n">cut_point_rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
<span class="linenos"> 734</span>        <span class="n">terminal_rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
<span class="linenos"> 735</span>        <span class="n">counterexample_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 736</span>        <span class="n">fast_check_subsumption</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 737</span>        <span class="n">direct_subproof_rules</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 738</span>        <span class="n">assume_defined</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 739</span>        <span class="n">extra_module</span><span class="p">:</span> <span class="n">KFlatModule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 740</span>        <span class="n">optimize_kcfg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 741</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 742</span>
<span class="linenos"> 743</span>        <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span> <span class="o">=</span> <span class="n">kcfg_explore</span>
<span class="linenos"> 744</span>        <span class="bp">self</span><span class="o">.</span><span class="n">main_module_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">cterm_symbolic</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">main_module_name</span>
<span class="linenos"> 745</span>        <span class="bp">self</span><span class="o">.</span><span class="n">execute_depth</span> <span class="o">=</span> <span class="n">execute_depth</span>
<span class="linenos"> 746</span>        <span class="bp">self</span><span class="o">.</span><span class="n">cut_point_rules</span> <span class="o">=</span> <span class="n">cut_point_rules</span>
<span class="linenos"> 747</span>        <span class="bp">self</span><span class="o">.</span><span class="n">terminal_rules</span> <span class="o">=</span> <span class="n">terminal_rules</span>
<span class="linenos"> 748</span>        <span class="bp">self</span><span class="o">.</span><span class="n">counterexample_info</span> <span class="o">=</span> <span class="n">counterexample_info</span>
<span class="linenos"> 749</span>        <span class="bp">self</span><span class="o">.</span><span class="n">fast_check_subsumption</span> <span class="o">=</span> <span class="n">fast_check_subsumption</span>
<span class="linenos"> 750</span>        <span class="bp">self</span><span class="o">.</span><span class="n">direct_subproof_rules</span> <span class="o">=</span> <span class="n">direct_subproof_rules</span>
<span class="linenos"> 751</span>        <span class="bp">self</span><span class="o">.</span><span class="n">assume_defined</span> <span class="o">=</span> <span class="n">assume_defined</span>
<span class="linenos"> 752</span>        <span class="bp">self</span><span class="o">.</span><span class="n">extra_module</span> <span class="o">=</span> <span class="n">extra_module</span>
<span class="linenos"> 753</span>        <span class="bp">self</span><span class="o">.</span><span class="n">optimize_kcfg</span> <span class="o">=</span> <span class="n">optimize_kcfg</span>
<span class="linenos"> 754</span>
<div class="viewcode-block" id="APRProver.close">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProver.close">[docs]</a>
<span class="linenos"> 755</span>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 756</span>        <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">cterm_symbolic</span><span class="o">.</span><span class="n">_kore_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<span class="linenos"> 757</span>
<div class="viewcode-block" id="APRProver.init_proof">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProver.init_proof">[docs]</a>
<span class="linenos"> 758</span>    <span class="k">def</span><span class="w"> </span><span class="nf">init_proof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proof</span><span class="p">:</span> <span class="n">APRProof</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 759</span>        <span class="n">main_module_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_module_name</span>
<span class="linenos"> 760</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_module</span><span class="p">:</span>
<span class="linenos"> 761</span>            <span class="n">main_module_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">cterm_symbolic</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_module</span><span class="p">,</span> <span class="n">name_as_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 762</span>
<span class="linenos"> 763</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_inject_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">import_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sentences</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KRule</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 764</span>            <span class="n">_module</span> <span class="o">=</span> <span class="n">KFlatModule</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">sentences</span><span class="p">,</span> <span class="p">[</span><span class="n">KImport</span><span class="p">(</span><span class="n">import_name</span><span class="p">)])</span>
<span class="linenos"> 765</span>            <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">cterm_symbolic</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="n">_module</span><span class="p">,</span> <span class="n">name_as_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 766</span>
<span class="linenos"> 767</span>        <span class="n">subproofs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Proof</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 768</span>            <span class="p">[</span><span class="n">Proof</span><span class="o">.</span><span class="n">read_proof_data</span><span class="p">(</span><span class="n">proof</span><span class="o">.</span><span class="n">proof_dir</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">proof</span><span class="o">.</span><span class="n">subproof_ids</span><span class="p">]</span>
<span class="linenos"> 769</span>            <span class="k">if</span> <span class="n">proof</span><span class="o">.</span><span class="n">proof_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="linenos"> 770</span>            <span class="k">else</span> <span class="p">[]</span>
<span class="linenos"> 771</span>        <span class="p">)</span>
<span class="linenos"> 772</span>        <span class="n">dependencies_as_rules</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 773</span>            <span class="n">rule</span>
<span class="linenos"> 774</span>            <span class="k">for</span> <span class="n">subproof</span> <span class="ow">in</span> <span class="n">subproofs</span>
<span class="linenos"> 775</span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subproof</span><span class="p">,</span> <span class="n">APRProof</span><span class="p">)</span>
<span class="linenos"> 776</span>            <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">subproof</span><span class="o">.</span><span class="n">as_rules</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">direct_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_subproof_rules</span><span class="p">)</span>
<span class="linenos"> 777</span>        <span class="p">]</span>
<span class="linenos"> 778</span>        <span class="n">_inject_module</span><span class="p">(</span><span class="n">proof</span><span class="o">.</span><span class="n">dependencies_module_name</span><span class="p">,</span> <span class="n">main_module_name</span><span class="p">,</span> <span class="n">dependencies_as_rules</span><span class="p">)</span>
<span class="linenos"> 779</span>
<span class="linenos"> 780</span>        <span class="k">if</span> <span class="n">proof</span><span class="o">.</span><span class="n">circularity</span><span class="p">:</span>
<span class="linenos"> 781</span>            <span class="n">circularity_rule</span> <span class="o">=</span> <span class="n">proof</span><span class="o">.</span><span class="n">as_rule</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="linenos"> 782</span>            <span class="n">_inject_module</span><span class="p">(</span><span class="n">proof</span><span class="o">.</span><span class="n">circularities_module_name</span><span class="p">,</span> <span class="n">proof</span><span class="o">.</span><span class="n">dependencies_module_name</span><span class="p">,</span> <span class="p">[</span><span class="n">circularity_rule</span><span class="p">])</span>
<span class="linenos"> 783</span>
<span class="linenos"> 784</span>        <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="p">[</span><span class="n">proof</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="n">proof</span><span class="o">.</span><span class="n">target</span><span class="p">]:</span>
<span class="linenos"> 785</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">kcfg_semantics</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">(</span><span class="n">proof</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span><span class="o">.</span><span class="n">cterm</span><span class="p">):</span>
<span class="linenos"> 786</span>                <span class="n">proof</span><span class="o">.</span><span class="n">add_terminal</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span></div>

<span class="linenos"> 787</span>
<span class="linenos"> 788</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_may_subsume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 789</span>        <span class="n">node_k_cell</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">cterm</span><span class="o">.</span><span class="n">try_cell</span><span class="p">(</span><span class="s1">&#39;K_CELL&#39;</span><span class="p">)</span>
<span class="linenos"> 790</span>        <span class="n">target_k_cell</span> <span class="o">=</span> <span class="n">target_node</span><span class="o">.</span><span class="n">cterm</span><span class="o">.</span><span class="n">try_cell</span><span class="p">(</span><span class="s1">&#39;K_CELL&#39;</span><span class="p">)</span>
<span class="linenos"> 791</span>        <span class="k">if</span> <span class="n">node_k_cell</span> <span class="ow">and</span> <span class="n">target_k_cell</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">target_k_cell</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">node_k_cell</span><span class="p">):</span>
<span class="linenos"> 792</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos"> 793</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 794</span>
<span class="linenos"> 795</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_subsume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">:</span> <span class="n">KCFG</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">proof_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CSubst</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 796</span>        <span class="n">target_cterm</span> <span class="o">=</span> <span class="n">target_node</span><span class="o">.</span><span class="n">cterm</span>
<span class="linenos"> 797</span>        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Checking subsumption into target state </span><span class="si">{</span><span class="n">proof_id</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">shorten_hashes</span><span class="p">((</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">target_cterm</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 798</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_check_subsumption</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_may_subsume</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">):</span>
<span class="linenos"> 799</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skipping full subsumption check because of fast may subsume check </span><span class="si">{</span><span class="n">proof_id</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 800</span>            <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 801</span>        <span class="n">_csubst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">cterm_symbolic</span><span class="o">.</span><span class="n">implies</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">cterm</span><span class="p">,</span> <span class="n">target_cterm</span><span class="p">,</span> <span class="n">assume_defined</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assume_defined</span><span class="p">)</span>
<span class="linenos"> 802</span>        <span class="n">csubst</span> <span class="o">=</span> <span class="n">_csubst</span><span class="o">.</span><span class="n">csubst</span>
<span class="linenos"> 803</span>        <span class="k">if</span> <span class="n">csubst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 804</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Subsumed into target node </span><span class="si">{</span><span class="n">proof_id</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">shorten_hashes</span><span class="p">((</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">target_node</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 805</span>        <span class="k">return</span> <span class="n">csubst</span>
<span class="linenos"> 806</span>
<div class="viewcode-block" id="APRProver.step_proof">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProver.step_proof">[docs]</a>
<span class="linenos"> 807</span>    <span class="k">def</span><span class="w"> </span><span class="nf">step_proof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">APRProofStep</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">APRProofResult</span><span class="p">]:</span>
<span class="linenos"> 808</span>        <span class="c1"># Check if the current node should be bounded</span>
<span class="linenos"> 809</span>        <span class="n">prior_loops</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
<span class="linenos"> 810</span>        <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">bmc_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">kcfg_semantics</span><span class="o">.</span><span class="n">is_loop</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">cterm</span><span class="p">):</span>
<span class="linenos"> 811</span>            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">shortest_path_to_node</span><span class="p">:</span>
<span class="linenos"> 812</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">kcfg_semantics</span><span class="o">.</span><span class="n">same_loop</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">cterm</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">cterm</span><span class="p">):</span>
<span class="linenos"> 813</span>                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">prior_loops_cache</span><span class="p">:</span>
<span class="linenos"> 814</span>                        <span class="n">prior_loops</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">prior_loops_cache</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,)</span>
<span class="linenos"> 815</span>                        <span class="k">break</span>
<span class="linenos"> 816</span>
<span class="linenos"> 817</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prior loop heads for node </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">prior_loops</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 818</span>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prior_loops</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">step</span><span class="o">.</span><span class="n">bmc_depth</span><span class="p">:</span>
<span class="linenos"> 819</span>                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bounded node </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">proof_id</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> at bmc depth </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">bmc_depth</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 820</span>                <span class="k">return</span> <span class="p">[</span>
<span class="linenos"> 821</span>                    <span class="n">APRProofBoundedResult</span><span class="p">(</span>
<span class="linenos"> 822</span>                        <span class="n">node_id</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">optimize_kcfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimize_kcfg</span><span class="p">,</span> <span class="n">prior_loops_cache_update</span><span class="o">=</span><span class="n">prior_loops</span>
<span class="linenos"> 823</span>                    <span class="p">)</span>
<span class="linenos"> 824</span>                <span class="p">]</span>
<span class="linenos"> 825</span>
<span class="linenos"> 826</span>        <span class="c1"># Check if the current node and target are terminal</span>
<span class="linenos"> 827</span>        <span class="n">is_terminal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">kcfg_semantics</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">cterm</span><span class="p">)</span>
<span class="linenos"> 828</span>        <span class="n">target_is_terminal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">kcfg_semantics</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">cterm</span><span class="p">)</span>
<span class="linenos"> 829</span>
<span class="linenos"> 830</span>        <span class="n">terminal_result</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">APRProofResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 831</span>            <span class="p">[</span>
<span class="linenos"> 832</span>                <span class="n">APRProofTerminalResult</span><span class="p">(</span>
<span class="linenos"> 833</span>                    <span class="n">node_id</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">optimize_kcfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimize_kcfg</span><span class="p">,</span> <span class="n">prior_loops_cache_update</span><span class="o">=</span><span class="n">prior_loops</span>
<span class="linenos"> 834</span>                <span class="p">)</span>
<span class="linenos"> 835</span>            <span class="p">]</span>
<span class="linenos"> 836</span>            <span class="k">if</span> <span class="n">is_terminal</span>
<span class="linenos"> 837</span>            <span class="k">else</span> <span class="p">[]</span>
<span class="linenos"> 838</span>        <span class="p">)</span>
<span class="linenos"> 839</span>
<span class="linenos"> 840</span>        <span class="c1"># Subsumption is checked if and only if the target node</span>
<span class="linenos"> 841</span>        <span class="c1"># and the current node are either both terminal or both not terminal</span>
<span class="linenos"> 842</span>        <span class="k">if</span> <span class="n">is_terminal</span> <span class="o">==</span> <span class="n">target_is_terminal</span><span class="p">:</span>
<span class="linenos"> 843</span>            <span class="n">csubst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_subsume</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">proof_id</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">proof_id</span><span class="p">)</span>
<span class="linenos"> 844</span>            <span class="k">if</span> <span class="n">csubst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 845</span>                <span class="c1"># Information about the subsumed node being terminal must be returned</span>
<span class="linenos"> 846</span>                <span class="c1"># so that the set of terminal nodes is correctly updated</span>
<span class="linenos"> 847</span>                <span class="k">return</span> <span class="n">terminal_result</span> <span class="o">+</span> <span class="p">[</span>
<span class="linenos"> 848</span>                    <span class="n">APRProofSubsumeResult</span><span class="p">(</span>
<span class="linenos"> 849</span>                        <span class="n">csubst</span><span class="o">=</span><span class="n">csubst</span><span class="p">,</span>
<span class="linenos"> 850</span>                        <span class="n">optimize_kcfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimize_kcfg</span><span class="p">,</span>
<span class="linenos"> 851</span>                        <span class="n">node_id</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="linenos"> 852</span>                        <span class="n">prior_loops_cache_update</span><span class="o">=</span><span class="n">prior_loops</span><span class="p">,</span>
<span class="linenos"> 853</span>                    <span class="p">)</span>
<span class="linenos"> 854</span>                <span class="p">]</span>
<span class="linenos"> 855</span>
<span class="linenos"> 856</span>        <span class="k">if</span> <span class="n">is_terminal</span><span class="p">:</span>
<span class="linenos"> 857</span>            <span class="k">return</span> <span class="n">terminal_result</span>
<span class="linenos"> 858</span>
<span class="linenos"> 859</span>        <span class="c1"># Ensure that we cut at applications of circularity, so that subsumption into target state will be checked</span>
<span class="linenos"> 860</span>        <span class="n">cut_rules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cut_point_rules</span><span class="p">)</span>
<span class="linenos"> 861</span>        <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">circularity</span> <span class="ow">and</span> <span class="n">step</span><span class="o">.</span><span class="n">nonzero_depth</span><span class="p">:</span>
<span class="linenos"> 862</span>            <span class="n">cut_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">circularity_rule_id</span><span class="p">)</span>
<span class="linenos"> 863</span>
<span class="linenos"> 864</span>        <span class="c1"># Ensure that we record progress ASAP for circularities, so the circularity rule will be included for execution as soon as possible</span>
<span class="linenos"> 865</span>        <span class="n">execute_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_depth</span>
<span class="linenos"> 866</span>        <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">circularity</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">step</span><span class="o">.</span><span class="n">nonzero_depth</span><span class="p">:</span>
<span class="linenos"> 867</span>            <span class="n">execute_depth</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 868</span>
<span class="linenos"> 869</span>        <span class="c1"># If the step has already been cached, do not invoke the backend and only send a signal back to the proof to use the cache</span>
<span class="linenos"> 870</span>        <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">use_cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 871</span>            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using cached step for edge </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">use_cache</span><span class="si">}</span><span class="s1"> --&gt; </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 872</span>            <span class="k">return</span> <span class="p">[</span>
<span class="linenos"> 873</span>                <span class="n">APRProofUseCacheResult</span><span class="p">(</span>
<span class="linenos"> 874</span>                    <span class="n">node_id</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="linenos"> 875</span>                    <span class="n">cached_node_id</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">use_cache</span><span class="p">,</span>
<span class="linenos"> 876</span>                    <span class="n">optimize_kcfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimize_kcfg</span><span class="p">,</span>
<span class="linenos"> 877</span>                    <span class="n">prior_loops_cache_update</span><span class="o">=</span><span class="n">prior_loops</span><span class="p">,</span>
<span class="linenos"> 878</span>                <span class="p">)</span>
<span class="linenos"> 879</span>            <span class="p">]</span>
<span class="linenos"> 880</span>        <span class="c1"># Invoke the backend to obtain the next KCFG extension</span>
<span class="linenos"> 881</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 882</span>            <span class="n">extend_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="o">.</span><span class="n">extend_cterm</span><span class="p">(</span>
<span class="linenos"> 883</span>                <span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">cterm</span><span class="p">,</span>
<span class="linenos"> 884</span>                <span class="n">execute_depth</span><span class="o">=</span><span class="n">execute_depth</span><span class="p">,</span>
<span class="linenos"> 885</span>                <span class="n">cut_point_rules</span><span class="o">=</span><span class="n">cut_rules</span><span class="p">,</span>
<span class="linenos"> 886</span>                <span class="n">terminal_rules</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">terminal_rules</span><span class="p">,</span>
<span class="linenos"> 887</span>                <span class="n">module_name</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">module_name</span><span class="p">,</span>
<span class="linenos"> 888</span>                <span class="n">node_id</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="linenos"> 889</span>            <span class="p">)</span>
<span class="linenos"> 890</span>
<span class="linenos"> 891</span>        <span class="c1"># We can obtain two results at most</span>
<span class="linenos"> 892</span>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">extend_results</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span>
<span class="linenos"> 893</span>        <span class="c1"># We have obtained two results: first is to be applied, second to be cached potentially</span>
<span class="linenos"> 894</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extend_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos"> 895</span>            <span class="c1"># Cache only if the current node is at non-zero depth</span>
<span class="linenos"> 896</span>            <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">nonzero_depth</span><span class="p">:</span>
<span class="linenos"> 897</span>                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Caching next step for edge starting from </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 898</span>                <span class="k">return</span> <span class="p">[</span>
<span class="linenos"> 899</span>                    <span class="n">APRProofExtendAndCacheResult</span><span class="p">(</span>
<span class="linenos"> 900</span>                        <span class="n">node_id</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="linenos"> 901</span>                        <span class="n">extension_to_apply</span><span class="o">=</span><span class="n">extend_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos"> 902</span>                        <span class="n">extension_to_cache</span><span class="o">=</span><span class="n">extend_results</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="linenos"> 903</span>                        <span class="n">prior_loops_cache_update</span><span class="o">=</span><span class="n">prior_loops</span><span class="p">,</span>
<span class="linenos"> 904</span>                        <span class="n">optimize_kcfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimize_kcfg</span><span class="p">,</span>
<span class="linenos"> 905</span>                    <span class="p">)</span>
<span class="linenos"> 906</span>                <span class="p">]</span>
<span class="linenos"> 907</span>
<span class="linenos"> 908</span>        <span class="c1"># Otherwise, discard the second result</span>
<span class="linenos"> 909</span>        <span class="k">return</span> <span class="p">[</span>
<span class="linenos"> 910</span>            <span class="n">APRProofExtendResult</span><span class="p">(</span>
<span class="linenos"> 911</span>                <span class="n">node_id</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="linenos"> 912</span>                <span class="n">extension_to_apply</span><span class="o">=</span><span class="n">extend_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos"> 913</span>                <span class="n">prior_loops_cache_update</span><span class="o">=</span><span class="n">prior_loops</span><span class="p">,</span>
<span class="linenos"> 914</span>                <span class="n">optimize_kcfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimize_kcfg</span><span class="p">,</span>
<span class="linenos"> 915</span>            <span class="p">)</span>
<span class="linenos"> 916</span>        <span class="p">]</span></div>

<span class="linenos"> 917</span>
<div class="viewcode-block" id="APRProver.failure_info">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRProver.failure_info">[docs]</a>
<span class="linenos"> 918</span>    <span class="k">def</span><span class="w"> </span><span class="nf">failure_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proof</span><span class="p">:</span> <span class="n">APRProof</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FailureInfo</span><span class="p">:</span>
<span class="linenos"> 919</span>        <span class="k">return</span> <span class="n">APRFailureInfo</span><span class="o">.</span><span class="n">from_proof</span><span class="p">(</span>
<span class="linenos"> 920</span>            <span class="n">proof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcfg_explore</span><span class="p">,</span> <span class="n">counterexample_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">counterexample_info</span><span class="p">,</span> <span class="n">assume_defined</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assume_defined</span>
<span class="linenos"> 921</span>        <span class="p">)</span></div>
</div>

<span class="linenos"> 922</span>
<span class="linenos"> 923</span>
<div class="viewcode-block" id="APRSummary">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRSummary">[docs]</a>
<span class="linenos"> 924</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 925</span><span class="k">class</span><span class="w"> </span><span class="nc">APRSummary</span><span class="p">(</span><span class="n">ProofSummary</span><span class="p">):</span>
<span class="linenos"> 926</span>    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 927</span>    <span class="n">status</span><span class="p">:</span> <span class="n">ProofStatus</span>
<span class="linenos"> 928</span>    <span class="n">admitted</span><span class="p">:</span> <span class="nb">bool</span>
<span class="linenos"> 929</span>    <span class="n">nodes</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 930</span>    <span class="n">pending</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 931</span>    <span class="n">failing</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 932</span>    <span class="n">vacuous</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 933</span>    <span class="n">stuck</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 934</span>    <span class="n">terminal</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 935</span>    <span class="n">refuted</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 936</span>    <span class="n">bmc_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
<span class="linenos"> 937</span>    <span class="n">bounded</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 938</span>    <span class="n">subproofs</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos"> 939</span>    <span class="n">formatted_exec_time</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 940</span>
<span class="linenos"> 941</span>    <span class="nd">@property</span>
<span class="linenos"> 942</span>    <span class="k">def</span><span class="w"> </span><span class="nf">lines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="linenos"> 943</span>        <span class="n">_lines</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 944</span>            <span class="sa">f</span><span class="s1">&#39;APRProof: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 945</span>            <span class="sa">f</span><span class="s1">&#39;    status: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 946</span>            <span class="sa">f</span><span class="s1">&#39;    admitted: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">admitted</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 947</span>            <span class="sa">f</span><span class="s1">&#39;    nodes: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 948</span>            <span class="sa">f</span><span class="s1">&#39;    pending: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pending</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 949</span>            <span class="sa">f</span><span class="s1">&#39;    failing: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">failing</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 950</span>            <span class="sa">f</span><span class="s1">&#39;    vacuous: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vacuous</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 951</span>            <span class="sa">f</span><span class="s1">&#39;    stuck: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stuck</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 952</span>            <span class="sa">f</span><span class="s1">&#39;    terminal: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">terminal</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 953</span>            <span class="sa">f</span><span class="s1">&#39;    refuted: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">refuted</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 954</span>            <span class="sa">f</span><span class="s1">&#39;    bounded: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bounded</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 955</span>            <span class="sa">f</span><span class="s1">&#39;    execution time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">formatted_exec_time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos"> 956</span>        <span class="p">]</span>
<span class="linenos"> 957</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 958</span>            <span class="n">_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    bmc depth: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bmc_depth</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 959</span>        <span class="n">_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Subproofs: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subproofs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos"> 960</span>        <span class="k">return</span> <span class="n">_lines</span></div>

<span class="linenos"> 961</span>
<span class="linenos"> 962</span>
<div class="viewcode-block" id="APRFailureInfo">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRFailureInfo">[docs]</a>
<span class="linenos"> 963</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 964</span><span class="k">class</span><span class="w"> </span><span class="nc">APRFailureInfo</span><span class="p">(</span><span class="n">FailureInfo</span><span class="p">):</span>
<span class="linenos"> 965</span>    <span class="n">pending_nodes</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="linenos"> 966</span>    <span class="n">failing_nodes</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="linenos"> 967</span>    <span class="n">path_conditions</span><span class="p">:</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 968</span>    <span class="n">failure_reasons</span><span class="p">:</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 969</span>    <span class="n">models</span><span class="p">:</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span>
<span class="linenos"> 970</span>
<span class="linenos"> 971</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span class="linenos"> 972</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 973</span>        <span class="n">failing_nodes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<span class="linenos"> 974</span>        <span class="n">pending_nodes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<span class="linenos"> 975</span>        <span class="n">path_conditions</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="linenos"> 976</span>        <span class="n">failure_reasons</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="linenos"> 977</span>        <span class="n">models</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span>
<span class="linenos"> 978</span>    <span class="p">):</span>
<span class="linenos"> 979</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;failing_nodes&#39;</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">failing_nodes</span><span class="p">))</span>
<span class="linenos"> 980</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pending_nodes&#39;</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">pending_nodes</span><span class="p">))</span>
<span class="linenos"> 981</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;path_conditions&#39;</span><span class="p">,</span> <span class="n">FrozenDict</span><span class="p">(</span><span class="n">path_conditions</span><span class="p">))</span>
<span class="linenos"> 982</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;failure_reasons&#39;</span><span class="p">,</span> <span class="n">FrozenDict</span><span class="p">(</span><span class="n">failure_reasons</span><span class="p">))</span>
<span class="linenos"> 983</span>        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span>
<span class="linenos"> 984</span>            <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="n">FrozenDict</span><span class="p">({</span><span class="n">node_id</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
<span class="linenos"> 985</span>        <span class="p">)</span>
<span class="linenos"> 986</span>
<div class="viewcode-block" id="APRFailureInfo.from_proof">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRFailureInfo.from_proof">[docs]</a>
<span class="linenos"> 987</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 988</span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_proof</span><span class="p">(</span>
<span class="linenos"> 989</span>        <span class="n">proof</span><span class="p">:</span> <span class="n">APRProof</span><span class="p">,</span> <span class="n">kcfg_explore</span><span class="p">:</span> <span class="n">KCFGExplore</span><span class="p">,</span> <span class="n">counterexample_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">assume_defined</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 990</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">APRFailureInfo</span><span class="p">:</span>
<span class="linenos"> 991</span>        <span class="n">target</span> <span class="o">=</span> <span class="n">proof</span><span class="o">.</span><span class="n">kcfg</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">proof</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="linenos"> 992</span>        <span class="n">pending_nodes</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">proof</span><span class="o">.</span><span class="n">pending</span><span class="p">}</span>
<span class="linenos"> 993</span>        <span class="n">failing_nodes</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">proof</span><span class="o">.</span><span class="n">failing</span><span class="p">}</span>
<span class="linenos"> 994</span>        <span class="n">path_conditions</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 995</span>        <span class="n">failure_reasons</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 996</span>        <span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 997</span>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">proof</span><span class="o">.</span><span class="n">failing</span><span class="p">:</span>
<span class="linenos"> 998</span>            <span class="n">node_cterm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">kcfg_explore</span><span class="o">.</span><span class="n">cterm_symbolic</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">cterm</span><span class="p">)</span>
<span class="linenos"> 999</span>            <span class="n">target_cterm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">kcfg_explore</span><span class="o">.</span><span class="n">cterm_symbolic</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">cterm</span><span class="p">)</span>
<span class="linenos">1000</span>            <span class="n">_</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">kcfg_explore</span><span class="o">.</span><span class="n">implication_failure_reason</span><span class="p">(</span><span class="n">node_cterm</span><span class="p">,</span> <span class="n">target_cterm</span><span class="p">,</span> <span class="n">assume_defined</span><span class="o">=</span><span class="n">assume_defined</span><span class="p">)</span>
<span class="linenos">1001</span>            <span class="n">path_condition</span> <span class="o">=</span> <span class="n">kcfg_explore</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">(</span><span class="n">proof</span><span class="o">.</span><span class="n">path_constraints</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
<span class="linenos">1002</span>            <span class="n">failure_reasons</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">reason</span>
<span class="linenos">1003</span>            <span class="n">path_conditions</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_condition</span>
<span class="linenos">1004</span>            <span class="k">if</span> <span class="n">counterexample_info</span><span class="p">:</span>
<span class="linenos">1005</span>                <span class="n">model_subst</span> <span class="o">=</span> <span class="n">kcfg_explore</span><span class="o">.</span><span class="n">cterm_symbolic</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">cterm</span><span class="p">)</span>
<span class="linenos">1006</span>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_subst</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Subst</span><span class="p">:</span>
<span class="linenos">1007</span>                    <span class="n">model</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1008</span>                    <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">model_subst</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">1009</span>                        <span class="n">term_kast</span> <span class="o">=</span> <span class="n">KInner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
<span class="linenos">1010</span>                        <span class="n">term_pretty</span> <span class="o">=</span> <span class="n">kcfg_explore</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">(</span><span class="n">term_kast</span><span class="p">)</span>
<span class="linenos">1011</span>                        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">var</span><span class="p">,</span> <span class="n">term_pretty</span><span class="p">))</span>
<span class="linenos">1012</span>                    <span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
<span class="linenos">1013</span>        <span class="k">return</span> <span class="n">APRFailureInfo</span><span class="p">(</span>
<span class="linenos">1014</span>            <span class="n">failing_nodes</span><span class="o">=</span><span class="n">failing_nodes</span><span class="p">,</span>
<span class="linenos">1015</span>            <span class="n">pending_nodes</span><span class="o">=</span><span class="n">pending_nodes</span><span class="p">,</span>
<span class="linenos">1016</span>            <span class="n">path_conditions</span><span class="o">=</span><span class="n">path_conditions</span><span class="p">,</span>
<span class="linenos">1017</span>            <span class="n">failure_reasons</span><span class="o">=</span><span class="n">failure_reasons</span><span class="p">,</span>
<span class="linenos">1018</span>            <span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span>
<span class="linenos">1019</span>        <span class="p">)</span></div>

<span class="linenos">1020</span>
<div class="viewcode-block" id="APRFailureInfo.print">
<a class="viewcode-back" href="../../../api/pyk.proof.reachability.html#pyk.proof.reachability.APRFailureInfo.print">[docs]</a>
<span class="linenos">1021</span>    <span class="k">def</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="linenos">1022</span>        <span class="n">res_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1023</span>
<span class="linenos">1024</span>        <span class="n">num_pending</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_nodes</span><span class="p">)</span>
<span class="linenos">1025</span>        <span class="n">num_failing</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failing_nodes</span><span class="p">)</span>
<span class="linenos">1026</span>        <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="linenos">1027</span>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">num_pending</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">num_failing</span><span class="si">}</span><span class="s1"> Failure nodes. (</span><span class="si">{</span><span class="n">num_pending</span><span class="si">}</span><span class="s1"> pending and </span><span class="si">{</span><span class="n">num_failing</span><span class="si">}</span><span class="s1"> failing)&#39;</span>
<span class="linenos">1028</span>        <span class="p">)</span>
<span class="linenos">1029</span>
<span class="linenos">1030</span>        <span class="k">if</span> <span class="n">num_pending</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1031</span>            <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">1032</span>            <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pending nodes: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_nodes</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1033</span>
<span class="linenos">1034</span>        <span class="k">if</span> <span class="n">num_failing</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1035</span>            <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">1036</span>            <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Failing nodes:&#39;</span><span class="p">)</span>
<span class="linenos">1037</span>            <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failing_nodes</span><span class="p">:</span>
<span class="linenos">1038</span>                <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_reasons</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
<span class="linenos">1039</span>                <span class="n">path_condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_conditions</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
<span class="linenos">1040</span>                <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">1041</span>                <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Node id: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1042</span>
<span class="linenos">1043</span>                <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  Failure reason:&#39;</span><span class="p">)</span>
<span class="linenos">1044</span>                <span class="n">res_lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reason</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]</span>
<span class="linenos">1045</span>
<span class="linenos">1046</span>                <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  Path condition:&#39;</span><span class="p">)</span>
<span class="linenos">1047</span>                <span class="n">res_lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="n">path_condition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
<span class="linenos">1048</span>
<span class="linenos">1049</span>                <span class="k">if</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span>
<span class="linenos">1050</span>                    <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  Model:&#39;</span><span class="p">)</span>
<span class="linenos">1051</span>                    <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node_id</span><span class="p">]:</span>
<span class="linenos">1052</span>                        <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">term</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">1053</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">1054</span>                    <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  Failed to generate a model.&#39;</span><span class="p">)</span>
<span class="linenos">1055</span>
<span class="linenos">1056</span>            <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">1057</span>            <span class="n">res_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Join the Runtime Verification Discord server for support: https://discord.gg/CurfmXNtbN&#39;</span><span class="p">)</span>
<span class="linenos">1058</span>        <span class="k">return</span> <span class="n">res_lines</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Runtime Verification, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>