<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="K | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />
<link rel="canonical" href="https://kframework.org/docs/user_manual/" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../assets/img/favicon.ico" />

<title>K User Manual | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../index.html">
    <picture>
      <source
        srcset="../../assets/img/k-logo-dark.png"
        media="(prefers-color-scheme: dark)"
      />
      <img src="../../assets/img/k-logo.png" alt="K" style="height: 48px" />
    </picture>
    Semantic Framework
  </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item dropdown">
      <a
        class="nav-link dropdown-toggle"
        href="#"
        id="navbarDropdown"
        role="button"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        <i class="fas fa-book"></i>
      </a>
      <div class="dropdown-menu" aria-labelledby="navbarDropdown">
        <a class="dropdown-item" href="../../exports/K.pdf">pdf</a>
        <a class="dropdown-item" href="../../exports/K.epub">epub</a>
        <a class="dropdown-item" href="../../exports/K.mobi">mobi</a>
        <a class="dropdown-item" href="../../exports/K.html">html</a>
      </div>
    </li>
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/k"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="https://github.com/runtimeverification/k/releases/latest"
    >Download</a
  >
</header>
<style>
  .dropdown:hover .dropdown-menu {
    display: block;
    margin-top: 0; /* remove the gap so it doesn't close */
  }
</style>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="sidebar-toc pl-2"><div>
<div style="padding:0.25rem 0;;padding-left: 8px;"><a href="../../">Homepage</a></div>
<div style="padding:0.25rem 0;;padding-left: 8px;"><a href="https://github.com/runtimeverification/k/releases/latest">Install K</a></div>
<div style="padding:0.25rem 0;;padding-left: 8px;"><a href="https://kframework.org/pyk">Pyk Documentation</a></div>
<details style="padding:0.25rem 0;;padding-left: 8px;"><summary><a href="../../k-distribution/k-tutorial/">K Tutorial</a></summary><div>
<details style="padding:0.25rem 0;;padding-left: 16px;"><summary><a href="../../k-distribution/k-tutorial/1_basic/">Section 1: Basic K Concepts</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/01_installing/">Lesson 1.1: Setting up a K Environment</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/02_basics/">Lesson 1.2: Basics of Functional K</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/03_parsing/">Lesson 1.3: BNF Syntax and Parser Generation</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/04_disambiguation/">Lesson 1.4: Disambiguating Parses</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/05_modules/">Lesson 1.5: Modules, Imports, and Requires</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/06_ints_and_bools/">Lesson 1.6: Integers and Booleans</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/07_side_conditions/">Lesson 1.7: Side Conditions and Rule Priority</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/08_literate_programming/">Lesson 1.8: Literate Programming with Markdown</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/09_unparsing/">Lesson 1.9: Unparsing and the format and color attributes</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/10_strings/">Lesson 1.10: Strings</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/11_casts/">Lesson 1.11: Casting Terms</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/12_syntactic_lists/">Lesson 1.12: Syntactic Lists</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/13_rewrite_rules/">Lesson 1.13: Basics of K Rewriting</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/14_evaluation_order/">Lesson 1.14: Defining Evaluation Order</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/15_configurations/">Lesson 1.15: Configuration Declarations and Cell Nesting</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/16_collections/">Lesson 1.16: Maps, Semantic Lists, and Sets</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/17_cell_multiplicity/">Lesson 1.17: Cell Multiplicity and Cell Collections</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/18_equality_and_conditionals/">Lesson 1.18: Term Equality and the Ternary Operator</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/19_debugging/">Lesson 1.19: Debugging with GDB or LLDB</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/20_backends/">Lesson 1.20: K Backends and the Haskell Backend</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/21_symbolic_execution/">Lesson 1.21: Unification and Symbolic Execution</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/1_basic/22_proofs/">Lesson 1.22: K Deductive Verification</a></div>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 16px;"><summary><a href="../../k-distribution/k-tutorial/2_intermediate/">Section 2: Intermediate K Concepts</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/01_macros/">Lesson 2.1: Macros, Aliases, and Anywhere Rules</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/02_fresh_constants/">Lesson 2.2: Fresh Constants</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/03_klabels/">Lesson 2.3: KLabels and Abstract Syntax</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/04_overloading/">Lesson 2.4: Overloaded Symbols</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/05_matching_logic/">Lesson 2.5: Matching Logic Connectives and #Or Patterns</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/06_function_context/">Lesson 2.6: Function Context</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/07_record_productions/">Lesson 2.7: Record Productions and Named Nonterminals</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/08_fun_and_let/">Lesson 2.8: #fun and #let</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/09_as/">Lesson 2.9: #as Patterns</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/10_matching_operator/">Lesson 2.10: The Matching Operators, :=K and :/=K</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/11_evaluation_order/">Lesson 2.11: Uncommon Evaluation Order Concepts</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/12_floats_and_machine_ints/">Lesson 2.12: IEEE 754 Floating Point and Fixed Width Integers</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/13_substitution/">Lesson 2.13: Alpha-renaming-aware Substitution</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/14_io/">Lesson 2.14: File I/O</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/15_string_buffers_and_bytes/">Lesson 2.15: String Buffers and Byte Sequences</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/16_kore/">Lesson 2.16: The Intermediate Language of K, KORE</a></div>
<div style="padding:0.25rem 0;;padding-left: 24px;"><a href="../../k-distribution/k-tutorial/2_intermediate/17_debugging_proofs/">Lesson 2.17: Debugging Proofs using the Haskell Backend REPL</a></div>
</div></details>
</div></details>
<div style="padding:0.25rem 0;;padding-left: 8px;"><a href="../../docs/user_manual/">K User Manual</a></div>
<div style="padding:0.25rem 0;;padding-left: 8px;"><a href="../../docs/cheat_sheet/">K Cheat Sheet</a></div>
<div style="padding:0.25rem 0;;padding-left: 8px;"><a href="../../docs/ktools/">K Tool Reference</a></div>
<details style="padding:0.25rem 0;;padding-left: 8px;"><summary><a href="../../k-distribution/include/kframework/">K Builtins</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 16px;"><a href="../../k-distribution/include/kframework/builtin/domains/">domains</a></div>
<div style="padding:0.25rem 0;;padding-left: 16px;"><a href="../../k-distribution/include/kframework/builtin/kast/">kast</a></div>
<div style="padding:0.25rem 0;;padding-left: 16px;"><a href="../../k-distribution/include/kframework/builtin/prelude/">prelude</a></div>
<div style="padding:0.25rem 0;;padding-left: 16px;"><a href="../../k-distribution/include/kframework/builtin/ffi/">ffi</a></div>
<div style="padding:0.25rem 0;;padding-left: 16px;"><a href="../../k-distribution/include/kframework/builtin/json/">json</a></div>
<div style="padding:0.25rem 0;;padding-left: 16px;"><a href="../../k-distribution/include/kframework/builtin/rat/">rat</a></div>
<div style="padding:0.25rem 0;;padding-left: 16px;"><a href="../../k-distribution/include/kframework/builtin/substitution/">substitution</a></div>
<div style="padding:0.25rem 0;;padding-left: 16px;"><a href="https://github.com/runtimeverification/k/blob/master/k-distribution/include/kframework/builtin/unification.k">unification</a></div>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 8px;"><summary><a href="../../k-distribution/pl-tutorial/">K PL Tutorial</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 16px;"><a href="../../overview/">K Overview</a></div>
<details style="padding:0.25rem 0;;padding-left: 16px;"><summary><a href="../../k-distribution/pl-tutorial/1_k/">Learning K</a></summary><div>
<details style="padding:0.25rem 0;;padding-left: 24px;"><summary><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/">Part 1: Defining LAMBDA</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/lesson_1/">Lesson 1, LAMBDA: Syntax Modules and Basic K Commands</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/lesson_2/">Lesson 2, LAMBDA: Module Importing, Rules, Variables</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/lesson_3/">Lesson 3, LAMBDA: Evaluation Strategies using Strictness</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/lesson_4/">Lesson 4, LAMBDA: Generating Documentation; Latex Attributes</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/lesson_5/">Lesson 5, LAMBDA: Adding Builtins; Side Conditions</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/lesson_6/">Lesson 6, LAMBDA: Selective Strictness; Anonymous Variables</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/lesson_7/">Lesson 7, LAMBDA: Derived Constructs; Extending Predefined Syntax</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/lesson_8/">Lesson 8, LAMBDA: Multiple Binding Constructs</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/1_lambda/lesson_9/">Lesson 9, LAMBDA: A Complete and Commented Definition</a></div>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 24px;"><summary><a href="../../k-distribution/pl-tutorial/1_k/2_imp/">Part 2: Defining IMP</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/2_imp/lesson_1/">Lesson 1, IMP: Defining a More Complex Syntax</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/2_imp/lesson_2/">Lesson 2, IMP: Defining a Configuration</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/2_imp/lesson_3/">Lesson 3, IMP: Computations, Results, Strictness; Rules Involving Cells</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/2_imp/lesson_4/">Lesson 4, IMP: Configuration Abstraction, Part 1; Types of Rules</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/2_imp/lesson_5/">Lesson 5, IMP: Completing and Documenting IMP</a></div>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 24px;"><summary><a href="../../k-distribution/pl-tutorial/1_k/3_lambda++/">Part 3: Defining LAMBDA++</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/3_lambda++/lesson_1/">Lesson 1, LAMBDA++: Abrupt Changes of Control</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/3_lambda++/lesson_2/">Lesson 2, LAMBDA++: Semantic (Non-Syntactic) Computation Items</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/3_lambda++/lesson_3/">Lesson 3, LAMBDA++: Reusing Existing Semantics</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/3_lambda++/lesson_4/">Lesson 4, LAMBDA++: Do Not Reuse Blindly!</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/3_lambda++/lesson_5/">Lesson 5, LAMBDA++: More Semantic Computation Items</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/3_lambda++/lesson_6/">Lesson 6, LAMBDA++: Wrapping Up and Documenting LAMBDA++ (environment-based)</a></div>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 24px;"><summary><a href="../../k-distribution/pl-tutorial/1_k/4_imp++/">Part 4: Defining IMP++</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/4_imp++/lesson_1/">Lesson 1, IMP++: Extending/Changing an Existing Language Syntax</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/4_imp++/lesson_2/">Lesson 2, IMP++: Configuration Refinement; Freshness</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/4_imp++/lesson_3/">Lesson 3, IMP++: Tagging; Superheat/Supercool Kompilation Options</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/4_imp++/lesson_4/">Lesson 4, IMP++: Semantic Lists; Input/Output Streaming</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/4_imp++/lesson_5/">Lesson 5, IMP++: Deleting, Saving and Restoring Cell Contents</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/4_imp++/lesson_6/">Lesson 6, IMP++: Adding/Deleting Cells Dynamically; Configuration Abstraction, Part 2</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/4_imp++/lesson_7/">Lesson 7, IMP++: Everything Changes: Syntax, Configuration, Semantics</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/4_imp++/lesson_8/">Lesson 8, IMP++: Wrapping up Larger Languages</a></div>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 24px;"><summary><a href="../../k-distribution/pl-tutorial/1_k/5_types/">Part 5: Defining Type Systems</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/5_types/lesson_1/">Lesson 1, Type Systems: Imperative, Environment-Based Type Systems</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/5_types/lesson_2/">Lesson 2, Type Systems: Substitution-Based Higher-Order Type Systems</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/5_types/lesson_3/">Lesson 3, Type Systems: Environment-Based Higher-Order Type Systems</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/5_types/lesson_4/">Lesson 4, Type Systems: A Naive Substitution-Based Type Inferencer</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/5_types/lesson_5/">Lesson 5, Type Systems: A Naive Environment-Based Type Inferencer</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/5_types/lesson_6/">Lesson 6, Type Systems: Parallel Type Checkers/Inferencers</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/5_types/lesson_7/">Lesson 7, Type Systems: A Naive Substitution-based Polymorphic Type Inferencer</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/5_types/lesson_8/">Lesson 8, Type Systems: A Naive Environment-based Polymorphic Type Inferencer</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/1_k/5_types/lesson_9/">Lesson 9, Type Systems: Let-Polymorphic Type Inferencer (Damas-Hindley-Milner)</a></div>
</div></details>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 16px;"><summary><a href="../../k-distribution/pl-tutorial/2_languages/">Learning Language Design and Semantics using K</a></summary><div>
<details style="padding:0.25rem 0;;padding-left: 24px;"><summary><a href="../../k-distribution/pl-tutorial/2_languages/1_simple/1_untyped/simple-untyped/">Part 7: SIMPLE: Designing Imperative Programming Languages</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/2_languages/1_simple/1_untyped/simple-untyped/">Lesson 1, SIMPLE untyped</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/2_languages/1_simple/2_typed/1_static/simple-typed-static/">Lesson 2, SIMPLE typed static</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/2_languages/1_simple/2_typed/2_dynamic/simple-typed-dynamic/">Lesson 3, SIMPLE typed dynamic</a></div>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 24px;"><summary><a href="../../k-distribution/pl-tutorial/2_languages/2_kool/1_untyped/kool-untyped/">Part 8: KOOL: Designing Object-Oriented Programming Languages</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/2_languages/2_kool/1_untyped/kool-untyped/">Lesson 1, KOOL untyped</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/2_languages/2_kool/2_typed/1_dynamic/kool-typed-dynamic/">Lesson 2, KOOL typed dynamic</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/2_languages/2_kool/2_typed/2_static/kool-typed-static/">Lesson 3, KOOL typed static</a></div>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 24px;"><summary><a href="../../k-distribution/pl-tutorial/2_languages/3_fun/1_untyped/1_environment/fun-untyped/">Part 9: FUN: Designing Functional Programming Languages</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/2_languages/3_fun/1_untyped/1_environment/fun-untyped/">Lesson 1, FUN untyped, Environment-Based</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/2_languages/3_fun/1_untyped/2_substitution/fun-untyped/">Lesson 2, FUN untyped, Substitution-Based</a></div>
<div style="padding:0.25rem 0;;padding-left: 32px;">Lesson 3, FUN polymorphic type inferencer</div>
</div></details>
<details style="padding:0.25rem 0;;padding-left: 24px;"><summary><a href="../../k-distribution/pl-tutorial/2_languages/4_logik/basic/logik/">Part 10: LOGIK: Designing Logic Programming Languages</a></summary><div>
<div style="padding:0.25rem 0;;padding-left: 32px;"><a href="../../k-distribution/pl-tutorial/2_languages/4_logik/basic/logik/">Lesson 1, LOGIK</a></div>
</div></details>
</div></details>
</div></details>
<div style="padding:0.25rem 0;;padding-left: 8px;"><a href="../../projects/">Projects using K</a></div>
</div></div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1 id="k-user-manual">K User Manual</h1>
<p><strong>NOTE:</strong> The K User Manual is still <strong>under construction</strong>; some features of K
may have partial or missing documentation.</p>
<h2 id="introduction">Introduction</h2>
<h3 id="why-k%3F">Why K?</h3>
<p>The K Framework is a programming language and system design toolkit made for
practioners and researchers alike.</p>
<p><strong>K For Practioners:</strong>
<em>K is a framework for deriving programming languages tools from their semantic
specifications.</em></p>
<p>Typically, programming language tool development follows a similar pattern.
After a new programming language is designed, separate teams will develop
separate language tools (e.g. a compiler, interpreter, parser, symbolic
execution engine, etc). Code reuse is uncommon. The end result is that for each
new language, the same basic tools and patterns are re-implemented again and
again.</p>
<p>K approaches the problem differently -- it generates each of these tools from a single language specification.
The work of programming language design and tool implementation are made separate concerns.
The end result is that the exercise of
designing new languages and their associated tooling is now reduced to
developing a single language specification from which we derive our tooling <em>for
free</em>.</p>
<p><strong>K For Researchers:</strong>
<em>K is a configuration- and rewrite-based executable semantic framework.</em></p>
<p>In more detail, K specifications are:</p>
<ol>
<li><strong>Executable:</strong> compile into runnable and testable programs;</li>
<li><strong>Semantic:</strong> correspond to a logical theory with a sound and relatively
complete proof system;</li>
<li><strong>Configuration-based:</strong> organize system states into compositional,
hierarchical, labelled units called cells;</li>
<li><strong>Rewrite-based:</strong> define system transitions using rewrite rules.</li>
</ol>
<p>K specifications are compiled into particular <em>matching logic</em> theories, giving
them a simple and expressive semantics. K semantic rules are implicitly defined
over the entire configuration structure, but omit unused cells, enabling a
highly modular definitional style. Furthermore, K has been used to develop
programming languages, type systems, and formal analysis tools.</p>
<h3 id="manual-objectives">Manual Objectives</h3>
<p>As mentioned in the <em>Why K?</em> section above, the K Framework is designed as a
collection of language-generic command-line interface (CLI) tools which revolve
around K specifications. These tools cover a broad range of uses, but they
typically fall into one of the following categories:</p>
<ol>
<li>Transforming K Specs (e.g. compilation)</li>
<li>Running K Specs (e.g. concrete and symbolic execution)</li>
<li>Analyzing K Specs (e.g. theorem proving)</li>
</ol>
<p>The main <em>user-facing</em> K tools include:</p>
<ul>
<li><code>kompile</code> - the K compiler driver</li>
<li><code>kparse</code> - the stanadlone K parser and abstract syntax tree (AST)
transformation tool</li>
<li><code>krun</code> - the K interpreter and symbolic execution engine driver</li>
<li><code>kprove</code> - the K theorem prover</li>
</ul>
<p>This user manual is designed to be a tool reference.
In particular, it is not desgined to be a tutorial on how to write K
specifications or to teach the logical foundations of K. New K users should
consult our dedicated
<a href="https://kframework.org/k-distribution/k-tutorial/" target="_blank" rel="noreferrer noopener">K tutorial</a>,
or the more language-design oriented
<a href="https://kframework.org/k-distribution/pl-tutorial/" target="_blank" rel="noreferrer noopener">PL tutorial</a>.
Researchers seeking to learn more about the logic underlying K are encouraged
to peruse the
<a href="https://fsl.cs.illinois.edu/projects/pl/index.html" target="_blank" rel="noreferrer noopener">growing literature on K and matching logic</a>.
We will consider the manual complete when it provides a complete description of
all user-facing K tools and features.</p>
<h2 id="introduction-to-k">Introduction to K</h2>
<p>Since K specifications are the primary input into the entire system, let us
take a moment to describe them. At the highest level, K specifications describe
a programming language or system using three different pieces:</p>
<ol>
<li>the <em>system primitives</em>, the base datatypes used during system operation,
e.g., numbers, lists, maps, etc;</li>
<li>the <em>system state</em>, a tuple or record over system primitives which gives a
complete snapshot of the system at any given moment;</li>
<li>the <em>system behavior</em>, a set of rules which defines possible system
evolutions.</li>
</ol>
<p>K specifications are then defined by a collection of <em>sentences</em> which
correspond to the three concepts above:</p>
<ol>
<li><code>syntax</code> declarations encode the <em>system primitives</em>;</li>
<li><code>configuration</code> declarations encode the <em>system state</em>;</li>
<li><code>context</code> and <code>rule</code> declarations encode the <em>system behavior</em>.</li>
</ol>
<p>K sentences are then organized into one or <em>modules</em> which are stored in one or
more <em>files</em>. In this scheme, files may <em>require</em> other files and modules may
<em>import</em> other modules, giving rise to a hierarchy of files and modules. We
give an intuitive sketch of the two levels of grouping in the diagram below:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>   example.k file
  +=======================+
  | requires ".." --------|--&gt; File_1
  | ...                   |
  | requires ".." --------|--&gt; File_N
  |                       |
  |  +-----------------+  |
  |  | module ..       |  |
  |  |   imports .. ---|--|--&gt; Module_1
  |  |   ...           |  |
  |  |   imports .. ---|--|--&gt; Module_M
  |  |                 |  |
  |  |   sentence_1    |  |
  |  |   ...           |  |
  |  |   sentence_K    |  |
  |  | endmodule       |  |
  |  +-----------------+  |
  |                       |
  +=======================+
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>where:</p>
<ul>
<li>files and modules are denoted by double-bordered and single-borded boxes
respectively;</li>
<li>file or module identifiers are denoted by double dots (<code>..</code>);</li>
<li>potential repititions are denoted by triple dots (<code>...</code>).</li>
</ul>
<p>In the end, we require that the file and module hierarchies both form a
directed acyclic graph (DAG). This is, no file may recursively require itself,
and likewise, no module may recursively import itself.</p>
<p>We now zoom in further to discuss the various kinds of sentences contained in K
specifications:</p>
<ol>
<li>
<p>sentences that define our <em>system's primitives</em>, including:</p>
<ul>
<li><strong>sort declarations:</strong> define new categories of primitive datatypes</li>
<li><strong>Backus-Naur Form (BNF) grammar declarations:</strong> define the
operators that inhabit our primitive datatypes</li>
<li><strong>lexical syntax declarations:</strong> define lexemes/tokens for the
lexer/tokenizer</li>
<li><strong>syntax associativity declarations:</strong> specify the
associativity/grouping of our declared operators</li>
<li><strong>syntax priority declarations:</strong> specify the priority of
potential ambiguous operators</li>
</ul>
</li>
<li>
<p>sentences that define our <em>system's state</em>, including:</p>
<ul>
<li><strong>configuration declarations:</strong> define labelled, hierarchical records
using an nested XML-like syntax</li>
</ul>
</li>
<li>
<p>sentences that define our <em>system's behavior</em>, including:</p>
<ul>
<li><strong>context declarations:</strong> describe how primitives and configurations
can simplify</li>
<li><strong>context alias declarations:</strong> define templates that can generate new
contexts</li>
<li><strong>rule declarations:</strong> define how the system transitions from one state
to the next</li>
</ul>
</li>
</ol>
<h3 id="k-process-overview">K Process Overview</h3>
<p>We now examine how the K tools are generally used. The main input to all of the
K tools is a K specification. For effieciency reasons, this specification is
first compiled into an intermediate representation called Kore. Once we have
obtained this intermediate representation, we can use it to do:</p>
<ol>
<li>parsing/pretty-printing, i.e., converting a K term, whose syntax is defined
by a K specification, into a alternate representation</li>
<li>concrete and abstract execution of a K specification</li>
<li>theorem proving, i.e., verifying whether a set of claims about a K
specification hold</li>
</ol>
<p>We represent the overall process using the graphic below:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code> K Compilation Process
+============================================================+
|                     +---------+                            |
|  K Specification ---| kompile |--&gt; Kore Specification --+  |
|                     +---------+                         |  |
+=========================================================|==+
                                                          |
 K Execution Process                                      |
+=========================================================|==+
|                                                         |  |
|             +-------------------------------------------+  |
|             |                                              |
|             |       +---------+                            |
|  K Term ----+-------| kparse  |--&gt; K Term                  |
|             |       +---------+                            |
|             |                                              |
|             |       +---------+                            |
|  K Term ----+-------|  krun   |--&gt; K Term                  |
|             |       +---------+                            |
|             |                                              |
|             |       +---------+                            |
|  K Claims --+-------| kprove  |--&gt; K Claims                |
|                     +---------+                            |
|                                                            |
+============================================================+
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>where:</p>
<ul>
<li>process outlines are denoted by boxes with double-lined borders</li>
<li>executables are denoted by boxes with single-lined borders</li>
<li>inputs and outputs are denoted by words attached to lines</li>
<li>K terms typically correspond to <em>programs</em> defined in a particular
language's syntax (which are either parsed using <code>kparse</code> or executed using
<code>krun</code>)</li>
<li>K claims are a notation for describing <em>how</em> certain K programs <em>should</em>
execute (which are checked by our theorem prover <code>kprove</code>)</li>
</ul>
<p><strong>K Compilation Process:</strong>
Let us start with a description of the compilation process. According to the
above diagram, the compiler driver is called <code>kompile</code>. For our purposes, it is
enough to view the K compilation process as a black box that transforms a K
specification into a lower-level Kore specification that encodes the same
information, but that is easier to work with programmatically.</p>
<p><strong>K Execution Process:</strong>
We now turn our attention to the K execution process. Abstractly, we can divide
the K execution process into the following stages:</p>
<ol>
<li>the kore specification is loaded (which defines a lexer, parser, and
unparser among other things)</li>
<li>the input string is lexed into a token stream</li>
<li>the token stream is parsed into K terms/claims</li>
<li>the K term/claims are transformed according the K tool being used (e.g.
<code>kparse</code>, <code>krun</code>, or <code>kprove</code>)</li>
<li>the K term/claims are unparsed into a string form and printed</li>
</ol>
<p>Note that all of the above steps performed in K execution process are fully
prescribed by the input K specification. Of course, there are entire languages
devoted to encoding these various stages proces individually, e.g., <code>flex</code> for
lexers, <code>bison</code> for parsers, etc. What K offers is a <em>consistent</em> language to
package the above concepts in a way that we believe is convenient and practical
for a wide range of uses.</p>
<h2 id="module-declaration">Module Declaration</h2>
<p>K modules are declared at the top level of a K file. They begin with the
<code>module</code> keyword and are followed by a <strong>module ID</strong> and an optional set of
attributes. They continue with zero or more imports and zero or more sentences
until the <code>endmodule</code> keyword is reached.</p>
<p>A module ID consists of an optional <code>#</code> at the beginning, followed by one or
more components separated by hyphens. Each component can contain letters,
numbers, or underscores.</p>
<p>After the module ID, attributes can be specified in square brackets. See below
for an (incomplete) list of allowed module attributes.</p>
<p>Following the attributes, a module can contain zero or more <strong>imports</strong>. An
import consists of the <code>import</code> or <code>imports</code> keywords followed by a module ID.
An import tells the compiler that this module should contain all the sentences
(recursively) contained by the module being imported.</p>
<p>Imports can be <strong>public</strong> or <strong>private</strong>. By default, they are public, which
means that all the imported syntax can be used by any module that imports the
module doing the import. However, you can explicitly override the visibility
of the import with the <code>public</code> or <code>private</code> keyword immediately prior to the
module name. A module imported privately does not export its syntax to modules
that import the module doing the import.</p>
<p>Following imports, a module can contain zero or more sentences. A sentence can
be a syntax declaration, a rule, a configuration declaration, a context, a
claim, or a context alias. Details on each of these can be found in subsequent
sections.</p>
<h3 id="private-attribute"><code>private</code> attribute</h3>
<p>If the module is given the <code>private</code> attribute, all of its imports and syntax
are private by default. Individual pieces of syntax can be made public with
the <code>public</code> attribute, and individual imports can be made public with the
<code>public</code> keyword. See relevant sections on syntax and modules for more details
on what it means for syntax and imports to be public or private.</p>
<h3 id="symbolic-and-concrete-attribute"><code>symbolic</code> and <code>concrete</code> attribute</h3>
<p>These attributes may be placed on modules to indicate that they should only
be used by the Haskell and LLVM backends respectively. If the definition is
compiled on the opposite backend, they are implicitly removed from the
definition prior to parsing anywhere they are imported. This can be useful when
used in limited capacity in order to provide alternate semantics for certain
features on different backends. It should be used sparingly as it makes it more
difficult to trust the correctness of your semantics, even in the presence of
testing.</p>
<h2 id="syntax-declaration">Syntax Declaration</h2>
<h3 id="named-non-terminals">Named Non-Terminals</h3>
<p>We have added a syntax to Productions which allows non-terminals to be given a
name in productions. This significantly improves the ability to document K, by
providing a way to explicitly explain what a field in a production corresponds
to instead of having to infer it from a comment or from the rule body.</p>
<p>The syntax is:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">name<span class="token punctuation">:</span> Sort
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This syntax can be used anywhere in a K definition that expects a non-terminal.</p>
<h3 id="symbol(_)-attribute"><code>symbol(_)</code> attribute</h3>
<p>By default, when compiling a definition, K generates a unique "mangled" label
identifier for each syntactic production. These identifiers can be used to
reference productions externally, for example when constructing terms by hand
or programmatically via Pyk.</p>
<p>The <code>symbol(_)</code> attribute can be applied to a production to control the precise
identifier for a production that appears in a compiled definition. For example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">module</span> SYMBOLS
    <span class="token keyword">syntax</span> Foo <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">endmodule</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Here, the compiled definition will contain the following symbol declarations:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>  symbol Lblfoo{}() ...
  symbol Lblbar'LParRParUnds'SYMBOLS'Unds'Foo{}() ...
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>The compiler enforces uniqueness<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> of symbol names specified in
this way; it would be an error to apply <code>symbol(foo)</code> to another production in
the module above. Additionally, <code>symbol(_)</code> with an argument may not co-occur
with the <code>klabel(_)</code> attribute (see below).</p>
<h3 id="overload-attribute"><code>overload</code> attribute</h3>
<p>K supports <em>subsort overloading</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> on symbols, whereby a
constructor can have a more specific sort for certain arguments. For example,
consider the following productions derived from a C-like language semantics:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp  <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> LVal
              <span class="token operator">|</span> Exp  <span class="token string">"."</span> <span class="token keyword">Id</span>
<span class="token keyword">syntax</span> LVal <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> LVal <span class="token string">"."</span> <span class="token keyword">Id</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Here, it is useful for the result of the dot operator to be an <code>LVal</code> if the
left-hand side is itself an <code>LVal</code>. However, there is an issue with the code
as written: if <code>L()</code> is a term of sort <code>LVal</code>, then the program <code>L() . x</code> has a
parsing ambiguity between the two productions for the dot operator. To resolve
this, we can mark the productions as <em>overloads</em>:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp  <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> LVal
              <span class="token operator">|</span> Exp  <span class="token string">"."</span> <span class="token keyword">Id</span> <span class="token punctuation">[</span>overload<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">syntax</span> LVal <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> LVal <span class="token string">"."</span> <span class="token keyword">Id</span> <span class="token punctuation">[</span>overload<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Now, the parser will select the <em>most specific</em> overloaded production when it
resolves ambiguities in <code>L() . x</code> (that is, <code>L() . x</code> parses to a term of sort
<code>LVal</code>.</p>
<p>Formally, the compiler organises productions into a partial order that defines
the overload relation as follows. We say that <code>P</code> is a more specific overload
of <code>Q</code> if:</p>
<ul>
<li><code>P</code> and <code>Q</code> have the same <code>overload(_)</code> attribute. Note that the argument
supplied has no semantic meaning other than as a key grouping productions
together.</li>
<li>Let <code>S_P</code> be the sort of <code>P</code>, and <code>S_p1</code> etc. be the sorts of its arguments
(c.f. for <code>Q</code>). The tuple <code>(S_P, S_p1, ..., S_pN)</code> must be elementwise
<em>strictly less than</em> <code>(S_Q, S_q1, ..., S_qN)</code> according to the definition's
subsorting relationship. That is, a term from production <code>P</code> is a restriction
of one from production <code>Q</code>; when its arguments are more precise, we can give
the result a more precise sort.</li>
</ul>
<h3 id="klabel(_)-and-symbol-attributes"><code>klabel(_)</code> and <code>symbol</code> attributes</h3>
<p><strong>Note: the <code>klabel(_), symbol</code> approach described in this section is a legacy
feature that will be removed in the future. New code should use the <code>symbol(_)</code>
and <code>overload(_)</code> attributes to opt into explicit naming and overloading
respectively.</strong></p>
<p><em>References here to "overloading" are explained in the section above; the use
of the <code>klabel(_)</code> attribute without <code>symbol</code> is equivalent to the new
<code>overload(_)</code> syntax.</em></p>
<p>By default K generates for each syntax definition a long and obfuscated klabel
string, which serves as a unique internal identifier and also is used in kast
format of that syntax. If we need to reference a certain syntax production
externally, we have to manually define the klabels using the <code>klabel</code> attribute.
One example of where you would want to do this is to be able to refer to a given
symbol via the <code>syntax priority</code> attribute, or to enable overloading of a
given symbol.</p>
<p>If you only provide the <code>klabel</code> attribute, you can use the provided <code>klabel</code> to
refer to that symbol anywhere in the frontend K code. However, the internal
identifier seen by the backend for that symbol will still be the long obfuscated
generated string. Sometimes you want control over the internal identifier used as
well, in which case you use the <code>symbol</code> attribute. This tells the frontend to
use whatever the declared <code>klabel</code> is directly as the internal identifier.</p>
<p>For example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">module</span> MYMODULE
    <span class="token keyword">syntax</span> FooBarBaz <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #Foo<span class="token punctuation">(</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>#Foo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">]</span> <span class="token comment">// symbol1</span>
                       <span class="token operator">|</span> #Bar<span class="token punctuation">(</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>#Bar<span class="token punctuation">)</span><span class="token punctuation">]</span>         <span class="token comment">// symbol2</span>
                       <span class="token operator">|</span> #Baz<span class="token punctuation">(</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>                        <span class="token comment">// symbol3</span>
<span class="token keyword">endmodule</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Here, we have that:</p>
<ul>
<li>In frontend K, you can refer to "symbol1" as <code>#Foo</code> (from <code>klabel(#Foo)</code>),
and the backend will see <code>'Hash'Foo</code> as the symbol name.</li>
<li>In frontend K, you can refer to "symbol2" as <code>#Bar</code> (from <code>klabel(#Bar)</code>),
and the backend will see
<code>'Hash'Bar'LParUndsCommUndsRParUnds'MYMODULE'Unds'FooBarBaz'Unds'Int'Unds'Int</code>
as the symbol name.</li>
<li>In frontend K, you can refer to "symbol3" as
<code>#Baz(_,_)_MYMODULE_FooBarBaz_Int_Int</code> (from auto-generated klabel), and
the backend will see
<code>'Hash'Baz'LParUndsCommUndsRParUnds'MYMODULE'Unds'FooBarBaz'Unds'Int'Unds'Int</code>
as the symbol name.</li>
</ul>
<p>The <code>symbol</code> provided <em>must</em> be unique to this definition. This is enforced by
K. In general, it's recommended to use the <code>symbol</code> attribute whenever you use
<code>klabel</code> unless you explicitly have a reason not to (e.g. you want to <em>overload</em>
symbols, or you're using a deprecated backend). It can be very helpful use the
<code>symbol</code> attribute for debugging, as many debugging messages are printed in
Kast format which will be more readable with the <code>symbol</code> names you explicitly
declare. In addition, if you are programatically manipulating definitions via
the JSON Kast format, building terms using the user-provided pretty
<code>symbol, klabel(...)</code> is easier and less error-prone if the auto-generation
process for klabels changes.</p>
<h4 id="syntactic-lists">Syntactic Lists</h4>
<p>When using K's support for syntactic lists, a production like:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Ints <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> List<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>ints<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>will desugar into two productions:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Ints <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">","</span> Ints <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>ints<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">syntax</span> Ints <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">".Ints"</span>      <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>List<span class="token punctuation">{</span><span class="token string">"ints"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Note that the symbol for the <em>terminator</em> of the list has been generated
automatically from the label on the original production. It is possible to
control what the terminator's label is using the <code>terminator-symbol(_)</code>
attribute. For example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Ints <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> List<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>ints<span class="token punctuation">)</span><span class="token punctuation">,</span> terminator<span class="token operator">-</span><span class="token class-name">symbol</span><span class="token punctuation">(</span><span class="token punctuation">.</span>ints<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>will desugar into two productions:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Ints <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">","</span> Ints <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>ints<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">syntax</span> Ints <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">".Ints"</span>      <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span><span class="token punctuation">.</span>ints<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>It is an error to apply <code>terminator-symbol(_)</code> to a non-production sentence, or
to a production that does not declare a syntactic list.</p>
<h3 id="parametric-productions-and-bracket-attributes">Parametric productions and <code>bracket</code> attributes</h3>
<p>Some syntax productions, like the rewrite operator, the bracket operator, and
the #if #then #else #fi operator, cannot have their precise type system
expressed using only concrete sorts.</p>
<p>Prior versions of K solved this issue by using the K sort in this case, but
this introduces inexactness in which poorly typed terms can be created even
without having a cast operator present in the syntax, which is a design
consideration we would prefer to avoid.</p>
<p>It also introduces cases where terms cannot be placed in positions where they
ought to be well sorted unless their return sort is made to be KBott, which in
turn vastly complicates the grammar and makes parsing much slower.</p>
<p>In order to introduce this, we provide a new syntax for parametric productions
in K. This allows you to express syntax that has a sort signature based on
parametric polymorphism. We do this by means of an optional curly-brace-
enclosed list of parameters prior to the return sort of a production.</p>
<p>Some examples:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token punctuation">{</span>Sort<span class="token punctuation">}</span> Sort <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"("</span> Sort <span class="token string">")"</span> <span class="token punctuation">[</span><span class="token class-name">bracket</span><span class="token punctuation">]</span>
<span class="token keyword">syntax</span> <span class="token punctuation">{</span>Sort<span class="token punctuation">}</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Sort
<span class="token keyword">syntax</span> <span class="token punctuation">{</span>Sort<span class="token punctuation">}</span> Sort <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> KBott
<span class="token keyword">syntax</span> <span class="token punctuation">{</span>Sort<span class="token punctuation">}</span> Sort <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Sort <span class="token string">"=&gt;"</span> Sort
<span class="token keyword">syntax</span> <span class="token punctuation">{</span>Sort<span class="token punctuation">}</span> Sort <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#if"</span> <span class="token keyword">Bool</span> <span class="token string">"#then"</span> Sort <span class="token string">"#else"</span> Sort <span class="token string">"#fi"</span>
<span class="token keyword">syntax</span> <span class="token punctuation">{</span>Sort1<span class="token punctuation">,</span> Sort2<span class="token punctuation">}</span> Sort1 <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#fun"</span> <span class="token string">"("</span> Sort2 <span class="token string">"=&gt;"</span> Sort1 <span class="token string">")"</span> <span class="token string">"("</span> Sort2 <span class="token string">")"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Here we have:</p>
<ol>
<li>Brackets, which can enclose any sort but should be of the same sort that was
enclosed.</li>
<li>Every sort is a KItem.</li>
<li>A KBott term can appear inside any sort.</li>
<li>Rewrites, which can rewrite a value of any sort to a value of the same sort.
Note that this allows the lhs or rhs to be a subsort of the other.</li>
<li>If then else, which can return any sort but which must contain that sort on
both the true and false branches.</li>
<li>lambda applications, in which the argument and parameter must be the same
sort, and the return value of the application must be the same sort as the
return value of the function.</li>
</ol>
<p>Note the last case, in which two different parameters are specified separated
by a comma. This indicates that we have multiple independent parameters which
must be the same each place they occur, but not the same as the other
parameters.</p>
<p>In practice, because every sort is a subsort of K, the <code>Sort2</code>
parameter in #6 above does nothing during parsing. It cannot
actually reject any parse, because it can always infer that the sort of the
argument and parameter are K, and it has no effect on the resulting sort of
the term. However, it will nevertheless affect the kore generated from the term
by introducing an additional parameter to the symbol generated for the term.</p>
<h3 id="function-and-total-attributes"><code>function</code> and <code>total</code> attributes</h3>
<p>Many times it becomes easier to write a semantics if you have "helper"
functions written which can be used in the RHS of rules. The <code>function</code>
attribute tells K that a given symbol should be simplified immediately when it
appears anywhere in the configuration. Semantically, it means that evaluation
of that symbol will result in at most one return value (that is, the symbol is
a <em>partial function</em>).</p>
<p>The <code>total</code> attribute indicates that a symbol cannot be equal to matching logic
bottom; in other words, it has <em>at least</em> one value for every possible set of
arguments. It can be added to a production with the <code>function</code> attribute to
indicate to the symbolic reasoning engine that a given symbol is a
<em>total function</em>, that is it has <em>exactly</em> one return value for every possible
input. Other uses of the <code>total</code> attribute (i.e., on multi-valued symbols to
indicate they always have at least one value) are not yet implemented.</p>
<p>For example, here we define the <code>_+Word_</code> total function and the <code>_/Word_</code>
partial function, which can be used to do addition/division modulo
<code>2 ^Int 256</code>. These functions can be used anywhere in the semantics where
integers should not grow larger than <code>2 ^Int 256</code>. Notice how <code>_/Word_</code> is
<em>not</em> defined when the denominator is <code>0</code>.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">"+Word"</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> total<span class="token punctuation">]</span>
             <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">"/Word"</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>

<span class="token keyword">rule</span> I1 <span class="token operator">+</span>Word I2 <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>I1 <span class="token operator">+</span><span class="token keyword">Int</span> I2<span class="token punctuation">)</span> modInt <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">^</span><span class="token keyword">Int</span> <span class="token number">256</span><span class="token punctuation">)</span>
<span class="token keyword">rule</span> I1 <span class="token operator">/</span>Word I2 <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>I1 <span class="token operator">/</span><span class="token keyword">Int</span> I2<span class="token punctuation">)</span> modInt <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">^</span><span class="token keyword">Int</span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> I2 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="freshgenerator-attribute"><code>freshGenerator</code> attribute</h3>
<p>In K, you can access "fresh" values in a given domain using the syntax
<code>!VARNAME:VarSort</code> (with the <code>!</code>-prefixed variable name). This is supported for
builtin sorts <code>Int</code> and <code>Id</code> already. For example, you can generate fresh
memory locations for declared identifiers as such:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> new var x <span class="token punctuation">;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env</span><span class="token punctuation">&gt;</span></span> ENV <span class="token operator">=&gt;</span> ENV <span class="token punctuation">[</span> x &lt;<span class="token operator">-</span> <span class="token operator">!</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>env</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mem</span><span class="token punctuation">&gt;</span></span> MEM <span class="token operator">=&gt;</span> MEM <span class="token punctuation">[</span> <span class="token operator">!</span>I &lt;<span class="token operator">-</span> <span class="token number">0</span>     <span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mem</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Each time a <code>!</code>-prefixed variable is encountered, a new integer will be used,
so each variable declared with <code>new var _ ;</code> will get a unique position in the
<code>&lt;mem&gt;</code>.</p>
<p>Sometimes you want to have generation of fresh constants in a user-defined
sort. For this, K will still generate a fresh <code>Int</code>, but can use a converter
function you supply to turn it into the correct sort. For example, here we can
generate fresh <code>Foo</code>s using the <code>freshFoo(_)</code> function annotated with
<code>freshGenerator</code>.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Foo <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"a"</span> <span class="token operator">|</span> <span class="token string">"b"</span> <span class="token operator">|</span> <span class="token string">"c"</span> <span class="token operator">|</span> d <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>

<span class="token keyword">syntax</span> Foo <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> freshFoo <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>freshGenerator<span class="token punctuation">,</span> function<span class="token punctuation">,</span> total<span class="token punctuation">]</span>

<span class="token keyword">rule</span> freshFoo<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a
<span class="token keyword">rule</span> freshFoo<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b
<span class="token keyword">rule</span> freshFoo<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c
<span class="token keyword">rule</span> freshFoo<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> new var x <span class="token punctuation">;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env</span><span class="token punctuation">&gt;</span></span> ENV <span class="token operator">=&gt;</span> ENV <span class="token punctuation">[</span> x &lt;<span class="token operator">-</span> <span class="token operator">!</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span>  <span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>env</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mem</span><span class="token punctuation">&gt;</span></span> MEM <span class="token operator">=&gt;</span> MEM <span class="token punctuation">[</span> <span class="token operator">!</span>I &lt;<span class="token operator">-</span> <span class="token operator">!</span>F<span class="token punctuation">:</span>Foo <span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mem</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Now each newly allocated memory slot will have a fresh <code>Foo</code> placed in it.</p>
<h3 id="token-attribute"><code>token</code> attribute</h3>
<p>The <code>token</code> attribute signals to the Kore generator that the associated sort
will be inhabited by domain values. Sorts inhabited by domain values must not
have any constructors declared.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Bytes <span class="token punctuation">[</span>hook<span class="token punctuation">(</span>BYTES<span class="token punctuation">.</span>Bytes<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">token</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="converting-between-%5Btoken%5D-sorts">Converting between <code>[token]</code> sorts</h3>
<p>You can convert between tokens of one sort via <code>String</code>s by defining functions
implemented by builtin hooks.
The hook <code>STRING.token2string</code> allows conversion of any token to a string:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> FooToString<span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>  <span class="token punctuation">[</span>function<span class="token punctuation">,</span> total<span class="token punctuation">,</span> hook<span class="token punctuation">(</span>STRING<span class="token punctuation">.</span>token2string<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Similarly, the hook <code>STRING.string2Token</code> allows the inverse:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Bar <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> StringToBar<span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> total<span class="token punctuation">,</span> hook<span class="token punctuation">(</span>STRING<span class="token punctuation">.</span>string2token<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>WARNING: This sort of conversion does <em>NOT</em> do any sort of parsing or validation.
Thus, we can create arbitary tokens of any sort:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>StringToBar("The sun rises in the west.")
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Composing these two functions lets us convert from <code>Foo</code> to <code>Bar</code></p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Bar <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> FooToBar<span class="token punctuation">(</span>Foo<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
<span class="token keyword">rule</span> FooToBar<span class="token punctuation">(</span>F<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> StringToBar<span class="token punctuation">(</span>FooToString<span class="token punctuation">(</span>F<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="parsing-comments%2C-and-the-%23layout-sort">Parsing comments, and the <code>#Layout</code> sort</h3>
<p>Productions for the <code>#Layout</code> sort are used to describe tokens that are
considered "whitespace". The scanner removes tokens matching these productions
so they are not even seen by the parser. Below, we use it to define
lines begining with <code>;</code> (semicolon) as comments.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> #Layout <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">"(;[^\\n\\r]*)"</span>    <span class="token comment">// Semi-colon comments</span>
                 <span class="token operator">|</span> r<span class="token string">"([\\ \\n\\r\\t])"</span> <span class="token comment">// Whitespace</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="prec-attribute"><code>prec</code> attribute</h3>
<p>Consider the following naive attempt at creating a language what syntax that
allows two types of variables: names that contain underbars, and names that
contain sharps/hashes/pound-signs:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> NameWithUnderbar <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">"[a-zA-Z][A-Za-z0-9_]*"</span>  <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
<span class="token keyword">syntax</span> NameWithSharp    <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">"[a-zA-Z][A-Za-z0-9_#]*"</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
<span class="token keyword">syntax</span> Pgm <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> underbar<span class="token punctuation">(</span>NameWithUnderbar<span class="token punctuation">)</span>
             <span class="token operator">|</span> sharp<span class="token punctuation">(</span>NameWithSharp<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Although, it seems that K has enough information to parse the programs
<code>underbar(foo)</code> and <code>sharp(foo)</code> with, the lexer does not take into account
whether a token is being parsed for the <code>sharp</code> or for the <code>underbar</code>
production. It chooses an arbitary sort for the token <code>foo</code> (perhaps
<code>NameWithUnderbar</code>). Thus, during paring it is unable to construct a valid term
for one of those programs (<code>sharp(foo)</code>) and produces the error message:
<code>Inner Parser: Parse error: unexpected token 'foo'.</code></p>
<p>Since calculating inclusions and intersections between regular expressions is
tricky, we must provide this information to K. We do this via the <code>prec(N)</code>
attribute. The lexer will always prefer longer tokens to shorter tokens.
However, when it has to choose between two different tokens of equal length,
token productions with higher precedence are tried first. Note that the default
precedence value is zero when the <code>prec</code> attribute is not specified.</p>
<p>For example, the <code>BUILTIN-ID-TOKENS</code> module defines <code>#UpperId</code> and <code>#LowerId</code> with
the <code>prec(2)</code> attribute.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">  <span class="token keyword">syntax</span> #LowerId <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">"[a-z][a-zA-Z0-9]*"</span>                    <span class="token punctuation">[</span>prec<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> #UpperId <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">"[A-Z][a-zA-Z0-9]*"</span>                    <span class="token punctuation">[</span>prec<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">token</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Furthermore, we also need to make sorts with more specific tokens subsorts of ones with more
general tokens. We add the token attribute to this production so that all
tokens of a particular sort are marked with the sort they are parsed as and not a
subsort thereof. e.g. we get <code>underbar(#token("foo", "NameWithUnderbar"))</code>
instead of <code>underbar(#token("foo", "#LowerId"))</code></p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">imports</span> BUILTIN<span class="token operator">-</span>ID<span class="token operator">-</span>TOKENS
<span class="token keyword">syntax</span> NameWithUnderbar <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">"[a-zA-Z][A-Za-z0-9_]*"</span> <span class="token punctuation">[</span>prec<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">token</span><span class="token punctuation">]</span>
                          <span class="token operator">|</span> #UpperId                <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
                          <span class="token operator">|</span> #LowerId                <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
<span class="token keyword">syntax</span> NameWithSharp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">"[a-zA-Z][A-Za-z0-9_#]*"</span> <span class="token punctuation">[</span>prec<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">token</span><span class="token punctuation">]</span>
                       <span class="token operator">|</span> #UpperId                 <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
                       <span class="token operator">|</span> #LowerId                 <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
<span class="token keyword">syntax</span> Pgm <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> underbar<span class="token punctuation">(</span>NameWithUnderbar<span class="token punctuation">)</span>
             <span class="token operator">|</span> sharp<span class="token punctuation">(</span>NameWithSharp<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="unused-attribute"><code>unused</code> attribute</h3>
<p>K will warn you if you declare a symbol that is not used in any of the rules of
your definition. Sometimes this is intentional, however; in this case, you can
suppress the warning by adding the <code>unused</code> attribute to the production or
cell.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Foo <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>unused<span class="token punctuation">]</span>

<span class="token keyword">configuration</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foo</span> <span class="token attr-name">unused</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>K <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foo</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="deprecated-attribute"><code>deprecated</code> attribute</h3>
<p>Symbols can be marked as deprecated by adding the <code>deprecated</code> attribute to
their declaration. If that symbol subsequently appears in the definition (in a
rule, context, context alias or configuration), the compiler will issue a
warning.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Foo <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>deprecated<span class="token punctuation">]</span>
<span class="token keyword">rule</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token comment">// warning on this line</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="symbol-priority-and-associativity">Symbol priority and associativity</h3>
<p>Unlike most other parser generators, K combines the task of parsing with AST
generation. A production declared with the <code>syntax</code> keyword in K is both a
piece of syntax used when parsing, and a symbol that is used when rewriting.
As a result, it is generally convenient to describe expression grammars using
priority and associativity declarations rather than explicitly transforming
your grammar into a series of nonterminals, one for each level of operator
precedence. Thus, for example, a simple grammar for addition and multiplication
will look like this:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exp <span class="token string">"*"</span> Exp
             <span class="token operator">|</span> Exp <span class="token string">"+"</span> Exp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>However, this grammar is ambiguous. The term <code>x+y*z</code> might refer to <code>x+(y*z)</code>
or to <code>(x+y)*z</code>. In order to differentiate this, we introduce a partial
ordering between productions known as priority. A symbol "has tighter priority"
than another symbol if the first symbol can appear under the second, but the
second cannot appear under the first without a bracket. For example, in
traditional arithmetic, multiplication has tighter priority than addition,
which means that <code>x+y*z</code> cannot parse as <code>(x+y)*z</code> because the addition
operator would appear directly beneath the multiplication, which is forbidden
by the priority filter.</p>
<p>Priority is applied individually to each possible ambiguous parse of a term. It
then either accepts or rejects that parse. If there is only a single remaining
parse (after all the other disambiguation steps have happened), this is the
parse that is chosen. If all the parses were rejected, it is a parse error. If
multiple parses remain, they might be resolved by further disambiguation such
as via the <code>prefer</code> and <code>avoid</code> attributes, but if multiple parses remain after
disambiguation finishes, this is an ambiguous parse error, indicating there is
not a unique parse for that term. In the vast majority of cases, this is
an error and indicates that you ought to either change your grammar or add
brackets to the term in question.</p>
<p>Priority is specified in K grammars by means of one of two different
mechanisms. The first, and simplest, simply replaces the <code>|</code> operator in a
sequence of K productions with the <code>&gt;</code> operator. This operator indicates that
everything prior to the <code>&gt;</code> operator (including transitively) binds tighter
than what comes after. For example, a more complete grammar for simple
arithmetic might be:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exp <span class="token string">"*"</span> Exp
             <span class="token operator">|</span> Exp <span class="token string">"/"</span> Exp
             &gt; Exp <span class="token string">"+"</span> Exp
             <span class="token operator">|</span> Exp <span class="token string">"-"</span> Exp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>This indicates that multiplication and division bind tigher than addition
and subtraction, but that there is no relationship in priority between
multiplication and division.</p>
<p>As you may have noticed, this grammar is also ambiguous. <code>x*y/z</code> might refer to
<code>x*(y/z)</code> or to <code>(x*y)/z</code>. Indeed, if we removed division and subtraction
entirely, the grammar would still be ambiguous: <code>x*y*z</code> might parse as
<code>x*(y*z)</code>, or as <code>(x*y)*z</code>. To resolve this, we introduce another feature:
associativity. Roughly, asssociativity tells us how symbols are allowed to nest
within other symbols with the same priority. If a set of symbols is left
associative, then symbols in that set cannot appear as the rightmost child
of other symbols in that set. If a set of symbols is right associative, then
symbols in that set cannot appear as the leftmost child of other symbols in
that set. Finally, if a set of symbols is non-associative, then symbols
in that set cannot appear as the rightmost or leftmost child of other symbols
in that set. For example, in the above example, if addition and subtraction
are left associative, then <code>x+y+z</code> will parse as <code>(x+y)+</code>z and <code>x+y-z</code> will
parse as <code>(x+y)-z</code> (because the other parse will have been rejected).</p>
<p>You might notice that this seems to apply only to binary infix operators. In
fact, the real behavior is slightly more complicated. Priority and
associativity (for technical reasons that go beyond the scope of this document)
really only apply when the rightmost or leftmost item in a production is a
nonterminal. If the rightmost nonterminal is followed by a terminal (or
respectively the leftmost preceded), priority and associativity do not apply.
Thus we can generalize these concepts to arbitrary context-free grammars.</p>
<p>Note that in some cases, this is not the behavior you want. You may actually
want to reject parses even though the leftmost and rightmost item in a
production are terminals. You can accomplish this by means of the
<code>applyPriority</code> attribute. When placed on a production, it tells the parser
which nonterminals of a production the priority filter ought to reject children
under, overriding the default behavior. For example, I might have a production
like <code>syntax Exp ::= foo(Exp, Exp) [applyPriority(1)]</code>. This tells the parser
to reject terms with looser priority binding under the first <code>Exp</code>, but not
the second. By default, with this production, neither position would apply
to the priority filter, because the first and last items of the production
are both terminals.</p>
<p>Associativity is specified in K grammars by means of one of two different
mechanisms. The first, and simplest, adds the associativity of a priority block
of symbols prior to that block. For example, we can remove the remaining
ambiguities in the above grammar like so:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token class-name">left</span><span class="token punctuation">:</span>
               Exp <span class="token string">"*"</span> Exp
             <span class="token operator">|</span> Exp <span class="token string">"/"</span> Exp
             &gt; <span class="token class-name">right</span><span class="token punctuation">:</span>
               Exp <span class="token string">"+"</span> Exp
             <span class="token operator">|</span> Exp <span class="token string">"-"</span> Exp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This indicates that multiplication and division are left-associative, ie, after
symbols with higher priority are parsed as innermost, symbols are nested with
the rightmost on top. Addition and subtraction are right associative, which
is the opposite and indicates that symbols are nested with the leftmost on top.
Note that this is similar but different from evaluation order, which also
concerns itself with the ordering of symbols, which is described in the next
section.</p>
<p>You may note we have not yet introduced the second syntax for priority
and associativity. In some cases, syntax for a grammar might be spread across
multiple modules, sometimes for very good reasons with respect to code
modularity. As a result, it becomes infeasible to declare priority and
associativity inline within a set of productions, because the productions
are not contiguous within a single file.</p>
<p>For this purpose, we introduce the equivalent <code>syntax priority</code>,
<code>syntax left</code>, <code>syntax right</code>, and <code>syntax non-assoc</code> declarations. For
example, the above grammar can be written equivalently as:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exp <span class="token string">"*"</span> Exp <span class="token punctuation">[</span>group<span class="token punctuation">(</span>mult<span class="token punctuation">)</span><span class="token punctuation">]</span>
             <span class="token operator">|</span> Exp <span class="token string">"/"</span> Exp <span class="token punctuation">[</span>group<span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">]</span>
             <span class="token operator">|</span> Exp <span class="token string">"+"</span> Exp <span class="token punctuation">[</span>group<span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">]</span>
             <span class="token operator">|</span> Exp <span class="token string">"-"</span> Exp <span class="token punctuation">[</span>group<span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">syntax priority</span> mult div &gt; add sub
<span class="token keyword">syntax left</span> mult div
<span class="token keyword">syntax right</span> add sub
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Here, the <code>group(_)</code> attribute is used to create user-defined groups of
sentences. A particular group name collectively refers to the whole set of
sentences within that group. The sets are flattened together, so we could
equivalently have written:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exp <span class="token string">"*"</span> Exp <span class="token punctuation">[</span>group<span class="token punctuation">(</span>mult<span class="token punctuation">)</span><span class="token punctuation">]</span>
             <span class="token operator">|</span> Exp <span class="token string">"/"</span> Exp <span class="token punctuation">[</span>group<span class="token punctuation">(</span>mult<span class="token punctuation">)</span><span class="token punctuation">]</span>
             <span class="token operator">|</span> Exp <span class="token string">"+"</span> Exp <span class="token punctuation">[</span>group<span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">]</span>
             <span class="token operator">|</span> Exp <span class="token string">"-"</span> Exp <span class="token punctuation">[</span>group<span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">syntax priority</span> mult &gt; add
<span class="token keyword">syntax left</span> mult
<span class="token keyword">syntax right</span> add
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Note that <code>syntax [left|right|non-assoc]</code> should not be used to group together
productions with different priorities. For example, this code would be invalid:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax priority</span> mult &gt; add
<span class="token keyword">syntax left</span> mult add
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Note that there is one other way to describe associativity, but it is
prone to a very common mistake. You can apply the attribute <code>left</code>, <code>right</code>,
or <code>non-assoc</code> directly to a production to indicate that it is, by itself,
left-, right-, or non-associative.</p>
<p>However, this often does not mean what users think it means. In particular:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exp <span class="token string">"+"</span> Exp <span class="token punctuation">[</span><span class="token class-name">left</span><span class="token punctuation">]</span>
             <span class="token operator">|</span> Exp <span class="token string">"-"</span> Exp <span class="token punctuation">[</span><span class="token class-name">left</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>is not equivalent to:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token class-name">left</span><span class="token punctuation">:</span>
               Exp <span class="token string">"+"</span> Exp
             <span class="token operator">|</span> Exp <span class="token string">"-"</span> Exp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Under the first, each production is associative with itself, but not each
other. Thus, <code>x+y+z</code> will parse unambiguously as <code>(x+y)+z</code>, but <code>x+y-z</code> will
be ambiguous. However, in the second, <code>x+y-z</code> will parse unambiguously as
<code>(x+y)-z</code>.</p>
<p>Think carefully about how you want your grammar to parse. In general, if you're
not sure, it's probably best to group associativity together into the same
blocks you use for priority, rather than using <code>left</code>, <code>right</code>, or <code>non-assoc</code>
attributes on the productions.</p>
<h3 id="lexical-identifiers">Lexical identifiers</h3>
<p>Sometimes it is convenient to be able to give a certain regular expression a
name and then refer to it in one or more regular expression terminals. This
can be done with a <code>syntax lexical</code> sentence in K:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax lexical</span> Alphanum <span class="token operator">=</span> r<span class="token string">"[0-9a-zA-Z]"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This defines a lexical identifier <code>Alphanum</code> which can be expanded in any
regular expression terminal to the above regular expression. For  example, I
might choose to then implement the syntax of identifiers as follows:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Id</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">"[a-zA-Z]{Alphanum}*"</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Here <code>{Alphanum}</code> expands to the above regular expression, making the sentence
equivalent to the following:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Id</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">"[a-zA-Z]([0-9a-zA-Z])*"</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This feature can be used to more modularly construct the lexical syntax of your
language. Note that K does not currently check that lexical identifiers used
in regular expressions have been defined; this will generate an error when
creating the scanner, however, and the user ought to be able to debug what
happened.</p>
<h3 id="assoc%2C-comm%2C-idem%2C-and-unit-attributes"><code>assoc</code>, <code>comm</code>, <code>idem</code>, and <code>unit</code> attributes</h3>
<p>These attributes are used to indicate whether a collection or a production
is associative, commutative, idempotent, and/or has a unit.
In general, you should not need to apply these attributes to productions
yourself, however, they do have certain special meaning to K. K will generate
axioms related to each of these concepts into your definition for you
automatically. It will also automatically sort associative-commutative
collections, and flatten the indentation of associative collections, when
unparsing.</p>
<h3 id="public-and-private-attribute"><code>public</code> and <code>private</code> attribute</h3>
<p>K allows users to declare certain pieces of syntax as either public or private.
All syntax is public by default. Public syntax can be used from any module that
imports that piece of syntax. A piece of syntax can be declared private with
the <code>private</code> attribute. This means that that syntax can only be used in the
module in which it is declared; it is not visible from modules that import
that module.</p>
<p>You can also change the default visibility of a module with the <code>private</code>
attribute, when it is placed directly on a module. A module with the <code>private</code>
attribute has all syntax <code>private</code> by default; this can be overridden on
specific sentences with the <code>public</code> attribute.</p>
<p>Note that the <code>private</code> module attribute also changes the default visiblity
of imports; please refer to the appropriate section elsewhere in the manual
for more details.</p>
<p>Here is an example usage:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">module</span> WIDGET<span class="token operator">-</span>SYNTAX

  <span class="token keyword">syntax</span> Widget <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">syntax</span> WidgetHelper <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> bar<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>private<span class="token punctuation">]</span> <span class="token comment">// this production is not visible</span>
                                          <span class="token comment">// outside this module</span>
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> WIDGET <span class="token punctuation">[</span>private<span class="token punctuation">]</span>
  <span class="token keyword">imports</span> WIDGET<span class="token operator">-</span>SYNTAX

  <span class="token keyword">syntax</span> Widget <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> fooImpl<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// this production is not visible outside this</span>
                              <span class="token comment">// module</span>

  <span class="token comment">// this production is visible outside this module</span>
  <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> adjustWidget<span class="token punctuation">(</span>Widget<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> public<span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="configuration-declaration">Configuration Declaration</h2>
<h3 id="exit-attribute"><code>exit</code> attribute</h3>
<p>A single configuration cell containing an integer may have the "exit"
attribute. This integer will then be used as the return value on the console
when executing the program.</p>
<p>For example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">configuration</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> $PGM<span class="token punctuation">:</span>Pgm <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>status-code</span> <span class="token attr-name">exit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token number">1</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>status-code</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>declares that the cell <code>status-code</code> should be used as the exit-code for
invocations of <code>krun</code>. Additionally, we state that the default exit-code is <code>1</code>
(an error state). One use of this is for writing testing harnesses which assume
that the test fails until proven otherwise and only set the <code>&lt;status-code&gt;</code> cell
to <code>0</code> if the test succeeds.</p>
<h3 id="collection-cells%3A-multiplicity-and-type-attributes">Collection Cells: <code>multiplicity</code> and <code>type</code> attributes</h3>
<p>Sometimes a semantics needs to allow multiple copies of the same cell, for
example if you are making a concurrent multi-threading programming language.
For this purpose, K supports the <code>multiplicity</code> and <code>type</code> attributes on cells
declared in the configuration.</p>
<p><code>multiplicity</code> can take on values <code>*</code> and <code>?</code>. Declaring <code>multiplicity="*"</code>
indicates that the cell may appear any number of times in a runtime
configuration. Setting <code>multiplicity="?"</code> indicates that the cell may only
appear exactly 0 or 1 times in a runtime configuration. If there are no
configuration variables present in the cell collection, the initial
configuration will start with exactly 0 instances of the cell collection. If
there are configuration variables present in the cell collection, the initial
configuration will start with exactly 1 instance of the cell collection.</p>
<p><code>type</code> can take on values <code>Set</code>, <code>List</code>, and <code>Map</code>. For example, here we declare
several collecion cells:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">configuration</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> $PGM<span class="token punctuation">:</span>Pgm <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sets</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span>  <span class="token attr-name">multiplicity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Set<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token number">0</span><span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sets</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lists</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span> <span class="token attr-name">multiplicity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>List<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lists</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maps</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span> <span class="token attr-name">multiplicity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Map<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-key</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-key</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-value-1</span><span class="token punctuation">&gt;</span></span> <span class="token string">""</span><span class="token punctuation">:</span><span class="token keyword">String</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-value-1</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-value-2</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token keyword">Int</span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-value-2</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maps</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Declaring <code>type="Set"</code> indicates that duplicate occurrences of the cell should
be de-duplicated, and accesses to instances of the cell will be nondeterministic
choices (constrained by any other parts of the match and side-conditions).
Similarly, declaring <code>type="List"</code> means that new instances of the cell can be
added at the front or back, and elements can be accessed from the front or back,
and the order of the cells will be maintained. The following are examples of
introduction and elimination rules for these collections:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> introduce<span class="token operator">-</span>set<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sets</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Bag <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sets</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> eliminate<span class="token operator">-</span>set <span class="token operator">=&gt;</span> I <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sets</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bag <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sets</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> introduce<span class="token operator">-</span>list<span class="token operator">-</span>start<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lists</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>Bag <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lists</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> introduce<span class="token operator">-</span>list<span class="token operator">-</span>end<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lists</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>Bag <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lists</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> eliminate<span class="token operator">-</span>list<span class="token operator">-</span>start <span class="token operator">=&gt;</span> I <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lists</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bag<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lists</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> eliminate<span class="token operator">-</span>list<span class="token operator">-</span>end <span class="token operator">=&gt;</span> I <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lists</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bag<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lists</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Notice that for <code>multiplicity="?"</code>, we only admit a single <code>&lt;set&gt;</code> instance at
a time. For the <code>type=List</code> cell, we can add/eliminate cells from the from or
back of the <code>&lt;lists&gt;</code> cell. Also note that we use <code>.Bag</code> to indicate the empty
cell collection in all cases.</p>
<p>Declaring <code>type="Map"</code> indicates that the first sub-cell will be used as a
cell-key. This means that matching on those cells will be done as a map-lookup
operation if the cell-key is mentioned in the rule (for performance). If the
cell-key is not mentioned, it will fallback to normal nondeterministic
constrained by other parts of the match and any side-conditions. Note that there
is no special meaning to the name of the cells (in this case <code>&lt;map&gt;</code>,
<code>&lt;map-key&gt;</code>, <code>&lt;map-value-1&gt;</code>, and <code>&lt;map-value-2&gt;</code>). Additionally, any number of
sub-cells are allowed, and the <em>entire</em> instance of the cell collection is
considered part of the cell-value, including the cell-key (<code>&lt;map-key&gt;</code> in this
case) and the surrounding collection cell (<code>&lt;map&gt;</code> in this case).</p>
<p>For example, the following rules introduce, set, retrieve from, and eliminate
<code>type="Map"</code> cells:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> introduce<span class="token operator">-</span>map<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maps</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>Bag <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-key</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-key</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maps</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> set<span class="token operator">-</span>map<span class="token operator">-</span>value<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">,</span> S<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-key</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-key</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-value-1</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> S <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-value-1</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> set<span class="token operator">-</span>map<span class="token operator">-</span>value<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">,</span> V<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-key</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-key</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-value-2</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> V <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-value-2</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> retrieve<span class="token operator">-</span>map<span class="token operator">-</span>value<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> S <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-key</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-key</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-value-1</span><span class="token punctuation">&gt;</span></span> S <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-value-1</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> retrieve<span class="token operator">-</span>map<span class="token operator">-</span>value<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> V <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-key</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-key</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-value-2</span><span class="token punctuation">&gt;</span></span> V <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-value-2</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> eliminate<span class="token operator">-</span>map<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maps</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map-key</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map-key</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bag<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maps</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Note how each rule makes sure that <code>&lt;map-key&gt;</code> cell is mentioned, and we
continue to use <code>.Bag</code> to indicate the empty collection. Also note that
when introducing new map elements, you may omit any of the sub-cells which are
not the cell-key. In case you do omit sub-cells, you must use structural
framing <code>...</code> to indicate the missing cells, they will receive the default
value given in the <code>configuration ...</code> declaration.</p>
<h2 id="rule-declaration">Rule Declaration</h2>
<h3 id="rule-structure">Rule Structure</h3>
<p>Each K rule follows the same basic structure (given as an example here):</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> LHS <span class="token operator">=&gt;</span> RHS <span class="token keyword">requires</span> REQ ensures ENS <span class="token punctuation">[</span>ATTRS<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>The portion between <code>rule</code> and <code>requires</code> is referred to as the <em>rule body</em>,
and may contain one or more rewrites (though not nested). Here, the rule body is
<code>LHS =&gt; RHS</code>, where <code>LHS</code> and <code>RHS</code> are used as placeholders for the pre- and
post- states. Note that we lose no generality referring to <em>the</em> <code>LHS</code> or <em>the</em>
<code>RHS</code>, even in the presence of multiple rewrites, as the rewrites are pulled to
the top-level anyway.</p>
<p>Next is the <em>requires clause</em>, represented here as <code>REQ</code>. The requires clause is
an additional predicate (function-like term of sort <code>Bool</code>), which is to be
evaluated before applying the rule. If the requires clause does not evaluate to
<code>true</code>, then the rule does not apply.</p>
<p>Finally is the <em>ensures clause</em>, represented here as <code>ENS</code>. The ensures clause
is to be interpreted as a post-condition, and will be automatically added to the
path condition if the rule applies. It <em>may</em> cause the entire term to become
undefined, but the backend will not stop itself from applying the rule in this
case. Note that concrete backends (eg. the LLVM backend) are free to ignore the
ensures clause.</p>
<p>Overall, the transition represented by such a rule is from a state
<code>LHS #And REQ</code> ending in a state <code>RHS #And ENS</code>. When backends apply this rule
as a transition/rewrite, they should:</p>
<ul>
<li>Check if pattern <code>LHS</code> matches (or unifies) with the current term, giving
substitution <code>alpha</code>.</li>
<li>Check if the instantiation <code>alpha(REQ)</code> is valid (or satisfiable).</li>
<li>Build the new term <code>alpha(RHS #And ENS)</code>, and check if it's satisfiable.</li>
</ul>
<h3 id="pattern-matching-operator">Pattern Matching operator</h3>
<p>Sometimes when you want to express a side condition, you want to say that a
rule matches if a particular term matches a particular pattern, or if it
instead does /not/ match a particular pattern.</p>
<p>The syntax in K for this is :=K and :/=K. It has similar meaning to ==K and
=/=K, except that where ==K and =/=K express equality, :=K and =/=K express
model membership. That is to say, whether or not the rhs is a member of the set
of terms expressed by the lhs pattern. Because the lhs of these operators is a
pattern, the user can use variables in the lhs of the operator. However, due to
current limitations, these variables are <em>NOT</em> bound in the rest of the term.
The user is thus encouraged to use anonymous variables only, although this is
not required.</p>
<p>This is compiled by the K frontend down to an efficient pattern matching on a
fresh function symbol.</p>
<h3 id="anonymous-function-applications">Anonymous function applications</h3>
<p>There are a number of cases in K where you would prefer to be able to take some
term on the RHS, bind it to a variable, and refer to it in multiple different
places in a rule.</p>
<p>You might also prefer to take a variable for which you know some of its
structure, and modify some of its internal structure without requiring you to
match on every single field contained inside that structure.</p>
<p>In order to do this, we introduce syntax to K that allows you to construct
anonymous functions in the RHS of a rule and apply them to a term.</p>
<p>The syntax for this is:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>#fun(RuleBody)(Argument)
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Note the limitations currently imposed by the implementation. These functions
are not first-order: you cannot bind them to a variable and inject them like
you can with a regular klabel for a function. You also cannot express multiple
rules or multiple parameters, or side conditions. All of these are extensions
we would like to support in the future, however.</p>
<p>In the following, we use three examples to illustrate the behavior of <code>#fun</code>.
We point out that the support for <code>#fun</code> is provided by the frontend, not the
backends.</p>
<p>The three examples are real examples borrowed or modified from existing language
semantics.</p>
<p><em>Example 1 (A Simple Self-Explained Example).</em></p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>#fun(V:Val =&gt; isFoo(V) andBool isBar(V))(someFunctionReturningVal())
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><em>Example 2 (Nested #fun).</em></p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>   #fun(C
=&gt; #fun(R
=&gt; #fun(E
=&gt; foo1(E, R, C)
  )(foo2(C))
  )(foo3(0))
  )(foo4(1))
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This example is from the <code>beacon</code>
semantics:https://github.com/runtimeverification/beacon-chain-spec/blob/master/b
eacon-chain.k at line 302, with some modification for simplicity. Note how
variables <code>C, R, E</code> are bound in the nested <code>#fun</code>.</p>
<p><em>Example 3 (Matching a structure).</em></p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>rule foo(K, RECORD) =&gt;
  #fun(record(... field: _ =&gt; K))(RECORD)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Unlike previous examples, the LHS of <code>#fun</code> in this example is no longer a
variable, but a structure. It has the same spirit as the first two examples,
but we match the <code>RECORD</code> with a structure <code>record( DotVar, field: X)</code>, instead
of a standalone variable. We also use K's local rewrite syntax (i.e., the
rewriting symbol <code>=&gt;</code> does not occur at the top-level) to prevent writing
duplicate expressions on the LHS and RHS of the rewriting.</p>
<h3 id="macros-and-aliases">Macros and Aliases</h3>
<p>A production can be tagged with the <code>macro</code>, <code>alias</code>, <code>macro-rec</code>, or <code>alias-rec</code>
attributes. In all cases, what this signifies is that this is a macro production.
Macro rules are rules where the top symbol of the left-hand-side are macro
labels. Macro rules are applied statically during compilation on all terms that
they match, and statically before program execution on the initial configuration.
Currently, macro rules are required to not have side conditions, although they
can contain sort checks.</p>
<p><code>alias</code> rules are also applied statically in reverse prior to unparsing on the
final configuration. Note that a macro rule can have unbound variables in the
right hand side. When such a macro exists, it should be used only on the left
hand side of rules, unless the user is performing symbolic execution and expects
to introduce symbolic terms into the subject being rewritten.</p>
<p>However, when used on the left hand side of a rule, it functions similarly to a
pattern alias, and allows the user to concisely express a reusable pattern that
they wish to match on in multiple places.</p>
<p>For example, consider the following semantics:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"foo"</span> <span class="token punctuation">[</span>alias<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token string">"foobar"</span>
<span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> bar<span class="token punctuation">(</span>KItem<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token operator">|</span> baz<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">,</span> KItem<span class="token punctuation">)</span>
<span class="token keyword">rule</span> foo <span class="token operator">=&gt;</span> foobar
<span class="token keyword">rule</span> bar<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> baz<span class="token punctuation">(</span><span class="token operator">?</span>_<span class="token punctuation">,</span> I<span class="token punctuation">)</span>
<span class="token keyword">rule</span> bar<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This will rewrite <code>baz(0, foo)</code> to <code>foo</code>. First <code>baz(0, foo)</code> will be rewritten
statically to <code>baz(0, foobar)</code>. Then the non-<code>macro</code> rule will apply (because
the rule will have been rewritten to <code>rule baz(_, I) =&gt; I</code>). Then <code>foobar</code> will
be rewritten statically after rewriting finishes to <code>foo</code> via the reverse form
of the alias.</p>
<p>Note that macros do not apply recursively within their own expansion. This is
done so as to ensure that macro expansion will always terminate. If the user
genuinely desires a recursive macro, the <code>macro-rec</code> and <code>alias-rec</code> attributes
can be used to provide this behavior.</p>
<p>For example, consider the following semantics:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"int"</span> Exp <span class="token string">";"</span> <span class="token operator">|</span> <span class="token string">"int"</span> Exps <span class="token string">";"</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token operator">|</span> Exp Exp <span class="token operator">|</span> <span class="token keyword">Id</span>
<span class="token keyword">syntax</span> Exps <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> List<span class="token punctuation">{</span>Exp<span class="token punctuation">,</span><span class="token string">","</span><span class="token punctuation">}</span>

<span class="token keyword">rule</span> int X<span class="token punctuation">:</span><span class="token keyword">Id</span><span class="token punctuation">,</span> X<span class="token string">':Id, Xs:Exps ; =&gt; int X ; int X'</span><span class="token punctuation">,</span> Xs <span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>This will expand <code>int x, y, z;</code> to <code>int x; int y, z;</code> because the macro does
not apply the second time after applying the substitution of the first
application. However, if the <code>macro</code> attribute were changed to the <code>macro-rec</code>
attribute, it would instead expand (as the user likely intended) to
<code>int x; int y; int z;</code>.</p>
<p>The <code>alias-rec</code> attribute behaves with respect to the <code>alias</code> attribute the
same way the <code>macro-rec</code> attribute behaves with respect to <code>macro</code>.</p>
<h3 id="anywhere-rules"><code>anywhere</code> rules</h3>
<p>Some rules are not functional, but you want them to apply anywhere in the
configuration (similar to functional rules). You can use the <code>anywhere</code>
attribute on a rule to instruct the backends to make sure they apply anywhere
they match in the entire configuration.</p>
<p>For example, if you want to make sure that some associative operator is always
right-associated anywhere in the configuration, you can do:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Stmt <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Stmt <span class="token string">";"</span> Stmt

<span class="token keyword">rule</span> <span class="token punctuation">(</span>S1 <span class="token punctuation">;</span> S2<span class="token punctuation">)</span> <span class="token punctuation">;</span> S3 <span class="token operator">=&gt;</span> S1 <span class="token punctuation">;</span> <span class="token punctuation">(</span>S2 <span class="token punctuation">;</span> S3<span class="token punctuation">)</span> <span class="token punctuation">[</span>anywhere<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Then after every step, all occurrences of <code>_;_</code> will be re-associated. Note that
this allows the symbol <code>_;_</code> to still be a constructor, even though it is
simplified similarly to a <code>function</code>.</p>
<h3 id="trusted-claims"><code>trusted</code> claims</h3>
<p>You may add the <code>trusted</code> attribute to a given claim for the K prover to
automatically add it to the list of proven circularities, instead of trying to
discharge it separately.</p>
<h3 id="projection-and-predicate-functions">Projection and Predicate functions</h3>
<p>K automatically generates certain predicate and projection functions from the
syntax you declare. For example, if you write:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Foo <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span>bar<span class="token punctuation">:</span> Bar<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>It will automatically generate the following K code:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> isFoo<span class="token punctuation">(</span>K<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
<span class="token keyword">syntax</span> Foo <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"{"</span> K <span class="token string">"}"</span> <span class="token string">":&gt;Foo"</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
<span class="token keyword">syntax</span> Bar <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> bar<span class="token punctuation">(</span>Foo<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>

<span class="token keyword">rule</span> isFoo<span class="token punctuation">(</span>F<span class="token punctuation">:</span>Foo<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
<span class="token keyword">rule</span> isFoo<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

<span class="token keyword">rule</span> <span class="token punctuation">{</span> F<span class="token punctuation">:</span>Foo <span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;Foo <span class="token operator">=&gt;</span> F
<span class="token keyword">rule</span> bar<span class="token punctuation">(</span>foo<span class="token punctuation">(</span>B<span class="token punctuation">:</span>Bar<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> B
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The first two types of functions are generated automatically for every sort in
your K definition, and the third type of function is generated automatically
for each named nonterminal in your definition. Essentially, <code>isFoo</code> for some
sort <code>Foo</code> will tell you whether a particular term of sort <code>K</code> is a <code>Foo</code>,
<code>{F}:&gt;Foo</code> will cast <code>F</code> to sort <code>Foo</code> if <code>F</code> is of sort <code>Foo</code> and will be
undefined (i.e., theoretically defined as <code>#Bottom</code>, the bottom symbol in
matching logic) otherwise. Finally, <code>bar</code> will project out the child of a <code>foo</code>
named <code>bar</code> in its production declaration.</p>
<p>Note that if another term of equal or smaller sort to <code>Foo</code> exists and has a
child named <code>bar</code> of equal or smaller sort to <code>Bar</code>, this will generate an
ambiguity during parsing, so care should be taken to ensure that named
nonterminals are sufficiently unique from one another to prevent such
ambiguities. Of course, the compiler will generate a warning in this case.</p>
<h3 id="simplification-attribute"><code>simplification</code> attribute</h3>
<p>The simplification attribute identifies rules outside the main semantics that
are used to simplify function patterns.</p>
<p><strong>Conditions</strong>: A simplification rule is applied by <em>matching</em> the function
arguments, instead of unification as when applying function definition
rules. This allows function symbols to appear nested as arguments to other
functions on the left-hand side of a simplification rule, which is forbidden in
function definition rules. For example, this rule would not be accepted as a
function definition rule:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token punctuation">(</span>X <span class="token operator">+</span><span class="token keyword">Int</span> Y<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> Z <span class="token operator">=&gt;</span> X <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>Y <span class="token operator">+</span><span class="token keyword">Int</span> Z<span class="token punctuation">)</span> <span class="token punctuation">[</span>simplification<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>A simplification rule is only applied when the current side condition <em>implies</em>
the <code>requires</code> clause of the rule, like function definition rules.</p>
<p><strong>Order</strong>: The <code>simplification</code> attribute accepts an optional integer argument
which is the rule's <em>simplification priority</em>; if the optional argument is not
specified, it is equivalent to a simplification priority of 50. Backends
<em>should</em> attempt simplification rules in order of their <em>simplification
priority</em>, but are not required to do so; in fact, the backend is free to apply
<code>simplification</code> rules at <em>any time</em>. Because of this, users must ensure that
simplification rules are sound regardless of their order of application. This
differs from the <code>priority</code> attribute in that rules with the <code>priority</code>
attribute <em>must</em> be applied in their priority order by the backend. It is an
error to have the <code>priority</code> attribute on a <code>simplification</code> rule.</p>
<p>For example, for the following definition:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">":"</span> WordStack <span class="token operator">|</span> <span class="token string">".WordStack"</span>
    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> sizeWordStack    <span class="token punctuation">(</span> WordStack       <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> sizeWordStackAux <span class="token punctuation">(</span> WordStack <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------</span>
    <span class="token keyword">rule</span> sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sizeWordStackAux<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> sizeWordStackAux<span class="token punctuation">(</span><span class="token punctuation">.</span>WordStack<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> N
    <span class="token keyword">rule</span> sizeWordStackAux<span class="token punctuation">(</span>W <span class="token punctuation">:</span> WS    <span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sizeWordStackAux<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> N <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>We might add the following simplification lemma:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">rule</span> sizeWordStackAux<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> N <span class="token operator">+</span><span class="token keyword">Int</span> sizeWordStackAux<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">requires</span> N <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
      <span class="token punctuation">[</span>simplification<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Then this simplification rule will only apply if the Haskell backend can prove
that <code>notBool N =/=Int 0</code> is unsatisfiable. This avoids an infinite cycle of
applying this simplification lemma.</p>
<p><strong>NOTE</strong>: The frontend and Haskell backend <strong>do not check</strong> that supplied
simplification rules are sound, this is the developer's responsibility. In
particular, rules with the simplification attribute must preserve definedness;
that is, if the left-hand side refers to any partial function then:</p>
<ul>
<li>the right-hand side must be <code>#Bottom</code> when the left-hand side is <code>#Bottom</code>, or</li>
<li>the rule must have an <code>ensures</code> clause that is <code>false</code> when the left-hand
side is <code>#Bottom</code>, or</li>
<li>the rule must have a <code>requires</code> clause that is <code>false</code> when the left-hand
side is <code>#Bottom</code>.</li>
</ul>
<p>These conditions are in order of decreasing preference: the best option is to
preserve <code>#Bottom</code> on the right-hand side, the next best option is to have an
<code>ensures</code> clause, and the least-preferred option is to have a <code>requires</code> clause.
The most preferred option is to write total functions and avoid the entire issue.</p>
<p><strong>NOTE</strong>: The Haskell backend does not attempt to prove claims which right-hand
side is <code>#Bottom</code>. The reason for this is that the general case is undecidable,
and the backend might enter an infinite loop. Therefore, the backend emits a
warning if it encounters such a claim.</p>
<h3 id="concrete-and-symbolic-attributes-(haskell-backend)"><code>concrete</code> and <code>symbolic</code> attributes (Haskell backend)</h3>
<p>Users can control the application of <code>simplification</code> rules using the <code>concrete</code>
and the <code>symbolic</code> attributes by specifying the type of patterns the rule's
arguments are to match.</p>
<p>A concrete pattern is a pattern which does not contain variables or unevaluated
functions, otherwise the pattern is symbolic.</p>
<p>The semantics of the two attributes is defined as follows:</p>
<ul>
<li>If a simplification rule is marked <code>concrete</code>, then <em>all</em> arguments must be
concrete for the rule to match.</li>
<li>If a simplification rule is marked <code>symbolic</code>, then <em>all</em> arguments must be
symbolic for the rule to match.</li>
<li>The following syntax <code>concrete(&lt;variables&gt;)</code> (resp. <code>symbolic(&lt;variables&gt;)</code>),
where <code>&lt;variables&gt;</code> is a list of variable names separated by commas, can be used
to specify the exact arguments the user expects to match concrete (resp. symbolic)
patterns.</li>
</ul>
<p>For example, the following will only match when all arguments
are concrete:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> X <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>Y <span class="token operator">+</span><span class="token keyword">Int</span> Z<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>X <span class="token operator">+</span><span class="token keyword">Int</span> Y<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> Z <span class="token punctuation">[</span>simplification<span class="token punctuation">,</span> concrete<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Conversely, the following will only match when all arguments
are symbolic:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> X <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>Y <span class="token operator">+</span><span class="token keyword">Int</span> Z<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>X <span class="token operator">+</span><span class="token keyword">Int</span> Y<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> Z <span class="token punctuation">[</span>simplification<span class="token punctuation">,</span> symbolic<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>In practice, the following rules will re-associate and commute terms to combine
concrete arguments:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token punctuation">(</span>A <span class="token operator">+</span><span class="token keyword">Int</span> Y<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> Z <span class="token operator">=&gt;</span> A <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>Y <span class="token operator">+</span><span class="token keyword">Int</span> Z<span class="token punctuation">)</span>
  <span class="token punctuation">[</span>concrete<span class="token punctuation">(</span>Y<span class="token punctuation">,</span> Z<span class="token punctuation">)</span><span class="token punctuation">,</span> symbolic<span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">,</span> simplification<span class="token punctuation">]</span>

<span class="token keyword">rule</span> X <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>B <span class="token operator">+</span><span class="token keyword">Int</span> Z<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> B <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>X <span class="token operator">+</span><span class="token keyword">Int</span> Z<span class="token punctuation">)</span>
  <span class="token punctuation">[</span>concrete<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Z<span class="token punctuation">)</span><span class="token punctuation">,</span> symbolic<span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">,</span> simplification<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="the-unboundvariables-attribute">The <code>unboundVariables</code> attribute</h3>
<p>Normally, K rules are not allowed to contain regular (i.e., not fresh, not
existential) variables in the RHS / <code>requires</code> / <code>ensures</code> clauses which are not
bound in the LHS.</p>
<p>However, in certain cases this behavior might be desired, like, for example,
when specifying a macro rule which is to be used in the LHS of other rules.
To allow for such cases, but still be useful and perform the unboundness checks
in regular cases, the <code>unboundVariables</code> attributes allows the user to specify
a comma-separated list of names of variables which can be unbound in the rule.</p>
<p>For example, in the macro declaration</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">  <span class="token keyword">rule</span> cppEnumType <span class="token operator">=&gt;</span> bar<span class="token punctuation">(</span>_<span class="token punctuation">,</span> scopedEnum<span class="token punctuation">(</span><span class="token punctuation">)</span> #Or unscopedEnum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>unboundVariables<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>the declaration <code>unboundVariables(_)</code> allows the rule to pass the unbound
variable checks, and this in turn allows for <code>cppEnumType</code> to be used in
the LHS of a rule to mean the pattern above:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">  <span class="token keyword">rule</span> inverseConvertType<span class="token punctuation">(</span>cppEnumType<span class="token punctuation">,</span> foo<span class="token punctuation">(</span><span class="token punctuation">(</span>cppEnumType #as T<span class="token punctuation">:</span><span class="token punctuation">:</span>CPPType <span class="token operator">=&gt;</span> underlyingType<span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="the-memo-attribute">The <code>memo</code> attribute</h3>
<p>The <code>memo</code> attribute is a hint from the user to the backend to memoize a
function. Not all backends support memoization, but when the attribute is used
and the definition is compiled for a <code>memo</code>-supporting backend, then calls to
the function may be cached. At the time of writing, only the Haskell
backend supports memoization.</p>
<h4 id="limitations-of-memoization-with-the-haskell-backend">Limitations of memoization with the Haskell backend</h4>
<p>The Haskell backend will only cache a function call if all arguments are concrete.</p>
<p>It is recommended not to memoize recursive functions, as each recursive call
will be stored in the cache, but only the first iteration will be retrieved from
the cache; that is, the cache will be filled with many unreachable
entries. Instead, we recommend to perform a worker-wrapper transformation on
recursive functions, and apply the <code>memo</code> attribute to the wrapper.</p>
<p><strong>Warning:</strong> A function declared with the <code>memo</code> attribute must not use
uninterpreted functions in the side-condition of any rule. Memoizing such an
impure function is unsound. To see why, consider the following rules:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> impure<span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>

<span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> unsound<span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> memo<span class="token punctuation">]</span>
<span class="token keyword">rule</span> unsound<span class="token punctuation">(</span>X<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> X <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token keyword">requires</span> impure<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
<span class="token keyword">rule</span> unsound<span class="token punctuation">(</span>X<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> X        <span class="token keyword">requires</span> notBool impure<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Because the function <code>impure</code> is not given rules to cover all inputs, <code>unsound</code>
can be memoized incoherently. For example,</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>{unsound(0) #And {impure(0) #Equals true}} #Equals 1
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>but</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>{unsound(0) #And {impure(0) #Equals false}} #Equals 0
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>The memoized value of <code>unsound(0)</code> would be incoherently determined by which
pattern the backend encounters first.</p>
<h3 id="variable-sort-inference">Variable Sort Inference</h3>
<p>In K, it is not required that users declare the sorts of variables in rules or
in the initial configuration. If the user does not explicitly declare the sort
of a variable somewhere via a cast (see below), the sort of the variable is
inferred from context based on the sort signature of every place the variable
appears in the rule.</p>
<p>As an example, consider the rule for addition in IMP:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exp <span class="token string">"+"</span> Exp <span class="token operator">|</span> <span class="token keyword">Int</span>

    <span class="token keyword">rule</span> I1 <span class="token operator">+</span> I2 <span class="token operator">=&gt;</span> I1 <span class="token operator">+</span><span class="token keyword">Int</span> I2
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Here <code>+Int</code> is defined in the INT module with the following signature:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">"+Int"</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>In the rule above, the sort of both <code>I1</code> and <code>I2</code> is inferred as <code>Int</code>. This is because
a variable must have the same sort every place it appears within the same rule.
While a variable appearing only on the left-hand-side of the rule could have
sort <code>Exp</code> instead, the same variable appears as a child of <code>+Int</code>, which
constriants the sorts of <code>I1</code> and <code>I2</code> more tightly. Since the sort must be a
subsort of <code>Int</code> or equal to <code>Int</code>, and <code>Int</code> has no subsorts, we infer <code>Int</code>
as the sorts of <code>I1</code> and <code>I2</code>. This means that the above rule will not match
until <code>I1</code> and <code>I2</code> become integers (i.e., have already been evaluated).</p>
<p>More complex examples are possible, however:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exp <span class="token string">"+"</span> <span class="token keyword">Int</span> <span class="token operator">|</span> <span class="token keyword">Int</span>
    <span class="token keyword">rule</span> _ <span class="token operator">+</span> _ <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Here we have two anonymous variables. They do not refer to the same variable
as one another, so they can have different sorts. The right side is constrained
by <code>+</code> to be of sort <code>Int</code>, but the left side could be either <code>Exp</code> or <code>Int</code>.
When this occurs, we have multiple solutions to the sorts of the variables in
the rule. K will only choose solutions which are <strong>maximal</strong>, however. To be
precise, if two different solutions exist, but the sorts of one solution are
all greater than or equal to the sorts of the other solution, K will discard
the smaller solution. Thus, in the case above, the variable on the left side
of the <code>+</code> is inferred of sort <code>Exp</code>, because the solution (<code>Exp</code>, <code>Int</code>) is
strictly greater than the solution (<code>Int</code>, <code>Int</code>).</p>
<p>It is possible, however, for terms to have multiple maximal solutions:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exp <span class="token string">"+"</span> <span class="token keyword">Int</span> <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">"+"</span> Exp <span class="token operator">|</span> <span class="token keyword">Int</span>
    <span class="token keyword">rule</span> I1 <span class="token operator">+</span> I2 <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>In this example, there is an ambiguous parse. This could parse as either
the first <code>+</code> or the second. In the first case, the maximal solution chosen is
(<code>Exp</code>, <code>Int</code>). In the second, it is (<code>Int</code>, <code>Exp</code>). Neither of these solutions is
greater than the other, so both are allowed by K. As a result, this program
will emit an error because the parse is ambiguous. To pick one solution over
the other, a cast or a <code>prefer</code> or <code>avoid</code> attribute can be used.</p>
<h3 id="casting">Casting</h3>
<p>There are three main types of casts in K: the semantic cast, the strict cast,
and the projection cast.</p>
<h3 id="semantic-casts">Semantic casts</h3>
<p>For every sort <code>S</code> declared in your grammar, K will define the following
production for you for use in rules:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">syntax</span> S <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> S <span class="token string">":S"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>The meaning of this cast is that the term inside the cast must be less than
or equal to <code>Sort</code>. This can be used to resolve ambiguities, but its principle
purpose is to guide execution by telling K what sort variables must match in
order for the rule to apply. When compiled, it will generate a pattern that
matches on an injection into <code>Sort</code>.</p>
<h3 id="strict-casts">Strict casts</h3>
<p>K also introduces the strict cast:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">syntax</span> S <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> S <span class="token string">"::S"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>The meaning at runtime is exactly the same as the semantic cast; however, it
restricts the sort of the term inside the cast to <strong>exactly</strong> <code>Sort</code>. That is
to say, if you use it on something that is a strictly smaller sort, it will
generate a type error. This is useful in certain circumstances to help
disambiguate terms, when a semantic cast would not have resolved the ambiguity.
As such, it is primarily used to solve ambiguities rather than to guide
execution.</p>
<h3 id="projection-casts">Projection casts</h3>
<p>K also introduces the projection cast:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">syntax</span> <span class="token punctuation">{</span>S2<span class="token punctuation">}</span> S <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"{"</span> S2 <span class="token string">"}"</span> <span class="token string">":&gt;S"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>The meaning of this cast at runtime is that if the term inside is of sort
<code>Sort</code>, it should have it injection stripped away and the value inside is
returned as a term of static sort <code>Sort</code>. However, if the term is of a
different sort, it is an error and execution will get stuck. Thus the primary
usefulness of this cast is to cast the return value of a function with a
greater sort down to a strictly smaller sort that you expect the return value
of the function to have. For example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">    <span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span>Exp<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span> <span class="token operator">|</span> bar<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">Int</span>
    <span class="token keyword">rule</span> foo<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I
    <span class="token keyword">rule</span> bar<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> bar<span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token punctuation">(</span>I <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;<span class="token keyword">Int</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Here we know that <code>foo(I +Int 1)</code> will return an Int, but the return sort of
<code>foo</code> is <code>Exp</code>. So we project the result into the <code>Int</code> sort so that it can
be placed as the child of a <code>bar</code>.</p>
<h3 id="owise-and-priority-attributes."><code>owise</code> and <code>priority</code> attributes.</h3>
<p>Sometimes, it is simply not convenient to explicitly describe every
single negative case under which a rule should <strong>not</strong> apply. Instead,
we simply wish to say that a rule should only apply after some other set of
rules have been tried. K introduces two different attributes that can be
added to rules which will automatically generate the necessary matching
conditions in a manner which is performant for concrete execution (indeed,
it generally outperforms during concrete execution code where the conditions
are written explicitly).</p>
<p>The first is the <code>owise</code> attribute. Very roughly, rules without an attribute
indicating their priority apply first, followed by rules with the <code>owise</code>
attribute only if all the other rules have been tried and failed. For example,
consider the following function:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
<span class="token keyword">rule</span> foo<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span class="token keyword">rule</span> foo<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Here <code>foo(0)</code> is defined explicitly as <code>0</code>. Any other integer yields the
integer <code>1</code>. In particular, the second rule above will only be tried after the
first rule has been shown not to apply.</p>
<p>This is because the first rule has a lower number assigned for its priority
than the second rule. In practice, each rule in your semantics is implicitly
or explicitly assigned a numerical priority. Rules are tried in increasing
order of priority, starting at zero and trying each increasing numerical value
successively.</p>
<p>You can specify the priority of a rule with the <code>priority</code> attribute. For
example, I could equivalently write the second rule above as:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> foo<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span> <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>The number <code>200</code> is not chosen at random. In fact, when you use the <code>owise</code>
attribute, what you are doing is implicitly setting the priority of the rule
to <code>200</code>. This has a couple of implications:</p>
<ol>
<li>Multiple rules with the owise attribute all have the same priority and thus
can apply in any order.</li>
<li>Rules with priority higher than <code>200</code> apply <strong>after</strong> all rules with the
<code>owise</code> attribute have been tried.</li>
</ol>
<p>There is one more rule by which priorities are assigned: a rule with no
attributes indicating its priority is assigned the priority 50. Thus,
with each priority explicitly declared, the above example looks like:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
<span class="token keyword">rule</span> foo<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">rule</span> foo<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>One final note: the llvm backend reserves priorities between 50 and 150
inclusive for certain specific purposes. Because of this, explicit
priorities which are given within this region may not behave precisely as
described above. This is primarily in order that it be possible where necessary
to provide guidance to the pattern matching algorithm when it would otherwise
make bad choices about which rules to try first. You generally should not
give any rule a priority within this region unless you know exactly what the
implications are with respect to how the llvm backend orders matches.</p>
<h2 id="evaluation-strategy">Evaluation Strategy</h2>
<h3 id="strict-and-seqstrict-attributes"><code>strict</code> and <code>seqstrict</code> attributes</h3>
<p>The strictness attributes allow defining evaluation strategies without having
to explicitly make rules which implement them. This is done by injecting
<em>heating</em> and <em>cooling</em> rules for the subterms. For this to work, you need to
define what a <em>result</em> is for K, by extending the  <code>KResult</code> sort.</p>
<p>For example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> AExp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span>
              <span class="token operator">|</span> AExp <span class="token string">"+"</span> AExp <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>addExp<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>This generates two heating rules (where the hole syntaxes <code>"[]" "+" AExp</code> and
<code>AExp "+" "[]"</code> is automatically added to create an evaluation context):</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token punctuation">[</span>addExp1<span class="token operator">-</span>heat<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>AExp <span class="token operator">+</span>  AE2<span class="token punctuation">:</span>AExp <span class="token operator">=&gt;</span> HOLE <span class="token operator">~&gt;</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> AE2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>heat<span class="token punctuation">]</span>
<span class="token keyword">rule</span> <span class="token punctuation">[</span>addExp2<span class="token operator">-</span>heat<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span>  AE1<span class="token punctuation">:</span>AExp <span class="token operator">+</span> HOLE<span class="token punctuation">:</span>AExp <span class="token operator">=&gt;</span> HOLE <span class="token operator">~&gt;</span> AE1 <span class="token operator">+</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>heat<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>And two corresponding cooling rules:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token punctuation">[</span>addExp1<span class="token operator">-</span>cool<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>AExp <span class="token operator">~&gt;</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> AE2 <span class="token operator">=&gt;</span> HOLE <span class="token operator">+</span>  AE2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>cool<span class="token punctuation">]</span>
<span class="token keyword">rule</span> <span class="token punctuation">[</span>addExp2<span class="token operator">-</span>cool<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>AExp <span class="token operator">~&gt;</span> AE1 <span class="token operator">+</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  AE1 <span class="token operator">+</span> HOLE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>cool<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Note that the rules are given labels based on the klabel of the production, which
nonterminal is the hole, and whether it's the heating or the cooling rule.</p>
<p>You will note that these rules can apply one after another infinitely. In
practice, the <code>KResult</code> sort is used to break this cycle by ensuring that only
terms that are not part of the <code>KResult</code> sort will be heated. The <code>heat</code> and
<code>cool</code> attributes are used to tell the compiler that these are heating and
cooling rules and should be handled in the manner just described. Nothing stops
the user from writing such heating and cooling rules directly if they wish,
although we describe other more convenient syntax for most of the advanced
cases below.</p>
<p>One other thing to note is that in the above sentences, <code>HOLE</code> is just a
variable, but it has special meaning in the context of sentences with the
<code>heat</code> or <code>cool</code> attribute. In heating or cooling rules, the variable named
<code>HOLE</code> is considered to be the term being heated or cooled and the compiler
will generate <code>isKResult(HOLE)</code> and <code>notBool isKResult(HOLE)</code> side conditions
appropriately to ensure that the backend does not loop infinitely. The module
<code>BOOL</code> will also be automatically and privately included for semantic
purposes. The syntax for parsing programs will not be affected.</p>
<p>In order for this functionality to work, you need to define the <code>KResult</code> sort.
For instance, we tell K that a term is fully evaluated once it becomes an <code>Int</code>
here:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Note that you can also say that a given expression is only strict only in
specific argument positions. Here we use this to define "short-circuiting"
boolean operators.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Bool</span>

<span class="token keyword">syntax</span> BExp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Bool</span>
              <span class="token operator">|</span> BExp <span class="token string">"||"</span> BExp <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
              <span class="token operator">|</span> BExp <span class="token string">"&amp;&amp;"</span> BExp <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span>  <span class="token operator">||</span> _    <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token operator">||</span> REST <span class="token operator">=&gt;</span> REST <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span>  <span class="token operator">&amp;&amp;</span> REST <span class="token operator">=&gt;</span> REST  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> _    <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>If you want to force a specific evaluation order of the arguments, you can use
the variant <code>seqstrict</code> to do so. For example, this would make the boolean
operators short-circuit in their <em>second</em> argument first:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Bool</span>

<span class="token keyword">syntax</span> BExp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Bool</span>
              <span class="token operator">|</span> BExp <span class="token string">"||"</span> BExp <span class="token punctuation">[</span><span class="token class-name">seqstrict</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
              <span class="token operator">|</span> BExp <span class="token string">"&amp;&amp;"</span> BExp <span class="token punctuation">[</span><span class="token class-name">seqstrict</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> _    <span class="token operator">||</span> <span class="token boolean">true</span>  <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> REST <span class="token operator">||</span> <span class="token boolean">false</span> <span class="token operator">=&gt;</span> REST <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> REST <span class="token operator">&amp;&amp;</span> <span class="token boolean">true</span>  <span class="token operator">=&gt;</span> REST  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> _    <span class="token operator">&amp;&amp;</span> <span class="token boolean">false</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This will generate rules like this in the case of <code>_||_</code> (note that <code>BE1</code> will
not be heated unless <code>isKResult(BE2)</code> is true, meaning that <code>BE2</code> must be
evaluated first):</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span>  BE1<span class="token punctuation">:</span>BExp <span class="token operator">||</span> HOLE<span class="token punctuation">:</span>BExp <span class="token operator">=&gt;</span> HOLE <span class="token operator">~&gt;</span> BE1 <span class="token operator">||</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>heat<span class="token punctuation">]</span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>BExp <span class="token operator">||</span>  BE2<span class="token punctuation">:</span>BExp <span class="token operator">=&gt;</span> HOLE <span class="token operator">~&gt;</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">||</span> BE2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> isKResult<span class="token punctuation">(</span>BE2<span class="token punctuation">)</span> <span class="token punctuation">[</span>heat<span class="token punctuation">]</span>

<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>BExp <span class="token operator">~&gt;</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">||</span> BE2 <span class="token operator">=&gt;</span> HOLE <span class="token operator">||</span>  BE2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>cool<span class="token punctuation">]</span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>BExp <span class="token operator">~&gt;</span> BE1 <span class="token operator">||</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  BE1 <span class="token operator">||</span> HOLE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>cool<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="context-declaration">Context Declaration</h3>
<p>Sometimes more advanced evaluation strategies are needed. By default, the
<code>strict</code> and <code>seqstrict</code> attributes are limited in that they cannot describe
the <em>context</em> in which heating or cooling should occur. When this type of
control over the evaluation strategy is required, <code>context</code> sentences can be
used to simplify the process of declaring heating and cooling when it would be
unnecessarily verbose to write heating and cooling rules directly.</p>
<p>For example, if the user wants to heat a term if it exists under a <code>foo</code>
constructor if the term to be heated is of sort <code>bar</code>, one might write the
following context (with the optional label):</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">context</span> <span class="token punctuation">[</span>foo<span class="token punctuation">]</span><span class="token punctuation">:</span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">:</span>Bar<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Once again, note that <code>HOLE</code> is just a variable, but one that has special
meaning to the compiler indicating the position in the context that should
be heated or cooled.</p>
<p>This will automatically generate the following sentences:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token punctuation">[</span>foo<span class="token operator">-</span>heat<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">:</span>Bar<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> HOLE <span class="token operator">~&gt;</span> foo<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>heat<span class="token punctuation">]</span>
<span class="token keyword">rule</span> <span class="token punctuation">[</span>foo<span class="token operator">-</span>cool<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>Bar <span class="token operator">~&gt;</span> foo<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>cool<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>The user may also write the K cell explicitly in the context declaration
if they want to match on another cell as well, for example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">context</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">:</span>Bar<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Map <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This context will now only heat or cool if the <code>state</code> cell is empty.</p>
<h3 id="side-conditions-in-context-declarations">Side conditions in context declarations</h3>
<p>The user is allowed to write a side condition in a context declaration, like
so:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">context</span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">:</span>Bar<span class="token punctuation">)</span> <span class="token keyword">requires</span> baz<span class="token punctuation">(</span>HOLE<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This side condition will be appended verbatim to the heating rule that is
generated, however, it will not affect the cooling rule that is generated:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">:</span>Bar<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> HOLE <span class="token operator">~&gt;</span> foo<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> baz<span class="token punctuation">(</span>HOLE<span class="token punctuation">)</span> <span class="token punctuation">[</span>heat<span class="token punctuation">]</span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>Bar <span class="token operator">~&gt;</span> foo<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>cool<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="rewrites-in-context-declarations">Rewrites in context declarations</h3>
<p>The user can also include exactly one rewrite operation in a context
declaration if that rule rewrites the variable <code>HOLE</code> on the left hand side
to a term containing <code>HOLE</code> on the right hand side. For exampl;e:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">context</span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">:</span>Bar <span class="token operator">=&gt;</span> bar<span class="token punctuation">(</span>HOLE<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>In this case, the code generated will be as follows:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">:</span>Bar<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> bar<span class="token punctuation">(</span>HOLE<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> foo<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>heat<span class="token punctuation">]</span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> bar<span class="token punctuation">(</span>HOLE<span class="token punctuation">:</span>Bar<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> foo<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> foo<span class="token punctuation">(</span>HOLE<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>cool<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>This can be useful if the user wishes to evaluate a term using a different
set of rules than normal.</p>
<h3 id="result-attribute"><code>result</code> attribute</h3>
<p>Sometimes it is necessary to be able to evaluate a term to a different sort
than <code>KResult</code>. This is done by means of adding the <code>result</code> attribute to
a strict production, a context, or an explicit heating or cooling rule:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> BExp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Bool</span>
              <span class="token operator">|</span> BExp <span class="token string">"||"</span> BExp <span class="token punctuation">[</span><span class="token class-name">seqstrict</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">(</span><span class="token keyword">Bool</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>In this case, the sort check used by <code>seqstrict</code> and by the <code>heat</code> and <code>cool</code>
attributes will be <code>isBool</code> instead of <code>isKResult</code>. This particular example
does not really require use of the <code>result</code> attribute, but if the user wishes
to evaluate a term of sort KResult further, the result attribute would be
required.</p>
<h3 id="hybrid-attribute"><code>hybrid</code> attribute</h3>
<p>In certain situations, it is desirable to treat a particular production which
has the <code>strict</code> attribute as a result if the term has had its arguments fully
evaluated. This can be accomplished by means of the <code>hybrid</code> attribute:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Bool</span>

<span class="token keyword">syntax</span> BExp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Bool</span>
              <span class="token operator">|</span> BExp <span class="token string">"||"</span> BExp <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hybrid<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>This attribute is equivalent in this case to the following additional axiom
being added to the definition of <code>isKResult</code>:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> isKResult<span class="token punctuation">(</span>BE1<span class="token punctuation">:</span>BExp <span class="token operator">||</span> BE2<span class="token punctuation">:</span>BExp<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token keyword">requires</span> isKResult<span class="token punctuation">(</span>BE1<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Sometimes you wish to declare a production hybrid with respect to a predicate
other than <code>isKResult</code>. You can do this by specifying a sort as the body of the
<code>hybrid</code> attribute, e.g.:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> BExp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> BExp <span class="token string">"||"</span> BExp <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hybrid<span class="token punctuation">(</span>Foo<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>generates the rule:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> isFoo<span class="token punctuation">(</span>BE1<span class="token punctuation">:</span>BExp <span class="token operator">||</span> BE2<span class="token punctuation">:</span>BExp<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token keyword">requires</span> isFoo<span class="token punctuation">(</span>BE1<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Properly speaking, <code>hybrid</code> takes an optional comma-separated list of sort
names. If the list is empty, the attribute is equivalent to <code>hybrid(KResult)</code>.
Otherwise, it generates hybrid predicates for exactly the sorts named.</p>
<h3 id="context-aliases">Context aliases</h3>
<p>Sometimes it is necessary to define a fairly complicated evaluation strategy
for a lot of different operators. In this case, the user <em>could</em> simply write
a number of complex <code>context</code> declarations, however, this quickly becomes
tedious. For this purpose, K has a concept called a <em>context alias</em>. A context
alias is a bit like a template for describing contexts. The template can then
be instantiated against particular productions using the <code>strict</code> and
<code>seqstrict</code> attributes.</p>
<p>Here is a (simplified) example taken from the K semantics of C++:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">context alias</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HERE<span class="token punctuation">:</span>K <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>evaluate</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>evaluate</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">context alias</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HERE<span class="token punctuation">:</span>K <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>evaluate</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>evaluate</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>result<span class="token punctuation">(</span>ExecResult<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">syntax</span> Expr <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Expr <span class="token string">"="</span> Init <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">(</span>c<span class="token punctuation">;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>This defines the evaluation strategy during the translation phase of a C++
program for the assignment operator. It is equivalent to writing the following
context declarations:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">context</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>Expr <span class="token operator">=</span> I<span class="token punctuation">:</span>Init <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>evaluate</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>evaluate</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">context</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HOLE<span class="token punctuation">:</span>Expr <span class="token operator">=</span> I<span class="token punctuation">:</span>Init <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>evaluate</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>evaluate</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">[</span>result<span class="token punctuation">(</span>ExecResult<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>What this is saying is, if the <code>evaluate</code> cell is false, evaluate the term
like normal to a <code>KResult</code>. But if the <code>evaluate</code> cell is true, instead
evaluate it to the <code>ExecResult</code> sort.</p>
<p>Essentially, we have given a name to this evaluation strategy in the form of
the rule label on the context alias sentences (in this case, <code>c</code>). We can
then say that we want to use this evaluation strategy to evaluate particular
arguments of particular productions by referring to it by name in a <code>strict</code>
attribute. For example, <code>strict(c)</code> will instantiate these contexts once for
each argument of the production, whereas <code>strict(c; 1)</code> will instantiate it
only for the first argument. The special variable <code>HERE</code> is used to tell the
compiler where you want to place the production that is to be heated or cooled.</p>
<p>You can also specify multiple context aliases for different parts of a production,
for example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span>Exp<span class="token punctuation">,</span> Exp<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">(</span><span class="token class-name">left</span><span class="token punctuation">;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token class-name">right</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This says that we can evaluate the left and right arguments in either order, but to evaluate
the left using the <code>left</code> context alias and the right using the <code>right</code> context alias.</p>
<p>We can also say <code>seqstrict(left; 1; right; 2)</code>, in which case we additionally must evaluate
the left argument before the right argument. Note, all strict positions are considered collectively
when determining the evaluation order of <code>seqstrict</code> or the <code>hybrid</code> predicates.</p>
<p>A <code>strict</code> attribute with no rule label associated with it is equivalent to
a <code>strict</code> attribute given with the following context alias:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">context alias</span> <span class="token punctuation">[</span>default<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> HERE<span class="token punctuation">:</span>K <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>One syntactic convenience that is provided is that if you wish to declare the following context:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">context</span> foo<span class="token punctuation">(</span>HOLE <span class="token operator">=&gt;</span> bar<span class="token punctuation">(</span>HOLE<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>you can simply write the following:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Foo <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span>Bar<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">context alias</span> <span class="token punctuation">[</span>alias<span class="token punctuation">]</span><span class="token punctuation">:</span> HERE <span class="token punctuation">[</span><span class="token keyword">context</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="pattern-matching">Pattern Matching</h2>
<h3 id="as-patterns">As Patterns</h3>
<p>New syntax has been added to K for matching a pattern and binding the resulting
match in its entirety to a variable.</p>
<p>The syntax is:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>Pattern #as V::Var
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>In this case, Pattern, including any variables, is matched and the resulting
variables are added to the substitution if matching succeeds. Furthermore, the
term matched by Pattern is added to the substitution as V.</p>
<p>This code can also be used outside of any rewrite, in which case matching
occurs as if it appeared on the left hand side, and the right hand side becomes
a variable corresponding to the alias.</p>
<p>It is an error to use an as pattern on the right hand side of a rule.</p>
<h3 id="record-like-kapply-patterns">Record-like KApply Patterns</h3>
<p>We have added a syntax for matching on KApply terms which mimics the record
syntax in functional languages. This allows us to more easily express patterns
involving a KApply term in which we don't care about some or most of the
children, without introducing a dependency into the code on the number of
arguments which could be changed by a future refactoring.</p>
<p>The syntax is:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>record(... field1: Pattern1, field2: Pattern2)
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Note that this only applies to productions that are prefix productions.
A prefix production is considered by the implementation to be any production
whose production items match the following regular expression:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>(Terminal(_)*) Terminal("(")
(NonTerminal (Terminal(",") NonTerminal)* )?
Terminal(")")
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>In other words, any sequence of terminals followed by an open parenthesis, an
optional comma separated list of non-terminals, and a close parenthesis.</p>
<p>If a prefix production has no named nonterminals, a <code>record(...)</code> syntax is
allowed, but in order to reference specific fields, it is necessary to give one
or more of the non-terminals in the production names.</p>
<p>Note: because the implementation currently creates one production per possible
set of fields to match on, and because all possible permutations of all
possible subsets of a list of n elements is a number that scales factorially
and reaches over 100 thousand productions at n=8, we currently do not allow
fields to be matched in any order like a true record, but only in the same
order as appears in the production itself.</p>
<p>Given that this only reduces the number of productions to the size of the power
set, this will still explode the parsing time if we create large productions of
10 or more fields that all have names. This is something that should probably
be improved, however, productions with that large of an arity are rare, and
thus it has not been viewed as a priority.</p>
<h3 id="or-patterns">Or Patterns</h3>
<p>Sometimes you wish to express that a rule should match if one out of multiple
patterns should match the same subterm. We can now express this in K by means
of using the <code>#Or</code> ML connective on the left hand side of a rule.</p>
<p>For example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span> foo #Or bar #Or baz <span class="token operator">=&gt;</span> qux
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Here any of foo, bar, or baz will match this rule. Note that the behavior is
ill-defined if it is not the case that all the clauses of the or have the same
bound variables.</p>
<h3 id="matching-global-context-in-function-rules">Matching global context in function rules</h3>
<p>On occasion it is highly desirable to be able to look up information from the
global configuration and match against it when evaluating a function. For this
purpose, we introduce a new syntax for function rules.</p>
<p>This syntax allows the user to match on <em>function context</em> from within a
function rule:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>

<span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> foo<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I <span class="token punctuation">]</span><span class="token punctuation">]</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bar</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bar</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">rule</span> something <span class="token operator">=&gt;</span> foo<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This is completely desugared by the K frontend and does not require any special
support in the backend. It is an error to have a rewrite inside function
context, as we do not currently support propagating such changes back into the
global configuration. It is also an error if the context is not at the top
level of a rule body.</p>
<p>Desugared code:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">,</span> GeneratedTopCell<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>

<span class="token keyword">rule</span> foo<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatedTop</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bar</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bar</span><span class="token punctuation">&gt;</span></span>
              <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generatedTop</span><span class="token punctuation">&gt;</span></span> #as Configuration<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatedTop</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> something <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generatedTop</span><span class="token punctuation">&gt;</span></span> #as Configuration
  <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatedTop</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> foo<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Configuration&gt; <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generatedTop</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="collection-patterns">Collection patterns</h3>
<p>It is allowed to write patterns on the left hand side of rules which refer to
complex terms of sort Map, List, and Set, despite these patterns ostensibly
breaking the rule that terms which are functions should not appear on the left
hand side of rules. Such terms are destructured into pattern matching
operations.</p>
<p>The following forms are allowed:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>// 0 or more elements followed by 0 or 1 variables of sort List followed by
// 0 or more elements
ListItem(E1) ListItem(E2) L:List ListItem(E3) ListItem(E4)

// the empty list
.List

// 1 or more list update operations applied to a variable
L:List [ K1 &lt;- E1 ] [ K2 &lt;- E2 ]

// 0 or more elements in any order plus 0 or 1 variables of sort Set
// in any order
SetItem(K1) SetItem(K2) S::Set SetItem(K3) SetItem(K4)

// the empty set
.Set

// 0 or more elements in any order plus by 0 or 1 variables of sort Map
// in any order
K1 |-&gt; E1 K2 |-&gt; E2 M::Map K3 |-&gt; E3 K4 |-&gt; E4

// the empty map
.Map
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Here K1, K2, K3, K4 etc can be any pattern except a pattern containing both
function symbols and unbound variables. An unbound variable is a variable whose
binding cannot be determined by means of decomposing non-set-or-map patterns or
map elements whose keys contain no unbound variables.</p>
<p>This is determined recursively, ie, the term <code>K1 |-&gt; E2 E2 |-&gt; E3 E3 |-&gt; E4</code> is
considered to contain no unbound variables.</p>
<p>Note that in the pattern <code>K1 |-&gt; E2 K3 |-&gt; E4 E4 |-&gt; E5</code>, K1 and K3 are
unbound, but E4 is bound because it is bound by deconstructing the key E3, even
though E3 is itself unbound.</p>
<p>In the above examples, E1, E2, E3, and E4 can be any pattern that is normally
allowed on the lhs of a rule.</p>
<p>When a map, set, or list key contains function symbols, we know that the
variables in that key are bound (because of the above restriction), so it is
possible to evaluate the function to a concrete term prior to performing the
lookup.</p>
<p>Indeed, this is the precise semantics which occurs; the function is evaluated
and the result is looked up in the collection.</p>
<p>For example:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> f<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
<span class="token keyword">rule</span> f<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> I<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> SetItem<span class="token punctuation">(</span>f<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>This will rewrite <code>I</code> to <code>.</code> if and only if the state cell contains
<code>I +Int 1</code>.</p>
<p>Note that in the case of Set and Map, one guarantee is that K1, K2, K3, and K4
represent /distinct/ elements. Pattern matching fails if the correct number of
distinct elements cannot be found.</p>
<h3 id="matching-on-cell-fragments">Matching on cell fragments</h3>
<p>K allows matching fragments of the configuration and using them to construct
terms and use as function parameters.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">configuration</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>t</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #init <span class="token operator">~&gt;</span> #collectOdd <span class="token operator">~&gt;</span> $PGM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fs</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>f</span> <span class="token attr-name">multiplicity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Set<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token number">1</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>f</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fs</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>t</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The <code>#collectOdd</code> construct grabs the entire content of the <code>&lt;fs&gt;</code> cell.
We may also match on only a portion of its content. Note that the fragment
must be wrapped in a <code>&lt;f&gt;</code> cell at the call site.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#collectOdd"</span>
<span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #collectOdd <span class="token operator">=&gt;</span> collectOdd<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fs</span><span class="token punctuation">&gt;</span></span> Fs <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fs</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fs</span><span class="token punctuation">&gt;</span></span> Fs <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fs</span><span class="token punctuation">&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>The <code>collectOdd</code> function collects the items it needs</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Set <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> collectOdd<span class="token punctuation">(</span>FsCell<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
<span class="token keyword">rule</span> collectOdd<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fs</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>f</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>f</span><span class="token punctuation">&gt;</span></span> REST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fs</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> SetItem<span class="token punctuation">(</span>I<span class="token punctuation">)</span> collectOdd<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fs</span><span class="token punctuation">&gt;</span></span> REST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fs</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token keyword">requires</span> I <span class="token operator">%</span><span class="token keyword">Int</span> <span class="token number">2</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">1</span>
<span class="token keyword">rule</span> collectOdd<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fs</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>f</span><span class="token punctuation">&gt;</span></span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>f</span><span class="token punctuation">&gt;</span></span> REST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fs</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>            collectOdd<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fs</span><span class="token punctuation">&gt;</span></span> REST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fs</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token keyword">requires</span> I <span class="token operator">%</span><span class="token keyword">Int</span> <span class="token number">2</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
<span class="token keyword">rule</span> collectOdd<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fs</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Bag <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fs</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Set
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="all-path-and-one-path-attributes-to-distinguish-reachability-claims"><code>all-path</code> and <code>one-path</code> attributes to distinguish reachability claims</h3>
<p>As the Haskell backend can handle both one-path and all-path reachability
claims, but both these are encoded as rewrite rules in K, these attributes can
be used to clarify what kind of claim a rule is.</p>
<p>In addition of being able to annotate a rule with one of them
(if annotating with more at the same time, only one of them would be chosen),
one can also annotate whole modules, to give a default claim type for all rules
in that module.</p>
<p>Additionally, the Haskell backend introduces an extra command line option
for the K frontend, <code>--default-claim-type</code>, with possible values
<code>all-path</code> and <code>one-path</code> to allow choosing a default type for all
claims.</p>
<h3 id="set-variables">Set Variables</h3>
<h4 id="motivation">Motivation</h4>
<p>Set variables were introduced as part of Matching Mu Logic, the mathematical
foundations for K. In Matching Mu Logic, terms evaluate to sets of values.
This is useful for both capturing partiality (as in <code>3/0</code>) and capturing
non-determinism (as in <code>3 #Or 5</code>). Consequently, symbol interpretation is
extended to have a collective interpretation over sets of input values.</p>
<p>Usually, K rules are given using regular variables, which expect that the term
they match is both defined and has a unique interpretation.</p>
<p>However, it is sometimes useful to have simplification rules which work over
any kind of pattern, be it undefined or non-deterministic. This behavior can be
achieved by using set variables to stand for any kind of pattern.</p>
<h4 id="syntax">Syntax</h4>
<p>Any variable prefixed by <code>@</code> will be considered a set variable.</p>
<h4 id="example">Example</h4>
<p>Below is a simplification rule which motivated this extension:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>  rule #Ceil(@I1:Int /Int @I2:Int) =&gt;
    {(@I2 =/=Int 0) #Equals true} #And #Ceil(@I1) #And #Ceil(@I2)
    [anywhere]
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>This rule basically says that <code>@I1:Int /Int @I2:Int</code> is defined if <code>@I1</code> and
<code>@I2</code> are defined and <code>@I2</code> is not 0. Using sets variables here is important as
it allows the simplification rule to apply <em>any</em> symbolic patterns, without
caring whether they are defined or not.</p>
<p>This allows simplifying the expression <code>#Ceil((A:Int /Int B:Int) / C:Int)</code> to:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>{(C =/=Int 0) #Equals true} #And #Ceil(C) #And ({(B =/=Int 0) #Equals true}
#And #Ceil(B) #And #Ceil(A)`
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>See <a href="https://github.com/kframework/kore/issues/729" target="_blank" rel="noreferrer noopener">kframework/kore#729</a> for
more details.</p>
<h4 id="smt-translation">SMT Translation</h4>
<p>K makes queries to an SMT solver (Z3) to discharge proof obligations when doing
symbolic execution. You can control how these queries are made using the
attributes <code>smtlib</code>, <code>smt-hook</code>, and <code>smt-lemma</code> on declared productions.
These attributes guide the prover when it tries to apply rules to discharge a
proof obligation.</p>
<ul>
<li><code>smt-hook(...)</code> allows you to specify a term in SMTLIB2 format which should
be used to encode that production, and assumes that all symbols appearing in
the term are already declared by the SMT solver.</li>
<li><code>smtlib(...)</code> allows you to declare a new SMT symbol to be used when that
production is sent to Z3, and gives it <em>uninterpreted function</em> semantics.</li>
<li><code>smt-lemma</code> can be applied to a rule to encode it as a conditional equality
when sending queries to Z3. A rule <code>rule LHS =&gt; RHS requires REQ</code> will be
encoded as the conditional equality <code>(=&gt; REQ (= (LHS RHS))</code>. Every symbol
present in the rule must have an <code>smt-hook(...)</code> or <code>smtlib(...)</code> attribute.</li>
</ul>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"~Int"</span> <span class="token keyword">Int</span>          <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span><span class="token operator">~</span>Int_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">,</span>
                                    smtlib<span class="token punctuation">(</span>notInt<span class="token punctuation">)</span><span class="token punctuation">]</span>
             <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">"^%Int"</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>_<span class="token operator">^</span><span class="token operator">%</span>Int__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">,</span>
                                    smt<span class="token operator">-</span>hook<span class="token punctuation">(</span><span class="token punctuation">(</span>mod <span class="token punctuation">(</span><span class="token operator">^</span> #<span class="token number">1</span> #<span class="token number">2</span><span class="token punctuation">)</span> #<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>In the example above, we declare two productions <code>~Int_</code> and <code>_^%Int__</code>, and
tell the SMT solver to:</p>
<ul>
<li>use uninterpreted function semantics for <code>~Int_</code> via SMTLIB2 symbol
<code>notInt</code>, and</li>
<li>use the SMTLIB2 term <code>(mod (^ #1 #2) #3)</code> (where <code>#N</code> marks the <code>N</code>th
production non-terminal argument positions) for <code>_^%Int__</code>, where <code>mod</code> and
<code>^</code> already are declared by the SMT solver.</li>
</ul>
<h4 id="caution">Caution</h4>
<p>Set variables are currently only supported by the Haskell backend.
The use of rules with set variables should be sound for all other backends
which just execute by rewriting, however it might not be safe for backends
which want to guarantee coverage.</p>
<h3 id="variables-occurring-only-in-the-rhs-of-a-rule">Variables occurring only in the RHS of a rule</h3>
<p>This section presents possible scenarios requiring variables to only appear in
the RHS of a rule.</p>
<h4 id="summary">Summary</h4>
<p>Except for <code>?</code> variables and <code>!</code> (fresh) variables, which are
<strong>required</strong> to only appear in the RHS of a rule, all other variables <strong>must</strong>
also appear in the LHS of a rule.  This restriction also applies to anonymous
variables; in particular, for claims, <code>?_</code> (not <code>_</code>) should be used in the RHS
to indicate that something changes but we don't care to what value.</p>
<p>To support specifying random-like behavior, the above restriction can be relaxed
by annotating a rule with the <code>unboundVariables</code> attribute whenever the rule
intentionally contains regular variables only occurring in the RHS.</p>
<h4 id="introduction-1">Introduction</h4>
<p>K uses question mark variables of the form <code>?X</code> to refer to
existential variables, and uses <code>ensures</code> to specify logical constraints on
those variables.
These variables are only allowed to appear in the RHS of a K rule.</p>
<p>If the rules represent rewrite (semantic) steps or verification claims,
then the <code>?</code> variables are existentially quantified at the top of the RHS;
otherwise, if they represent equations, the <code>?</code> variables are quantified at the
top of the entire rule.</p>
<p>Note that when both <code>?</code>-variables and regular variables are present,
regular variables are (implicitly) universally quantified on top of the rule
(already containing the existential quantifications).
This essentially makes all <code>?</code> variables depend on all regular variables.</p>
<p>All examples below are intended more for program verification /
symbolic execution, and thus concrete implementations might choose to ignore
them altogether or to provide ad-hoc implementations for them.</p>
<h4 id="example%3A-verification-claims">Example: Verification claims</h4>
<p>Consider the following definition of a (transition) system:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">module</span> A
  <span class="token keyword">rule</span> foo <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
  <span class="token keyword">rule</span> bar <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
  <span class="token keyword">rule</span> bar <span class="token operator">=&gt;</span> <span class="token boolean">false</span>
<span class="token keyword">endmodule</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Consider also, the following specification of claims about the definition above:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">module</span> A<span class="token operator">-</span>SPEC
  <span class="token keyword">rule</span> <span class="token punctuation">[</span>s1<span class="token punctuation">]</span><span class="token punctuation">:</span> foo <span class="token operator">=&gt;</span> <span class="token operator">?</span>X<span class="token punctuation">:</span><span class="token keyword">Bool</span>
  <span class="token keyword">rule</span> <span class="token punctuation">[</span>s2<span class="token punctuation">]</span><span class="token punctuation">:</span> foo <span class="token operator">=&gt;</span>  X<span class="token punctuation">:</span><span class="token keyword">Bool</span>  <span class="token punctuation">[</span>unboundVariables<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">rule</span> <span class="token punctuation">[</span>s3<span class="token punctuation">]</span><span class="token punctuation">:</span> bar <span class="token operator">=&gt;</span> <span class="token operator">?</span>X<span class="token punctuation">:</span><span class="token keyword">Bool</span>
  <span class="token keyword">rule</span> <span class="token punctuation">[</span>s4<span class="token punctuation">]</span><span class="token punctuation">:</span> bar <span class="token operator">=&gt;</span>  X<span class="token punctuation">:</span><span class="token keyword">Bool</span>  <span class="token punctuation">[</span>unboundVariables<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="one-path-interpretation">One-path interpretation</h5>
<ul>
<li>(s1) says that there exists a path from <code>foo</code> to some boolean, which is
satisfied easily using the <code>foo =&gt; true</code> rule</li>
<li>(s3) says the same thing about <code>bar</code> and can be satisfied by either of
<code>bar =&gt; true</code> and <code>bar =&gt; false</code> rules</li>
<li>(s2) and (s4) can be better understood by replacing them with instances for
<strong>each</strong> element of type <code>Bool</code>, which can be interpreted that
both <code>true</code> and <code>false</code> are reachable from <code>foo</code> for (s2), or <code>bar</code> for (s4),
respectively.
<ul>
<li>(s2) cannot be verified as we cannot find a path from <code>foo</code> to <code>false</code>.</li>
<li>(s4) can be verified by using <code>bar =&gt; true</code> to show <code>true</code> is reachable and
<code>bar =&gt; false</code> to achieve the same thing for <code>false</code></li>
</ul>
</li>
</ul>
<h5 id="all-path-interpretation">All-path interpretation</h5>
<ul>
<li>
<p>(s1) says that all paths from <code>foo</code> will reach some boolean, which is
satisfied by the <code>foo =&gt; true</code> rule and the lack of other rules for <code>foo</code></p>
</li>
<li>
<p>(s3) says the same thing about <code>bar</code> and can be satisfied by checking that
both <code>bar =&gt; true</code> and <code>bar =&gt; false</code> end in a boolean, and there are no
other rules for <code>bar</code></p>
</li>
<li>
<p>(s2) and (s4) can be better understood by replacing them with instances for
<strong>each</strong> element of type <code>Bool</code>, which can be interpreted that
both <code>true</code> and <code>false</code> are reachable <strong>in all paths</strong> originating in
<code>foo</code> for (s2), or <code>bar</code> for (s4), respectively.
This is a very strong claim, requiring that all paths originating in
<code>foo</code> (<code>bar</code>) pass through <strong>both</strong> <code>true</code> and <code>false</code>,
so neither (s2) nor (s4) can be verified.</p>
<p>Interestingly enough, adding a rule like <code>false =&gt; true</code> would make both
(s2) and (s4) hold.</p>
</li>
</ul>
<h4 id="example%3A-random-number-construct-rand()">Example: Random Number Construct <code>rand()</code></h4>
<p>The random number construct <code>rand()</code> is a language construct which could be
easily conceived to be part of the syntax of a programming language:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"rand"</span> <span class="token string">"("</span> <span class="token string">")"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>The intended semantics of <code>rand()</code> is that it can rewrite to any integer in
a single step. This could be expressed as the following following infinitely
many rules.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">rule</span>  rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span class="token keyword">rule</span>  rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>
<span class="token keyword">rule</span>  rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">2</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">rule</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">rule</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Since we need an instance of the rule for <strong>every</strong> integer, one could summarize
the above infinitely many rules with the rule</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>rule rand() =&gt; I:Int [unboundVariables(I)]
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Note that <code>I</code> occurs only in the RHS in the rule above, and thus the rule
needs the <code>unboundVariables(I)</code> attribute to signal that this is intentionally.</p>
<p>One can define variants of <code>rand()</code> by further constraining the output variable
as a precondition to the rule.</p>
<h5 id="rand-like-examples">Rand-like examples</h5>
<ol>
<li>
<p><code>randBounded(M,N)</code> can rewrite to any integer between <code>M</code> and <code>N</code></p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> randBounded<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span>
<span class="token keyword">rule</span> randBounded<span class="token punctuation">(</span>M<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I
  <span class="token keyword">requires</span> M <span class="token operator">&lt;=</span><span class="token keyword">Int</span> I andBool I <span class="token operator">&lt;=</span><span class="token keyword">Int</span> N
  <span class="token punctuation">[</span>unboundVariables<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p><code>randInList(Is)</code> takes a list <code>Is</code> of items
and can rewrite in one step to any item in <code>Is</code>.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> randInList <span class="token punctuation">(</span>List<span class="token punctuation">)</span>
<span class="token keyword">rule</span> randInList<span class="token punctuation">(</span>Is<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I
  <span class="token keyword">requires</span> I inList Is
  <span class="token punctuation">[</span>unboundVariables<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p><code>randNotInList(Is)</code> takes a list <code>Is</code> of items
and can rewrite in one step to any item <em>not</em> in <code>Is</code>.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> randNotInList <span class="token punctuation">(</span>List<span class="token punctuation">)</span>
<span class="token keyword">rule</span> randNotInList<span class="token punctuation">(</span>Is<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I
  <span class="token keyword">requires</span> notBool<span class="token punctuation">(</span>I inList Is<span class="token punctuation">)</span>
  <span class="token punctuation">[</span>unboundVariables<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p><code>randPrime()</code>, can rewrite to any <em>prime number</em>.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> randPrime <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">rule</span> randPrime<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> X<span class="token punctuation">:</span><span class="token keyword">Int</span>
  <span class="token keyword">requires</span> isPrime<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
  <span class="token punctuation">[</span>unboundVariables<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>where <code>isPrime(_)</code> is a predicate that can be defined in the usual way.</p>
</li>
</ol>
<p>Note 1: all above are not function symbols, but language constructs.</p>
<p>Note 2: Currently the frontend does not allow rules with universally quantified
variables in the RHS which are not bound in the LHS.</p>
<p>Note 3. Allowing these rules in a concrete execution engine would require an
algorithm for generating concrete instances for such variables, satisfying the
given constraints; thus the <code>unboundVariables</code> attribute serves two purposes:</p>
<ul>
<li>to allow such rules to pass the variable checks, and</li>
<li>to signal (concrete execution) backends that specialized algorithm would be
needed to instantiate these variables.</li>
</ul>
<h4 id="example%3A-fresh-integer-construct-fresh(is)">Example: Fresh Integer Construct <code>fresh(Is)</code></h4>
<p>The fresh integer construct <code>fresh(Is)</code> is a language construct.</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>Exp ::= ... | "fresh" "(" List{Int} ")"
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>The intended semantics of <code>fresh(Is)</code> is that it can always rewrite to an
integer that in not in <code>Is</code>.</p>
<p>Note that <code>fresh(Is)</code> and <code>randNotInList(Is)</code> are different; the former
does not <em>need</em> to be able to rewrite to every integers not in <code>Is</code>,
while the latter requires so.</p>
<p>For example, it is <em>correct</em> to implement <code>fresh(Is)</code> so it always returns the
smallest positive integer that is not in <code>Is</code>, but same implementation for
<code>randNotInList(Is)</code> might be considered <em>inadequate</em>.
In other words, there exist multiple correct implementations of <code>fresh(Is)</code>,
some of which may be deterministic, but there only exists a unique
implementation of <code>randNotInList(Is)</code>.
Finally, note that <code>randNotInList(Is)</code> is a <em>correct</em> implementation
for <code>fresh(Is)</code>; Hence, concrete execution engines can choose to handle
such rules accordingly.</p>
<p>We use the following K syntax to define <code>fresh(Is)</code></p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> fresh <span class="token punctuation">(</span>List<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">rule</span> fresh<span class="token punctuation">(</span>Is<span class="token punctuation">:</span>List<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">?</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span>
  ensures notBool <span class="token punctuation">(</span><span class="token operator">?</span>I inList<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">}</span> Is<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>A variant of this would be a <code>choiceInList(Is)</code> language construct which would
choose some number from a list:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> choiceInList <span class="token punctuation">(</span>List<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">rule</span> choiceInList<span class="token punctuation">(</span>Is<span class="token punctuation">:</span>List<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">?</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span>
  ensures <span class="token operator">?</span>I inList<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">}</span> Is
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Note: This definition is different from one using a <code>!</code> variable to indicate
freshness because using <code>!</code> is just syntactic sugar for generating globally
unique instances and relies on a special configuration cell, and cannot be
constrained, while the <code>fresh</code> described here is local and can be constrained.
While the first is more appropriate for concrete execution, this might be
better for symbolic execution / program verification.</p>
<h4 id="example%3A-arbitrary-number-(unspecific-function)-arb()">Example: Arbitrary Number (Unspecific Function) <code>arb()</code></h4>
<p>The function <code>arb()</code> is not a PL construct, but a mathematical function.
Therefore, its definition should not be interpreted as an execution step, but
rather as an equality.</p>
<p>The intended semantics of <code>arb()</code> is that it is an unspecified nullary function.
The exact return value of <code>arb()</code> is unspecified in the semantics but up to the
implementations.
However, being a mathematical function, <code>arb()</code> must return the same value in
any one implementation.</p>
<p>We do not need special frontend syntax to define <code>arb()</code>.
We only need to define it in the usual way as a function
(instead of a language construct), and provide no axioms for it.
The <code>total</code> attribute ensures that the function is total, i.e.,
that it evaluates to precisely one value for each input.</p>
<h5 id="variants">Variants</h5>
<p>There are many variants of <code>arb()</code>. For example, <code>arbInList(Is)</code> is
an unspecified function whose return value must be an element from <code>Is</code>.</p>
<p>Note that <code>arbInList(Is)</code> is different from <code>choiceInList(Is)</code>, because
<code>choiceInList(Is)</code> <em>transitions</em> to an integer in <code>Is</code> (could be a different one
each time it is used), while <code>arbInList(Is)</code> <em>is equal to</em> a (fixed)
integer not in <code>Is</code>.</p>
<p>W.r.t. the <code>arb</code> variants, we can use <code>?</code> variables and the <code>function</code>
annotation to signal that we're defining a function and the value of the
function is fixed, but non-determinate.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> arbInList<span class="token punctuation">(</span>List<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
<span class="token keyword">rule</span> arbInList<span class="token punctuation">(</span>Is<span class="token punctuation">:</span>List<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">?</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span>
  ensures <span class="token operator">?</span>I inList<span class="token punctuation">{</span><span class="token keyword">Int</span><span class="token punctuation">}</span> Is
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>If elimination of existentials in equational rules is needed, one possible
approach would be through <a href="https://en.wikipedia.org/wiki/Skolem_normal_form" target="_blank" rel="noreferrer noopener">Skolemization</a>,
i.e., replacing the <code>?</code> variable with a new uninterpreted function depending
on the regular variables present in the function.</p>
<h4 id="example%3A-interval-(non-function-symbols)-interval()">Example: Interval (Non-function Symbols) <code>interval()</code></h4>
<p>The symbol <code>interval(M,N)</code> is not a PL construct, nor a function in the
first-order sense, but a proper matching-logic symbol, whose interpretation is
in the powerset of its domain.
Its axioms will not use rewrites but equalities.</p>
<p>The intended semantics of <code>interval(M,N)</code> is that it equals the <em>set</em> of
integers that are larger than or equal to <code>M</code> and smaller than or equal to <code>N</code>.</p>
<p>Since expressing the axiom for <code>interval</code> requires an an existential
quantification on the right-hand-side, thus making it a non-total symbol
defined through an equation, using <code>?</code> variables might be confusing since their
usage would be different from that presented in the previous sections.</p>
<p>Hence, the proposal to support this would be to write this as a proper ML rule.
A possible syntax for this purpose would be:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>eq  interval(M,N)
    ==
    #Exists X:Int .
        (X:Int #And { X &gt;=Int M #Equals true } #And { X &lt;=Int N #Equals true })
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Additionally, the symbol declaration would require a special attribute to
signal the fact that it is not a constructor but a <em>defined</em> symbol.</p>
<p>Since this feature is not clearly needed by K users at the moment, it is only
presented here as an example; its implementation will be postponed for such time
when its usefulness becomes apparent.</p>
<h2 id="parser-generation">Parser Generation</h2>
<p>In addition to on-the-fly parser generation using <code>kast</code>, K is capable of
ahead-of-time parser generation of LR(1) or GLR parsers using Flex and Bison.
This can be done one of two different ways.</p>
<ol>
<li>You can explicitly request for a particular parser to be generated by
invoking <code>kast --gen-parser &lt;outputFile&gt;</code> or
<code>kast --gen-glr-parser &lt;outputFile&gt;</code> respectively. <code>kast</code> will then create a
parser based on the same command line flags that govern on-the-fly parsing,
like <code>-s</code> to specify the starting sort, and <code>-m</code> to specify the module to
parse under. By default, this generates a parser for the sort of the <code>$PGM</code>
configuration variable in the main syntax module of the definition.</li>
<li>You can request that a specific set of parsers be generated for all the
configuration variables of your definition by passing the
<code>--gen-bison-parser</code> or <code>--gen-glr-bison-parser</code> flags to <code>kompile</code>.
<code>kompile</code> will decide the sorts to use as start symbols based on the sorts
in the configuration declaration for the configuration variables. The <code>$PGM</code>
configuration variable will be generated based on the main syntax module
of the definition. The user must explicitly annotate the configuration
declaration with the other modules to use to parse the other configuration
variables as attributes. For example, if I have the following cell in the
configuration declaration: <code>&lt;cell&gt; foo($FOO:Foo, $BAR:Bar) &lt;/cell&gt;</code>,
One might annotate it with the attribute pair <code>parser="FOO, TEST; BAR, TEST2"</code>
to indicate that configuration variable <code>$FOO</code> should be parsed in the
<code>TEST</code> module, and configuration variable <code>$BAR</code> should be parsed in the
<code>TEST2</code> module. If the user forgets to annotate the declaration with the
parser attribute, only the <code>$PGM</code> parser will be generated.</li>
</ol>
<p>Bison-generated parsers are extremely fast compared to <code>kast</code>, but they have
some important limitations:</p>
<ul>
<li>Bison parsers will always output Kore. You can then pass the resulting AST
directly to <code>llvm-krun</code> or <code>kore-exec</code> and bypass the <code>krun</code> frontend, making
them very fast, but lower-level.</li>
<li>Bison parsers do not yet support macros. This may change in a future release.
Note that you can use anywhere rules instead of macros in most cases to get
around this limitation, although they will not benefit from unparsing via the
<code>alias</code> attribute.</li>
<li>Obligation falls on the user to ensure that the grammar they write is LR(1)
if they choose to use LR(1) parsing. If this does not happen, the parser
generated will have shift/reduce or reduce/reduce conflicts and the parser
may behave differently than <code>kast</code> would (<code>kast</code> is a GLL parser, ie, it
is based on LL parsers and parses all unambiguous context-free grammars).
K provides an attribute, <code>not-lr1</code>, which can be applied to modules known to
not be LR(1), and will trigger a warning if the user attempts to generate an
LR(1) parser which recursively imports that module.</li>
<li>If you are using LR(1) based parsing, the <code>prefer</code> and <code>avoid</code> attributes are
ignored. It is only possible to implement these attributes by means of
generalized LL or LR parsing and a postprocessing on the AST to remove the
undesirable ambiguity.</li>
<li>Obligation falls on the user to ensure that the grammar they write has as
few conflicts as possible if they are using GLR parsing. Bison's GLR support
is quite primitive, and in the worst case it can use exponential space and
time to parse a program, which generally leads the generated parser to report
"memory exhausted", indicating that the parse could not be completed within
the stack space allocated by Bison. It's best to ensure that the grammar is
as close to LR(1) as possible and only utilizes conflicts where absolutely
necessary. One tool that can be used to facilitate this is to pass
<code>--bison-lists</code> to kompile. This will disable support for the <code>List{Sort}</code>
syntax production, and it will make <code>NeList{Sort}</code> left associative, but the
resulting productions generated for <code>NeList{Sort}</code> will be LR(1) and use bounded
stack space.</li>
<li>If the grammar you are parsing is context-sensitive (for example, because
it requires a symbol table to parse), one thing you can do to make this
language parse in K is to implement the language as an ambiguous grammar.
Bison's GLR parser will generate an <code>amb</code> production that is parametric in
the sort of the ambiguity. You can then import the <code>K-AMBIGUITIES</code> module
and use rewriting to resolve the ambiguities using whatever preprocessing
mechanisms you prefer.</li>
</ul>
<h2 id="location-information">Location Information</h2>
<p>K is able to insert file, line, and column metadata into the parse tree on a
per-sort basis when parsing using a bison-generated parser. To enable this,
mark the sort with the <code>locations</code> attribute.</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">  <span class="token keyword">syntax</span> Exp <span class="token punctuation">[</span>locations<span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exp <span class="token string">"/"</span> Exp <span class="token operator">|</span> <span class="token keyword">Int</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>K implicitly wraps productions of these sorts in a <code>#location</code> term (see the
<code>K-LOCATIONS</code> module in <code>kast.md</code>). The metadata can thus be accessed with
ordinary rewrite rules:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k">  <span class="token keyword">rule</span> #location<span class="token punctuation">(</span>_ <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">,</span> File<span class="token punctuation">,</span> StartLine<span class="token punctuation">,</span> _StartColumn<span class="token punctuation">,</span> _EndLine<span class="token punctuation">,</span> _EndColumn<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token string">"Error: Division by zero at "</span> <span class="token operator">+</span><span class="token keyword">String</span> File <span class="token operator">+</span><span class="token keyword">String</span> <span class="token string">":"</span> Int2String<span class="token punctuation">(</span>StartLine<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Sometimes it is desirable to allow code to be written in a file which
overwrites the current location information provided by the parser. This can be
done via a combination of the <code>#LineMarker</code> sort and the <code>--bison-file</code> flag to
the parser generator. If you declare a production of sort <code>#LineMarker</code> which
contains a regular expression terminal, this will be treated as a
<strong>line marker</strong> by the bison parser. The user will then be expected to provide
an implementation of the parser for the line marker in C. The function expected
by the parser has the signature <code>void line_marker(char *, yyscan_t)</code>, where
<code>yyscan_t</code> is a
<a href="https://westes.github.io/flex/manual/Reentrant.html" target="_blank" rel="noreferrer noopener">reentrant flex scanner</a>.
The string value of the line marker token as specified by your regular
expression can be found in the first parameter of the function, and you can
set the line number used by the scanner using <code>yyset_lineno(int, yyscan_t)</code>. If
you declare the variable <code>extern char *filename</code>, you can also set the current
file name by writing a malloc'd, zero-terminated string to that variable.</p>
<h2 id="unparsing">Unparsing</h2>
<p>A number of factors go into how terms are unparsed in K. Here we describe some
of the features the user can use to control how unparsing happens.</p>
<h3 id="brackets">Brackets</h3>
<p>One of the phases that the unparser goes through is to insert productions
tagged with the <code>bracket</code> attribute where it believes this is necessary
in order to create a correct string that will be parsed back into the original
AST. The most common case of this is in expression grammars. For example,
consider the following grammar:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span>
             <span class="token operator">|</span> Exp <span class="token string">"*"</span> Exp
             &gt; Exp <span class="token string">"+"</span> Exp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Here we have declared that expressions can contain integer addition and
multiplication, and that multiplication binds tighter than addition. As a
result, when writing a program, if we want to write an expression that first
applies addition, then multiplication, we must use brackets: <code>(1 + 2) * 3</code>.
Similarly, if we have such an AST, we must <strong>insert</strong> brackets into the AST
in order to faithfully unparse the term in a manner that will be parsed back
into the same ast, because if we do not, we end up unparsing the term as
<code>1 + 2 * 3</code>, which will be parsed back as <code>1 + (2 * 3)</code> because of the priority
declaration in the grammar.</p>
<p>You can control how the unparser will insert such brackets by adding a
production with the <code>bracket</code> attribute and the correct sort. For example, if,
instead of parentheses, you want to use curly braces, you could write:</p>
<pre style="position: relative; padding-top: 32px; counter-reset: linenumber 0;" class="line-numbers language-line-numbers" data-start="1"><div class="code-block-selectors">k</div><code class="language-k"><span class="token keyword">syntax</span> Exp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"{"</span> Exp <span class="token string">"}"</span> <span class="token punctuation">[</span><span class="token class-name">bracket</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This would signal to the unparser how brackets should look for terms of sort
<code>Exp</code>, and it will use this syntax when unparsing terms of sort <code>Exp</code>.</p>
<h3 id="commutative-collections">Commutative collections</h3>
<p>One thing that K will do (unless you pass the <code>--no-sort-collections</code> flag to
krun) is to sort associative, commutative collections (such as <code>Set</code> and <code>Map</code>)
alphanumerically. For example, if I have a collection whose keys are sort <code>Id</code>
and they have the values a, b, c, and d, then unparsing will always print
first the key a, then b, then c, then d, because this is the alphabetic order
of these keys when unparsed.</p>
<p>Furthermore, K will sort numeric keys numerically. For example, if I have a
collection whose keys are <code>1, 2, 5, 10, 30</code>, it will first display 1, then 2,
then 5, then 10, then 30, because it will sort these keys numerically. Note
that this is different than an alphabetic sort, which would sort them as
<code>1, 10, 2, 30, 5</code>. We believe the former is more intuitive to users.</p>
<h3 id="substitution-filtering">Substitution filtering</h3>
<p>K will remove substitution terms corresponding to anonymous variables when
using the <code>--pattern</code> flag if those anonymous variables provide no information
about the named variables in your serach pattern. You can disable this behavior
by passing <code>--no-substitution-filtering</code> to krun. When this flag is not passed,
and you are using the Haskell backend, any equality in a substitution (ie, an
<code>#Equals</code> under an <code>#And</code> under an <code>#Or</code>), will be hidden from the user if the
left hand side is a variable that was anonymous in the <code>--pattern</code> passed by
the user, unless that variable appears elsewhere in the substitution. If you
want to see that variable in the substitution, you can either disable this
filtering, or give that variable a name in the original search pattern.</p>
<h3 id="variable-alpha-renaming">Variable alpha renaming</h3>
<p>K will automatically rename variables that appear in the output configuration.
Similar to commutative collections, this is done to <strong>normalize</strong> the resulting
configuration so that equivalent configurations will be printed identically
regardless of how they happen to be reached. This pass can be disabled by
passing <code>--no-alpha-renaming</code> to krun.</p>
<h3 id="macro-expansion">Macro expansion</h3>
<p>K will apply macros in reverse on the output configuration if the macro was
created with the <code>alias</code> or <code>alias-rec</code> attribute. See the section on macro
expansion for more details.</p>
<h3 id="formatting">Formatting</h3>
<h4 id="format-attribute"><code>format</code> attribute</h4>
<p>K allows you to control how terms are unparsed using the <code>format</code> attribute.
By default, a domain value is unparsed by printing its string value verbatim,
and an application pattern is unparsed by printing its terminals and children
in the sequence implied by its concrete syntax, separated by spaces. However,
K gives you complete control over how you want to unparse the symbol.</p>
<p>A format attribute is a string containing zero or more escape sequences that
tell K how to unparse the symbol. Escape sequences begin with a '%' and are
followed by either an integer, or a single non-digit character. Below is a
list of escape sequences recognized by the formatter:</p>
<table class="table">
<thead>
<tr>
<th>Escape Sequence</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>Insert '\n' followed by the current indentation level</td>
</tr>
<tr>
<td>i</td>
<td>Increase the current indentation level by 1</td>
</tr>
<tr>
<td>d</td>
<td>Decrease the current indentation level by 1</td>
</tr>
<tr>
<td>c</td>
<td>Move to the next color in the list of colors for this production</td>
</tr>
<tr>
<td>r</td>
<td>Reset color to the default foreground color for the terminal (See below for more information on how colors work)</td>
</tr>
<tr>
<td>an integer</td>
<td>Print a terminal or nonterminal from the production (See below for more information)</td>
</tr>
<tr>
<td>any other char</td>
<td>Print that character verbatim</td>
</tr>
</tbody>
</table>
<h4 id="using-the-integer-escape-sequence">Using the integer escape sequence</h4>
<p>In the integer escape sequence <code>%a</code>, the integer <code>a</code> is treated as a 1-based
index into the terminals and nonterminals of the production.</p>
<ul>
<li>
<p>If the offset refers to a terminal, move to the next color in the list of
colors for this production, print the value of that terminal, then reset the
color to the default foreground color for the terminal.</p>
</li>
<li>
<p>If the offset refers to a regular expression terminal, it is an error.</p>
</li>
<li>
<p>If the offset refers to a nonterminal, print the unparsed representation of
the corresponding child of the current term.</p>
</li>
</ul>
<h4 id="color-and-colors-attributes"><code>color</code> and <code>colors</code> attributes</h4>
<p>K allows you to take advantage of ANSI terminal codes for foreground color
in order to colorize output pretty-printed by the unparser. This is controlled
via the <code>color</code> and <code>colors</code> attributes of productions. These attributes
combine with the <code>format</code> attribute to control how a term is colorized.</p>
<p>The first thing to understand about how colorization works is that the <code>color</code>
and <code>colors</code> attributes are used to construct a <strong>list</strong> of colors associated
with each production, and the format attribute then uses that list to choose
the color for each part of the production. For more information on how the
format attribute chooses a color from the list, see above, but essentially,
each terminal or <code>%c</code> in the format attribute advances the pointer in the list
by one element, and terminals and <code>%r</code> reset the current color to the default
foreground color of the terminal afterwards.</p>
<p>There are two ways you can construct a list of colors associated with a
production:</p>
<ul>
<li>
<p>The <code>color</code> attribute creates the entire list all with the same color, as
specified by the value of the attribute. When combined with the default format
attribute, this will color all the terminals in that production that color, but
more advanced techniques can be used as well.</p>
</li>
<li>
<p>The <code>colors</code> attribute creates the list from a manual, comma-separated list
of colors. The attribute is invalid if the length of the list is not equal to
the number of terminals in the production plus the number of <code>%c</code> substrings in
the <code>format</code> attribute.</p>
</li>
</ul>
<h2 id="attributes-reference">Attributes Reference</h2>
<h3 id="attribute-syntax-overview">Attribute Syntax Overview</h3>
<p>In K, many different syntactic categories accept an optional trailing list of
keywords known as <em>attributes</em>. Attribute lists have two different syntaxes,
depending on where they occur. Each attribute also has a type which describes
where it may occur.</p>
<p>The first syntax is a square-bracketed (<code>[]</code>) list of words. This syntax is
available for following attribute types:</p>
<ol>
<li><code>module</code> attributes - may appear immediately after the <code>module</code> keyword</li>
<li><code>sort</code> attributes - may appear immediately after a sort declaration</li>
<li><code>production</code> attributes - may appear immediately after a BNF production
alternative</li>
<li><code>rule</code> attributes - may appear immediately after a rule</li>
<li><code>context</code> attributes - may appear immediately after a context or context
alias</li>
<li><code>context alias</code> attributes - may appear immediately after a context alias</li>
<li><code>claim</code> attributes - may appear immediately after a claim</li>
</ol>
<p>The second syntax is the XML attribute syntax, i.e., a space delemited list of
key-and-quoted-value pairs appearing inside the start tag of an XML element:
<code>&lt;element key1="value" key2="value2" ... &gt; &lt;/element&gt;</code>. This syntax is
available for the following attribute types:</p>
<ol>
<li><code>cell</code> attributes - may appear inside of the cell start tag in
configuration declarations</li>
</ol>
<p>Unrecognized attributes are reported as an error. When we talk about
the <em>type</em> of an attribute, we mean a syntactic category to which an attribute
can be attached where the attribute has some semantic effect.</p>
<h3 id="attribute-index">Attribute Index</h3>
<p>We now provide an index of available attributes organized alphabetically with a
brief description of each. Note that the same attribute may appear in the index
multiple times to indicate its effect in different contexts or with/without
arguments. A legend describing how to interpret the index follows.</p>
<table class="table">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Backend</th>
<th>Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>alias-rec</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#macros-and-aliases">Macros and Aliases</a></td>
</tr>
<tr>
<td><code>alias</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#macros-and-aliases">Macros and Aliases</a></td>
</tr>
<tr>
<td><code>all-path</code></td>
<td>claim</td>
<td>haskell</td>
<td><a href="#all-path-and-one-path-attributes-to-distinguish-reachability-claims"><code>all-path</code> and <code>one-path</code> attributes to distinguish reachability claims</a></td>
</tr>
<tr>
<td><code>anywhere</code></td>
<td>rule</td>
<td>all</td>
<td><a href="#anywhere-rules"><code>anywhere</code> rules</a></td>
</tr>
<tr>
<td><code>applyPriority(_)</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#symbol-priority-and-associativity">Symbol priority and associativity</a></td>
</tr>
<tr>
<td><code>avoid</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#symbol-priority-and-associativity">Symbol priority and associativity</a></td>
</tr>
<tr>
<td><code>binder</code></td>
<td>prod</td>
<td>all</td>
<td>No reference yet.</td>
</tr>
<tr>
<td><code>bracket</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#parametric-productions-and-bracket-attributes">Parametric productions and <code>bracket</code> attributes</a></td>
</tr>
<tr>
<td><code>color(_)</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#color-and-colors-attributes"><code>color</code> and <code>colors</code> attributes</a></td>
</tr>
<tr>
<td><code>colors(_)</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#color-and-colors-attributes"><code>color</code> and <code>colors</code> attributes</a></td>
</tr>
<tr>
<td><code>concrete</code></td>
<td>mod</td>
<td>llvm</td>
<td><a href="#symbolic-and-concrete-attribute"><code>symbolic</code> and <code>concrete</code> attribute</a></td>
</tr>
<tr>
<td><code>concrete(_)</code></td>
<td>rule</td>
<td>haskell</td>
<td><a href="#concrete-and-symbolic-attributes-haskell-backend"><code>concrete</code> and <code>symbolic</code> attributes (Haskell backend)</a></td>
</tr>
<tr>
<td><code>concrete</code></td>
<td>rule</td>
<td>haskell</td>
<td><a href="#concrete-and-symbolic-attributes-haskell-backend"><code>concrete</code> and <code>symbolic</code> attributes (Haskell backend)</a></td>
</tr>
<tr>
<td><code>context(_)</code></td>
<td>alias</td>
<td>all</td>
<td><a href="#context-aliases">Context aliases</a></td>
</tr>
<tr>
<td><code>deprecated</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#deprecated-attribute"><code>deprecated</code> attribute</a></td>
</tr>
<tr>
<td><code>exit = ""</code></td>
<td>cell</td>
<td>all</td>
<td><a href="#exit-attribute"><code>exit</code> attribute</a></td>
</tr>
<tr>
<td><code>format</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#format-attribute"><code>format</code> attribute</a></td>
</tr>
<tr>
<td><code>freshGenerator</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#freshgenerator-attribute"><code>freshGenerator</code> attribute</a></td>
</tr>
<tr>
<td><code>function</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#function-and-total-attributes"><code>function</code> and <code>total</code> attributes</a></td>
</tr>
<tr>
<td><code>group(_)</code></td>
<td>all</td>
<td>all</td>
<td><a href="#symbol-priority-and-associativity">Symbol priority and associativity</a></td>
</tr>
<tr>
<td><code>hook(_)</code></td>
<td>prod</td>
<td>all</td>
<td>No reference yet</td>
</tr>
<tr>
<td><code>hybrid(_)</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#hybrid-attribute"><code>hybrid</code> attribute</a></td>
</tr>
<tr>
<td><code>hybrid</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#hybrid-attribute"><code>hybrid</code> attribute</a></td>
</tr>
<tr>
<td><code>klabel(_)</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#klabel_-and-symbol-attributes"><code>klabel(_)</code> and <code>symbol</code> attributes</a></td>
</tr>
<tr>
<td><code>left</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#symbol-priority-and-associativity">Symbol priority and associativity</a></td>
</tr>
<tr>
<td><code>locations</code></td>
<td>sort</td>
<td>all</td>
<td><a href="#location-information">Location Information</a></td>
</tr>
<tr>
<td><code>macro-rec</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#macros-and-aliases">Macros and Aliases</a></td>
</tr>
<tr>
<td><code>macro</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#macros-and-aliases">Macros and Aliases</a></td>
</tr>
<tr>
<td><code>memo</code></td>
<td>rule</td>
<td>haskell</td>
<td><a href="#the-memo-attribute">The <code>memo</code> attribute</a></td>
</tr>
<tr>
<td><code>multiplicity = "_"</code></td>
<td>cell</td>
<td>all</td>
<td><a href="#collection-cells-multiplicity-and-type-attributes">Collection Cells: <code>multiplicity</code> and <code>type</code> attributes</a></td>
</tr>
<tr>
<td><code>non-assoc</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#symbol-priority-and-associativity">Symbol priority and associativity</a></td>
</tr>
<tr>
<td><code>one-path</code></td>
<td>claim</td>
<td>haskell</td>
<td><a href="#all-path-and-one-path-attributes-to-distinguish-reachability-claims"><code>all-path</code> and <code>one-path</code> attributes to distinguish reachability claims</a></td>
</tr>
<tr>
<td><code>overload(_)</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#overload-attribute"><code>overload(_)</code> attribute</a></td>
</tr>
<tr>
<td><code>owise</code></td>
<td>rule</td>
<td>all</td>
<td><a href="#owise-and-priority-attributes"><code>owise</code> and <code>priority</code> attributes</a></td>
</tr>
<tr>
<td><code>prec(_)</code></td>
<td>token</td>
<td>all</td>
<td><a href="#prec-attribute"><code>prec</code> attribute</a></td>
</tr>
<tr>
<td><code>prefer</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#symbol-priority-and-associativity">Symbol priority and associativity</a></td>
</tr>
<tr>
<td><code>priority(_)</code></td>
<td>rule</td>
<td>all</td>
<td><a href="#owise-and-priority-attributes"><code>owise</code> and <code>priority</code> attributes</a></td>
</tr>
<tr>
<td><code>private</code></td>
<td>mod</td>
<td>all</td>
<td><a href="#private-attribute"><code>private</code> attribute</a></td>
</tr>
<tr>
<td><code>private</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#public-and-private-attribute"><code>public</code> and <code>private</code> attribute</a></td>
</tr>
<tr>
<td><code>public</code></td>
<td>mod</td>
<td>all</td>
<td>No reference yet.</td>
</tr>
<tr>
<td><code>public</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#public-and-private-attribute"><code>public</code> and <code>private</code> attribute</a></td>
</tr>
<tr>
<td><code>result(_)</code></td>
<td>ctxt</td>
<td>all</td>
<td><a href="#result-attribute"><code>result</code> attribute</a></td>
</tr>
<tr>
<td><code>result(_)</code></td>
<td>rule</td>
<td>all</td>
<td><a href="#result-attribute"><code>result</code> attribute</a></td>
</tr>
<tr>
<td><code>right</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#symbol-priority-and-associativity">Symbol priority and associativity</a></td>
</tr>
<tr>
<td><code>seqstrict(_)</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#strict-and-seqstrict-attributes"><code>strict</code> and <code>seqstrict</code> attributes</a></td>
</tr>
<tr>
<td><code>seqstrict</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#strict-and-seqstrict-attributes"><code>strict</code> and <code>seqstrict</code> attributes</a></td>
</tr>
<tr>
<td><code>simplification</code></td>
<td>rule</td>
<td>haskell</td>
<td><a href="#simplification-attribute-haskell-backend"><code>simplification</code> attribute (Haskell backend)</a></td>
</tr>
<tr>
<td><code>simplification(_)</code></td>
<td>rule</td>
<td>haskell</td>
<td><a href="#simplification-attribute-haskell-backend"><code>simplification</code> attribute (Haskell backend)</a></td>
</tr>
<tr>
<td><code>smt-hook(_)</code></td>
<td>prod</td>
<td>haskell</td>
<td><a href="#smt-translation">SMT Translation</a></td>
</tr>
<tr>
<td><code>smtlib(_)</code></td>
<td>prod</td>
<td>haskell</td>
<td><a href="#smt-translation">SMT Translation</a></td>
</tr>
<tr>
<td><code>smt-lemma</code></td>
<td>rule</td>
<td>haskell</td>
<td><a href="#smt-translation">SMT Translation</a></td>
</tr>
<tr>
<td><code>strict</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#strict-and-seqstrict-attributes"><code>strict</code> and <code>seqstrict</code> attributes</a></td>
</tr>
<tr>
<td><code>strict(_)</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#strict-and-seqstrict-attributes"><code>strict</code> and <code>seqstrict</code> attributes</a></td>
</tr>
<tr>
<td><code>symbolic</code></td>
<td>mod</td>
<td>haskell</td>
<td><a href="#symbolic-and-concrete-attribute"><code>symbolic</code> and <code>concrete</code> attribute</a></td>
</tr>
<tr>
<td><code>symbolic</code></td>
<td>rule</td>
<td>haskell</td>
<td><a href="#concrete-and-symbolic-attributes-haskell-backend"><code>concrete</code> and <code>symbolic</code> attributes (Haskell backend)</a></td>
</tr>
<tr>
<td><code>symbolic(_)</code></td>
<td>rule</td>
<td>haskell</td>
<td><a href="#concrete-and-symbolic-attributes-haskell-backend"><code>concrete</code> and <code>symbolic</code> attributes (Haskell backend)</a></td>
</tr>
<tr>
<td><code>symbol</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#klabel_-and-symbol-attributes"><code>klabel(_)</code> and <code>symbol</code> attributes</a></td>
</tr>
<tr>
<td><code>terminator-symbol(_)</code></td>
<td>prod</td>
<td>all</td>
<td><a href="https://github.com/runtimeverification/k/tree/master/..."><code>klabel(_)</code> and <code>symbol</code> attributes</a></td>
</tr>
<tr>
<td><code>token</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#token-attribute"><code>token</code> attribute</a></td>
</tr>
<tr>
<td><code>token</code></td>
<td>sort</td>
<td>all</td>
<td><a href="#token-attribute"><code>token</code> attribute</a></td>
</tr>
<tr>
<td><code>total</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#function-and-total-attributes"><code>function</code> and <code>total</code> attributes</a></td>
</tr>
<tr>
<td><code>trusted</code></td>
<td>claim</td>
<td>haskell</td>
<td><a href="#trusted-claims"><code>trusted</code> attribute</a></td>
</tr>
<tr>
<td><code>type = "_"</code></td>
<td>cell</td>
<td>all</td>
<td><a href="#collection-cells-multiplicity-and-type-attributes">Collection Cells: <code>multiplicity</code> and <code>type</code> attributes</a></td>
</tr>
<tr>
<td><code>unboundVariables(_)</code></td>
<td>rule</td>
<td>all</td>
<td><a href="#the-unboundvariables-attribute">The <code>unboundVariables</code> attribute</a></td>
</tr>
<tr>
<td><code>unused</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#unused-attribute"><code>unused</code> attribute</a></td>
</tr>
<tr>
<td><code>concrete</code></td>
<td>mod</td>
<td>all</td>
<td>Specify that this module should only be included in concrete backends (LLVM backend).</td>
</tr>
<tr>
<td><code>symbolic</code></td>
<td>mod</td>
<td>all</td>
<td>Specify that this module should only be included in symbolic backends (Haskell backend).</td>
</tr>
<tr>
<td><code>stream = "_"</code></td>
<td>cell</td>
<td>all</td>
<td>Specify that this cell should be hooked up to a stream, either <code>stdin</code>, <code>stdout</code>, or <code>stderr</code>.</td>
</tr>
</tbody>
</table>
<h3 id="internal-attribute-index">Internal Attribute Index</h3>
<p>Some attributes should not generally appear in user code, except in some
unusual or complex examples. Such attributes are typically generated by the
compiler and used internally. We list these attributes below as a reference for
interested readers:</p>
<table class="table">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Backend</th>
<th>Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>assoc</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#assoc-comm-idem-and-unit-attributes"><code>assoc</code>, <code>comm</code>, <code>idem</code> and <code>unit</code> attributes</a></td>
</tr>
<tr>
<td><code>comm</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#assoc-comm-idem-and-unit-attributes"><code>assoc</code>, <code>comm</code>, <code>idem</code> and <code>unit</code> attributes</a></td>
</tr>
<tr>
<td><code>digest</code></td>
<td>mod</td>
<td>all</td>
<td>Contains the hash of the textual contents of the module.</td>
</tr>
<tr>
<td><code>idem</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#assoc-comm-idem-and-unit-attributes"><code>assoc</code>, <code>comm</code>, <code>idem</code> and <code>unit</code> attributes</a></td>
</tr>
<tr>
<td><code>unit</code></td>
<td>prod</td>
<td>all</td>
<td><a href="#assoc-comm-idem-and-unit-attributes"><code>assoc</code>, <code>comm</code>, <code>idem</code> and <code>unit</code> attributes</a></td>
</tr>
<tr>
<td><code>userList</code></td>
<td>prod</td>
<td>all</td>
<td>Identifies the desugared form of <code>Lst ::= List{Elm,"delim"}</code></td>
</tr>
<tr>
<td><code>predicate</code></td>
<td>prod</td>
<td>all</td>
<td>Specifies the sort of a predicate label</td>
</tr>
<tr>
<td><code>element</code></td>
<td>prod</td>
<td>all</td>
<td>Specifies the label of the elements in a list</td>
</tr>
<tr>
<td><code>bracketLabel</code></td>
<td>prod</td>
<td>all</td>
<td>Keep track of the label of a bracket production since it can't have a klabel</td>
</tr>
<tr>
<td><code>injective</code></td>
<td>prod</td>
<td>all</td>
<td>Label a given production as injective (unique output for each input)</td>
</tr>
<tr>
<td><code>internal</code></td>
<td>prod</td>
<td>all</td>
<td>Production is reserved for internal use by the compiler</td>
</tr>
<tr>
<td><code>cool</code></td>
<td>rule</td>
<td>all</td>
<td><a href="#strict-and-seqstrict-attributes"><code>strict</code> and <code>seqstrict</code> attributes</a></td>
</tr>
<tr>
<td><code>heat</code></td>
<td>rule</td>
<td>all</td>
<td><a href="#strict-and-seqstrict-attributes"><code>strict</code> and <code>seqstrict</code> attributes</a></td>
</tr>
</tbody>
</table>
<h3 id="index-legend">Index Legend</h3>
<ul>
<li>
<p><code>Name</code> - the attribute's name (optionally followed by an underscore <code>_</code> to indicate the attribute takes arguments)</p>
</li>
<li>
<p><code>Type</code> - the syntactic categories where this attribute is <em>not</em> ignored;
the possible values are the types mentioned above or shorthands:</p>
<ol>
<li><code>all</code> - short for any type except <code>cell</code></li>
<li><code>mod</code> - short for <code>module</code></li>
<li><code>sort</code></li>
<li><code>prod</code> - short for <code>production</code></li>
<li><code>rule</code></li>
<li><code>ctxt</code> - short for <code>context</code> or <code>context alias</code></li>
<li><code>claim</code></li>
<li><code>cell</code></li>
</ol>
</li>
<li>
<p><code>Backend</code> - the backends that do <em>not</em> ignore this attribute; possible values:</p>
<ol>
<li><code>all</code> - all backends</li>
<li><code>llvm</code> - the LLVM backend</li>
<li><code>haskell</code> - the Haskell backend</li>
</ol>
</li>
<li>
<p><code>Effect</code> - the attribute's effect (when it applies)</p>
</li>
</ul>
<h2 id="pending-documentation">Pending Documentation</h2>
<p>Backend features not yet given documentation:</p>
<ul>
<li>Parser of KORE terms and definitions</li>
<li>Term representation of K terms</li>
<li>Hooked sorts and symbols</li>
<li>Substituting a substitution into the RHS of a rule
<ul>
<li>domain values</li>
<li>functions</li>
<li>variables</li>
<li>symbols</li>
<li>polymorphism</li>
<li>hooks</li>
<li>injection compaction</li>
<li>overload compaction</li>
</ul>
</li>
<li>Pattern Matching / Unification of subject and LHS of rule
<ul>
<li>domain values</li>
<li>symbols</li>
<li>side conditions</li>
<li>and/or patterns</li>
<li>list patterns</li>
<li>nonlinear variables</li>
<li>map/set patterns
<ul>
<li>deterministic</li>
<li>nondeterministic</li>
</ul>
</li>
<li>modulo injections</li>
<li>modulo overloads</li>
</ul>
</li>
<li>Stepping
<ul>
<li>initialization</li>
<li>termination</li>
</ul>
</li>
<li>Print kore terms</li>
<li>Equality/comparison of terms</li>
<li>Owise rules</li>
<li>Strategy #STUCK axiom</li>
<li>User substitution
<ul>
<li>binders</li>
<li>kvar</li>
</ul>
</li>
</ul>
<p>To get a complete list of hooks supported by K, you can run:</p>
<pre class="line-numbers language-line-numbers" data-start="1" style="counter-reset: linenumber 0;"><code>grep -P -R "(?&lt;=[^-])hook\([^)]*\)" k-distribution/include/kframework/builtin/ \
     --include "*.k" -ho | \
sed 's/hook(//' | sed 's/)//' | sort | uniq | grep -v org.kframework
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>All of these hooks will also eventually need documentation.</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>Except for in a very limited number of special cases from the
K standard library. <a href="#fnref1" class="footnote-backref"></a></p>
</li>
<li id="fn2" class="footnote-item"><p>The <a href="https://maude.lcc.uma.es/maude-manual/maude-manualch3.html#x15-310003.6" target="_blank" rel="noreferrer noopener">Maude documentation</a>
has an example in a context that's somewhat similar to K; discussion of
<em>ad-hoc</em> overloading is not relevant. <a href="#fnref2" class="footnote-backref"></a></p>
</li>
</ol>
</section>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<details style="padding:0.25rem 0;;padding-left: 0px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#k-user-manual" class="bd-toc-link">K User Manual</a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#introduction" class="bd-toc-link">Introduction</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#why-k%3F"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Why K?
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#manual-objectives"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Manual Objectives
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#introduction-to-k" class="bd-toc-link">Introduction to K</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#k-process-overview"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                K Process Overview
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#module-declaration" class="bd-toc-link">Module Declaration</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#private-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>private</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#symbolic-and-concrete-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>symbolic</code> and <code>concrete</code> attribute
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#syntax-declaration" class="bd-toc-link">Syntax Declaration</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#named-non-terminals"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Named Non-Terminals
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#symbol(_)-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>symbol(_)</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#overload-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>overload</code> attribute
              </a></div><details style="padding:0.25rem 0;;padding-left: 16px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#klabel(_)-and-symbol-attributes" class="bd-toc-link"><code>klabel(_)</code> and <code>symbol</code> attributes</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#syntactic-lists"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Syntactic Lists
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#parametric-productions-and-bracket-attributes"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Parametric productions and <code>bracket</code> attributes
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#function-and-total-attributes"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>function</code> and <code>total</code> attributes
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#freshgenerator-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>freshGenerator</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#token-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>token</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#converting-between-%5Btoken%5D-sorts"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Converting between <code>[token]</code> sorts
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#parsing-comments%2C-and-the-%23layout-sort"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Parsing comments, and the <code>#Layout</code> sort
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#prec-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>prec</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#unused-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>unused</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#deprecated-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>deprecated</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#symbol-priority-and-associativity"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Symbol priority and associativity
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#lexical-identifiers"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Lexical identifiers
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#assoc%2C-comm%2C-idem%2C-and-unit-attributes"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>assoc</code>, <code>comm</code>, <code>idem</code>, and <code>unit</code> attributes
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#public-and-private-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>public</code> and <code>private</code> attribute
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#configuration-declaration" class="bd-toc-link">Configuration Declaration</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#exit-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>exit</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#collection-cells%3A-multiplicity-and-type-attributes"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Collection Cells: <code>multiplicity</code> and <code>type</code> attributes
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#rule-declaration" class="bd-toc-link">Rule Declaration</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#rule-structure"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Rule Structure
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#pattern-matching-operator"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Pattern Matching operator
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#anonymous-function-applications"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Anonymous function applications
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#macros-and-aliases"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Macros and Aliases
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#anywhere-rules"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>anywhere</code> rules
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#trusted-claims"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>trusted</code> claims
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#projection-and-predicate-functions"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Projection and Predicate functions
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#simplification-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>simplification</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#concrete-and-symbolic-attributes-(haskell-backend)"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>concrete</code> and <code>symbolic</code> attributes (Haskell backend)
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#the-unboundvariables-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                The <code>unboundVariables</code> attribute
              </a></div><details style="padding:0.25rem 0;;padding-left: 16px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#the-memo-attribute" class="bd-toc-link">The <code>memo</code> attribute</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#limitations-of-memoization-with-the-haskell-backend"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Limitations of memoization with the Haskell backend
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#variable-sort-inference"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Variable Sort Inference
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#casting"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Casting
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#semantic-casts"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Semantic casts
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#strict-casts"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Strict casts
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#projection-casts"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Projection casts
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#owise-and-priority-attributes."
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>owise</code> and <code>priority</code> attributes.
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#evaluation-strategy" class="bd-toc-link">Evaluation Strategy</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#strict-and-seqstrict-attributes"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>strict</code> and <code>seqstrict</code> attributes
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#context-declaration"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Context Declaration
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#side-conditions-in-context-declarations"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Side conditions in context declarations
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#rewrites-in-context-declarations"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Rewrites in context declarations
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#result-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>result</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#hybrid-attribute"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>hybrid</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#context-aliases"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Context aliases
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#pattern-matching" class="bd-toc-link">Pattern Matching</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#as-patterns"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                As Patterns
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#record-like-kapply-patterns"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Record-like KApply Patterns
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#or-patterns"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Or Patterns
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#matching-global-context-in-function-rules"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Matching global context in function rules
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#collection-patterns"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Collection patterns
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#matching-on-cell-fragments"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Matching on cell fragments
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#all-path-and-one-path-attributes-to-distinguish-reachability-claims"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                <code>all-path</code> and <code>one-path</code> attributes to distinguish reachability claims
              </a></div><details style="padding:0.25rem 0;;padding-left: 16px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#set-variables" class="bd-toc-link">Set Variables</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#motivation"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Motivation
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#syntax"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Syntax
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#example"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Example
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#smt-translation"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                SMT Translation
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#caution"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Caution
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 16px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#variables-occurring-only-in-the-rhs-of-a-rule" class="bd-toc-link">Variables occurring only in the RHS of a rule</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#summary"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Summary
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#introduction-1"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Introduction
              </a></div><details style="padding:0.25rem 0;;padding-left: 24px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#example%3A-verification-claims" class="bd-toc-link">Example: Verification claims</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#one-path-interpretation"
                class="bd-toc-link"
                style="padding-left: 32px;;"
              >
                One-path interpretation
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#all-path-interpretation"
                class="bd-toc-link"
                style="padding-left: 32px;;"
              >
                All-path interpretation
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 24px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#example%3A-random-number-construct-rand()" class="bd-toc-link">Example: Random Number Construct <code>rand()</code></a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#rand-like-examples"
                class="bd-toc-link"
                style="padding-left: 32px;;"
              >
                Rand-like examples
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#example%3A-fresh-integer-construct-fresh(is)"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Example: Fresh Integer Construct <code>fresh(Is)</code>
              </a></div><details style="padding:0.25rem 0;;padding-left: 24px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#example%3A-arbitrary-number-(unspecific-function)-arb()" class="bd-toc-link">Example: Arbitrary Number (Unspecific Function) <code>arb()</code></a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#variants"
                class="bd-toc-link"
                style="padding-left: 32px;;"
              >
                Variants
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#example%3A-interval-(non-function-symbols)-interval()"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Example: Interval (Non-function Symbols) <code>interval()</code>
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#parser-generation"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Parser Generation
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#location-information"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Location Information
              </a></div><details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#unparsing" class="bd-toc-link">Unparsing</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#brackets"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Brackets
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#commutative-collections"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Commutative collections
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#substitution-filtering"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Substitution filtering
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#variable-alpha-renaming"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Variable alpha renaming
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#macro-expansion"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Macro expansion
              </a></div><details style="padding:0.25rem 0;;padding-left: 16px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#formatting" class="bd-toc-link">Formatting</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#format-attribute"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>format</code> attribute
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#using-the-integer-escape-sequence"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Using the integer escape sequence
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#color-and-colors-attributes"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                <code>color</code> and <code>colors</code> attributes
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#attributes-reference" class="bd-toc-link">Attributes Reference</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#attribute-syntax-overview"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Attribute Syntax Overview
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#attribute-index"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Attribute Index
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#internal-attribute-index"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Internal Attribute Index
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#index-legend"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Index Legend
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#pending-documentation"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Pending Documentation
              </a></div>
            </div>
          </details>
        
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://maps.app.goo.gl/8YhKozfmZtgzQBsH7" target="_blank"
            >202 S Broadway Ave #31, Urbana, IL</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 pl-0 text-md-right">
        <p class="copyright">2026  all rights reserved</p>
        <span class="copyright"
          ><a href="https://runtimeverification.com/privacy-policy"
            >privacy policy</a
          >
          |
          <a href="https://runtimeverification.com/terms-of-use"
            >terms of use</a
          ></span
        >
      </div>
    </div>
  </div>
</footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../assets/js/index.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9LBGDMRG32"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9LBGDMRG32");
    </script>
  </body>
</html>
